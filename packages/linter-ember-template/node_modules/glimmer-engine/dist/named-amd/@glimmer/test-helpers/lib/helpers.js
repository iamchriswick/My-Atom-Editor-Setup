enifed("@glimmer/test-helpers/lib/helpers", ["exports", "simple-html-tokenizer", "@glimmer/runtime", "@glimmer/compiler"], function (exports, _simpleHtmlTokenizer, _glimmerRuntime, _glimmerCompiler) {
    "use strict";

    exports.compile = compile;
    exports.compileLayout = compileLayout;
    exports.equalInnerHTML = equalInnerHTML;
    exports.equalHTML = equalHTML;
    exports.equalTokens = equalTokens;
    exports.generateSnapshot = generateSnapshot;
    exports.equalSnapshots = equalSnapshots;
    exports.normalizeInnerHTML = normalizeInnerHTML;
    exports.getTextContent = getTextContent;
    exports.strip = strip;
    exports.stripTight = stripTight;
    exports.trimLines = trimLines;

    // For Phantom
    function toObject(val) {
        if (val === null || val === undefined) {
            throw new TypeError('Object.assign cannot be called with null or undefined');
        }
        return Object(val);
    }
    if (typeof Object.assign !== 'function') {
        Object.assign = function (target, source) {
            var from = undefined;
            var to = toObject(target);
            var symbols = undefined;
            for (var s = 1; s < arguments.length; s++) {
                from = Object(arguments[s]);
                for (var key in from) {
                    if (Object.prototype.hasOwnProperty.call(from, key)) {
                        to[key] = from[key];
                    }
                }
                if (Object.getOwnPropertySymbols) {
                    symbols = Object.getOwnPropertySymbols(from);
                    for (var i = 0; i < symbols.length; i++) {
                        if (Object.prototype.propertyIsEnumerable.call(from, symbols[i])) {
                            to[symbols[i]] = from[symbols[i]];
                        }
                    }
                }
            }
            return to;
        };
    }
    var assign = Object.assign;
    exports.assign = assign;
    function isMarker(node) {
        var TextNode = window.Text;
        var Comment = window.Comment;
        if (node instanceof Comment && node.textContent === '') {
            return true;
        }
        if (node instanceof TextNode && node.textContent === '') {
            return true;
        }
        return false;
    }

    function compile(string, options) {
        var js = _glimmerCompiler.precompile(string, options);
        var factory = _glimmerRuntime.templateFactory(JSON.parse(js));
        return factory.create(options.env);
    }

    function compileLayout(string, options) {
        return compile(string, options).asLayout();
    }

    function equalInnerHTML(fragment, html, msg) {
        var actualHTML = normalizeInnerHTML(fragment.innerHTML);
        QUnit.push(actualHTML === html, actualHTML, html, msg);
    }

    function equalHTML(node, html) {
        var fragment = undefined;
        if (!node.nodeType && node.length) {
            fragment = document.createDocumentFragment();
            while (node[0]) {
                fragment.appendChild(node[0]);
            }
        } else {
            fragment = node;
        }
        var div = document.createElement("div");
        div.appendChild(fragment.cloneNode(true));
        equalInnerHTML(div, html);
    }

    function generateTokens(divOrHTML) {
        var div = undefined;
        if (typeof divOrHTML === 'string') {
            div = document.createElement("div");
            div.innerHTML = divOrHTML;
        } else {
            div = divOrHTML;
        }
        return { tokens: _simpleHtmlTokenizer.tokenize(div.innerHTML), html: div.innerHTML };
    }

    function equalTokens(fragment, html) {
        var message = arguments.length <= 2 || arguments[2] === undefined ? null : arguments[2];

        if (fragment.fragment) {
            fragment = fragment.fragment;
        }
        if (html.fragment) {
            html = html.fragment;
        }
        var fragTokens = generateTokens(fragment);
        var htmlTokens = generateTokens(html);
        function normalizeTokens(token) {
            if (token.type === 'StartTag') {
                token.attributes = token.attributes.sort(function (a, b) {
                    if (a[0] > b[0]) {
                        return 1;
                    }
                    if (a[0] < b[0]) {
                        return -1;
                    }
                    return 0;
                });
            }
        }
        fragTokens.tokens.forEach(normalizeTokens);
        htmlTokens.tokens.forEach(normalizeTokens);
        // let msg = "Expected: " + htmlTokens.html + "; Actual: " + fragTokens.html;
        // if (message) { msg += " (" + message + ")"; }
        var equiv = QUnit.equiv(fragTokens.tokens, htmlTokens.tokens);
        if (equiv && fragTokens.html !== htmlTokens.html) {
            QUnit.deepEqual(fragTokens.tokens, htmlTokens.tokens, message);
        } else {
            QUnit.push(QUnit.equiv(fragTokens.tokens, htmlTokens.tokens), fragTokens.html, htmlTokens.html, message);
        }
        // deepEqual(fragTokens.tokens, htmlTokens.tokens, msg);
    }

    function generateSnapshot(element) {
        var snapshot = [];
        var node = element.firstChild;
        while (node) {
            if (!isMarker(node)) {
                snapshot.push(node);
            }
            node = node.nextSibling;
        }
        return snapshot;
    }

    function equalSnapshots(a, b) {
        QUnit.strictEqual(a.length, b.length, 'Same number of nodes');
        for (var i = 0; i < b.length; i++) {
            QUnit.strictEqual(a[i], b[i], 'Nodes are the same');
        }
    }

    // detect side-effects of cloning svg elements in IE9-11
    var ieSVGInnerHTML = (function () {
        if (typeof document === 'undefined' || !document.createElementNS) {
            return false;
        }
        var div = document.createElement('div');
        var node = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        div.appendChild(node);
        var clone = div.cloneNode(true);
        return clone.innerHTML === '<svg xmlns="http://www.w3.org/2000/svg" />';
    })();

    function normalizeInnerHTML(actualHTML) {
        if (ieSVGInnerHTML) {
            // Replace `<svg xmlns="http://www.w3.org/2000/svg" height="50%" />` with `<svg height="50%"></svg>`, etc.
            // drop namespace attribute
            actualHTML = actualHTML.replace(/ xmlns="[^"]+"/, '');
            // replace self-closing elements
            actualHTML = actualHTML.replace(/<([^ >]+) [^\/>]*\/>/gi, function (tag, tagName) {
                return tag.slice(0, tag.length - 3) + '></' + tagName + '>';
            });
        }
        return actualHTML;
    }

    var isCheckedInputHTML = undefined;
    if (typeof document === 'undefined') {
        exports.isCheckedInputHTML = isCheckedInputHTML = function (element) {};
    } else {
        (function () {
            // detect weird IE8 checked element string
            var checkedInput = document.createElement('input');
            checkedInput.setAttribute('checked', 'checked');
            var checkedInputString = checkedInput.outerHTML;
            exports.isCheckedInputHTML = isCheckedInputHTML = function (element) {
                QUnit.equal(element.outerHTML, checkedInputString);
            };
        })();
    }
    exports.isCheckedInputHTML = isCheckedInputHTML;

    // check which property has the node's text content
    var textProperty = typeof document === 'object' && document.createElement('div').textContent === undefined ? 'innerText' : 'textContent';

    function getTextContent(el) {
        // textNode
        if (el.nodeType === 3) {
            return el.nodeValue;
        } else {
            return el[textProperty];
        }
    }

    function strip(strings) {
        return strings[0].split('\n').map(function (s) {
            return s.trim();
        }).join(' ');
    }

    function stripTight(strings) {
        return strings[0].split('\n').map(function (s) {
            return s.trim();
        }).join('');
    }

    function trimLines(strings) {
        return strings[0].trim().split('\n').map(function (s) {
            return s.trim();
        }).join('\n');
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL3Rlc3QtaGVscGVycy9saWIvaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUtBLGFBQUEsUUFBQSxDQUFrQixHQUFHLEVBQUE7QUFDbkIsWUFBSSxHQUFHLEtBQUssSUFBSSxJQUFJLEdBQUcsS0FBSyxTQUFTLEVBQUU7QUFDckMsa0JBQU0sSUFBSSxTQUFTLENBQUMsdURBQXVELENBQUMsQ0FBQztTQUM5RTtBQUVELGVBQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ3BCO0FBRUQsUUFBSSxPQUFPLE1BQU0sQ0FBQyxNQUFNLEtBQUssVUFBVSxFQUFFO0FBQ3ZDLGNBQU0sQ0FBQyxNQUFNLEdBQUcsVUFBUyxNQUFNLEVBQUUsTUFBTSxFQUFBO0FBQ3JDLGdCQUFJLElBQUksWUFBQSxDQUFDO0FBQ1QsZ0JBQUksRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUMxQixnQkFBSSxPQUFPLFlBQUEsQ0FBQztBQUVaLGlCQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUN6QyxvQkFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUU1QixxQkFBSyxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUU7QUFDcEIsd0JBQUksTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRTtBQUNuRCwwQkFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztxQkFDckI7aUJBQ0Y7QUFFRCxvQkFBSSxNQUFNLENBQUMscUJBQXFCLEVBQUU7QUFDaEMsMkJBQU8sR0FBRyxNQUFNLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDN0MseUJBQUssSUFBSSxD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Q0FBQyxVQUFBLENBQUM7bUJBQUksQ0FBQyxDQUFDLElBQUksRUFBRTtTQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7S0FDNUQ7O0FBRUssYUFBQSxVQUFBLENBQXFCLE9BQTZCLEVBQUE7QUFDdEQsZUFBTyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUM7bUJBQUksQ0FBQyxDQUFDLElBQUksRUFBRTtTQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDM0Q7O0FBRUssYUFBQSxTQUFBLENBQW9CLE9BQTZCLEVBQUE7QUFDckQsZUFBTyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUM7bUJBQUksQ0FBQyxDQUFDLElBQUksRUFBRTtTQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDcEUiLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHRva2VuaXplIH0gZnJvbSBcInNpbXBsZS1odG1sLXRva2VuaXplclwiO1xuaW1wb3J0IHsgRW52aXJvbm1lbnQsIFRlbXBsYXRlLCBMYXlvdXQsIHRlbXBsYXRlRmFjdG9yeSB9IGZyb20gXCJAZ2xpbW1lci9ydW50aW1lXCI7XG5pbXBvcnQgeyBwcmVjb21waWxlLCBQcmVjb21waWxlT3B0aW9ucyB9IGZyb20gXCJAZ2xpbW1lci9jb21waWxlclwiO1xuXG4vLyBGb3IgUGhhbnRvbVxuZnVuY3Rpb24gdG9PYmplY3QodmFsKSB7XG4gIGlmICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3QuYXNzaWduIGNhbm5vdCBiZSBjYWxsZWQgd2l0aCBudWxsIG9yIHVuZGVmaW5lZCcpO1xuICB9XG5cbiAgcmV0dXJuIE9iamVjdCh2YWwpO1xufVxuXG5pZiAodHlwZW9mIE9iamVjdC5hc3NpZ24gIT09ICdmdW5jdGlvbicpIHtcbiAgT2JqZWN0LmFzc2lnbiA9IGZ1bmN0aW9uKHRhcmdldCwgc291cmNlKSB7XG4gICAgbGV0IGZyb207XG4gICAgbGV0IHRvID0gdG9PYmplY3QodGFyZ2V0KTtcbiAgICBsZXQgc3ltYm9scztcblxuICAgIGZvciAobGV0IHMgPSAxOyBzIDwgYXJndW1lbnRzLmxlbmd0aDsgcysrKSB7XG4gICAgICBmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7XG5cbiAgICAgIGZvciAobGV0IGtleSBpbiBmcm9tKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZnJvbSwga2V5KSkge1xuICAgICAgICAgIHRvW2tleV0gPSBmcm9tW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcbiAgICAgICAgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3ltYm9scy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoZnJvbSwgc3ltYm9sc1tpXSkpIHtcbiAgICAgICAgICAgIHRvW3N5bWJvbHNbaV1dID0gZnJvbVtzeW1ib2xzW2ldXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdG87XG4gIH07XG59XG5cbmV4cG9ydCBjb25zdCBhc3NpZ24gPSBPYmplY3QuYXNzaWduO1xuXG5mdW5jdGlvbiBpc01hcmtlcihub2RlKSB7XG4gIGNvbnN0IFRleHROb2RlID0gKDxhbnk+d2luZG93KS5UZXh0O1xuICBjb25zdCBDb21tZW50ID0gKDxhbnk+d2luZG93KS5Db21tZW50O1xuXG4gIGlmIChub2RlIGluc3RhbmNlb2YgQ29tbWVudCAmJiBub2RlLnRleHRDb250ZW50ID09PSAnJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaWYgKG5vZGUgaW5zdGFuY2VvZiBUZXh0Tm9kZSAmJiBub2RlLnRleHRDb250ZW50ID09PSAnJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRlc3RDb21waWxlT3B0aW9uczxUPiBleHRlbmRzIFByZWNvbXBpbGVPcHRpb25zPFQ+IHtcbiAgZW52OiBFbnZpcm9ubWVudDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBpbGU8VD4oc3RyaW5nOiBzdHJpbmcsIG9wdGlvbnM6IFRlc3RDb21waWxlT3B0aW9uczxUPik6IFRlbXBsYXRlPFQ+IHtcbiAgbGV0IGpzID0gcHJlY29tcGlsZShzdHJpbmcsIG9wdGlvbnMpO1xuICBsZXQgZmFjdG9yeSA9IHRlbXBsYXRlRmFjdG9yeTxUPihKU09OLnBhcnNlKGpzKSk7XG4gIHJldHVybiBmYWN0b3J5LmNyZWF0ZShvcHRpb25zLmVudik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21waWxlTGF5b3V0PFQ+KHN0cmluZzogc3RyaW5nLCBvcHRpb25zOiBUZXN0Q29tcGlsZU9wdGlvbnM8VD4pOiBMYXlvdXQge1xuICByZXR1cm4gY29tcGlsZShzdHJpbmcsIG9wdGlvbnMpLmFzTGF5b3V0KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbElubmVySFRNTChmcmFnbWVudCwgaHRtbCwgbXNnPykge1xuICBsZXQgYWN0dWFsSFRNTCA9IG5vcm1hbGl6ZUlubmVySFRNTChmcmFnbWVudC5pbm5lckhUTUwpO1xuICBRVW5pdC5wdXNoKGFjdHVhbEhUTUwgPT09IGh0bWwsIGFjdHVhbEhUTUwsIGh0bWwsIG1zZyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbEhUTUwobm9kZSwgaHRtbCkge1xuICBsZXQgZnJhZ21lbnQ7XG4gIGlmICghbm9kZS5ub2RlVHlwZSAmJiBub2RlLmxlbmd0aCkge1xuICAgIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHdoaWxlIChub2RlWzBdKSB7XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChub2RlWzBdKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZnJhZ21lbnQgPSBub2RlO1xuICB9XG5cbiAgbGV0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGRpdi5hcHBlbmRDaGlsZChmcmFnbWVudC5jbG9uZU5vZGUodHJ1ZSkpO1xuXG4gIGVxdWFsSW5uZXJIVE1MKGRpdiwgaHRtbCk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVG9rZW5zKGRpdk9ySFRNTCkge1xuICBsZXQgZGl2O1xuICBpZiAodHlwZW9mIGRpdk9ySFRNTCA9PT0gJ3N0cmluZycpIHtcbiAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGRpdi5pbm5lckhUTUwgPSBkaXZPckhUTUw7XG4gIH0gZWxzZSB7XG4gICAgZGl2ID0gZGl2T3JIVE1MO1xuICB9XG5cbiAgcmV0dXJuIHsgdG9rZW5zOiB0b2tlbml6ZShkaXYuaW5uZXJIVE1MKSwgaHRtbDogZGl2LmlubmVySFRNTCB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXF1YWxUb2tlbnMoZnJhZ21lbnQsIGh0bWwsIG1lc3NhZ2U9bnVsbCkge1xuICBpZiAoZnJhZ21lbnQuZnJhZ21lbnQpIHsgZnJhZ21lbnQgPSBmcmFnbWVudC5mcmFnbWVudDsgfVxuICBpZiAoaHRtbC5mcmFnbWVudCkgeyBodG1sID0gaHRtbC5mcmFnbWVudDsgfVxuXG4gIGxldCBmcmFnVG9rZW5zID0gZ2VuZXJhdGVUb2tlbnMoZnJhZ21lbnQpO1xuICBsZXQgaHRtbFRva2VucyA9IGdlbmVyYXRlVG9rZW5zKGh0bWwpO1xuXG4gIGZ1bmN0aW9uIG5vcm1hbGl6ZVRva2Vucyh0b2tlbikge1xuICAgIGlmICh0b2tlbi50eXBlID09PSAnU3RhcnRUYWcnKSB7XG4gICAgICB0b2tlbi5hdHRyaWJ1dGVzID0gdG9rZW4uYXR0cmlidXRlcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgaWYgKGFbMF0gPiBiWzBdKSB7IHJldHVybiAxOyB9XG4gICAgICAgIGlmIChhWzBdIDwgYlswXSkgeyByZXR1cm4gLTE7IH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBmcmFnVG9rZW5zLnRva2Vucy5mb3JFYWNoKG5vcm1hbGl6ZVRva2Vucyk7XG4gIGh0bWxUb2tlbnMudG9rZW5zLmZvckVhY2gobm9ybWFsaXplVG9rZW5zKTtcblxuICAvLyBsZXQgbXNnID0gXCJFeHBlY3RlZDogXCIgKyBodG1sVG9rZW5zLmh0bWwgKyBcIjsgQWN0dWFsOiBcIiArIGZyYWdUb2tlbnMuaHRtbDtcblxuICAvLyBpZiAobWVzc2FnZSkgeyBtc2cgKz0gXCIgKFwiICsgbWVzc2FnZSArIFwiKVwiOyB9XG5cbiAgbGV0IGVxdWl2ID0gUVVuaXQuZXF1aXYoZnJhZ1Rva2Vucy50b2tlbnMsIGh0bWxUb2tlbnMudG9rZW5zKTtcblxuICBpZiAoZXF1aXYgJiYgZnJhZ1Rva2Vucy5odG1sICE9PSBodG1sVG9rZW5zLmh0bWwpIHtcbiAgICBRVW5pdC5kZWVwRXF1YWwoZnJhZ1Rva2Vucy50b2tlbnMsIGh0bWxUb2tlbnMudG9rZW5zLCBtZXNzYWdlKTtcbiAgfSBlbHNlIHtcbiAgICBRVW5pdC5wdXNoKFFVbml0LmVxdWl2KGZyYWdUb2tlbnMudG9rZW5zLCBodG1sVG9rZW5zLnRva2VucyksIGZyYWdUb2tlbnMuaHRtbCwgaHRtbFRva2Vucy5odG1sLCBtZXNzYWdlKTtcbiAgfVxuXG4gIC8vIGRlZXBFcXVhbChmcmFnVG9rZW5zLnRva2VucywgaHRtbFRva2Vucy50b2tlbnMsIG1zZyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNuYXBzaG90KGVsZW1lbnQpIHtcbiAgbGV0IHNuYXBzaG90ID0gW107XG4gIGxldCBub2RlID0gZWxlbWVudC5maXJzdENoaWxkO1xuXG4gIHdoaWxlIChub2RlKSB7XG4gICAgaWYgKCFpc01hcmtlcihub2RlKSkge1xuICAgICAgc25hcHNob3QucHVzaChub2RlKTtcbiAgICB9XG4gICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XG4gIH1cblxuICByZXR1cm4gc25hcHNob3Q7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbFNuYXBzaG90cyhhLCBiKSB7XG4gIFFVbml0LnN0cmljdEVxdWFsKGEubGVuZ3RoLCBiLmxlbmd0aCwgJ1NhbWUgbnVtYmVyIG9mIG5vZGVzJyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYi5sZW5ndGg7IGkrKykge1xuICAgIFFVbml0LnN0cmljdEVxdWFsKGFbaV0sIGJbaV0sICdOb2RlcyBhcmUgdGhlIHNhbWUnKTtcbiAgfVxufVxuXG4vLyBkZXRlY3Qgc2lkZS1lZmZlY3RzIG9mIGNsb25pbmcgc3ZnIGVsZW1lbnRzIGluIElFOS0xMVxubGV0IGllU1ZHSW5uZXJIVE1MID0gKGZ1bmN0aW9uICgpIHtcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgfHwgIWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGxldCBub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgZGl2LmFwcGVuZENoaWxkKG5vZGUpO1xuICBsZXQgY2xvbmUgPSA8SFRNTERpdkVsZW1lbnQ+ZGl2LmNsb25lTm9kZSh0cnVlKTtcbiAgcmV0dXJuIGNsb25lLmlubmVySFRNTCA9PT0gJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIC8+Jztcbn0pKCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVJbm5lckhUTUwoYWN0dWFsSFRNTCkge1xuICBpZiAoaWVTVkdJbm5lckhUTUwpIHtcbiAgICAvLyBSZXBsYWNlIGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiBoZWlnaHQ9XCI1MCVcIiAvPmAgd2l0aCBgPHN2ZyBoZWlnaHQ9XCI1MCVcIj48L3N2Zz5gLCBldGMuXG4gICAgLy8gZHJvcCBuYW1lc3BhY2UgYXR0cmlidXRlXG4gICAgYWN0dWFsSFRNTCA9IGFjdHVhbEhUTUwucmVwbGFjZSgvIHhtbG5zPVwiW15cIl0rXCIvLCAnJyk7XG4gICAgLy8gcmVwbGFjZSBzZWxmLWNsb3NpbmcgZWxlbWVudHNcbiAgICBhY3R1YWxIVE1MID0gYWN0dWFsSFRNTC5yZXBsYWNlKC88KFteID5dKykgW15cXC8+XSpcXC8+L2dpLCBmdW5jdGlvbih0YWcsIHRhZ05hbWUpIHtcbiAgICAgIHJldHVybiB0YWcuc2xpY2UoMCwgdGFnLmxlbmd0aCAtIDMpICsgJz48LycgKyB0YWdOYW1lICsgJz4nO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGFjdHVhbEhUTUw7XG59XG5cbmxldCBpc0NoZWNrZWRJbnB1dEhUTUw7XG5cbmlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7XG4gIGlzQ2hlY2tlZElucHV0SFRNTCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgfTtcbn0gZWxzZSB7XG4gIC8vIGRldGVjdCB3ZWlyZCBJRTggY2hlY2tlZCBlbGVtZW50IHN0cmluZ1xuICBsZXQgY2hlY2tlZElucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgY2hlY2tlZElucHV0LnNldEF0dHJpYnV0ZSgnY2hlY2tlZCcsICdjaGVja2VkJyk7XG4gIGxldCBjaGVja2VkSW5wdXRTdHJpbmcgPSBjaGVja2VkSW5wdXQub3V0ZXJIVE1MO1xuXG4gIGlzQ2hlY2tlZElucHV0SFRNTCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBRVW5pdC5lcXVhbChlbGVtZW50Lm91dGVySFRNTCwgY2hlY2tlZElucHV0U3RyaW5nKTtcbiAgfTtcbn1cblxuZXhwb3J0IHsgaXNDaGVja2VkSW5wdXRIVE1MIH07XG5cbi8vIGNoZWNrIHdoaWNoIHByb3BlcnR5IGhhcyB0aGUgbm9kZSdzIHRleHQgY29udGVudFxubGV0IHRleHRQcm9wZXJ0eSA9IHR5cGVvZiBkb2N1bWVudCA9PT0gJ29iamVjdCcgJiYgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykudGV4dENvbnRlbnQgPT09IHVuZGVmaW5lZCA/ICdpbm5lclRleHQnIDogJ3RleHRDb250ZW50JztcbmV4cG9ydCBmdW5jdGlvbiBnZXRUZXh0Q29udGVudChlbCkge1xuICAvLyB0ZXh0Tm9kZVxuICBpZiAoZWwubm9kZVR5cGUgPT09IDMpIHtcbiAgICByZXR1cm4gZWwubm9kZVZhbHVlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBlbFt0ZXh0UHJvcGVydHldO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdHJpcChzdHJpbmdzOiBUZW1wbGF0ZVN0cmluZ3NBcnJheSkge1xuICByZXR1cm4gc3RyaW5nc1swXS5zcGxpdCgnXFxuJykubWFwKHMgPT4gcy50cmltKCkpLmpvaW4oJyAnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmlwVGlnaHQoc3RyaW5nczogVGVtcGxhdGVTdHJpbmdzQXJyYXkpIHtcbiAgcmV0dXJuIHN0cmluZ3NbMF0uc3BsaXQoJ1xcbicpLm1hcChzID0+IHMudHJpbSgpKS5qb2luKCcnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRyaW1MaW5lcyhzdHJpbmdzOiBUZW1wbGF0ZVN0cmluZ3NBcnJheSkge1xuICByZXR1cm4gc3RyaW5nc1swXS50cmltKCkuc3BsaXQoJ1xcbicpLm1hcChzID0+IHMudHJpbSgpKS5qb2luKCdcXG4nKTtcbn1cbiJdfQ==