enifed('@glimmer/runtime/lib/compiled/opcodes/component', ['exports', '@glimmer/runtime/lib/opcodes', '@glimmer/runtime/lib/compiled/opcodes/vm', '@glimmer/runtime/lib/compiled/expressions/args', '@glimmer/reference'], function (exports, _glimmerRuntimeLibOpcodes, _glimmerRuntimeLibCompiledOpcodesVm, _glimmerRuntimeLibCompiledExpressionsArgs, _glimmerReference) {
    'use strict';

    function _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

    function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }

    _glimmerRuntimeLibOpcodes.APPEND_OPCODES.add(_glimmerRuntimeLibOpcodes.OpcodeName.PutDynamicComponent, function (vm) {
        var reference = vm.frame.getOperand();
        var cache = _glimmerReference.isConst(reference) ? undefined : new _glimmerReference.ReferenceCache(reference);
        var definition = cache ? cache.peek() : reference.value();
        vm.frame.setImmediate(definition);
        if (cache) {
            vm.updateWith(new _glimmerRuntimeLibCompiledOpcodesVm.Assert(cache));
        }
    });
    _glimmerRuntimeLibOpcodes.APPEND_OPCODES.add(_glimmerRuntimeLibOpcodes.OpcodeName.PutComponent, function (vm, _ref) {
        var _component = _ref.op1;

        var definition = vm.constants.getOther(_component);
        vm.frame.setImmediate(definition);
    });
    _glimmerRuntimeLibOpcodes.APPEND_OPCODES.add(_glimmerRuntimeLibOpcodes.OpcodeName.OpenComponent, function (vm, _ref2) {
        var _args = _ref2.op1;
        var _shadow = _ref2.op2;

        var rawArgs = vm.constants.getExpression(_args);
        var shadow = vm.constants.getBlock(_shadow);
        var definition = vm.frame.getImmediate();
        var dynamicScope = vm.pushDynamicScope();
        var callerScope = vm.scope();
        var manager = definition.manager;
        var args = manager.prepareArgs(definition, rawArgs.evaluate(vm), dynamicScope);
        var hasDefaultBlock = !!args.blocks.default; // TODO Cleanup?
        var component = manager.create(vm.env, definition, args, dynamicScope, vm.getSelf(), hasDefaultBlock);
        var destructor = manager.getDestructor(component);
        if (destructor) vm.newDestroyable(destructor);
        var layout = manager.layoutFor(definition, component, vm.env);
        var selfRef = manager.getSelf(component);
        vm.beginCacheGroup();
        vm.stack().pushSimpleBlock();
        vm.pushRootScope(selfRef, layout.symbols);
        vm.invokeLayout(args, layout, callerScope, component, manager, shadow);
        vm.updateWith(new UpdateComponentOpcode(definition.name, component, manager, args, dynamicScope));
    });
    // export class DidCreateElementOpcode extends Opcode {
    //   public type = "did-create-element";
    //   evaluate(vm: VM) {
    //     let manager = vm.frame.getManager();
    //     let component = vm.frame.getComponent();
    //     let action = 'DidCreateElementOpcode#evaluate';
    //     manager.didCreateElement(component, vm.stack().expectConstructing(action), vm.stack().expectOperations(action));
    //   }
    //   toJSON(): OpcodeJSON {
    //     return {
    //       guid: this._guid,
    //       type: this.type,
    //       args: ["$ARGS"]
    //     };
    //   }
    // }
    _glimmerRuntimeLibOpcodes.APPEND_OPCODES.add(_glimmerRuntimeLibOpcodes.OpcodeName.DidCreateElement, function (vm) {
        var manager = vm.frame.getManager();
        var component = vm.frame.getComponent();
        var action = 'DidCreateElementOpcode#evaluate';
        manager.didCreateElement(component, vm.stack().expectConstructing(action), vm.stack().expectOperations(action));
    });
    // export class ShadowAttributesOpcode extends Opcode {
    //   public type = "shadow-attributes";
    //   evaluate(vm: VM) {
    //     let shadow = vm.frame.getShadow();
    //     vm.pushCallerScope();
    //     if (!shadow) return;
    //     vm.invokeBlock(shadow, EvaluatedArgs.empty());
    //   }
    //   toJSON(): OpcodeJSON {
    //     return {
    //       guid: this._guid,
    //       type: this.type,
    //       args: ["$ARGS"]
    //     };
    //   }
    // }
    // Slow path for non-specialized component invocations. Uses an internal
    // named lookup on the args.
    _glimmerRuntimeLibOpcodes.APPEND_OPCODES.add(_glimmerRuntimeLibOpcodes.OpcodeName.ShadowAttributes, function (vm) {
        var shadow = vm.frame.getShadow();
        vm.pushCallerScope();
        if (!shadow) return;
        vm.invokeBlock(shadow, _glimmerRuntimeLibCompiledExpressionsArgs.EvaluatedArgs.empty());
    });
    // export class DidRenderLayoutOpcode extends Opcode {
    //   public type = "did-render-layout";
    //   evaluate(vm: VM) {
    //     let manager = vm.frame.getManager();
    //     let component = vm.frame.getComponent();
    //     let bounds = vm.stack().popBlock();
    //     manager.didRenderLayout(component, bounds);
    //     vm.env.didCreate(component, manager);
    //     vm.updateWith(new DidUpdateLayoutOpcode(manager, component, bounds));
    //   }
    // }
    _glimmerRuntimeLibOpcodes.APPEND_OPCODES.add(_glimmerRuntimeLibOpcodes.OpcodeName.DidRenderLayout, function (vm) {
        var manager = vm.frame.getManager();
        var component = vm.frame.getComponent();
        var bounds = vm.stack().popBlock();
        manager.didRenderLayout(component, bounds);
        vm.env.didCreate(component, manager);
        vm.updateWith(new DidUpdateLayoutOpcode(manager, component, bounds));
    });
    // export class CloseComponentOpcode extends Opcode {
    //   public type = "close-component";
    //   evaluate(vm: VM) {
    //     vm.popScope();
    //     vm.popDynamicScope();
    //     vm.commitCacheGroup();
    //   }
    // }
    _glimmerRuntimeLibOpcodes.APPEND_OPCODES.add(_glimmerRuntimeLibOpcodes.OpcodeName.CloseComponent, function (vm) {
        vm.popScope();
        vm.popDynamicScope();
        vm.commitCacheGroup();
    });

    var UpdateComponentOpcode = (function (_UpdatingOpcode) {
        _inherits(UpdateComponentOpcode, _UpdatingOpcode);

        function UpdateComponentOpcode(name, component, manager, args, dynamicScope) {
            _classCallCheck(this, UpdateComponentOpcode);

            _UpdatingOpcode.call(this);
            this.name = name;
            this.component = component;
            this.manager = manager;
            this.args = args;
            this.dynamicScope = dynamicScope;
            this.type = "update-component";
            var componentTag = manager.getTag(component);
            if (componentTag) {
                this.tag = _glimmerReference.combine([args.tag, componentTag]);
            } else {
                this.tag = args.tag;
            }
        }

        UpdateComponentOpcode.prototype.evaluate = function evaluate(_vm) {
            var component = this.component;
            var manager = this.manager;
            var args = this.args;
            var dynamicScope = this.dynamicScope;

            manager.update(component, args, dynamicScope);
        };

        UpdateComponentOpcode.prototype.toJSON = function toJSON() {
            return {
                guid: this._guid,
                type: this.type,
                args: [JSON.stringify(this.name)]
            };
        };

        return UpdateComponentOpcode;
    })(_glimmerRuntimeLibOpcodes.UpdatingOpcode);

    exports.UpdateComponentOpcode = UpdateComponentOpcode;

    var DidUpdateLayoutOpcode = (function (_UpdatingOpcode2) {
        _inherits(DidUpdateLayoutOpcode, _UpdatingOpcode2);

        function DidUpdateLayoutOpcode(manager, component, bounds) {
            _classCallCheck(this, DidUpdateLayoutOpcode);

            _UpdatingOpcode2.call(this);
            this.manager = manager;
            this.component = component;
            this.bounds = bounds;
            this.type = "did-update-layout";
            this.tag = _glimmerReference.CONSTANT_TAG;
        }

        DidUpdateLayoutOpcode.prototype.evaluate = function evaluate(vm) {
            var manager = this.manager;
            var component = this.component;
            var bounds = this.bounds;

            manager.didUpdateLayout(component, bounds);
            vm.env.didUpdate(component, manager);
        };

        return DidUpdateLayoutOpcode;
    })(_glimmerRuntimeLibOpcodes.UpdatingOpcode);

    exports.DidUpdateLayoutOpcode = DidUpdateLayoutOpcode;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL2NvbXBpbGVkL29wY29kZXMvY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQVVBLDhCQUZTLGNBQWMsQ0FFUixHQUFHLENBQUMsMEJBRk0sVUFBVSxDQUViLG1CQUFtQixFQUFFLFVBQUEsRUFBRSxFQUFBO0FBQzNDLFlBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsVUFBVSxFQUFrQyxDQUFDO0FBQ3RFLFlBQUksS0FBSyxHQUFHLGtCQUxrQyxPQUFPLENBS2pDLFNBQVMsQ0FBQyxHQUFHLFNBQVMsR0FBRyxzQkFMeEIsY0FBYyxDQUs2QixTQUFTLENBQUMsQ0FBQztBQUMzRSxZQUFJLFVBQVUsR0FBRyxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksRUFBRSxHQUFHLFNBQVMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztBQUUxRCxVQUFFLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUVsQyxZQUFJLEtBQUssRUFBRTtBQUNULGNBQUUsQ0FBQyxVQUFVLENBQUMsd0NBakJULE1BQU0sQ0FpQmMsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUNsQztLQUNGLENBQUMsQ0FBQztBQUVILDhCQWRTLGNBQWMsQ0FjUixHQUFHLENBQUMsMEJBZE0sVUFBVSxDQWNiLFlBQVksRUFBRSxVQUFDLEVBQUUsRUFBRSxJQUFtQixFQUFBO1lBQVosVUFBVSxHQUFqQixJQUFtQixDQUFqQixHQUFHOztBQUM1QyxZQUFJLFVBQVUsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBaUMsVUFBVSxDQUFDLENBQUM7QUFDbkYsVUFBRSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUM7S0FDbkMsQ0FBQyxDQUFDO0FBRUgsOEJBbkJTLGNBQWMsQ0FtQlIsR0FBRyxDQUFDLDBCQW5CTSxVQUFVLENBbUJiLGFBQWEsRUFBRSxVQUFDLEVBQUUsRUFB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QUksQ0FBQyxLQUFLO0FBQ2hCLG9CQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7QUFDZixvQkFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7YUFDbEMsQ0FBQztTQUNIOztlQWpDRyxxQkFBNkI7aUNBN0pkLGNBQWM7Ozs7UUFpTTdCLHFCQUE2QjtrQkFBN0IscUJBQTZCOztBQUlqQyxpQkFKSSxxQkFBNkIsQ0FLdkIsT0FBb0MsRUFDcEMsU0FBb0IsRUFDcEIsTUFBYyxFQUFBO2tDQVBwQixxQkFBNkI7O0FBUy9CLHVDQUFPLENBQUM7QUFKQSxnQkFBQSxDQUFBLE9BQU8sR0FBUCxPQUFPLENBQTZCO0FBQ3BDLGdCQUFBLENBQUEsU0FBUyxHQUFULFNBQVMsQ0FBVztBQUNwQixnQkFBQSxDQUFBLE1BQU0sR0FBTixNQUFNLENBQVE7QUFOakIsZ0JBQUEsQ0FBQSxJQUFJLEdBQUcsbUJBQW1CLENBQUM7QUFDM0IsZ0JBQUEsQ0FBQSxHQUFHLHFCQTVMSCxZQUFZLEFBNExtQixDQUFDO1NBUXRDOztBQVZHLDZCQUE2QixXQVlqQyxRQUFRLEdBQUEsa0JBQUMsRUFBYyxFQUFBO2dCQUNmLE9BQU8sR0FBd0IsSUFBSSxDQUFuQyxPQUFPO2dCQUFFLFNBQVMsR0FBYSxJQUFJLENBQTFCLFNBQVM7Z0JBQUUsTUFBTSxHQUFLLElBQUksQ0FBZixNQUFNOztBQUVoQyxtQkFBTyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFFM0MsY0FBRSxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQ3RDOztlQWxCRyxxQkFBNkI7aUNBak1kLGNBQWMiLCJmaWxlIjoiY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT3Bjb2RlSlNPTiwgVXBkYXRpbmdPcGNvZGUgfSBmcm9tICcuLi8uLi9vcGNvZGVzJztcbmltcG9ydCB7IEFzc2VydCB9IGZyb20gJy4vdm0nO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBDb21wb25lbnRNYW5hZ2VyLCBDb21wb25lbnREZWZpbml0aW9uIH0gZnJvbSAnLi4vLi4vY29tcG9uZW50L2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgVXBkYXRpbmdWTSB9IGZyb20gJy4uLy4uL3ZtJztcbmltcG9ydCB7IENvbXBpbGVkQXJncywgRXZhbHVhdGVkQXJncyB9IGZyb20gJy4uLy4uL2NvbXBpbGVkL2V4cHJlc3Npb25zL2FyZ3MnO1xuaW1wb3J0IHsgRHluYW1pY1Njb3BlIH0gZnJvbSAnLi4vLi4vZW52aXJvbm1lbnQnO1xuaW1wb3J0IEJvdW5kcyBmcm9tICcuLi8uLi9ib3VuZHMnO1xuaW1wb3J0IHsgQ09OU1RBTlRfVEFHLCBSZWZlcmVuY2VDYWNoZSwgY29tYmluZSwgaXNDb25zdCwgUmV2aXNpb25UYWcgfSBmcm9tICdAZ2xpbW1lci9yZWZlcmVuY2UnO1xuaW1wb3J0IHsgQVBQRU5EX09QQ09ERVMsIE9wY29kZU5hbWUgYXMgT3AgfSBmcm9tICcuLi8uLi9vcGNvZGVzJztcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLlB1dER5bmFtaWNDb21wb25lbnQsIHZtID0+IHtcbiAgbGV0IHJlZmVyZW5jZSA9IHZtLmZyYW1lLmdldE9wZXJhbmQ8Q29tcG9uZW50RGVmaW5pdGlvbjxDb21wb25lbnQ+PigpO1xuICBsZXQgY2FjaGUgPSBpc0NvbnN0KHJlZmVyZW5jZSkgPyB1bmRlZmluZWQgOiBuZXcgUmVmZXJlbmNlQ2FjaGUocmVmZXJlbmNlKTtcbiAgbGV0IGRlZmluaXRpb24gPSBjYWNoZSA/IGNhY2hlLnBlZWsoKSA6IHJlZmVyZW5jZS52YWx1ZSgpO1xuXG4gIHZtLmZyYW1lLnNldEltbWVkaWF0ZShkZWZpbml0aW9uKTtcblxuICBpZiAoY2FjaGUpIHtcbiAgICB2bS51cGRhdGVXaXRoKG5ldyBBc3NlcnQoY2FjaGUpKTtcbiAgfVxufSk7XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5QdXRDb21wb25lbnQsICh2bSwgeyBvcDE6IF9jb21wb25lbnQgfSkgPT4ge1xuICBsZXQgZGVmaW5pdGlvbiA9IHZtLmNvbnN0YW50cy5nZXRPdGhlcjxDb21wb25lbnREZWZpbml0aW9uPENvbXBvbmVudD4+KF9jb21wb25lbnQpO1xuICB2bS5mcmFtZS5zZXRJbW1lZGlhdGUoZGVmaW5pdGlvbik7XG59KTtcblxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLk9wZW5Db21wb25lbnQsICh2bSwgeyBvcDE6IF9hcmdzLCBvcDI6IF9zaGFkb3cgfSkgPT4ge1xuICBsZXQgcmF3QXJncyA9IHZtLmNvbnN0YW50cy5nZXRFeHByZXNzaW9uPENvbXBpbGVkQXJncz4oX2FyZ3MpO1xuICBsZXQgc2hhZG93ID0gdm0uY29uc3RhbnRzLmdldEJsb2NrKF9zaGFkb3cpO1xuXG4gIGxldCBkZWZpbml0aW9uID0gdm0uZnJhbWUuZ2V0SW1tZWRpYXRlPENvbXBvbmVudERlZmluaXRpb248Q29tcG9uZW50Pj4oKTtcbiAgbGV0IGR5bmFtaWNTY29wZSA9IHZtLnB1c2hEeW5hbWljU2NvcGUoKTtcbiAgbGV0IGNhbGxlclNjb3BlID0gdm0uc2NvcGUoKTtcblxuICBsZXQgbWFuYWdlciA9IGRlZmluaXRpb24ubWFuYWdlcjtcbiAgbGV0IGFyZ3MgPSBtYW5hZ2VyLnByZXBhcmVBcmdzKGRlZmluaXRpb24sIHJhd0FyZ3MuZXZhbHVhdGUodm0pLCBkeW5hbWljU2NvcGUpO1xuICBsZXQgaGFzRGVmYXVsdEJsb2NrID0gISFhcmdzLmJsb2Nrcy5kZWZhdWx0OyAvLyBUT0RPIENsZWFudXA/XG4gIGxldCBjb21wb25lbnQgPSBtYW5hZ2VyLmNyZWF0ZSh2bS5lbnYsIGRlZmluaXRpb24sIGFyZ3MsIGR5bmFtaWNTY29wZSwgdm0uZ2V0U2VsZigpLCBoYXNEZWZhdWx0QmxvY2spO1xuICBsZXQgZGVzdHJ1Y3RvciA9IG1hbmFnZXIuZ2V0RGVzdHJ1Y3Rvcihjb21wb25lbnQpO1xuICBpZiAoZGVzdHJ1Y3Rvcikgdm0ubmV3RGVzdHJveWFibGUoZGVzdHJ1Y3Rvcik7XG5cbiAgbGV0IGxheW91dCA9IG1hbmFnZXIubGF5b3V0Rm9yKGRlZmluaXRpb24sIGNvbXBvbmVudCwgdm0uZW52KTtcbiAgbGV0IHNlbGZSZWYgPSBtYW5hZ2VyLmdldFNlbGYoY29tcG9uZW50KTtcblxuICB2bS5iZWdpbkNhY2hlR3JvdXAoKTtcbiAgdm0uc3RhY2soKS5wdXNoU2ltcGxlQmxvY2soKTtcbiAgdm0ucHVzaFJvb3RTY29wZShzZWxmUmVmLCBsYXlvdXQuc3ltYm9scyk7XG4gIHZtLmludm9rZUxheW91dChhcmdzLCBsYXlvdXQsIGNhbGxlclNjb3BlLCBjb21wb25lbnQsIG1hbmFnZXIsIHNoYWRvdyk7XG5cbiAgdm0udXBkYXRlV2l0aChuZXcgVXBkYXRlQ29tcG9uZW50T3Bjb2RlKGRlZmluaXRpb24ubmFtZSwgY29tcG9uZW50LCBtYW5hZ2VyLCBhcmdzLCBkeW5hbWljU2NvcGUpKTtcbn0pO1xuXG4vLyBleHBvcnQgY2xhc3MgRGlkQ3JlYXRlRWxlbWVudE9wY29kZSBleHRlbmRzIE9wY29kZSB7XG4vLyAgIHB1YmxpYyB0eXBlID0gXCJkaWQtY3JlYXRlLWVsZW1lbnRcIjtcblxuLy8gICBldmFsdWF0ZSh2bTogVk0pIHtcbi8vICAgICBsZXQgbWFuYWdlciA9IHZtLmZyYW1lLmdldE1hbmFnZXIoKTtcbi8vICAgICBsZXQgY29tcG9uZW50ID0gdm0uZnJhbWUuZ2V0Q29tcG9uZW50KCk7XG5cbi8vICAgICBsZXQgYWN0aW9uID0gJ0RpZENyZWF0ZUVsZW1lbnRPcGNvZGUjZXZhbHVhdGUnO1xuLy8gICAgIG1hbmFnZXIuZGlkQ3JlYXRlRWxlbWVudChjb21wb25lbnQsIHZtLnN0YWNrKCkuZXhwZWN0Q29uc3RydWN0aW5nKGFjdGlvbiksIHZtLnN0YWNrKCkuZXhwZWN0T3BlcmF0aW9ucyhhY3Rpb24pKTtcbi8vICAgfVxuXG4vLyAgIHRvSlNPTigpOiBPcGNvZGVKU09OIHtcbi8vICAgICByZXR1cm4ge1xuLy8gICAgICAgZ3VpZDogdGhpcy5fZ3VpZCxcbi8vICAgICAgIHR5cGU6IHRoaXMudHlwZSxcbi8vICAgICAgIGFyZ3M6IFtcIiRBUkdTXCJdXG4vLyAgICAgfTtcbi8vICAgfVxuLy8gfVxuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuRGlkQ3JlYXRlRWxlbWVudCwgdm0gPT4ge1xuICBsZXQgbWFuYWdlciA9IHZtLmZyYW1lLmdldE1hbmFnZXIoKTtcbiAgbGV0IGNvbXBvbmVudCA9IHZtLmZyYW1lLmdldENvbXBvbmVudCgpO1xuXG4gIGxldCBhY3Rpb24gPSAnRGlkQ3JlYXRlRWxlbWVudE9wY29kZSNldmFsdWF0ZSc7XG4gIG1hbmFnZXIuZGlkQ3JlYXRlRWxlbWVudChjb21wb25lbnQsIHZtLnN0YWNrKCkuZXhwZWN0Q29uc3RydWN0aW5nKGFjdGlvbiksIHZtLnN0YWNrKCkuZXhwZWN0T3BlcmF0aW9ucyhhY3Rpb24pKTtcbn0pO1xuXG4vLyBleHBvcnQgY2xhc3MgU2hhZG93QXR0cmlidXRlc09wY29kZSBleHRlbmRzIE9wY29kZSB7XG4vLyAgIHB1YmxpYyB0eXBlID0gXCJzaGFkb3ctYXR0cmlidXRlc1wiO1xuXG4vLyAgIGV2YWx1YXRlKHZtOiBWTSkge1xuLy8gICAgIGxldCBzaGFkb3cgPSB2bS5mcmFtZS5nZXRTaGFkb3coKTtcblxuLy8gICAgIHZtLnB1c2hDYWxsZXJTY29wZSgpO1xuLy8gICAgIGlmICghc2hhZG93KSByZXR1cm47XG5cbi8vICAgICB2bS5pbnZva2VCbG9jayhzaGFkb3csIEV2YWx1YXRlZEFyZ3MuZW1wdHkoKSk7XG4vLyAgIH1cblxuLy8gICB0b0pTT04oKTogT3Bjb2RlSlNPTiB7XG4vLyAgICAgcmV0dXJuIHtcbi8vICAgICAgIGd1aWQ6IHRoaXMuX2d1aWQsXG4vLyAgICAgICB0eXBlOiB0aGlzLnR5cGUsXG4vLyAgICAgICBhcmdzOiBbXCIkQVJHU1wiXVxuLy8gICAgIH07XG4vLyAgIH1cbi8vIH1cblxuLy8gU2xvdyBwYXRoIGZvciBub24tc3BlY2lhbGl6ZWQgY29tcG9uZW50IGludm9jYXRpb25zLiBVc2VzIGFuIGludGVybmFsXG4vLyBuYW1lZCBsb29rdXAgb24gdGhlIGFyZ3MuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuU2hhZG93QXR0cmlidXRlcywgdm0gPT4ge1xuICBsZXQgc2hhZG93ID0gdm0uZnJhbWUuZ2V0U2hhZG93KCk7XG5cbiAgdm0ucHVzaENhbGxlclNjb3BlKCk7XG4gIGlmICghc2hhZG93KSByZXR1cm47XG5cbiAgdm0uaW52b2tlQmxvY2soc2hhZG93LCBFdmFsdWF0ZWRBcmdzLmVtcHR5KCkpO1xufSk7XG5cbi8vIGV4cG9ydCBjbGFzcyBEaWRSZW5kZXJMYXlvdXRPcGNvZGUgZXh0ZW5kcyBPcGNvZGUge1xuLy8gICBwdWJsaWMgdHlwZSA9IFwiZGlkLXJlbmRlci1sYXlvdXRcIjtcblxuLy8gICBldmFsdWF0ZSh2bTogVk0pIHtcbi8vICAgICBsZXQgbWFuYWdlciA9IHZtLmZyYW1lLmdldE1hbmFnZXIoKTtcbi8vICAgICBsZXQgY29tcG9uZW50ID0gdm0uZnJhbWUuZ2V0Q29tcG9uZW50KCk7XG4vLyAgICAgbGV0IGJvdW5kcyA9IHZtLnN0YWNrKCkucG9wQmxvY2soKTtcblxuLy8gICAgIG1hbmFnZXIuZGlkUmVuZGVyTGF5b3V0KGNvbXBvbmVudCwgYm91bmRzKTtcblxuLy8gICAgIHZtLmVudi5kaWRDcmVhdGUoY29tcG9uZW50LCBtYW5hZ2VyKTtcblxuLy8gICAgIHZtLnVwZGF0ZVdpdGgobmV3IERpZFVwZGF0ZUxheW91dE9wY29kZShtYW5hZ2VyLCBjb21wb25lbnQsIGJvdW5kcykpO1xuLy8gICB9XG4vLyB9XG5cbkFQUEVORF9PUENPREVTLmFkZChPcC5EaWRSZW5kZXJMYXlvdXQsIHZtID0+IHtcbiAgbGV0IG1hbmFnZXIgPSB2bS5mcmFtZS5nZXRNYW5hZ2VyKCk7XG4gIGxldCBjb21wb25lbnQgPSB2bS5mcmFtZS5nZXRDb21wb25lbnQoKTtcbiAgbGV0IGJvdW5kcyA9IHZtLnN0YWNrKCkucG9wQmxvY2soKTtcblxuICBtYW5hZ2VyLmRpZFJlbmRlckxheW91dChjb21wb25lbnQsIGJvdW5kcyk7XG5cbiAgdm0uZW52LmRpZENyZWF0ZShjb21wb25lbnQsIG1hbmFnZXIpO1xuXG4gIHZtLnVwZGF0ZVdpdGgobmV3IERpZFVwZGF0ZUxheW91dE9wY29kZShtYW5hZ2VyLCBjb21wb25lbnQsIGJvdW5kcykpO1xufSk7XG5cbi8vIGV4cG9ydCBjbGFzcyBDbG9zZUNvbXBvbmVudE9wY29kZSBleHRlbmRzIE9wY29kZSB7XG4vLyAgIHB1YmxpYyB0eXBlID0gXCJjbG9zZS1jb21wb25lbnRcIjtcblxuLy8gICBldmFsdWF0ZSh2bTogVk0pIHtcbi8vICAgICB2bS5wb3BTY29wZSgpO1xuLy8gICAgIHZtLnBvcER5bmFtaWNTY29wZSgpO1xuLy8gICAgIHZtLmNvbW1pdENhY2hlR3JvdXAoKTtcbi8vICAgfVxuLy8gfVxuXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuQ2xvc2VDb21wb25lbnQsIHZtID0+IHtcbiAgdm0ucG9wU2NvcGUoKTtcbiAgdm0ucG9wRHluYW1pY1Njb3BlKCk7XG4gIHZtLmNvbW1pdENhY2hlR3JvdXAoKTtcbn0pO1xuXG5leHBvcnQgY2xhc3MgVXBkYXRlQ29tcG9uZW50T3Bjb2RlIGV4dGVuZHMgVXBkYXRpbmdPcGNvZGUge1xuICBwdWJsaWMgdHlwZSA9IFwidXBkYXRlLWNvbXBvbmVudFwiO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbmFtZTogc3RyaW5nLFxuICAgIHByaXZhdGUgY29tcG9uZW50OiBDb21wb25lbnQsXG4gICAgcHJpdmF0ZSBtYW5hZ2VyOiBDb21wb25lbnRNYW5hZ2VyPENvbXBvbmVudD4sXG4gICAgcHJpdmF0ZSBhcmdzOiBFdmFsdWF0ZWRBcmdzLFxuICAgIHByaXZhdGUgZHluYW1pY1Njb3BlOiBEeW5hbWljU2NvcGUsXG4gICkge1xuICAgIHN1cGVyKCk7XG5cbiAgICBsZXQgY29tcG9uZW50VGFnID0gbWFuYWdlci5nZXRUYWcoY29tcG9uZW50KTtcblxuICAgIGlmIChjb21wb25lbnRUYWcpIHtcbiAgICAgIHRoaXMudGFnID0gY29tYmluZShbYXJncy50YWcsIGNvbXBvbmVudFRhZ10pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnRhZyA9IGFyZ3MudGFnO1xuICAgIH1cbiAgfVxuXG4gIGV2YWx1YXRlKF92bTogVXBkYXRpbmdWTSkge1xuICAgIGxldCB7IGNvbXBvbmVudCwgbWFuYWdlciwgYXJncywgZHluYW1pY1Njb3BlIH0gPSB0aGlzO1xuXG4gICAgbWFuYWdlci51cGRhdGUoY29tcG9uZW50LCBhcmdzLCBkeW5hbWljU2NvcGUpO1xuICB9XG5cbiAgdG9KU09OKCk6IE9wY29kZUpTT04ge1xuICAgIHJldHVybiB7XG4gICAgICBndWlkOiB0aGlzLl9ndWlkLFxuICAgICAgdHlwZTogdGhpcy50eXBlLFxuICAgICAgYXJnczogW0pTT04uc3RyaW5naWZ5KHRoaXMubmFtZSldXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRGlkVXBkYXRlTGF5b3V0T3Bjb2RlIGV4dGVuZHMgVXBkYXRpbmdPcGNvZGUge1xuICBwdWJsaWMgdHlwZSA9IFwiZGlkLXVwZGF0ZS1sYXlvdXRcIjtcbiAgcHVibGljIHRhZzogUmV2aXNpb25UYWcgPSBDT05TVEFOVF9UQUc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBtYW5hZ2VyOiBDb21wb25lbnRNYW5hZ2VyPENvbXBvbmVudD4sXG4gICAgcHJpdmF0ZSBjb21wb25lbnQ6IENvbXBvbmVudCxcbiAgICBwcml2YXRlIGJvdW5kczogQm91bmRzXG4gICkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICBldmFsdWF0ZSh2bTogVXBkYXRpbmdWTSkge1xuICAgIGxldCB7IG1hbmFnZXIsIGNvbXBvbmVudCwgYm91bmRzIH0gPSB0aGlzO1xuXG4gICAgbWFuYWdlci5kaWRVcGRhdGVMYXlvdXQoY29tcG9uZW50LCBib3VuZHMpO1xuXG4gICAgdm0uZW52LmRpZFVwZGF0ZShjb21wb25lbnQsIG1hbmFnZXIpO1xuICB9XG59XG4iXX0=