enifed('@glimmer/runtime/lib/compiler', ['exports', '@glimmer/runtime/lib/compiled/blocks', '@glimmer/runtime/lib/scanner', '@glimmer/runtime/lib/syntax/functions', '@glimmer/runtime/lib/compiled/opcodes/builder'], function (exports, _glimmerRuntimeLibCompiledBlocks, _glimmerRuntimeLibScanner, _glimmerRuntimeLibSyntaxFunctions, _glimmerRuntimeLibCompiledOpcodesBuilder) {
    'use strict';

    var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

    exports.compileLayout = compileLayout;
    exports.builder = builder;

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

    function compileLayout(compilable, env) {
        var builder = new ComponentLayoutBuilder(env);
        compilable.compile(builder);
        return builder.compile();
    }

    var ComponentLayoutBuilder = (function () {
        function ComponentLayoutBuilder(env) {
            _classCallCheck(this, ComponentLayoutBuilder);

            this.env = env;
        }

        ComponentLayoutBuilder.prototype.wrapLayout = function wrapLayout(layout) {
            this.inner = new WrappedBuilder(this.env, layout);
        };

        ComponentLayoutBuilder.prototype.fromLayout = function fromLayout(layout) {
            this.inner = new UnwrappedBuilder(this.env, layout);
        };

        ComponentLayoutBuilder.prototype.compile = function compile() {
            return this.inner.compile();
        };

        _createClass(ComponentLayoutBuilder, [{
            key: 'tag',
            get: function () {
                return this.inner.tag;
            }
        }, {
            key: 'attrs',
            get: function () {
                return this.inner.attrs;
            }
        }]);

        return ComponentLayoutBuilder;
    })();

    var WrappedBuilder = (function () {
        function WrappedBuilder(env, layout) {
            _classCallCheck(this, WrappedBuilder);

            this.env = env;
            this.layout = layout;
            this.tag = new ComponentTagBuilder();
            this.attrs = new ComponentAttrsBuilder();
        }

        WrappedBuilder.prototype.compile = function compile() {
            //========DYNAMIC
            //        PutValue(TagExpr)
            //        Test
            //        JumpUnless(BODY)
            //        OpenDynamicPrimitiveElement
            //        DidCreateElement
            //        ...attr statements...
            //        FlushElement
            // BODY:  Noop
            //        ...body statements...
            //        PutValue(TagExpr)
            //        Test
            //        JumpUnless(END)
            //        CloseElement
            // END:   Noop
            //        DidRenderLayout
            //        Exit
            //
            //========STATIC
            //        OpenPrimitiveElementOpcode
            //        DidCreateElement
            //        ...attr statements...
            //        FlushElement
            //        ...body statements...
            //        CloseElement
            //        DidRenderLayout
            //        Exit
            var env = this.env;
            var layout = this.layout;

            var symbolTable = layout.symbolTable;
            var b = builder(env, layout.symbolTable);
            b.startLabels();
            var dynamicTag = this.tag.getDynamic();
            var staticTag = undefined;
            if (dynamicTag) {
                b.putValue(dynamicTag);
                b.test('simple');
                b.jumpUnless('BODY');
                b.openDynamicPrimitiveElement();
                b.didCreateElement();
                this.attrs['buffer'].forEach(function (statement) {
                    return _glimmerRuntimeLibScanner.compileStatement(statement, b);
                });
                b.flushElement();
                b.label('BODY');
            } else if (staticTag = this.tag.getStatic()) {
                b.openPrimitiveElement(staticTag);
                b.didCreateElement();
                this.attrs['buffer'].forEach(function (statement) {
                    return _glimmerRuntimeLibScanner.compileStatement(statement, b);
                });
                b.flushElement();
            }
            b.preludeForLayout(layout);
            layout.statements.forEach(function (statement) {
                return _glimmerRuntimeLibScanner.compileStatement(statement, b);
            });
            if (dynamicTag) {
                b.putValue(dynamicTag);
                b.test('simple');
                b.jumpUnless('END');
                b.closeElement();
                b.label('END');
            } else if (staticTag) {
                b.closeElement();
            }
            b.didRenderLayout();
            b.stopLabels();
            return new _glimmerRuntimeLibCompiledBlocks.CompiledProgram(b.toSlice(), symbolTable.size);
        };

        return WrappedBuilder;
    })();

    function isOpenElement(value) {
        var type = value[0];
        return type === 'open-element' || type === 'open-primitive-element';
    }

    var UnwrappedBuilder = (function () {
        function UnwrappedBuilder(env, layout) {
            _classCallCheck(this, UnwrappedBuilder);

            this.env = env;
            this.layout = layout;
            this.attrs = new ComponentAttrsBuilder();
        }

        UnwrappedBuilder.prototype.compile = function compile() {
            var env = this.env;
            var layout = this.layout;

            var b = builder(env, layout.symbolTable);
            b.startLabels();
            b.preludeForLayout(layout);
            var attrs = this.attrs['buffer'];
            var attrsInserted = false;
            for (var i = 0; i < layout.statements.length; i++) {
                var statement = layout.statements[i];
                if (!attrsInserted && isOpenElement(statement)) {
                    b.openComponentElement(statement[1]);
                    b.didCreateElement();
                    b.shadowAttributes();
                    attrs.forEach(function (statement) {
                        return _glimmerRuntimeLibScanner.compileStatement(statement, b);
                    });
                    attrsInserted = true;
                } else {
                    _glimmerRuntimeLibScanner.compileStatement(statement, b);
                }
            }
            b.didRenderLayout();
            b.stopLabels();
            return new _glimmerRuntimeLibCompiledBlocks.CompiledProgram(b.toSlice(), layout.symbolTable.size);
        };

        _createClass(UnwrappedBuilder, [{
            key: 'tag',
            get: function () {
                throw new Error('BUG: Cannot call `tag` on an UnwrappedBuilder');
            }
        }]);

        return UnwrappedBuilder;
    })();

    var ComponentTagBuilder = (function () {
        function ComponentTagBuilder() {
            _classCallCheck(this, ComponentTagBuilder);

            this.isDynamic = null;
            this.isStatic = null;
            this.staticTagName = null;
            this.dynamicTagName = null;
        }

        ComponentTagBuilder.prototype.getDynamic = function getDynamic() {
            if (this.isDynamic) {
                return this.dynamicTagName;
            }
        };

        ComponentTagBuilder.prototype.getStatic = function getStatic() {
            if (this.isStatic) {
                return this.staticTagName;
            }
        };

        ComponentTagBuilder.prototype.static = function _static(tagName) {
            this.isStatic = true;
            this.staticTagName = tagName;
        };

        ComponentTagBuilder.prototype.dynamic = function dynamic(tagName) {
            this.isDynamic = true;
            this.dynamicTagName = ['function', tagName];
        };

        return ComponentTagBuilder;
    })();

    var ComponentAttrsBuilder = (function () {
        function ComponentAttrsBuilder() {
            _classCallCheck(this, ComponentAttrsBuilder);

            this.buffer = [];
        }

        ComponentAttrsBuilder.prototype.static = function _static(name, value) {
            this.buffer.push(['static-attr', name, value, null]);
        };

        ComponentAttrsBuilder.prototype.dynamic = function dynamic(name, value) {
            this.buffer.push(['dynamic-attr', name, ['function', value], null]);
        };

        return ComponentAttrsBuilder;
    })();

    var ComponentBuilder = (function () {
        function ComponentBuilder(builder) {
            _classCallCheck(this, ComponentBuilder);

            this.builder = builder;
            this.env = builder.env;
        }

        ComponentBuilder.prototype.static = function _static(definition, args, _symbolTable, shadow) {
            this.builder.unit(function (b) {
                b.putComponentDefinition(definition);
                b.openComponent(_glimmerRuntimeLibSyntaxFunctions.compileBaselineArgs(args, b), shadow);
                b.closeComponent();
            });
        };

        ComponentBuilder.prototype.dynamic = function dynamic(definitionArgs, definition, args, _symbolTable, shadow) {
            this.builder.unit(function (b) {
                b.putArgs(_glimmerRuntimeLibSyntaxFunctions.compileArgs(definitionArgs[0], definitionArgs[1], b));
                b.putValue(['function', definition]);
                b.test('simple');
                b.enter('BEGIN', 'END');
                b.label('BEGIN');
                b.jumpUnless('END');
                b.putDynamicComponentDefinition();
                b.openComponent(_glimmerRuntimeLibSyntaxFunctions.compileBaselineArgs(args, b), shadow);
                b.closeComponent();
                b.label('END');
                b.exit();
            });
        };

        return ComponentBuilder;
    })();

    exports.ComponentBuilder = ComponentBuilder;

    function builder(env, symbolTable) {
        return new _glimmerRuntimeLibCompiledOpcodesBuilder.default(symbolTable, env);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL2NvbXBpbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFxQ00sYUFBQSxhQUFBLENBQXdCLFVBQTRCLEVBQUUsR0FBZ0IsRUFBQTtBQUMxRSxZQUFJLE9BQU8sR0FBRyxJQUFJLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBRTlDLGtCQUFVLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBRTVCLGVBQU8sT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQzFCOztRQUVELHNCQUFBO0FBR0UsaUJBSEYsc0JBQUEsQ0FHcUIsR0FBZ0IsRUFBQTtrQ0FIckMsc0JBQUE7O0FBR3FCLGdCQUFBLENBQUEsR0FBRyxHQUFILEdBQUcsQ0FBYTtTQUFJOztBQUh6Qyw4QkFBQSxXQUtFLFVBQVUsR0FBQSxvQkFBQyxNQUFjLEVBQUE7QUFDdkIsZ0JBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUNuRDs7QUFQSCw4QkFBQSxXQVNFLFVBQVUsR0FBQSxvQkFBQyxNQUFjLEVBQUE7QUFDdkIsZ0JBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ3JEOztBQVhILDhCQUFBLFdBYUUsT0FBTyxHQUFBLG1CQUFBO0FBQ0wsbUJBQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsQ0FBQztTQUM3Qjs7cUJBZkgsc0JBQUE7O2lCQWlCUyxZQUFBO0FBQ0wsdUJBQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7YUFDdkI7OztpQkFFUSxZQUFBO0FBQ1AsdUJBQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7YUFDekI7OztlQXZCSCxzQkFBQTs7O1FBMEJBLGNBQUE7QUFJRSxpQkFKRixjQUFBLENBSXFCLEdBQWdCLEVBQVUsTUFBYyxFQUFBO2tDQUo3RCxjQUFBOztBQUlxQixnQkFBQSxDQUFBLEdBQUcsR0FBSCxHQUFHLENBQWE7QUFBVSxnQkFBQSxDQUFBLE1BQU0sR0FBTixNQUFNLENBQVE7QUFIcEQsZ0JBQUEsQ0FBQSxHQUFHLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO0FBQ2hDLGdCQUFBLENBQUEsS0FBSyxHQUFHLElBQUkscUJBQXFCLEVBQUUsQ0FBQztTQUVvQjs7QUFKakUsc0JBQUEsV0FNRSxPQUFPLEdBQUEsbUJBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Z0JBNkJDLEdBQUcsR0FBYSxJQUFJLENBQXBCLEdBQUc7Z0JBQUUsTUFBTSxHQUFLLElBQUksQ0FBZixNQUFNOztBQUVqQixnQkFBSSxXQUFXLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztBQUNyQyxnQkFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7QUFFekMsYUFBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBRWhCLGdCQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDO0FBQ3ZDLGdCQUFJLFNBQXdCLFlBQUEsQ0FBQztBQUU3QixnQkFBSSxVQUFVLEVBQUU7QUFDZCxpQkFBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUN2QixpQkFBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqQixpQkFBQyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNyQixpQkFBQyxDQUFDLDJCQUEyQixFQUFFLENBQUM7QUFDaEMsaUJBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQ3JCLG9CQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFBLFNBQVM7MkJBQUksMEJBakg5QyxnQkFBZ0IsQ0FpSCtDLFNBQVMsRUFBRSxDQUFDLENBQUM7aUJBQUEsQ0FBQyxDQUFDO0FBQzFFLGlCQUFDLENBQUMsWUFBWSxFQUFFLENBQUM7QUFDakIsaUJBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDakIsTUFBTSxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxFQUFFO0FBQzNDLGlCQUFDLENBQUMsb0JBQW9CLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDbEMsaUJBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQ3JCLG9CQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFBLFNBQVM7MkJBQUksMEJBdkg5QyxnQkFBZ0IsQ0F1SCtDLFNBQVMsRUFBRSxDQUFDLENBQUM7aUJBQUEsQ0FBQyxDQUFDO0FBQzFFLGlCQUFDLENBQUMsWUFBWSxFQUFFLENBQUM7YUFDbEI7QUFFRCxhQUFDLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFM0Isa0JBQU0sQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFVBQUEsU0FBUzt1QkFBSSwwQkE3SHpDLGdCQUFnQixDQTZIMEMsU0FBUyxFQUFFLENBQUMsQ0FBQzthQUFBLENBQUMsQ0FBQztBQUV2RSxnQkFBSSxVQUFVLEVBQUU7QUFDZCxpQkFBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUN2QixpQkFBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqQixpQkFBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwQixpQkFBQyxDQUFDLFlBQVksRUFBRSxDQUFDO0FBQ2pCLGlCQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQ2hCLE1BQU0sSUFBSSxTQUFTLEVBQUU7QUFDcEIsaUJBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQzthQUNsQjtBQUVELGFBQUMsQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUNwQixhQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7QUFFZixtQkFBTyxxQ0FuSkYsZUFBZSxDQW1KTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzNEOztlQS9FSCxjQUFBOzs7QUFrRkEsYUFBQSxhQUFBLENBQXVCLEtBQWtDLEVBQUE7QUFDdkQsWUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3BCLGVBQU8sSUFBSSxLQUFLLGNBQWMsSUFBSSxJQUFJLEtBQUssd0JBQXdCLENBQUM7S0FDckU7O1FBRUQsZ0JBQUE7QUFHRSxpQkFIRixnQkFBQSxDQUdxQixHQUFnQixFQUFVLE1BQWMsRUFBQTtrQ0FIN0QsZ0JBQUE7O0FBR3FCLGdCQUFBLENBQUEsR0FBRyxHQUFILEdBQUcsQ0FBYTtBQUFVLGdCQUFBLENBQUEsTUFBTSxHQUFOLE1BQU0sQ0FBUTtBQUZwRCxnQkFBQSxDQUFBLEtBQUssR0FBRyxJQUFJLHFCQUFxQixFQUFFLENBQUM7U0FFb0I7O0FBSGpFLHdCQUFBLFdBU0UsT0FBTyxHQUFBLG1CQUFBO2dCQUNDLEdBQUcsR0FBYSxJQUFJLENBQXBCLEdBQUc7Z0JBQUUsTUFBTSxHQUFLLElBQUksQ0FBZixNQUFNOztBQUVqQixnQkFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUM7QUFFekMsYUFBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO0FBRWhCLGFBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUUzQixnQkFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqQyxnQkFBSSxhQUFhLEdBQUcsS0FBSyxDQUFDO0FBRTFCLGlCQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDakQsb0JBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDckMsb0JBQUksQ0FBQyxhQUFhLElBQUksYUFBYSxDQUFDLFNBQVMsQ0FBQyxFQUFFO0FBQzlDLHFCQUFDLENBQUMsb0JBQW9CLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDckMscUJBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0FBQ3JCLHFCQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztBQUNyQix5QkFBSyxDQUFDLE9BQU8sQ0FBQyxVQUFBLFNBQVM7K0JBQUksMEJBaExqQyxnQkFBZ0IsQ0FnTGtDLFNBQVMsRUFBRSxDQUFDLENBQUM7cUJBQUEsQ0FBQyxDQUFDO0FBQzNELGlDQUFhLEdBQUcsSUFBSSxDQUFDO2lCQUN0QixNQUFNO0FBQ0wsOENBbkxOLGdCQUFnQixDQW1MTyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7aUJBQ2hDO2FBQ0Y7QUFFRCxhQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7QUFDcEIsYUFBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO0FBRWYsbUJBQU8scUNBak1GLGVBQWUsQ0FpTU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDbEU7O3FCQXRDSCxnQkFBQTs7aUJBS1MsWUFBQTtBQUNMLHNCQUFNLElBQUksS0FBSyxDQUFDLCtDQUErQyxDQUFDLENBQUM7YUFDbEU7OztlQVBILGdCQUFBOzs7UUF5Q0EsbUJBQUE7QUFBQSxpQkFBQSxtQkFBQSxHQUFBO2tDQUFBLG1CQUFBOztBQUNTLGdCQUFBLENBQUEsU0FBUyxHQUFvQixJQUFJLENBQUM7QUFDbEMsZ0JBQUEsQ0FBQSxRQUFRLEdBQW9CLElBQUksQ0FBQztBQUNqQyxnQkFBQSxDQUFBLGFBQWEsR0FBbUIsSUFBSSxDQUFDO0FBQ3JDLGdCQUFBLENBQUEsY0FBYyxHQUF5QyxJQUFJLENBQUM7U0F1QnBFOztBQTNCRCwyQkFBQSxXQU1FLFVBQVUsR0FBQSxzQkFBQTtBQUNSLGdCQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7QUFDbEIsdUJBQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQzthQUM1QjtTQUNGOztBQVZILDJCQUFBLFdBWUUsU0FBUyxHQUFBLHFCQUFBO0FBQ1AsZ0JBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtBQUNqQix1QkFBTyxJQUFJLENBQUMsYUFBYSxDQUFDO2FBQzNCO1NBQ0Y7O0FBaEJILDJCQUFBLFdBa0JFLE1BQU0sR0FBQSxpQkFBQyxPQUFlLEVBQUE7QUFDcEIsZ0JBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO0FBQ3JCLGdCQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQztTQUM5Qjs7QUFyQkgsMkJBQUEsV0F1QkUsT0FBTyxHQUFBLGlCQUFDLE9BQW1DLEVBQUE7QUFDekMsZ0JBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO0FBQ3RCLGdCQUFJLENBQUMsY0FBYyxHQUFHLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQzdDOztlQTFCSCxtQkFBQTs7O1FBNkJBLHFCQUFBO0FBQUEsaUJBQUEscUJBQUEsR0FBQTtrQ0FBQSxxQkFBQTs7QUFDVSxnQkFBQSxDQUFBLE1BQU0sR0FBc0MsRUFBRSxDQUFDO1NBU3hEOztBQVZELDZCQUFBLFdBR0UsTUFBTSxHQUFBLGlCQUFDLElBQVksRUFBRSxLQUFhLEVBQUE7QUFDaEMsZ0JBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUN0RDs7QUFMSCw2QkFBQSxXQU9FLE9BQU8sR0FBQSxpQkFBQyxJQUFZLEVBQUUsS0FBaUMsRUFBQTtBQUNyRCxnQkFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLEVBQUUsSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDckU7O2VBVEgscUJBQUE7OztRQVlNLGdCQUFBO0FBR0osaUJBSEksZ0JBQUEsQ0FHZ0IsT0FBeUIsRUFBQTtrQ0FIekMsZ0JBQUE7O0FBR2dCLGdCQUFBLENBQUEsT0FBTyxHQUFQLE9BQU8sQ0FBa0I7QUFDM0MsZ0JBQUksQ0FBQyxHQUFHLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQztTQUN4Qjs7QUFMRyx3QkFBQSxXQU9KLE1BQU0sR0FBQSxpQkFBQyxVQUE0QixFQUFFLElBQXlCLEVBQUUsWUFBeUIsRUFBRSxNQUFtQixFQUFBO0FBQzVHLGdCQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxVQUFBLENBQUMsRUFBQTtBQUNqQixpQkFBQyxDQUFDLHNCQUFzQixDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3JDLGlCQUFDLENBQUMsYUFBYSxDQUFDLGtDQXRPcEIsbUJBQW1CLENBc09xQixJQUFJLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEQsaUJBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQzthQUNwQixDQUFDLENBQUM7U0FDSjs7QUFiRyx3QkFBQSxXQWVKLE9BQU8sR0FBQSxpQkFBQyxjQUFtQyxFQUFFLFVBQTZCLEVBQUUsSUFBeUIsRUFBRSxZQUF5QixFQUFFLE1BQW1CLEVBQUE7QUFDbkosZ0JBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQyxFQUFBO0FBQ2pCLGlCQUFDLENBQUMsT0FBTyxDQUFDLGtDQTlPZCxXQUFXLENBOE9lLGNBQWMsQ0FBQyxDQUFDLENBQUMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoRSxpQkFBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO0FBQ3JDLGlCQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2pCLGlCQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztBQUN4QixpQkFBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUNqQixpQkFBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNwQixpQkFBQyxDQUFDLDZCQUE2QixFQUFFLENBQUM7QUFDbEMsaUJBQUMsQ0FBQyxhQUFhLENBQUMsa0NBcFBwQixtQkFBbUIsQ0FvUHFCLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUN0RCxpQkFBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO0FBQ25CLGlCQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ2YsaUJBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQzthQUNWLENBQUMsQ0FBQztTQUNKOztlQTdCRyxnQkFBQTs7Ozs7QUFnQ0EsYUFBQSxPQUFBLENBQXlDLEdBQWdCLEVBQUUsV0FBYyxFQUFBO0FBQzdFLGVBQU8scURBQXFCLFdBQVcsRUFBRSxHQUFHLENBQUMsQ0FBQztLQUMvQyIsImZpbGUiOiJjb21waWxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVudmlyb25tZW50IH0gZnJvbSAnLi9lbnZpcm9ubWVudCc7XG5pbXBvcnQgeyBTeW1ib2xUYWJsZSB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgQ29tcGlsZWRQcm9ncmFtIH0gZnJvbSAnLi9jb21waWxlZC9ibG9ja3MnO1xuaW1wb3J0IHsgTWF5YmUsIE9wdGlvbiB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuXG5pbXBvcnQge1xuICBCYXNlbGluZVN5bnRheCxcbiAgTGF5b3V0LFxuICBJbmxpbmVCbG9jayxcbiAgY29tcGlsZVN0YXRlbWVudFxufSBmcm9tICcuL3NjYW5uZXInO1xuXG5pbXBvcnQge1xuICBDb21wb25lbnRCdWlsZGVyIGFzIElDb21wb25lbnRCdWlsZGVyLFxuICBEeW5hbWljRGVmaW5pdGlvbixcbiAgU3RhdGljRGVmaW5pdGlvblxufSBmcm9tICcuL29wY29kZS1idWlsZGVyJztcblxuaW1wb3J0IHtcbiAgY29tcGlsZUFyZ3MsXG4gIGNvbXBpbGVCYXNlbGluZUFyZ3Ncbn0gZnJvbSAnLi9zeW50YXgvZnVuY3Rpb25zJztcblxuaW1wb3J0IHtcbiAgRnVuY3Rpb25FeHByZXNzaW9uXG59IGZyb20gJy4vY29tcGlsZWQvZXhwcmVzc2lvbnMvZnVuY3Rpb24nO1xuXG5pbXBvcnQgT3Bjb2RlQnVpbGRlckRTTCBmcm9tICcuL2NvbXBpbGVkL29wY29kZXMvYnVpbGRlcic7XG5cbmltcG9ydCAqIGFzIENvbXBvbmVudCBmcm9tICcuL2NvbXBvbmVudC9pbnRlcmZhY2VzJztcblxuaW1wb3J0ICogYXMgV2lyZUZvcm1hdCBmcm9tICdAZ2xpbW1lci93aXJlLWZvcm1hdCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcGlsYWJsZUxheW91dCB7XG4gIGNvbXBpbGUoYnVpbGRlcjogQ29tcG9uZW50LkNvbXBvbmVudExheW91dEJ1aWxkZXIpOiB2b2lkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29tcGlsZUxheW91dChjb21waWxhYmxlOiBDb21waWxhYmxlTGF5b3V0LCBlbnY6IEVudmlyb25tZW50KTogQ29tcGlsZWRQcm9ncmFtIHtcbiAgbGV0IGJ1aWxkZXIgPSBuZXcgQ29tcG9uZW50TGF5b3V0QnVpbGRlcihlbnYpO1xuXG4gIGNvbXBpbGFibGUuY29tcGlsZShidWlsZGVyKTtcblxuICByZXR1cm4gYnVpbGRlci5jb21waWxlKCk7XG59XG5cbmNsYXNzIENvbXBvbmVudExheW91dEJ1aWxkZXIgaW1wbGVtZW50cyBDb21wb25lbnQuQ29tcG9uZW50TGF5b3V0QnVpbGRlciB7XG4gIHByaXZhdGUgaW5uZXI6IFdyYXBwZWRCdWlsZGVyIHwgVW53cmFwcGVkQnVpbGRlcjtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgZW52OiBFbnZpcm9ubWVudCkge31cblxuICB3cmFwTGF5b3V0KGxheW91dDogTGF5b3V0KSB7XG4gICAgdGhpcy5pbm5lciA9IG5ldyBXcmFwcGVkQnVpbGRlcih0aGlzLmVudiwgbGF5b3V0KTtcbiAgfVxuXG4gIGZyb21MYXlvdXQobGF5b3V0OiBMYXlvdXQpIHtcbiAgICB0aGlzLmlubmVyID0gbmV3IFVud3JhcHBlZEJ1aWxkZXIodGhpcy5lbnYsIGxheW91dCk7XG4gIH1cblxuICBjb21waWxlKCk6IENvbXBpbGVkUHJvZ3JhbSB7XG4gICAgcmV0dXJuIHRoaXMuaW5uZXIuY29tcGlsZSgpO1xuICB9XG5cbiAgZ2V0IHRhZygpOiBDb21wb25lbnQuQ29tcG9uZW50VGFnQnVpbGRlciB7XG4gICAgcmV0dXJuIHRoaXMuaW5uZXIudGFnO1xuICB9XG5cbiAgZ2V0IGF0dHJzKCk6IENvbXBvbmVudC5Db21wb25lbnRBdHRyc0J1aWxkZXIge1xuICAgIHJldHVybiB0aGlzLmlubmVyLmF0dHJzO1xuICB9XG59XG5cbmNsYXNzIFdyYXBwZWRCdWlsZGVyIHtcbiAgcHVibGljIHRhZyA9IG5ldyBDb21wb25lbnRUYWdCdWlsZGVyKCk7XG4gIHB1YmxpYyBhdHRycyA9IG5ldyBDb21wb25lbnRBdHRyc0J1aWxkZXIoKTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgZW52OiBFbnZpcm9ubWVudCwgcHJpdmF0ZSBsYXlvdXQ6IExheW91dCkge31cblxuICBjb21waWxlKCk6IENvbXBpbGVkUHJvZ3JhbSB7XG4gICAgLy89PT09PT09PURZTkFNSUNcbiAgICAvLyAgICAgICAgUHV0VmFsdWUoVGFnRXhwcilcbiAgICAvLyAgICAgICAgVGVzdFxuICAgIC8vICAgICAgICBKdW1wVW5sZXNzKEJPRFkpXG4gICAgLy8gICAgICAgIE9wZW5EeW5hbWljUHJpbWl0aXZlRWxlbWVudFxuICAgIC8vICAgICAgICBEaWRDcmVhdGVFbGVtZW50XG4gICAgLy8gICAgICAgIC4uLmF0dHIgc3RhdGVtZW50cy4uLlxuICAgIC8vICAgICAgICBGbHVzaEVsZW1lbnRcbiAgICAvLyBCT0RZOiAgTm9vcFxuICAgIC8vICAgICAgICAuLi5ib2R5IHN0YXRlbWVudHMuLi5cbiAgICAvLyAgICAgICAgUHV0VmFsdWUoVGFnRXhwcilcbiAgICAvLyAgICAgICAgVGVzdFxuICAgIC8vICAgICAgICBKdW1wVW5sZXNzKEVORClcbiAgICAvLyAgICAgICAgQ2xvc2VFbGVtZW50XG4gICAgLy8gRU5EOiAgIE5vb3BcbiAgICAvLyAgICAgICAgRGlkUmVuZGVyTGF5b3V0XG4gICAgLy8gICAgICAgIEV4aXRcbiAgICAvL1xuICAgIC8vPT09PT09PT1TVEFUSUNcbiAgICAvLyAgICAgICAgT3BlblByaW1pdGl2ZUVsZW1lbnRPcGNvZGVcbiAgICAvLyAgICAgICAgRGlkQ3JlYXRlRWxlbWVudFxuICAgIC8vICAgICAgICAuLi5hdHRyIHN0YXRlbWVudHMuLi5cbiAgICAvLyAgICAgICAgRmx1c2hFbGVtZW50XG4gICAgLy8gICAgICAgIC4uLmJvZHkgc3RhdGVtZW50cy4uLlxuICAgIC8vICAgICAgICBDbG9zZUVsZW1lbnRcbiAgICAvLyAgICAgICAgRGlkUmVuZGVyTGF5b3V0XG4gICAgLy8gICAgICAgIEV4aXRcblxuICAgIGxldCB7IGVudiwgbGF5b3V0IH0gPSB0aGlzO1xuXG4gICAgbGV0IHN5bWJvbFRhYmxlID0gbGF5b3V0LnN5bWJvbFRhYmxlO1xuICAgIGxldCBiID0gYnVpbGRlcihlbnYsIGxheW91dC5zeW1ib2xUYWJsZSk7XG5cbiAgICBiLnN0YXJ0TGFiZWxzKCk7XG5cbiAgICBsZXQgZHluYW1pY1RhZyA9IHRoaXMudGFnLmdldER5bmFtaWMoKTtcbiAgICBsZXQgc3RhdGljVGFnOiBNYXliZTxzdHJpbmc+O1xuXG4gICAgaWYgKGR5bmFtaWNUYWcpIHtcbiAgICAgIGIucHV0VmFsdWUoZHluYW1pY1RhZyk7XG4gICAgICBiLnRlc3QoJ3NpbXBsZScpO1xuICAgICAgYi5qdW1wVW5sZXNzKCdCT0RZJyk7XG4gICAgICBiLm9wZW5EeW5hbWljUHJpbWl0aXZlRWxlbWVudCgpO1xuICAgICAgYi5kaWRDcmVhdGVFbGVtZW50KCk7XG4gICAgICB0aGlzLmF0dHJzWydidWZmZXInXS5mb3JFYWNoKHN0YXRlbWVudCA9PiBjb21waWxlU3RhdGVtZW50KHN0YXRlbWVudCwgYikpO1xuICAgICAgYi5mbHVzaEVsZW1lbnQoKTtcbiAgICAgIGIubGFiZWwoJ0JPRFknKTtcbiAgICB9IGVsc2UgaWYgKHN0YXRpY1RhZyA9IHRoaXMudGFnLmdldFN0YXRpYygpKSB7XG4gICAgICBiLm9wZW5QcmltaXRpdmVFbGVtZW50KHN0YXRpY1RhZyk7XG4gICAgICBiLmRpZENyZWF0ZUVsZW1lbnQoKTtcbiAgICAgIHRoaXMuYXR0cnNbJ2J1ZmZlciddLmZvckVhY2goc3RhdGVtZW50ID0+IGNvbXBpbGVTdGF0ZW1lbnQoc3RhdGVtZW50LCBiKSk7XG4gICAgICBiLmZsdXNoRWxlbWVudCgpO1xuICAgIH1cblxuICAgIGIucHJlbHVkZUZvckxheW91dChsYXlvdXQpO1xuXG4gICAgbGF5b3V0LnN0YXRlbWVudHMuZm9yRWFjaChzdGF0ZW1lbnQgPT4gY29tcGlsZVN0YXRlbWVudChzdGF0ZW1lbnQsIGIpKTtcblxuICAgIGlmIChkeW5hbWljVGFnKSB7XG4gICAgICBiLnB1dFZhbHVlKGR5bmFtaWNUYWcpO1xuICAgICAgYi50ZXN0KCdzaW1wbGUnKTtcbiAgICAgIGIuanVtcFVubGVzcygnRU5EJyk7XG4gICAgICBiLmNsb3NlRWxlbWVudCgpO1xuICAgICAgYi5sYWJlbCgnRU5EJyk7XG4gICAgfSBlbHNlIGlmIChzdGF0aWNUYWcpIHtcbiAgICAgIGIuY2xvc2VFbGVtZW50KCk7XG4gICAgfVxuXG4gICAgYi5kaWRSZW5kZXJMYXlvdXQoKTtcbiAgICBiLnN0b3BMYWJlbHMoKTtcblxuICAgIHJldHVybiBuZXcgQ29tcGlsZWRQcm9ncmFtKGIudG9TbGljZSgpLCBzeW1ib2xUYWJsZS5zaXplKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc09wZW5FbGVtZW50KHZhbHVlOiBCYXNlbGluZVN5bnRheC5BbnlTdGF0ZW1lbnQpOiB2YWx1ZSBpcyAoQmFzZWxpbmVTeW50YXguT3BlblByaW1pdGl2ZUVsZW1lbnQgfCBXaXJlRm9ybWF0LlN0YXRlbWVudHMuT3BlbkVsZW1lbnQpIHtcbiAgbGV0IHR5cGUgPSB2YWx1ZVswXTtcbiAgcmV0dXJuIHR5cGUgPT09ICdvcGVuLWVsZW1lbnQnIHx8IHR5cGUgPT09ICdvcGVuLXByaW1pdGl2ZS1lbGVtZW50Jztcbn1cblxuY2xhc3MgVW53cmFwcGVkQnVpbGRlciB7XG4gIHB1YmxpYyBhdHRycyA9IG5ldyBDb21wb25lbnRBdHRyc0J1aWxkZXIoKTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgZW52OiBFbnZpcm9ubWVudCwgcHJpdmF0ZSBsYXlvdXQ6IExheW91dCkge31cblxuICBnZXQgdGFnKCk6IENvbXBvbmVudC5Db21wb25lbnRUYWdCdWlsZGVyIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JVRzogQ2Fubm90IGNhbGwgYHRhZ2Agb24gYW4gVW53cmFwcGVkQnVpbGRlcicpO1xuICB9XG5cbiAgY29tcGlsZSgpOiBDb21waWxlZFByb2dyYW0ge1xuICAgIGxldCB7IGVudiwgbGF5b3V0IH0gPSB0aGlzO1xuXG4gICAgbGV0IGIgPSBidWlsZGVyKGVudiwgbGF5b3V0LnN5bWJvbFRhYmxlKTtcblxuICAgIGIuc3RhcnRMYWJlbHMoKTtcblxuICAgIGIucHJlbHVkZUZvckxheW91dChsYXlvdXQpO1xuXG4gICAgbGV0IGF0dHJzID0gdGhpcy5hdHRyc1snYnVmZmVyJ107XG4gICAgbGV0IGF0dHJzSW5zZXJ0ZWQgPSBmYWxzZTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGF5b3V0LnN0YXRlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBzdGF0ZW1lbnQgPSBsYXlvdXQuc3RhdGVtZW50c1tpXTtcbiAgICAgIGlmICghYXR0cnNJbnNlcnRlZCAmJiBpc09wZW5FbGVtZW50KHN0YXRlbWVudCkpIHtcbiAgICAgICAgYi5vcGVuQ29tcG9uZW50RWxlbWVudChzdGF0ZW1lbnRbMV0pO1xuICAgICAgICBiLmRpZENyZWF0ZUVsZW1lbnQoKTtcbiAgICAgICAgYi5zaGFkb3dBdHRyaWJ1dGVzKCk7XG4gICAgICAgIGF0dHJzLmZvckVhY2goc3RhdGVtZW50ID0+IGNvbXBpbGVTdGF0ZW1lbnQoc3RhdGVtZW50LCBiKSk7XG4gICAgICAgIGF0dHJzSW5zZXJ0ZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29tcGlsZVN0YXRlbWVudChzdGF0ZW1lbnQsIGIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGIuZGlkUmVuZGVyTGF5b3V0KCk7XG4gICAgYi5zdG9wTGFiZWxzKCk7XG5cbiAgICByZXR1cm4gbmV3IENvbXBpbGVkUHJvZ3JhbShiLnRvU2xpY2UoKSwgbGF5b3V0LnN5bWJvbFRhYmxlLnNpemUpO1xuICB9XG59XG5cbmNsYXNzIENvbXBvbmVudFRhZ0J1aWxkZXIgaW1wbGVtZW50cyBDb21wb25lbnQuQ29tcG9uZW50VGFnQnVpbGRlciB7XG4gIHB1YmxpYyBpc0R5bmFtaWM6IE9wdGlvbjxib29sZWFuPiA9IG51bGw7XG4gIHB1YmxpYyBpc1N0YXRpYzogT3B0aW9uPGJvb2xlYW4+ID0gbnVsbDtcbiAgcHVibGljIHN0YXRpY1RhZ05hbWU6IE9wdGlvbjxzdHJpbmc+ID0gbnVsbDtcbiAgcHVibGljIGR5bmFtaWNUYWdOYW1lOiBPcHRpb248QmFzZWxpbmVTeW50YXguQW55RXhwcmVzc2lvbj4gPSBudWxsO1xuXG4gIGdldER5bmFtaWMoKTogTWF5YmU8QmFzZWxpbmVTeW50YXguQW55RXhwcmVzc2lvbj4ge1xuICAgIGlmICh0aGlzLmlzRHluYW1pYykge1xuICAgICAgcmV0dXJuIHRoaXMuZHluYW1pY1RhZ05hbWU7XG4gICAgfVxuICB9XG5cbiAgZ2V0U3RhdGljKCk6IE1heWJlPHN0cmluZz4ge1xuICAgIGlmICh0aGlzLmlzU3RhdGljKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdGF0aWNUYWdOYW1lO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyh0YWdOYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLmlzU3RhdGljID0gdHJ1ZTtcbiAgICB0aGlzLnN0YXRpY1RhZ05hbWUgPSB0YWdOYW1lO1xuICB9XG5cbiAgZHluYW1pYyh0YWdOYW1lOiBGdW5jdGlvbkV4cHJlc3Npb248c3RyaW5nPikge1xuICAgIHRoaXMuaXNEeW5hbWljID0gdHJ1ZTtcbiAgICB0aGlzLmR5bmFtaWNUYWdOYW1lID0gWydmdW5jdGlvbicsIHRhZ05hbWVdO1xuICB9XG59XG5cbmNsYXNzIENvbXBvbmVudEF0dHJzQnVpbGRlciBpbXBsZW1lbnRzIENvbXBvbmVudC5Db21wb25lbnRBdHRyc0J1aWxkZXIge1xuICBwcml2YXRlIGJ1ZmZlcjogV2lyZUZvcm1hdC5TdGF0ZW1lbnRzLkF0dHJpYnV0ZVtdID0gW107XG5cbiAgc3RhdGljKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMuYnVmZmVyLnB1c2goWydzdGF0aWMtYXR0cicsIG5hbWUsIHZhbHVlLCBudWxsXSk7XG4gIH1cblxuICBkeW5hbWljKG5hbWU6IHN0cmluZywgdmFsdWU6IEZ1bmN0aW9uRXhwcmVzc2lvbjxzdHJpbmc+KSB7XG4gICAgdGhpcy5idWZmZXIucHVzaChbJ2R5bmFtaWMtYXR0cicsIG5hbWUsIFsnZnVuY3Rpb24nLCB2YWx1ZV0sIG51bGxdKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29tcG9uZW50QnVpbGRlciBpbXBsZW1lbnRzIElDb21wb25lbnRCdWlsZGVyIHtcbiAgcHJpdmF0ZSBlbnY6IEVudmlyb25tZW50O1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYnVpbGRlcjogT3Bjb2RlQnVpbGRlckRTTCkge1xuICAgIHRoaXMuZW52ID0gYnVpbGRlci5lbnY7XG4gIH1cblxuICBzdGF0aWMoZGVmaW5pdGlvbjogU3RhdGljRGVmaW5pdGlvbiwgYXJnczogQmFzZWxpbmVTeW50YXguQXJncywgX3N5bWJvbFRhYmxlOiBTeW1ib2xUYWJsZSwgc2hhZG93OiBJbmxpbmVCbG9jaykge1xuICAgIHRoaXMuYnVpbGRlci51bml0KGIgPT4ge1xuICAgICAgYi5wdXRDb21wb25lbnREZWZpbml0aW9uKGRlZmluaXRpb24pO1xuICAgICAgYi5vcGVuQ29tcG9uZW50KGNvbXBpbGVCYXNlbGluZUFyZ3MoYXJncywgYiksIHNoYWRvdyk7XG4gICAgICBiLmNsb3NlQ29tcG9uZW50KCk7XG4gICAgfSk7XG4gIH1cblxuICBkeW5hbWljKGRlZmluaXRpb25BcmdzOiBCYXNlbGluZVN5bnRheC5BcmdzLCBkZWZpbml0aW9uOiBEeW5hbWljRGVmaW5pdGlvbiwgYXJnczogQmFzZWxpbmVTeW50YXguQXJncywgX3N5bWJvbFRhYmxlOiBTeW1ib2xUYWJsZSwgc2hhZG93OiBJbmxpbmVCbG9jaykge1xuICAgIHRoaXMuYnVpbGRlci51bml0KGIgPT4ge1xuICAgICAgYi5wdXRBcmdzKGNvbXBpbGVBcmdzKGRlZmluaXRpb25BcmdzWzBdLCBkZWZpbml0aW9uQXJnc1sxXSwgYikpO1xuICAgICAgYi5wdXRWYWx1ZShbJ2Z1bmN0aW9uJywgZGVmaW5pdGlvbl0pO1xuICAgICAgYi50ZXN0KCdzaW1wbGUnKTtcbiAgICAgIGIuZW50ZXIoJ0JFR0lOJywgJ0VORCcpO1xuICAgICAgYi5sYWJlbCgnQkVHSU4nKTtcbiAgICAgIGIuanVtcFVubGVzcygnRU5EJyk7XG4gICAgICBiLnB1dER5bmFtaWNDb21wb25lbnREZWZpbml0aW9uKCk7XG4gICAgICBiLm9wZW5Db21wb25lbnQoY29tcGlsZUJhc2VsaW5lQXJncyhhcmdzLCBiKSwgc2hhZG93KTtcbiAgICAgIGIuY2xvc2VDb21wb25lbnQoKTtcbiAgICAgIGIubGFiZWwoJ0VORCcpO1xuICAgICAgYi5leGl0KCk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWxkZXI8UyBleHRlbmRzIFN5bWJvbFRhYmxlPihlbnY6IEVudmlyb25tZW50LCBzeW1ib2xUYWJsZTogUykge1xuICByZXR1cm4gbmV3IE9wY29kZUJ1aWxkZXJEU0woc3ltYm9sVGFibGUsIGVudik7XG59XG4iXX0=