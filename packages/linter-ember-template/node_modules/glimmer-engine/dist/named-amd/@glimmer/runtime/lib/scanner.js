enifed('@glimmer/runtime/lib/scanner', ['exports', '@glimmer/runtime/lib/compiled/blocks', '@glimmer/runtime/lib/compiler', '@glimmer/wire-format', '@glimmer/runtime/lib/symbol-table', '@glimmer/runtime/lib/syntax/functions', '@glimmer/runtime/lib/syntax/specialize'], function (exports, _glimmerRuntimeLibCompiledBlocks, _glimmerRuntimeLibCompiler, _glimmerWireFormat, _glimmerRuntimeLibSymbolTable, _glimmerRuntimeLibSyntaxFunctions, _glimmerRuntimeLibSyntaxSpecialize) {
    'use strict';

    exports.compileStatement = compileStatement;
    exports.scanBlock = scanBlock;

    function _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }

    function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

    function compileStatement(statement, builder) {
        var refined = _glimmerRuntimeLibSyntaxSpecialize.SPECIALIZE.specialize(statement, builder.symbolTable);
        _glimmerRuntimeLibSyntaxFunctions.STATEMENTS.compile(refined, builder);
    }

    var Template = function Template(statements, symbolTable) {
        _classCallCheck(this, Template);

        this.statements = statements;
        this.symbolTable = symbolTable;
    };

    exports.Template = Template;

    var Layout = (function (_Template) {
        _inherits(Layout, _Template);

        function Layout() {
            _classCallCheck(this, Layout);

            _Template.apply(this, arguments);
        }

        return Layout;
    })(Template);

    exports.Layout = Layout;

    var EntryPoint = (function (_Template2) {
        _inherits(EntryPoint, _Template2);

        function EntryPoint() {
            _classCallCheck(this, EntryPoint);

            _Template2.apply(this, arguments);
        }

        EntryPoint.prototype.compile = function compile(env) {
            var table = this.symbolTable;
            var b = _glimmerRuntimeLibCompiler.builder(env, table);
            for (var i = 0; i < this.statements.length; i++) {
                var statement = this.statements[i];
                var refined = _glimmerRuntimeLibSyntaxSpecialize.SPECIALIZE.specialize(statement, table);
                _glimmerRuntimeLibSyntaxFunctions.STATEMENTS.compile(refined, b);
            }
            return new _glimmerRuntimeLibCompiledBlocks.CompiledProgram(b.toSlice(), this.symbolTable.size);
        };

        return EntryPoint;
    })(Template);

    exports.EntryPoint = EntryPoint;

    var InlineBlock = (function (_Template3) {
        _inherits(InlineBlock, _Template3);

        function InlineBlock() {
            _classCallCheck(this, InlineBlock);

            _Template3.apply(this, arguments);
        }

        InlineBlock.prototype.splat = function splat(builder) {
            var table = builder.symbolTable;
            var locals = table.getSymbols().locals;
            if (locals) {
                builder.pushChildScope();
                builder.bindPositionalArgsForLocals(locals);
            }
            for (var i = 0; i < this.statements.length; i++) {
                var statement = this.statements[i];
                var refined = _glimmerRuntimeLibSyntaxSpecialize.SPECIALIZE.specialize(statement, table);
                _glimmerRuntimeLibSyntaxFunctions.STATEMENTS.compile(refined, builder);
            }
            if (locals) {
                builder.popScope();
            }
        };

        InlineBlock.prototype.compile = function compile(env) {
            var table = this.symbolTable;
            var b = _glimmerRuntimeLibCompiler.builder(env, table);
            this.splat(b);
            return new _glimmerRuntimeLibCompiledBlocks.CompiledBlock(b.toSlice());
        };

        return InlineBlock;
    })(Template);

    exports.InlineBlock = InlineBlock;

    var PartialBlock = (function (_Template4) {
        _inherits(PartialBlock, _Template4);

        function PartialBlock() {
            _classCallCheck(this, PartialBlock);

            _Template4.apply(this, arguments);
        }

        PartialBlock.prototype.compile = function compile(env) {
            var table = this.symbolTable;
            var b = _glimmerRuntimeLibCompiler.builder(env, table);
            for (var i = 0; i < this.statements.length; i++) {
                var statement = this.statements[i];
                var refined = _glimmerRuntimeLibSyntaxSpecialize.SPECIALIZE.specialize(statement, table);
                _glimmerRuntimeLibSyntaxFunctions.STATEMENTS.compile(refined, b);
            }
            return new _glimmerRuntimeLibCompiledBlocks.CompiledProgram(b.toSlice(), table.size);
        };

        return PartialBlock;
    })(Template);

    exports.PartialBlock = PartialBlock;

    var Scanner = (function () {
        function Scanner(block, meta, env) {
            _classCallCheck(this, Scanner);

            this.block = block;
            this.meta = meta;
            this.env = env;
        }

        Scanner.prototype.scanEntryPoint = function scanEntryPoint() {
            var block = this.block;
            var meta = this.meta;

            var symbolTable = _glimmerRuntimeLibSymbolTable.entryPoint(meta);
            var child = scanBlock(block, symbolTable, this.env);
            return new EntryPoint(child.statements, symbolTable);
        };

        Scanner.prototype.scanLayout = function scanLayout() {
            var block = this.block;
            var meta = this.meta;
            var named = block.named;
            var yields = block.yields;
            var hasPartials = block.hasPartials;

            var symbolTable = _glimmerRuntimeLibSymbolTable.layout(meta, named, yields, hasPartials);
            var child = scanBlock(block, symbolTable, this.env);
            return new Layout(child.statements, symbolTable);
        };

        Scanner.prototype.scanPartial = function scanPartial(symbolTable) {
            var block = this.block;

            var child = scanBlock(block, symbolTable, this.env);
            return new PartialBlock(child.statements, symbolTable);
        };

        return Scanner;
    })();

    exports.default = Scanner;

    function scanBlock(_ref, symbolTable, env) {
        var statements = _ref.statements;

        return new RawInlineBlock(env, symbolTable, statements).scan();
    }

    var BaselineSyntax;
    exports.BaselineSyntax = BaselineSyntax;
    (function (BaselineSyntax) {
        BaselineSyntax.isScannedComponent = _glimmerWireFormat.is('scanned-component');
        BaselineSyntax.isPrimitiveElement = _glimmerWireFormat.is('open-primitive-element');
        BaselineSyntax.isOptimizedAppend = _glimmerWireFormat.is('optimized-append');
        BaselineSyntax.isUnoptimizedAppend = _glimmerWireFormat.is('unoptimized-append');
        BaselineSyntax.isAnyAttr = _glimmerWireFormat.is('any-dynamic-attr');
        BaselineSyntax.isStaticPartial = _glimmerWireFormat.is('static-partial');
        BaselineSyntax.isDynamicPartial = _glimmerWireFormat.is('dynamic-partial');
        BaselineSyntax.isFunctionExpression = _glimmerWireFormat.is('function');
        BaselineSyntax.isNestedBlock = _glimmerWireFormat.is('nested-block');
        BaselineSyntax.isScannedBlock = _glimmerWireFormat.is('scanned-block');
        BaselineSyntax.isDebugger = _glimmerWireFormat.is('debugger');
        var NestedBlock;
        (function (NestedBlock) {
            function defaultBlock(sexp) {
                return sexp[4];
            }
            NestedBlock.defaultBlock = defaultBlock;
            function inverseBlock(sexp) {
                return sexp[5];
            }
            NestedBlock.inverseBlock = inverseBlock;
            function params(sexp) {
                return sexp[2];
            }
            NestedBlock.params = params;
            function hash(sexp) {
                return sexp[3];
            }
            NestedBlock.hash = hash;
        })(NestedBlock = BaselineSyntax.NestedBlock || (BaselineSyntax.NestedBlock = {}));
    })(BaselineSyntax || (exports.BaselineSyntax = BaselineSyntax = {}));

    var RawInlineBlock = (function () {
        function RawInlineBlock(env, table, statements) {
            _classCallCheck(this, RawInlineBlock);

            this.env = env;
            this.table = table;
            this.statements = statements;
        }

        RawInlineBlock.prototype.scan = function scan() {
            var buffer = [];
            for (var i = 0; i < this.statements.length; i++) {
                var statement = this.statements[i];
                if (_glimmerWireFormat.Statements.isBlock(statement)) {
                    buffer.push(this.specializeBlock(statement));
                } else if (_glimmerWireFormat.Statements.isComponent(statement)) {
                    buffer.push.apply(buffer, this.specializeComponent(statement));
                } else {
                    buffer.push(statement);
                }
            }
            return new InlineBlock(buffer, this.table);
        };

        RawInlineBlock.prototype.specializeBlock = function specializeBlock(block) {
            var path = block[1];
            var params = block[2];
            var hash = block[3];
            var template = block[4];
            var inverse = block[5];

            return ['scanned-block', path, params, hash, this.child(template), this.child(inverse)];
        };

        RawInlineBlock.prototype.specializeComponent = function specializeComponent(sexp) {
            var tag = sexp[1];
            var component = sexp[2];

            if (this.env.hasComponentDefinition([tag], this.table)) {
                var child = this.child(component);
                var attrs = new RawInlineBlock(this.env, this.table, component.attrs);
                return [['scanned-component', tag, attrs, component.args, child]];
            } else {
                var buf = [];
                buf.push(['open-element', tag, []]);
                buf.push.apply(buf, component.attrs);
                buf.push(['flush-element']);
                buf.push.apply(buf, component.statements);
                buf.push(['close-element']);
                return buf;
            }
        };

        RawInlineBlock.prototype.child = function child(block) {
            if (!block) return null;
            var table = _glimmerRuntimeLibSymbolTable.block(this.table, block.locals);
            return new RawInlineBlock(this.env, table, block.statements);
        };

        return RawInlineBlock;
    })();

    exports.RawInlineBlock = RawInlineBlock;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL3NjYW5uZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBb0JNLGFBQUEsZ0JBQUEsQ0FBMkIsU0FBc0MsRUFBRSxPQUFzQixFQUFBO0FBQzdGLFlBQUksT0FBTyxHQUFHLG1DQU5kLFVBQVUsQ0FNZSxVQUFVLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUNwRSwwQ0FYQSxVQUFVLENBV0MsT0FBTyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztLQUN0Qzs7UUFFSyxRQUFBLEdBQ0osU0FESSxRQUFBLENBQ2UsVUFBeUMsRUFBUyxXQUF3QixFQUFBOzhCQUR6RixRQUFBOztBQUNlLFlBQUEsQ0FBQSxVQUFVLEdBQVYsVUFBVSxDQUErQjtBQUFTLFlBQUEsQ0FBQSxXQUFXLEdBQVgsV0FBVyxDQUFhO0tBQUk7Ozs7UUFHN0YsTUFBYztrQkFBZCxNQUFjOztpQkFBZCxNQUFjO2tDQUFkLE1BQWM7Ozs7O2VBQWQsTUFBYztPQUFRLFFBQVE7Ozs7UUFJOUIsVUFBa0I7a0JBQWxCLFVBQWtCOztpQkFBbEIsVUFBa0I7a0NBQWxCLFVBQWtCOzs7OztBQUFsQixrQkFBa0IsV0FHdEIsT0FBTyxHQUFBLGlCQUFDLEdBQWdCLEVBQUE7QUFDdEIsZ0JBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7QUFFN0IsZ0JBQUksQ0FBQyxHQUFHLDJCQXRDSCxPQUFPLENBc0NJLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUU1QixpQkFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQy9DLG9CQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ25DLG9CQUFJLE9BQU8sR0FBRyxtQ0E1QmxCLFVBQVUsQ0E0Qm1CLFVBQVUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDdEQsa0RBakNKLFVBQVUsQ0FpQ0ssT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQzthQUNoQztBQUVELG1CQUFPLHFDQS9DRixlQUFlLENBK0NPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ2hFOztlQWZHLFVBQWtCO09BQVEsUUFBUTs7OztRQWtCbEMsV0FBbUI7a0JBQW5CLFdBQW1COztpQkFBbkIsV0FBbUI7a0NBQW5CLFdBQW1COzs7OztBQUFuQixtQkFBbUIsV0FDdkIsS0FBSyxHQUFBLGVBQUMsT0FBc0IsRUFBQTtBQUMxQixnQkFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUVoQyxnQkFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLFVBQVUsRUFBRSxDQUFDLE1BQU0sQ0FBQztBQUV2QyxnQkFBSSxNQUFNLEVBQUU7QUFDVix1QkFBTyxDQUFDLGNBQWMsRUFBRSxDQUFDO0FBQ3pCLHVCQUFPLENBQUMsMkJBQTJCLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDN0M7QUFFRCxpQkFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQy9DLG9CQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ25DLG9CQUFJLE9BQU8sR0FBRyxtQ0FqRGxCLFVBQVUsQ0FpRG1CLFVBQVUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDdEQsa0RBdERKLFVBQVUsQ0FzREssT0FBTyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQzthQUN0QztBQUVELGdCQUFJLE1BQU0sRUFBRTtBQUNWLHVCQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7YUFDcEI7U0FDRjs7QUFwQkcsbUJBQW1CLFdBc0J2QixPQUFPLEdBQUEsaUJBQUMsR0FBZ0IsRUFBQTtBQUN0QixnQkFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztBQUM3QixnQkFBSSxDQUFDLEdBQUcsMkJBMUVILE9BQU8sQ0EwRUksR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBRTVCLGdCQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBRWQsbUJBQU8scUNBL0VlLGFBQWEsQ0ErRVYsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7U0FDdkM7O2VBN0JHLFdBQW1CO09BQVEsUUFBUTs7OztRQWdDbkMsWUFBb0I7a0JBQXBCLFlBQW9COztpQkFBcEIsWUFBb0I7a0NBQXBCLFlBQW9COzs7OztBQUFwQixvQkFBb0IsV0FHeEIsT0FBTyxHQUFBLGlCQUFDLEdBQWdCLEVBQUE7QUFDdEIsZ0JBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7QUFDN0IsZ0JBQUksQ0FBQyxHQUFHLDJCQXZGSCxPQUFPLENBdUZJLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUU1QixpQkFBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO0FBQy9DLG9CQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ25DLG9CQUFJLE9BQU8sR0FBRyxtQ0E3RWxCLFVBQVUsQ0E2RW1CLFVBQVUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDdEQsa0RBbEZKLFVBQVUsQ0FrRkssT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQzthQUNoQztBQUVELG1CQUFPLHFDQWhHRixlQUFlLENBZ0dPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDckQ7O2VBZEcsWUFBb0I7T0FBUSxRQUFROzs7O1FBaUI1QixPQUFBO0FBQ1osaUJBRFksT0FBQSxDQUNRLEtBQThCLEVBQVUsSUFBa0IsRUFBVSxHQUFnQixFQUFBO2tDQUQ1RixPQUFBOztBQUNRLGdCQUFBLENBQUEsS0FBSyxHQUFMLEtBQUssQ0FBeUI7QUFBVSxnQkFBQSxDQUFBLElBQUksR0FBSixJQUFJLENBQWM7QUFBVSxnQkFBQSxDQUFBLEdBQUcsR0FBSCxHQUFHLENBQWE7U0FDdkc7O0FBRlcsZUFBQSxXQUlaLGNBQWMsR0FBQSwwQkFBQTtnQkFDTixLQUFLLEdBQVcsSUFBSSxDQUFwQixLQUFLO2dCQUFFLElBQUksR0FBSyxJQUFJLENBQWIsSUFBSTs7QUFFakIsZ0JBQUksV0FBVyxHQUFHLDhCQXBHYixVQUFVLENBb0dtQixJQUFJLENBQUMsQ0FBQztBQUN4QyxnQkFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLEtBQUssRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3BELG1CQUFPLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUM7U0FDdEQ7O0FBVlcsZUFBQSxXQVlaLFVBQVUsR0FBQSxzQkFBQTtnQkFDRixLQUFLLEdBQVcsSUFBSSxDQUFwQixLQUFLO2dCQUFFLElBQUksR0FBSyxJQUFJLENBQWIsSUFBSTtnQkFDWCxLQUFLLEdBQTBCLEtBQUssQ0FBcEMsS0FBSztnQkFBRSxNQUFNLEdBQWtCLEtBQUssQ0FBN0IsTUFBTTtnQkFBRSxXQUFXLEdBQUssS0FBSyxDQUFyQixXQUFXOztBQUVoQyxnQkFBSSxXQUFXLEdBQUcsOEJBN0drQixNQUFNLENBNkdaLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQ2hFLGdCQUFJLEtBQUssR0FBRyxTQUFTLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFFcEQsbUJBQU8sSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQztTQUNsRDs7QUFwQlcsZUFBQSxXQXNCWixXQUFXLEdBQUEscUJBQUMsV0FBd0IsRUFBQTtnQkFDNUIsS0FBSyxHQUFLLElBQUksQ0FBZCxLQUFLOztBQUVYLGdCQUFJLEtBQUssR0FBRyxTQUFTLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFFcEQsbUJBQU8sSUFBSSxZQUFZLENBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQztTQUN4RDs7ZUE1QlcsT0FBQTs7O3NCQUFBLE9BQUE7O0FBK0JSLGFBQUEsU0FBQSxDQUFvQixJQUErQixFQUFFLFdBQXdCLEVBQUUsR0FBZ0IsRUFBQTtZQUF6RSxVQUFVLEdBQVosSUFBK0IsQ0FBN0IsVUFBVTs7QUFDcEMsZUFBTyxJQUFJLGNBQWMsQ0FBQyxHQUFHLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ2hFOztBQUtLLFFBQVcsY0FBYyxDQThFOUI7O0FBOUVELEtBQUEsVUFBaUIsY0FBYyxFQUFBO0FBS2hCLHNCQUFBLENBQUEsa0JBQWtCLEdBQUcsbUJBQVcsRUFBRSxDQUFtQixtQkFBbUIsQ0FBQyxDQUFDO0FBTzFFLHNCQUFBLENBQUEsa0JBQWtCLEdBQUcsbUJBQVcsRUFBRSxDQUF1Qix3QkFBd0IsQ0FBQyxDQUFDO0FBR25GLHNCQUFBLENBQUEsaUJBQWlCLEdBQUcsbUJBQVcsRUFBRSxDQUFrQixrQkFBa0IsQ0FBQyxDQUFDO0FBR3ZFLHNCQUFBLENBQUEsbUJBQW1CLEdBQUcsbUJBQVcsRUFBRSxDQUFvQixvQkFBb0IsQ0FBQyxDQUFDO0FBRzdFLHNCQUFBLENBQUEsU0FBUyxHQUFHLG1CQUFXLEVBQUUsQ0FBaUIsa0JBQWtCLENBQUMsQ0FBQztBQUc5RCxzQkFBQSxDQUFBLGVBQWUsR0FBRyxtQkFBVyxFQUFFLENBQWdCLGdCQUFnQixDQUFDLENBQUM7QUFFakUsc0JBQUEsQ0FBQSxnQkFBZ0IsR0FBRyxtQkFBVyxFQUFFLENBQWlCLGlCQUFpQixDQUFDLENBQUM7QUFJcEUsc0JBQUEsQ0FBQSxvQkFBb0IsR0FBRyxtQkFBVyxFQUFFLENBQXFCLFVBQVUsQ0FBQyxDQUFDO0FBR3JFLHNCQUFBLENBQUEsYUFBYSxHQUFHLG1CQUFXLEVBQUUsQ0FBYyxjQUFjLENBQUMsQ0FBQztBQUczRCxzQkFBQSxDQUFBLGNBQWMsR0FBRyxtQkFBVyxFQUFFLENBQWUsZUFBZSxDQUFDLENBQUM7QUFHOUQsc0JBQUEsQ0FBQSxVQUFVLEdBQUcsbUJBQVcsRUFBRSxDQUFXLFVBQVUsQ0FBQyxDQUFDO0FBSTlELFlBQWlCLFdBQVcsQ0FnQjNCO0FBaEJELFNBQUEsVUFBaUIsV0FBVyxFQUFBO0FBQzFCLHFCQUFBLFlBQUEsQ0FBNkIsSUFBaUIsRUFBQTtBQUM1Qyx1QkFBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDaEI7QUFGZSx1QkFBQSxDQUFBLFlBQVksR0FBQSxZQUUzQixDQUFBO0FBRUQscUJBQUEsWUFBQSxDQUE2QixJQUFpQixFQUFBO0FBQzVDLHVCQUFPLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNoQjtBQUZlLHVCQUFBLENBQUEsWUFBWSxHQUFBLFlBRTNCLENBQUE7QUFFRCxxQkFBQSxNQUFBLENBQXVCLElBQWlCLEVBQUE7QUFDdEMsdUJBQU8sSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2hCO0FBRmUsdUJBQUEsQ0FBQSxNQUFNLEdBQUEsTUFFckIsQ0FBQTtBQUVELHFCQUFBLElBQUEsQ0FBcUIsSUFBaUIsRUFBQTtBQUNwQyx1QkFBTyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDaEI7QUFGZSx1QkFBQSxDQUFBLElBQUksR0FBQSxJQUVuQixDQUFBO1NBQ0YsQ0FBQSxDQWhCZ0IsV0FBVyxHQUFYLGNBQUEsQ0FBQSxXQUFXLEtBQVgsY0FBQSxDQUFBLFdBQVcsR0FBQSxFQUFBLENBQUEsQ0FBQSxDQWdCM0I7S0FtQkYsQ0FBQSxDQTlFZ0IsY0FBYyxhQUFkLGNBQWMsR0FBZCxjQUFjLEdBQUEsRUFBQSxDQUFBLENBQUEsQ0E4RTlCOztRQUVLLGNBQUE7QUFDSixpQkFESSxjQUFBLENBQ2dCLEdBQWdCLEVBQVUsS0FBa0IsRUFBVSxVQUFpQyxFQUFBO2tDQUR2RyxjQUFBOztBQUNnQixnQkFBQSxDQUFBLEdBQUcsR0FBSCxHQUFHLENBQWE7QUFBVSxnQkFBQSxDQUFBLEtBQUssR0FBTCxLQUFLLENBQWE7QUFBVSxnQkFBQSxDQUFBLFVBQVUsR0FBVixVQUFVLENBQXVCO1NBQUk7O0FBRDNHLHNCQUFBLFdBR0osSUFBSSxHQUFBLGdCQUFBO0FBQ0YsZ0JBQUksTUFBTSxHQUFrQyxFQUFFLENBQUM7QUFFL0MsaUJBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUM5QyxvQkFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNuQyxvQkFBSSxtQkFBVyxVQUFVLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFO0FBQzVDLDBCQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztpQkFDOUMsTUFBTSxJQUFJLG1CQUFXLFVBQVUsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLEVBQUU7QUFDdkQsMEJBQU0sQ0FBQyxJQUFJLE1BQUEsQ0FBWCxNQUFNLEVBQVMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7aUJBQ3JELE1BQU07QUFDTCwwQkFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztpQkFDeEI7YUFDRjtBQUVELG1CQUFPLElBQUksV0FBVyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDNUM7O0FBbEJHLHNCQUFBLFdBb0JJLGVBQWUsR0FBQSx5QkFBQyxLQUFrQyxFQUFBO2dCQUNqRCxJQUFJLEdBQXFDLEtBQUs7Z0JBQXhDLE1BQU0sR0FBNkIsS0FBSztnQkFBaEMsSUFBSSxHQUF1QixLQUFLO2dCQUExQixRQUFRLEdBQWEsS0FBSztnQkFBaEIsT0FBTyxHQUFJLEtBQUs7O0FBQ3JELG1CQUFPLENBQUMsZUFBZSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1NBQ3pGOztBQXZCRyxzQkFBQSxXQXlCSSxtQkFBbUIsR0FBQSw2QkFBQyxJQUFxQyxFQUFBO2dCQUN4RCxHQUFHLEdBQWUsSUFBSTtnQkFBakIsU0FBUyxHQUFJLElBQUk7O0FBRTdCLGdCQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDdEQsb0JBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDbEMsb0JBQUksS0FBSyxHQUFHLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDdEUsdUJBQU8sQ0FBQyxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsU0FBUyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO2FBQ25FLE1BQU07QUFDTCxvQkFBSSxHQUFHLEdBQWtDLEVBQUUsQ0FBQztBQUM1QyxtQkFBRyxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNwQyxtQkFBRyxDQUFDLElBQUksTUFBQSxDQUFSLEdBQUcsRUFBUyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDN0IsbUJBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDO0FBQzVCLG1CQUFHLENBQUMsSUFBSSxNQUFBLENBQVIsR0FBRyxFQUFTLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNsQyxtQkFBRyxDQUFDLElBQUksQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7QUFDNUIsdUJBQU8sR0FBRyxDQUFDO2FBQ1o7U0FDRjs7QUF6Q0csc0JBQUEsV0EyQ0osS0FBSyxHQUFBLGVBQUMsS0FBOEIsRUFBQTtBQUNsQyxnQkFBSSxDQUFDLEtBQUssRUFBRSxPQUFPLElBQUksQ0FBQztBQUN4QixnQkFBSSxLQUFLLEdBQUcsOEJBaFErQyxLQUFLLENBZ1F6QyxJQUFJLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUNqRCxtQkFBTyxJQUFJLGNBQWMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7U0FDOUQ7O2VBL0NHLGNBQUEiLCJmaWxlIjoic2Nhbm5lci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBpbGVkUHJvZ3JhbSwgQ29tcGlsZWRCbG9jayB9IGZyb20gJy4vY29tcGlsZWQvYmxvY2tzJztcbmltcG9ydCB7IGJ1aWxkZXIgfSBmcm9tICcuL2NvbXBpbGVyJztcbmltcG9ydCBPcGNvZGVCdWlsZGVyIGZyb20gJy4vY29tcGlsZWQvb3Bjb2Rlcy9idWlsZGVyJztcbmltcG9ydCBFbnZpcm9ubWVudCBmcm9tICcuL2Vudmlyb25tZW50JztcbmltcG9ydCB7IE9wdGlvbiB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgU2VyaWFsaXplZFRlbXBsYXRlQmxvY2ssIFRlbXBsYXRlTWV0YSwgU2VyaWFsaXplZEJsb2NrLCBTdGF0ZW1lbnQgYXMgU2VyaWFsaXplZFN0YXRlbWVudCB9IGZyb20gJ0BnbGltbWVyL3dpcmUtZm9ybWF0JztcbmltcG9ydCAqIGFzIFdpcmVGb3JtYXQgZnJvbSAnQGdsaW1tZXIvd2lyZS1mb3JtYXQnO1xuaW1wb3J0IHsgZW50cnlQb2ludCBhcyBlbnRyeVBvaW50VGFibGUsIGxheW91dCBhcyBsYXlvdXRUYWJsZSwgYmxvY2sgYXMgYmxvY2tUYWJsZSB9IGZyb20gJy4vc3ltYm9sLXRhYmxlJztcbmltcG9ydCB7IE9wYXF1ZSwgU3ltYm9sVGFibGUsIFByb2dyYW1TeW1ib2xUYWJsZSB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuXG5pbXBvcnQge1xuICBTVEFURU1FTlRTXG59IGZyb20gJy4vc3ludGF4L2Z1bmN0aW9ucyc7XG5cbmltcG9ydCB7XG4gIFNQRUNJQUxJWkVcbn0gZnJvbSAnLi9zeW50YXgvc3BlY2lhbGl6ZSc7XG5cbmV4cG9ydCB0eXBlIERlc2VyaWFsaXplZFN0YXRlbWVudCA9IFdpcmVGb3JtYXQuU3RhdGVtZW50IHwgV2lyZUZvcm1hdC5TdGF0ZW1lbnRzLkF0dHJpYnV0ZSB8IFdpcmVGb3JtYXQuU3RhdGVtZW50cy5Bcmd1bWVudDtcblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBpbGVTdGF0ZW1lbnQoc3RhdGVtZW50OiBCYXNlbGluZVN5bnRheC5BbnlTdGF0ZW1lbnQsIGJ1aWxkZXI6IE9wY29kZUJ1aWxkZXIpIHtcbiAgbGV0IHJlZmluZWQgPSBTUEVDSUFMSVpFLnNwZWNpYWxpemUoc3RhdGVtZW50LCBidWlsZGVyLnN5bWJvbFRhYmxlKTtcbiAgU1RBVEVNRU5UUy5jb21waWxlKHJlZmluZWQsIGJ1aWxkZXIpO1xufVxuXG5leHBvcnQgY2xhc3MgVGVtcGxhdGUge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgc3RhdGVtZW50czogQmFzZWxpbmVTeW50YXguQW55U3RhdGVtZW50W10sIHB1YmxpYyBzeW1ib2xUYWJsZTogU3ltYm9sVGFibGUpIHt9XG59XG5cbmV4cG9ydCBjbGFzcyBMYXlvdXQgZXh0ZW5kcyBUZW1wbGF0ZSB7XG4gIHB1YmxpYyBzeW1ib2xUYWJsZTogUHJvZ3JhbVN5bWJvbFRhYmxlO1xufVxuXG5leHBvcnQgY2xhc3MgRW50cnlQb2ludCBleHRlbmRzIFRlbXBsYXRlIHtcbiAgcHVibGljIHN5bWJvbFRhYmxlOiBQcm9ncmFtU3ltYm9sVGFibGU7XG5cbiAgY29tcGlsZShlbnY6IEVudmlyb25tZW50KTogQ29tcGlsZWRQcm9ncmFtIHtcbiAgICBsZXQgdGFibGUgPSB0aGlzLnN5bWJvbFRhYmxlO1xuXG4gICAgbGV0IGIgPSBidWlsZGVyKGVudiwgdGFibGUpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnN0YXRlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBzdGF0ZW1lbnQgPSB0aGlzLnN0YXRlbWVudHNbaV07XG4gICAgICBsZXQgcmVmaW5lZCA9IFNQRUNJQUxJWkUuc3BlY2lhbGl6ZShzdGF0ZW1lbnQsIHRhYmxlKTtcbiAgICAgIFNUQVRFTUVOVFMuY29tcGlsZShyZWZpbmVkLCBiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IENvbXBpbGVkUHJvZ3JhbShiLnRvU2xpY2UoKSwgdGhpcy5zeW1ib2xUYWJsZS5zaXplKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSW5saW5lQmxvY2sgZXh0ZW5kcyBUZW1wbGF0ZSB7XG4gIHNwbGF0KGJ1aWxkZXI6IE9wY29kZUJ1aWxkZXIpIHtcbiAgICBsZXQgdGFibGUgPSBidWlsZGVyLnN5bWJvbFRhYmxlO1xuXG4gICAgbGV0IGxvY2FscyA9IHRhYmxlLmdldFN5bWJvbHMoKS5sb2NhbHM7XG5cbiAgICBpZiAobG9jYWxzKSB7XG4gICAgICBidWlsZGVyLnB1c2hDaGlsZFNjb3BlKCk7XG4gICAgICBidWlsZGVyLmJpbmRQb3NpdGlvbmFsQXJnc0ZvckxvY2Fscyhsb2NhbHMpO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgc3RhdGVtZW50ID0gdGhpcy5zdGF0ZW1lbnRzW2ldO1xuICAgICAgbGV0IHJlZmluZWQgPSBTUEVDSUFMSVpFLnNwZWNpYWxpemUoc3RhdGVtZW50LCB0YWJsZSk7XG4gICAgICBTVEFURU1FTlRTLmNvbXBpbGUocmVmaW5lZCwgYnVpbGRlcik7XG4gICAgfVxuXG4gICAgaWYgKGxvY2Fscykge1xuICAgICAgYnVpbGRlci5wb3BTY29wZSgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBpbGUoZW52OiBFbnZpcm9ubWVudCk6IENvbXBpbGVkQmxvY2sge1xuICAgIGxldCB0YWJsZSA9IHRoaXMuc3ltYm9sVGFibGU7XG4gICAgbGV0IGIgPSBidWlsZGVyKGVudiwgdGFibGUpO1xuXG4gICAgdGhpcy5zcGxhdChiKTtcblxuICAgIHJldHVybiBuZXcgQ29tcGlsZWRCbG9jayhiLnRvU2xpY2UoKSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFBhcnRpYWxCbG9jayBleHRlbmRzIFRlbXBsYXRlIHtcbiAgcHVibGljIHN5bWJvbFRhYmxlOiBQcm9ncmFtU3ltYm9sVGFibGU7XG5cbiAgY29tcGlsZShlbnY6IEVudmlyb25tZW50KTogQ29tcGlsZWRQcm9ncmFtIHtcbiAgICBsZXQgdGFibGUgPSB0aGlzLnN5bWJvbFRhYmxlO1xuICAgIGxldCBiID0gYnVpbGRlcihlbnYsIHRhYmxlKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgc3RhdGVtZW50ID0gdGhpcy5zdGF0ZW1lbnRzW2ldO1xuICAgICAgbGV0IHJlZmluZWQgPSBTUEVDSUFMSVpFLnNwZWNpYWxpemUoc3RhdGVtZW50LCB0YWJsZSk7XG4gICAgICBTVEFURU1FTlRTLmNvbXBpbGUocmVmaW5lZCwgYik7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBDb21waWxlZFByb2dyYW0oYi50b1NsaWNlKCksIHRhYmxlLnNpemUpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNjYW5uZXIge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJsb2NrOiBTZXJpYWxpemVkVGVtcGxhdGVCbG9jaywgcHJpdmF0ZSBtZXRhOiBUZW1wbGF0ZU1ldGEsIHByaXZhdGUgZW52OiBFbnZpcm9ubWVudCkge1xuICB9XG5cbiAgc2NhbkVudHJ5UG9pbnQoKTogRW50cnlQb2ludCB7XG4gICAgbGV0IHsgYmxvY2ssIG1ldGEgfSA9IHRoaXM7XG5cbiAgICBsZXQgc3ltYm9sVGFibGUgPSBlbnRyeVBvaW50VGFibGUobWV0YSk7XG4gICAgbGV0IGNoaWxkID0gc2NhbkJsb2NrKGJsb2NrLCBzeW1ib2xUYWJsZSwgdGhpcy5lbnYpO1xuICAgIHJldHVybiBuZXcgRW50cnlQb2ludChjaGlsZC5zdGF0ZW1lbnRzLCBzeW1ib2xUYWJsZSk7XG4gIH1cblxuICBzY2FuTGF5b3V0KCk6IExheW91dCB7XG4gICAgbGV0IHsgYmxvY2ssIG1ldGEgfSA9IHRoaXM7XG4gICAgbGV0IHsgbmFtZWQsIHlpZWxkcywgaGFzUGFydGlhbHMgfSA9IGJsb2NrO1xuXG4gICAgbGV0IHN5bWJvbFRhYmxlID0gbGF5b3V0VGFibGUobWV0YSwgbmFtZWQsIHlpZWxkcywgaGFzUGFydGlhbHMpO1xuICAgIGxldCBjaGlsZCA9IHNjYW5CbG9jayhibG9jaywgc3ltYm9sVGFibGUsIHRoaXMuZW52KTtcblxuICAgIHJldHVybiBuZXcgTGF5b3V0KGNoaWxkLnN0YXRlbWVudHMsIHN5bWJvbFRhYmxlKTtcbiAgfVxuXG4gIHNjYW5QYXJ0aWFsKHN5bWJvbFRhYmxlOiBTeW1ib2xUYWJsZSk6IFBhcnRpYWxCbG9jayB7XG4gICAgbGV0IHsgYmxvY2sgfSA9IHRoaXM7XG5cbiAgICBsZXQgY2hpbGQgPSBzY2FuQmxvY2soYmxvY2ssIHN5bWJvbFRhYmxlLCB0aGlzLmVudik7XG5cbiAgICByZXR1cm4gbmV3IFBhcnRpYWxCbG9jayhjaGlsZC5zdGF0ZW1lbnRzLCBzeW1ib2xUYWJsZSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNjYW5CbG9jayh7IHN0YXRlbWVudHMgfTogU2VyaWFsaXplZEJsb2NrLCBzeW1ib2xUYWJsZTogU3ltYm9sVGFibGUsIGVudjogRW52aXJvbm1lbnQpOiBJbmxpbmVCbG9jayB7XG4gIHJldHVybiBuZXcgUmF3SW5saW5lQmxvY2soZW52LCBzeW1ib2xUYWJsZSwgc3RhdGVtZW50cykuc2NhbigpO1xufVxuXG5pbXBvcnQgeyBQdWJsaWNWTSB9IGZyb20gJy4vdm0nO1xuaW1wb3J0IHsgUGF0aFJlZmVyZW5jZSB9IGZyb20gJ0BnbGltbWVyL3JlZmVyZW5jZSc7XG5cbmV4cG9ydCBuYW1lc3BhY2UgQmFzZWxpbmVTeW50YXgge1xuICBpbXBvcnQgQ29yZSA9IFdpcmVGb3JtYXQuQ29yZTtcblxuICAvLyBUT0RPOiB1c2Ugc3ltYm9scyBmb3Igc2V4cFswXT9cbiAgZXhwb3J0IHR5cGUgU2Nhbm5lZENvbXBvbmVudCA9IFsnc2Nhbm5lZC1jb21wb25lbnQnLCBzdHJpbmcsIFJhd0lubGluZUJsb2NrLCBXaXJlRm9ybWF0LkNvcmUuSGFzaCwgT3B0aW9uPFJhd0lubGluZUJsb2NrPl07XG4gIGV4cG9ydCBjb25zdCBpc1NjYW5uZWRDb21wb25lbnQgPSBXaXJlRm9ybWF0LmlzPFNjYW5uZWRDb21wb25lbnQ+KCdzY2FubmVkLWNvbXBvbmVudCcpO1xuXG4gIGltcG9ydCBQYXJhbXMgPSBXaXJlRm9ybWF0LkNvcmUuUGFyYW1zO1xuICBpbXBvcnQgSGFzaCA9IFdpcmVGb3JtYXQuQ29yZS5IYXNoO1xuICBleHBvcnQgdHlwZSBCbG9jayA9IElubGluZUJsb2NrO1xuXG4gIGV4cG9ydCB0eXBlIE9wZW5QcmltaXRpdmVFbGVtZW50ID0gWydvcGVuLXByaW1pdGl2ZS1lbGVtZW50Jywgc3RyaW5nLCBzdHJpbmdbXV07XG4gIGV4cG9ydCBjb25zdCBpc1ByaW1pdGl2ZUVsZW1lbnQgPSBXaXJlRm9ybWF0LmlzPE9wZW5QcmltaXRpdmVFbGVtZW50Pignb3Blbi1wcmltaXRpdmUtZWxlbWVudCcpO1xuXG4gIGV4cG9ydCB0eXBlIE9wdGltaXplZEFwcGVuZCA9IFsnb3B0aW1pemVkLWFwcGVuZCcsIFdpcmVGb3JtYXQuRXhwcmVzc2lvbiwgYm9vbGVhbl07XG4gIGV4cG9ydCBjb25zdCBpc09wdGltaXplZEFwcGVuZCA9IFdpcmVGb3JtYXQuaXM8T3B0aW1pemVkQXBwZW5kPignb3B0aW1pemVkLWFwcGVuZCcpO1xuXG4gIGV4cG9ydCB0eXBlIFVub3B0aW1pemVkQXBwZW5kID0gWyd1bm9wdGltaXplZC1hcHBlbmQnLCBXaXJlRm9ybWF0LkV4cHJlc3Npb24sIGJvb2xlYW5dO1xuICBleHBvcnQgY29uc3QgaXNVbm9wdGltaXplZEFwcGVuZCA9IFdpcmVGb3JtYXQuaXM8VW5vcHRpbWl6ZWRBcHBlbmQ+KCd1bm9wdGltaXplZC1hcHBlbmQnKTtcblxuICBleHBvcnQgdHlwZSBBbnlEeW5hbWljQXR0ciA9IFsnYW55LWR5bmFtaWMtYXR0cicsIHN0cmluZywgV2lyZUZvcm1hdC5FeHByZXNzaW9uLCBPcHRpb248c3RyaW5nPiwgYm9vbGVhbl07XG4gIGV4cG9ydCBjb25zdCBpc0FueUF0dHIgPSBXaXJlRm9ybWF0LmlzPEFueUR5bmFtaWNBdHRyPignYW55LWR5bmFtaWMtYXR0cicpO1xuXG4gIGV4cG9ydCB0eXBlIFN0YXRpY1BhcnRpYWwgPSBbJ3N0YXRpYy1wYXJ0aWFsJywgc3RyaW5nXTtcbiAgZXhwb3J0IGNvbnN0IGlzU3RhdGljUGFydGlhbCA9IFdpcmVGb3JtYXQuaXM8U3RhdGljUGFydGlhbD4oJ3N0YXRpYy1wYXJ0aWFsJyk7XG4gIGV4cG9ydCB0eXBlIER5bmFtaWNQYXJ0aWFsID0gWydkeW5hbWljLXBhcnRpYWwnLCBXaXJlRm9ybWF0LkV4cHJlc3Npb25dO1xuICBleHBvcnQgY29uc3QgaXNEeW5hbWljUGFydGlhbCA9IFdpcmVGb3JtYXQuaXM8RHluYW1pY1BhcnRpYWw+KCdkeW5hbWljLXBhcnRpYWwnKTtcblxuICBleHBvcnQgdHlwZSBGdW5jdGlvbkV4cHJlc3Npb25DYWxsYmFjazxUPiA9IChWTTogUHVibGljVk0sIHN5bWJvbFRhYmxlOiBTeW1ib2xUYWJsZSkgPT4gUGF0aFJlZmVyZW5jZTxUPjtcbiAgZXhwb3J0IHR5cGUgRnVuY3Rpb25FeHByZXNzaW9uID0gWydmdW5jdGlvbicsIEZ1bmN0aW9uRXhwcmVzc2lvbkNhbGxiYWNrPE9wYXF1ZT5dO1xuICBleHBvcnQgY29uc3QgaXNGdW5jdGlvbkV4cHJlc3Npb24gPSBXaXJlRm9ybWF0LmlzPEZ1bmN0aW9uRXhwcmVzc2lvbj4oJ2Z1bmN0aW9uJyk7XG5cbiAgZXhwb3J0IHR5cGUgTmVzdGVkQmxvY2sgPSBbJ25lc3RlZC1ibG9jaycsIFdpcmVGb3JtYXQuQ29yZS5QYXRoLCBXaXJlRm9ybWF0LkNvcmUuUGFyYW1zLCBXaXJlRm9ybWF0LkNvcmUuSGFzaCwgT3B0aW9uPEJsb2NrPiwgT3B0aW9uPEJsb2NrPl07XG4gIGV4cG9ydCBjb25zdCBpc05lc3RlZEJsb2NrID0gV2lyZUZvcm1hdC5pczxOZXN0ZWRCbG9jaz4oJ25lc3RlZC1ibG9jaycpO1xuXG4gIGV4cG9ydCB0eXBlIFNjYW5uZWRCbG9jayA9IFsnc2Nhbm5lZC1ibG9jaycsIENvcmUuUGF0aCwgQ29yZS5QYXJhbXMsIENvcmUuSGFzaCwgT3B0aW9uPFJhd0lubGluZUJsb2NrPiwgT3B0aW9uPFJhd0lubGluZUJsb2NrPl07XG4gIGV4cG9ydCBjb25zdCBpc1NjYW5uZWRCbG9jayA9IFdpcmVGb3JtYXQuaXM8U2Nhbm5lZEJsb2NrPignc2Nhbm5lZC1ibG9jaycpO1xuXG4gIGV4cG9ydCB0eXBlIERlYnVnZ2VyID0gWydkZWJ1Z2dlciddO1xuICBleHBvcnQgY29uc3QgaXNEZWJ1Z2dlciA9IFdpcmVGb3JtYXQuaXM8RGVidWdnZXI+KCdkZWJ1Z2dlcicpO1xuXG4gIGV4cG9ydCB0eXBlIEFyZ3MgPSBbUGFyYW1zLCBIYXNoLCBPcHRpb248QmxvY2s+LCBPcHRpb248QmxvY2s+XTtcblxuICBleHBvcnQgbmFtZXNwYWNlIE5lc3RlZEJsb2NrIHtcbiAgICBleHBvcnQgZnVuY3Rpb24gZGVmYXVsdEJsb2NrKHNleHA6IE5lc3RlZEJsb2NrKTogT3B0aW9uPElubGluZUJsb2NrPiB7XG4gICAgICByZXR1cm4gc2V4cFs0XTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gaW52ZXJzZUJsb2NrKHNleHA6IE5lc3RlZEJsb2NrKTogT3B0aW9uPElubGluZUJsb2NrPiB7XG4gICAgICByZXR1cm4gc2V4cFs1XTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gcGFyYW1zKHNleHA6IE5lc3RlZEJsb2NrKTogV2lyZUZvcm1hdC5Db3JlLlBhcmFtcyB7XG4gICAgICByZXR1cm4gc2V4cFsyXTtcbiAgICB9XG5cbiAgICBleHBvcnQgZnVuY3Rpb24gaGFzaChzZXhwOiBOZXN0ZWRCbG9jayk6IFdpcmVGb3JtYXQuQ29yZS5IYXNoIHtcbiAgICAgIHJldHVybiBzZXhwWzNdO1xuICAgIH1cbiAgfVxuXG4gIGV4cG9ydCB0eXBlIFN0YXRlbWVudCA9XG4gICAgICBTY2FubmVkQ29tcG9uZW50XG4gICAgfCBPcGVuUHJpbWl0aXZlRWxlbWVudFxuICAgIHwgT3B0aW1pemVkQXBwZW5kXG4gICAgfCBVbm9wdGltaXplZEFwcGVuZFxuICAgIHwgU3RhdGljUGFydGlhbFxuICAgIHwgRHluYW1pY1BhcnRpYWxcbiAgICB8IEFueUR5bmFtaWNBdHRyXG4gICAgfCBOZXN0ZWRCbG9ja1xuICAgIHwgU2Nhbm5lZEJsb2NrXG4gICAgfCBEZWJ1Z2dlclxuICAgIDtcblxuICBleHBvcnQgdHlwZSBBbnlTdGF0ZW1lbnQgPSBTdGF0ZW1lbnQgfCBXaXJlRm9ybWF0LlN0YXRlbWVudDtcbiAgZXhwb3J0IHR5cGUgQW55RXhwcmVzc2lvbiA9IEZ1bmN0aW9uRXhwcmVzc2lvbiB8IFdpcmVGb3JtYXQuRXhwcmVzc2lvbjtcblxuICBleHBvcnQgdHlwZSBQcm9ncmFtID0gQW55U3RhdGVtZW50W107XG59XG5cbmV4cG9ydCBjbGFzcyBSYXdJbmxpbmVCbG9jayB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgZW52OiBFbnZpcm9ubWVudCwgcHJpdmF0ZSB0YWJsZTogU3ltYm9sVGFibGUsIHByaXZhdGUgc3RhdGVtZW50czogU2VyaWFsaXplZFN0YXRlbWVudFtdKSB7fVxuXG4gIHNjYW4oKTogSW5saW5lQmxvY2sge1xuICAgIGxldCBidWZmZXI6IEJhc2VsaW5lU3ludGF4LkFueVN0YXRlbWVudFtdID0gW107XG5cbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgdGhpcy5zdGF0ZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgc3RhdGVtZW50ID0gdGhpcy5zdGF0ZW1lbnRzW2ldO1xuICAgICAgaWYgKFdpcmVGb3JtYXQuU3RhdGVtZW50cy5pc0Jsb2NrKHN0YXRlbWVudCkpIHtcbiAgICAgICAgYnVmZmVyLnB1c2godGhpcy5zcGVjaWFsaXplQmxvY2soc3RhdGVtZW50KSk7XG4gICAgICB9IGVsc2UgaWYgKFdpcmVGb3JtYXQuU3RhdGVtZW50cy5pc0NvbXBvbmVudChzdGF0ZW1lbnQpKSB7XG4gICAgICAgIGJ1ZmZlci5wdXNoKC4uLnRoaXMuc3BlY2lhbGl6ZUNvbXBvbmVudChzdGF0ZW1lbnQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJ1ZmZlci5wdXNoKHN0YXRlbWVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBJbmxpbmVCbG9jayhidWZmZXIsIHRoaXMudGFibGUpO1xuICB9XG5cbiAgcHJpdmF0ZSBzcGVjaWFsaXplQmxvY2soYmxvY2s6IFdpcmVGb3JtYXQuU3RhdGVtZW50cy5CbG9jayk6IEJhc2VsaW5lU3ludGF4LlNjYW5uZWRCbG9jayB7XG4gICAgbGV0IFssIHBhdGgsIHBhcmFtcywgaGFzaCwgdGVtcGxhdGUsIGludmVyc2VdID0gYmxvY2s7XG4gICAgcmV0dXJuIFsnc2Nhbm5lZC1ibG9jaycsIHBhdGgsIHBhcmFtcywgaGFzaCwgdGhpcy5jaGlsZCh0ZW1wbGF0ZSksIHRoaXMuY2hpbGQoaW52ZXJzZSldO1xuICB9XG5cbiAgcHJpdmF0ZSBzcGVjaWFsaXplQ29tcG9uZW50KHNleHA6IFdpcmVGb3JtYXQuU3RhdGVtZW50cy5Db21wb25lbnQpOiBCYXNlbGluZVN5bnRheC5BbnlTdGF0ZW1lbnRbXSB7XG4gICAgbGV0IFssIHRhZywgY29tcG9uZW50XSA9IHNleHA7XG5cbiAgICBpZiAodGhpcy5lbnYuaGFzQ29tcG9uZW50RGVmaW5pdGlvbihbdGFnXSwgdGhpcy50YWJsZSkpIHtcbiAgICAgIGxldCBjaGlsZCA9IHRoaXMuY2hpbGQoY29tcG9uZW50KTtcbiAgICAgIGxldCBhdHRycyA9IG5ldyBSYXdJbmxpbmVCbG9jayh0aGlzLmVudiwgdGhpcy50YWJsZSwgY29tcG9uZW50LmF0dHJzKTtcbiAgICAgIHJldHVybiBbWydzY2FubmVkLWNvbXBvbmVudCcsIHRhZywgYXR0cnMsIGNvbXBvbmVudC5hcmdzLCBjaGlsZF1dO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgYnVmOiBCYXNlbGluZVN5bnRheC5BbnlTdGF0ZW1lbnRbXSA9IFtdO1xuICAgICAgYnVmLnB1c2goWydvcGVuLWVsZW1lbnQnLCB0YWcsIFtdXSk7XG4gICAgICBidWYucHVzaCguLi5jb21wb25lbnQuYXR0cnMpO1xuICAgICAgYnVmLnB1c2goWydmbHVzaC1lbGVtZW50J10pO1xuICAgICAgYnVmLnB1c2goLi4uY29tcG9uZW50LnN0YXRlbWVudHMpO1xuICAgICAgYnVmLnB1c2goWydjbG9zZS1lbGVtZW50J10pO1xuICAgICAgcmV0dXJuIGJ1ZjtcbiAgICB9XG4gIH1cblxuICBjaGlsZChibG9jazogT3B0aW9uPFNlcmlhbGl6ZWRCbG9jaz4pOiBPcHRpb248UmF3SW5saW5lQmxvY2s+IHtcbiAgICBpZiAoIWJsb2NrKSByZXR1cm4gbnVsbDtcbiAgICBsZXQgdGFibGUgPSBibG9ja1RhYmxlKHRoaXMudGFibGUsIGJsb2NrLmxvY2Fscyk7XG4gICAgcmV0dXJuIG5ldyBSYXdJbmxpbmVCbG9jayh0aGlzLmVudiwgdGFibGUsIGJsb2NrLnN0YXRlbWVudHMpO1xuICB9XG59XG4iXX0=