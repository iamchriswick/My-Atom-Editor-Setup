enifed('@glimmer/runtime/lib/symbol-table', ['exports', '@glimmer/util'], function (exports, _glimmerUtil) {
    'use strict';

    exports.entryPoint = entryPoint;
    exports.layout = layout;
    exports.block = block;

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

    function entryPoint(meta) {
        return new ProgramSymbolTable(meta);
    }

    function layout(meta, wireNamed, wireYields, hasPartials) {
        var _symbols = symbols(wireNamed, wireYields, hasPartials);

        var named = _symbols.named;
        var yields = _symbols.yields;
        var partialSymbol = _symbols.partialSymbol;
        var size = _symbols.size;

        return new ProgramSymbolTable(meta, named, yields, partialSymbol, size);
    }

    function block(parent, locals) {
        var localsMap = null;
        var program = parent['program'];
        if (locals.length !== 0) {
            (function () {
                var map = localsMap = _glimmerUtil.dict();
                locals.forEach(function (l) {
                    return map[l] = program.size++;
                });
            })();
        }
        return new BlockSymbolTable(parent, program, localsMap);
    }

    function symbols(named, yields, hasPartials) {
        var yieldsMap = null;
        var namedMap = null;
        var size = 1;
        if (yields.length !== 0) {
            (function () {
                var map = yieldsMap = _glimmerUtil.dict();
                yields.forEach(function (y) {
                    return map[y] = size++;
                });
            })();
        }
        if (named.length !== 0) {
            (function () {
                var map = namedMap = _glimmerUtil.dict();
                named.forEach(function (y) {
                    return map[y] = size++;
                });
            })();
        }
        var partialSymbol = hasPartials ? size++ : null;
        return { named: namedMap, yields: yieldsMap, partialSymbol: partialSymbol, size: size };
    }

    var ProgramSymbolTable = (function () {
        function ProgramSymbolTable(meta) {
            var named = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];
            var yields = arguments.length <= 2 || arguments[2] === undefined ? null : arguments[2];
            var partialArgs = arguments.length <= 3 || arguments[3] === undefined ? null : arguments[3];
            var size = arguments.length <= 4 || arguments[4] === undefined ? 1 : arguments[4];

            _classCallCheck(this, ProgramSymbolTable);

            this.meta = meta;
            this.named = named;
            this.yields = yields;
            this.partialArgs = partialArgs;
            this.size = size;
            this.program = this;
        }

        ProgramSymbolTable.prototype.getMeta = function getMeta() {
            return this.meta;
        };

        ProgramSymbolTable.prototype.getSymbols = function getSymbols() {
            return {
                named: this.named,
                yields: this.yields,
                locals: null,
                partialArgs: this.partialArgs
            };
        };

        ProgramSymbolTable.prototype.getSymbol = function getSymbol(kind, name) {
            if (kind === 'local') return null;
            return this[kind] && this[kind][name];
        };

        ProgramSymbolTable.prototype.getPartialArgs = function getPartialArgs() {
            return this.partialArgs || 0;
        };

        return ProgramSymbolTable;
    })();

    exports.ProgramSymbolTable = ProgramSymbolTable;

    var BlockSymbolTable = (function () {
        function BlockSymbolTable(parent, program, locals) {
            _classCallCheck(this, BlockSymbolTable);

            this.parent = parent;
            this.program = program;
            this.locals = locals;
        }

        BlockSymbolTable.prototype.getMeta = function getMeta() {
            return this.program.getMeta();
        };

        BlockSymbolTable.prototype.getSymbols = function getSymbols() {
            return {
                named: null,
                yields: null,
                locals: this.locals,
                partialArgs: null
            };
        };

        BlockSymbolTable.prototype.getSymbol = function getSymbol(kind, name) {
            if (kind === 'local') {
                return this.getLocal(name);
            } else {
                return this.program.getSymbol(kind, name);
            }
        };

        BlockSymbolTable.prototype.getLocal = function getLocal(name) {
            var locals = this.locals;
            var parent = this.parent;

            var symbol = locals && locals[name];
            if (!symbol && parent) {
                symbol = parent.getSymbol('local', name);
            }
            return symbol;
        };

        BlockSymbolTable.prototype.getPartialArgs = function getPartialArgs() {
            return this.program.getPartialArgs();
        };

        return BlockSymbolTable;
    })();

    exports.BlockSymbolTable = BlockSymbolTable;
    var EMPTY_SYMBOL_TABLE = {
        getMeta: function () {
            return null;
        },
        getSymbols: function () {
            return {
                named: null,
                yields: null,
                locals: null,
                partialArgs: null
            };
        },
        getSymbol: function (_kind, _name) {
            throw new Error("BUG: Calling getSymbol on EMPTY_SYMBOL_TABLE");
        },
        getPartialArgs: function () {
            return null;
        }
    };
    exports.EMPTY_SYMBOL_TABLE = EMPTY_SYMBOL_TABLE;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL3N5bWJvbC10YWJsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFTTSxhQUFBLFVBQUEsQ0FBcUIsSUFBMEIsRUFBQTtBQUNuRCxlQUFPLElBQUksa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDckM7O0FBRUssYUFBQSxNQUFBLENBQWlCLElBQWtCLEVBQUUsU0FBbUIsRUFBRSxVQUFvQixFQUFFLFdBQW9CLEVBQUE7dUJBQzNELE9BQU8sQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLFdBQVcsQ0FBQzs7WUFBbEYsS0FBSyxZQUFMLEtBQUs7WUFBRSxNQUFNLFlBQU4sTUFBTTtZQUFFLGFBQWEsWUFBYixhQUFhO1lBQUUsSUFBSSxZQUFKLElBQUk7O0FBQ3hDLGVBQU8sSUFBSSxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7S0FDekU7O0FBRUssYUFBQSxLQUFBLENBQWdCLE1BQW1CLEVBQUUsTUFBZ0IsRUFBQTtBQUN6RCxZQUFJLFNBQVMsR0FBeUIsSUFBSSxDQUFDO0FBQzNDLFlBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUVoQyxZQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFOztBQUN2QixvQkFBSSxHQUFHLEdBQUcsU0FBUyxHQUFHLGFBdkJILElBQUksRUF1QmEsQ0FBQztBQUNyQyxzQkFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUM7MkJBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxJQUFJLEVBQUU7aUJBQUEsQ0FBQyxDQUFDOztTQUM5QztBQUVELGVBQU8sSUFBSSxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0tBQ3pEOztBQUVELGFBQUEsT0FBQSxDQUFpQixLQUFlLEVBQUUsTUFBZ0IsRUFB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SSxDQUFDO1NBQ2I7QUFFRCxrQkFBVSxFQUFBLFlBQUE7QUFDUixtQkFBTztBQUNMLHFCQUFLLEVBQUUsSUFBSTtBQUNYLHNCQUFNLEVBQUUsSUFBSTtBQUNaLHNCQUFNLEVBQUUsSUFBSTtBQUNaLDJCQUFXLEVBQUUsSUFBSTthQUNsQixDQUFDO1NBQ0g7QUFFRCxpQkFBUyxFQUFBLFVBQUMsS0FBWSxFQUFFLEtBQWEsRUFBQTtBQUNuQyxrQkFBTSxJQUFJLEtBQUssQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO1NBQ2pFO0FBRUQsc0JBQWMsRUFBQSxZQUFBO0FBQ1osbUJBQU8sSUFBSSxDQUFDO1NBQ2I7S0FDRixDQUFDIiwiZmlsZSI6InN5bWJvbC10YWJsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9wdGlvbiwgRGljdCwgZGljdCB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgVGVtcGxhdGVNZXRhIH0gZnJvbSAnQGdsaW1tZXIvd2lyZS1mb3JtYXQnO1xuaW1wb3J0IHtcbiAgU3ltYm9sVGFibGUsXG4gIFByb2dyYW1TeW1ib2xUYWJsZSBhcyBJUHJvZ3JhbVN5bWJvbFRhYmxlLFxuICBCbG9ja1N5bWJvbFRhYmxlIGFzIElCbG9ja1N5bWJvbFRhYmxlLFxuICBTeW1ib2xzXG59IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgZnVuY3Rpb24gZW50cnlQb2ludChtZXRhOiBPcHRpb248VGVtcGxhdGVNZXRhPik6IFByb2dyYW1TeW1ib2xUYWJsZSB7XG4gIHJldHVybiBuZXcgUHJvZ3JhbVN5bWJvbFRhYmxlKG1ldGEpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbGF5b3V0KG1ldGE6IFRlbXBsYXRlTWV0YSwgd2lyZU5hbWVkOiBzdHJpbmdbXSwgd2lyZVlpZWxkczogc3RyaW5nW10sIGhhc1BhcnRpYWxzOiBib29sZWFuKTogUHJvZ3JhbVN5bWJvbFRhYmxlIHtcbiAgbGV0IHsgbmFtZWQsIHlpZWxkcywgcGFydGlhbFN5bWJvbCwgc2l6ZSB9ID0gc3ltYm9scyh3aXJlTmFtZWQsIHdpcmVZaWVsZHMsIGhhc1BhcnRpYWxzKTtcbiAgcmV0dXJuIG5ldyBQcm9ncmFtU3ltYm9sVGFibGUobWV0YSwgbmFtZWQsIHlpZWxkcywgcGFydGlhbFN5bWJvbCwgc2l6ZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBibG9jayhwYXJlbnQ6IFN5bWJvbFRhYmxlLCBsb2NhbHM6IHN0cmluZ1tdKTogU3ltYm9sVGFibGUge1xuICBsZXQgbG9jYWxzTWFwOiBPcHRpb248RGljdDxudW1iZXI+PiA9IG51bGw7XG4gIGxldCBwcm9ncmFtID0gcGFyZW50Wydwcm9ncmFtJ107XG5cbiAgaWYgKGxvY2Fscy5sZW5ndGggIT09IDApIHtcbiAgICBsZXQgbWFwID0gbG9jYWxzTWFwID0gZGljdDxudW1iZXI+KCk7XG4gICAgbG9jYWxzLmZvckVhY2gobCA9PiBtYXBbbF0gPSBwcm9ncmFtLnNpemUrKyk7XG4gIH1cblxuICByZXR1cm4gbmV3IEJsb2NrU3ltYm9sVGFibGUocGFyZW50LCBwcm9ncmFtLCBsb2NhbHNNYXApO1xufVxuXG5mdW5jdGlvbiBzeW1ib2xzKG5hbWVkOiBzdHJpbmdbXSwgeWllbGRzOiBzdHJpbmdbXSwgaGFzUGFydGlhbHM6IGJvb2xlYW4pOiB7IG5hbWVkOiBPcHRpb248RGljdDxudW1iZXI+PiwgeWllbGRzOiBPcHRpb248RGljdDxudW1iZXI+PiwgcGFydGlhbFN5bWJvbDogT3B0aW9uPG51bWJlcj4sIHNpemU6IG51bWJlciB9IHtcbiAgbGV0IHlpZWxkc01hcDogT3B0aW9uPERpY3Q8bnVtYmVyPj4gPSBudWxsO1xuICBsZXQgbmFtZWRNYXA6IE9wdGlvbjxEaWN0PG51bWJlcj4+ID0gbnVsbDtcblxuICBsZXQgc2l6ZSA9IDE7XG5cbiAgaWYgKHlpZWxkcy5sZW5ndGggIT09IDApIHtcbiAgICBsZXQgbWFwID0geWllbGRzTWFwID0gZGljdDxudW1iZXI+KCk7XG4gICAgeWllbGRzLmZvckVhY2goeSA9PiBtYXBbeV0gPSBzaXplKyspO1xuICB9XG5cbiAgaWYgKG5hbWVkLmxlbmd0aCAhPT0gMCkge1xuICAgIGxldCBtYXAgPSBuYW1lZE1hcCA9IGRpY3Q8bnVtYmVyPigpO1xuICAgIG5hbWVkLmZvckVhY2goeSA9PiBtYXBbeV0gPSBzaXplKyspO1xuICB9XG5cbiAgbGV0IHBhcnRpYWxTeW1ib2w6IE9wdGlvbjxudW1iZXI+ID0gaGFzUGFydGlhbHMgPyBzaXplKysgOiBudWxsO1xuXG4gIHJldHVybiB7IG5hbWVkOiBuYW1lZE1hcCwgeWllbGRzOiB5aWVsZHNNYXAsIHBhcnRpYWxTeW1ib2wsIHNpemUgfTtcbn1cblxuZXhwb3J0IGNsYXNzIFByb2dyYW1TeW1ib2xUYWJsZSBpbXBsZW1lbnRzIElQcm9ncmFtU3ltYm9sVGFibGUge1xuICBwcm9ncmFtOiB0aGlzO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbWV0YTogT3B0aW9uPFRlbXBsYXRlTWV0YT4sXG4gICAgcHJpdmF0ZSBuYW1lZDogT3B0aW9uPERpY3Q8bnVtYmVyPj4gPSBudWxsLFxuICAgIHByaXZhdGUgeWllbGRzOiBPcHRpb248RGljdDxudW1iZXI+PiA9IG51bGwsXG4gICAgcHJpdmF0ZSBwYXJ0aWFsQXJnczogT3B0aW9uPG51bWJlcj4gPSBudWxsLFxuICAgIHB1YmxpYyBzaXplID0gMVxuICApIHtcbiAgICB0aGlzLnByb2dyYW0gPSB0aGlzO1xuICB9XG5cbiAgZ2V0TWV0YSgpOiBPcHRpb248VGVtcGxhdGVNZXRhPiB7XG4gICAgcmV0dXJuIHRoaXMubWV0YTtcbiAgfVxuXG4gIGdldFN5bWJvbHMoKTogU3ltYm9scyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWVkOiB0aGlzLm5hbWVkLFxuICAgICAgeWllbGRzOiB0aGlzLnlpZWxkcyxcbiAgICAgIGxvY2FsczogbnVsbCxcbiAgICAgIHBhcnRpYWxBcmdzOiB0aGlzLnBhcnRpYWxBcmdzXG4gICAgfTtcbiAgfVxuXG4gIGdldFN5bWJvbChraW5kOiAnbG9jYWwnLCBuYW1lOiBzdHJpbmcpOiBudWxsO1xuICBnZXRTeW1ib2woa2luZDogJ2xvY2FsJyB8ICduYW1lZCcgfCAneWllbGRzJywgbmFtZTogc3RyaW5nKTogT3B0aW9uPG51bWJlcj47XG4gIGdldFN5bWJvbChraW5kOiBzdHJpbmcsIG5hbWU6IHN0cmluZyk6IE9wdGlvbjxudW1iZXI+IHtcbiAgICBpZiAoa2luZCA9PT0gJ2xvY2FsJykgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHRoaXNba2luZF0gJiYgdGhpc1traW5kXVtuYW1lXTtcbiAgfVxuXG4gIGdldFBhcnRpYWxBcmdzKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucGFydGlhbEFyZ3MgfHwgMDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQmxvY2tTeW1ib2xUYWJsZSBpbXBsZW1lbnRzIElCbG9ja1N5bWJvbFRhYmxlIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwYXJlbnQ6IFN5bWJvbFRhYmxlLCBwcm90ZWN0ZWQgcHJvZ3JhbTogUHJvZ3JhbVN5bWJvbFRhYmxlLCBwcml2YXRlIGxvY2FsczogT3B0aW9uPERpY3Q8bnVtYmVyPj4pIHtcbiAgfVxuXG4gIGdldE1ldGEoKTogT3B0aW9uPFRlbXBsYXRlTWV0YT4ge1xuICAgIHJldHVybiB0aGlzLnByb2dyYW0uZ2V0TWV0YSgpO1xuICB9XG5cbiAgZ2V0U3ltYm9scygpOiBTeW1ib2xzIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZWQ6IG51bGwsXG4gICAgICB5aWVsZHM6IG51bGwsXG4gICAgICBsb2NhbHM6IHRoaXMubG9jYWxzLFxuICAgICAgcGFydGlhbEFyZ3M6IG51bGxcbiAgICB9O1xuICB9XG5cbiAgZ2V0U3ltYm9sKGtpbmQ6ICdsb2NhbCcgfCAnbmFtZWQnIHwgJ3lpZWxkcycsIG5hbWU6IHN0cmluZyk6IE9wdGlvbjxudW1iZXI+IHtcbiAgICBpZiAoa2luZCA9PT0gJ2xvY2FsJykge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TG9jYWwobmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnByb2dyYW0uZ2V0U3ltYm9sKGtpbmQsIG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0TG9jYWwobmFtZTogc3RyaW5nKTogT3B0aW9uPG51bWJlcj4ge1xuICAgIGxldCB7IGxvY2FscywgcGFyZW50IH0gPSB0aGlzO1xuXG4gICAgbGV0IHN5bWJvbDogT3B0aW9uPG51bWJlcj4gPSBsb2NhbHMgJiYgbG9jYWxzW25hbWVdO1xuXG4gICAgaWYgKCFzeW1ib2wgJiYgcGFyZW50KSB7XG4gICAgICBzeW1ib2wgPSBwYXJlbnQuZ2V0U3ltYm9sKCdsb2NhbCcsIG5hbWUpO1xuICAgIH1cblxuICAgIHJldHVybiBzeW1ib2w7XG4gIH1cblxuICBnZXRQYXJ0aWFsQXJncygpOiBPcHRpb248bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMucHJvZ3JhbS5nZXRQYXJ0aWFsQXJncygpO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBFTVBUWV9TWU1CT0xfVEFCTEU6IFN5bWJvbFRhYmxlID0ge1xuICBnZXRNZXRhKCkge1xuICAgIHJldHVybiBudWxsO1xuICB9LFxuXG4gIGdldFN5bWJvbHMoKTogU3ltYm9scyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWVkOiBudWxsLFxuICAgICAgeWllbGRzOiBudWxsLFxuICAgICAgbG9jYWxzOiBudWxsLFxuICAgICAgcGFydGlhbEFyZ3M6IG51bGxcbiAgICB9O1xuICB9LFxuXG4gIGdldFN5bWJvbChfa2luZDogbmV2ZXIsIF9uYW1lOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJVRzogQ2FsbGluZyBnZXRTeW1ib2wgb24gRU1QVFlfU1lNQk9MX1RBQkxFXCIpO1xuICB9LFxuXG4gIGdldFBhcnRpYWxBcmdzKCk6IE9wdGlvbjxudW1iZXI+IHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcbiJdfQ==