enifed('@glimmer/runtime/lib/vm/append', ['exports', '@glimmer/runtime/lib/environment', '@glimmer/util', '@glimmer/reference', '@glimmer/runtime/lib/compiled/opcodes/vm', '@glimmer/runtime/lib/vm/update', '@glimmer/runtime/lib/vm/render-result', '@glimmer/runtime/lib/vm/frame', '@glimmer/runtime/lib/opcodes'], function (exports, _glimmerRuntimeLibEnvironment, _glimmerUtil, _glimmerReference, _glimmerRuntimeLibCompiledOpcodesVm, _glimmerRuntimeLibVmUpdate, _glimmerRuntimeLibVmRenderResult, _glimmerRuntimeLibVmFrame, _glimmerRuntimeLibOpcodes) {
    'use strict';

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

    var VM = (function () {
        function VM(env, scope, dynamicScope, elementStack) {
            _classCallCheck(this, VM);

            this.env = env;
            this.elementStack = elementStack;
            this.dynamicScopeStack = new _glimmerUtil.Stack();
            this.scopeStack = new _glimmerUtil.Stack();
            this.updatingOpcodeStack = new _glimmerUtil.Stack();
            this.cacheGroups = new _glimmerUtil.Stack();
            this.listBlockStack = new _glimmerUtil.Stack();
            this.frame = new _glimmerRuntimeLibVmFrame.FrameStack();
            this.env = env;
            this.constants = env.constants;
            this.elementStack = elementStack;
            this.scopeStack.push(scope);
            this.dynamicScopeStack.push(dynamicScope);
        }

        VM.initial = function initial(env, self, dynamicScope, elementStack, size) {
            var scope = _glimmerRuntimeLibEnvironment.Scope.root(self, size);
            return new VM(env, scope, dynamicScope, elementStack);
        };

        VM.prototype.capture = function capture() {
            return {
                env: this.env,
                scope: this.scope(),
                dynamicScope: this.dynamicScope(),
                frame: this.frame.capture()
            };
        };

        VM.prototype.goto = function goto(ip) {
            // assert(this.frame.getOps().contains(op), `Illegal jump to ${op.label}`);
            this.frame.goto(ip);
        };

        VM.prototype.beginCacheGroup = function beginCacheGroup() {
            this.cacheGroups.push(this.updating().tail());
        };

        VM.prototype.commitCacheGroup = function commitCacheGroup() {
            //        JumpIfNotModified(END)
            //        (head)
            //        (....)
            //        (tail)
            //        DidModify
            // END:   Noop
            var END = new _glimmerRuntimeLibCompiledOpcodesVm.LabelOpcode("END");
            var opcodes = this.updating();
            var marker = this.cacheGroups.pop();
            var head = marker ? opcodes.nextNode(marker) : opcodes.head();
            var tail = opcodes.tail();
            var tag = _glimmerReference.combineSlice(new _glimmerUtil.ListSlice(head, tail));
            var guard = new _glimmerRuntimeLibCompiledOpcodesVm.JumpIfNotModifiedOpcode(tag, END);
            opcodes.insertBefore(guard, head);
            opcodes.append(new _glimmerRuntimeLibCompiledOpcodesVm.DidModifyOpcode(guard));
            opcodes.append(END);
        };

        VM.prototype.enter = function enter(sliceId) {
            var updating = new _glimmerUtil.LinkedList();
            var tracker = this.stack().pushUpdatableBlock();
            var state = this.capture();
            var slice = this.constants.getSlice(sliceId);
            var tryOpcode = new _glimmerRuntimeLibVmUpdate.TryOpcode(slice, state, tracker, updating);
            this.didEnter(tryOpcode, updating);
        };

        VM.prototype.enterWithKey = function enterWithKey(key, ops) {
            var updating = new _glimmerUtil.LinkedList();
            var tracker = this.stack().pushUpdatableBlock();
            var state = this.capture();
            var tryOpcode = new _glimmerRuntimeLibVmUpdate.TryOpcode(ops, state, tracker, updating);
            this.listBlock().map[key] = tryOpcode;
            this.didEnter(tryOpcode, updating);
        };

        VM.prototype.enterList = function enterList(ops) {
            var updating = new _glimmerUtil.LinkedList();
            var tracker = this.stack().pushBlockList(updating);
            var state = this.capture();
            var artifacts = this.frame.getIterator().artifacts;
            var opcode = new _glimmerRuntimeLibVmUpdate.ListBlockOpcode(ops, state, tracker, updating, artifacts);
            this.listBlockStack.push(opcode);
            this.didEnter(opcode, updating);
        };

        VM.prototype.didEnter = function didEnter(opcode, updating) {
            this.updateWith(opcode);
            this.updatingOpcodeStack.push(updating);
        };

        VM.prototype.exit = function exit() {
            this.stack().popBlock();
            this.updatingOpcodeStack.pop();
            var parent = this.updating().tail();
            parent.didInitializeChildren();
        };

        VM.prototype.exitList = function exitList() {
            this.exit();
            this.listBlockStack.pop();
        };

        VM.prototype.updateWith = function updateWith(opcode) {
            this.updating().append(opcode);
        };

        VM.prototype.listBlock = function listBlock() {
            return _glimmerUtil.expect(this.listBlockStack.current, 'expected a list block');
        };

        VM.prototype.updating = function updating() {
            return _glimmerUtil.expect(this.updatingOpcodeStack.current, 'expected updating opcode on the updating opcode stack');
        };

        VM.prototype.stack = function stack() {
            return this.elementStack;
        };

        VM.prototype.scope = function scope() {
            return _glimmerUtil.expect(this.scopeStack.current, 'expected scope on the scope stack');
        };

        VM.prototype.dynamicScope = function dynamicScope() {
            return _glimmerUtil.expect(this.dynamicScopeStack.current, 'expected dynamic scope on the dynamic scope stack');
        };

        VM.prototype.pushFrame = function pushFrame(block, args, callerScope) {
            this.frame.push(block.slice);
            if (args) this.frame.setArgs(args);
            if (args && args.blocks) this.frame.setBlocks(args.blocks);
            if (callerScope) this.frame.setCallerScope(callerScope);
        };

        VM.prototype.pushComponentFrame = function pushComponentFrame(layout, args, callerScope, component, manager, shadow) {
            this.frame.push(layout.slice, component, manager, shadow);
            if (args) this.frame.setArgs(args);
            if (args && args.blocks) this.frame.setBlocks(args.blocks);
            if (callerScope) this.frame.setCallerScope(callerScope);
        };

        VM.prototype.pushEvalFrame = function pushEvalFrame(slice) {
            this.frame.push(slice);
        };

        VM.prototype.pushChildScope = function pushChildScope() {
            this.scopeStack.push(this.scope().child());
        };

        VM.prototype.pushCallerScope = function pushCallerScope() {
            this.scopeStack.push(_glimmerUtil.expect(this.scope().getCallerScope(), 'pushCallerScope is called when a caller scope is present'));
        };

        VM.prototype.pushDynamicScope = function pushDynamicScope() {
            var child = this.dynamicScope().child();
            this.dynamicScopeStack.push(child);
            return child;
        };

        VM.prototype.pushRootScope = function pushRootScope(self, size) {
            var scope = _glimmerRuntimeLibEnvironment.Scope.root(self, size);
            this.scopeStack.push(scope);
            return scope;
        };

        VM.prototype.popScope = function popScope() {
            this.scopeStack.pop();
        };

        VM.prototype.popDynamicScope = function popDynamicScope() {
            this.dynamicScopeStack.pop();
        };

        VM.prototype.newDestroyable = function newDestroyable(d) {
            this.stack().newDestroyable(d);
        };

        /// SCOPE HELPERS

        VM.prototype.getSelf = function getSelf() {
            return this.scope().getSelf();
        };

        VM.prototype.referenceForSymbol = function referenceForSymbol(symbol) {
            return this.scope().getSymbol(symbol);
        };

        VM.prototype.getArgs = function getArgs() {
            return this.frame.getArgs();
        };

        /// EXECUTION

        VM.prototype.resume = function resume(opcodes, frame) {
            return this.execute(opcodes, function (vm) {
                return vm.frame.restore(frame);
            });
        };

        VM.prototype.execute = function execute(opcodes, initialize) {
            _glimmerUtil.LOGGER.debug("[VM] Begin program execution");
            var elementStack = this.elementStack;
            var frame = this.frame;
            var updatingOpcodeStack = this.updatingOpcodeStack;
            var env = this.env;

            elementStack.pushSimpleBlock();
            updatingOpcodeStack.push(new _glimmerUtil.LinkedList());
            frame.push(opcodes);
            if (initialize) initialize(this);
            var opcode = undefined;
            while (frame.hasOpcodes()) {
                if (opcode = frame.nextStatement(this.env)) {
                    _glimmerUtil.LOGGER.trace(opcode);
                    _glimmerRuntimeLibOpcodes.APPEND_OPCODES.evaluate(this, opcode);
                }
            }
            _glimmerUtil.LOGGER.debug("[VM] Completed program execution");
            return new _glimmerRuntimeLibVmRenderResult.default(env, _glimmerUtil.expect(updatingOpcodeStack.pop(), 'there should be a final updating opcode stack'), elementStack.popBlock());
        };

        VM.prototype.evaluateOpcode = function evaluateOpcode(opcode) {
            _glimmerRuntimeLibOpcodes.APPEND_OPCODES.evaluate(this, opcode);
        };

        // Make sure you have opcodes that push and pop a scope around this opcode
        // if you need to change the scope.

        VM.prototype.invokeBlock = function invokeBlock(block, args) {
            var compiled = block.compile(this.env);
            this.pushFrame(compiled, args);
        };

        VM.prototype.invokePartial = function invokePartial(block) {
            var compiled = block.compile(this.env);
            this.pushFrame(compiled);
        };

        VM.prototype.invokeLayout = function invokeLayout(args, layout, callerScope, component, manager, shadow) {
            this.pushComponentFrame(layout, args, callerScope, component, manager, shadow);
        };

        VM.prototype.evaluateOperand = function evaluateOperand(expr) {
            this.frame.setOperand(expr.evaluate(this));
        };

        VM.prototype.evaluateArgs = function evaluateArgs(args) {
            var evaledArgs = this.frame.setArgs(args.evaluate(this));
            this.frame.setOperand(evaledArgs.positional.at(0));
        };

        VM.prototype.bindPositionalArgs = function bindPositionalArgs(symbols) {
            var args = _glimmerUtil.expect(this.frame.getArgs(), 'bindPositionalArgs assumes a previous setArgs');
            var positional = args.positional;

            var scope = this.scope();
            for (var i = 0; i < symbols.length; i++) {
                scope.bindSymbol(symbols[i], positional.at(i));
            }
        };

        VM.prototype.bindNamedArgs = function bindNamedArgs(names, symbols) {
            var args = _glimmerUtil.expect(this.frame.getArgs(), 'bindNamedArgs assumes a previous setArgs');
            var scope = this.scope();
            var named = args.named;

            for (var i = 0; i < names.length; i++) {
                var _name = this.constants.getString(names[i]);
                scope.bindSymbol(symbols[i], named.get(_name));
            }
        };

        VM.prototype.bindBlocks = function bindBlocks(names, symbols) {
            var blocks = this.frame.getBlocks();
            var scope = this.scope();
            for (var i = 0; i < names.length; i++) {
                var _name2 = this.constants.getString(names[i]);
                scope.bindBlock(symbols[i], blocks && blocks[_name2] || null);
            }
        };

        VM.prototype.bindPartialArgs = function bindPartialArgs(symbol) {
            var args = _glimmerUtil.expect(this.frame.getArgs(), 'bindPartialArgs assumes a previous setArgs');
            var scope = this.scope();
            _glimmerUtil.assert(args, "Cannot bind named args");
            scope.bindPartialArgs(symbol, args);
        };

        VM.prototype.bindCallerScope = function bindCallerScope() {
            var callerScope = this.frame.getCallerScope();
            var scope = this.scope();
            _glimmerUtil.assert(callerScope, "Cannot bind caller scope");
            scope.bindCallerScope(callerScope);
        };

        VM.prototype.bindDynamicScope = function bindDynamicScope(names) {
            var args = _glimmerUtil.expect(this.frame.getArgs(), 'bindDynamicScope assumes a previous setArgs');
            var scope = this.dynamicScope();
            _glimmerUtil.assert(args, "Cannot bind dynamic scope");
            for (var i = 0; i < names.length; i++) {
                var _name3 = this.constants.getString(names[i]);
                scope.set(_name3, args.named.get(_name3));
            }
        };

        return VM;
    })();

    exports.default = VM;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL3ZtL2FwcGVuZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztRQStCYyxFQUFBO0FBb0JaLGlCQXBCWSxFQUFBLENBcUJILEdBQWdCLEVBQ3ZCLEtBQVksRUFDWixZQUEwQixFQUNsQixZQUEwQixFQUFBO2tDQXhCeEIsRUFBQTs7QUFxQkgsZ0JBQUEsQ0FBQSxHQUFHLEdBQUgsR0FBRyxDQUFhO0FBR2YsZ0JBQUEsQ0FBQSxZQUFZLEdBQVosWUFBWSxDQUFjO0FBdkI1QixnQkFBQSxDQUFBLGlCQUFpQixHQUFHLGlCQTlCQSxLQUFLLEVBOEJvQixDQUFDO0FBQzlDLGdCQUFBLENBQUEsVUFBVSxHQUFHLGlCQS9CTyxLQUFLLEVBK0JNLENBQUM7QUFDakMsZ0JBQUEsQ0FBQSxtQkFBbUIsR0FBRyxpQkFoQ0QsS0FBSyxFQWdDbUMsQ0FBQztBQUM5RCxnQkFBQSxDQUFBLFdBQVcsR0FBRyxpQkFqQ08sS0FBSyxFQWlDdUIsQ0FBQztBQUNsRCxnQkFBQSxDQUFBLGNBQWMsR0FBRyxpQkFsQ0ksS0FBSyxFQWtDbUIsQ0FBQztBQUM5QyxnQkFBQSxDQUFBLEtBQUssR0FBRyw4QkF6Qk8sVUFBVSxFQXlCRCxDQUFDO0FBb0I5QixnQkFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7QUFDZixnQkFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDO0FBQy9CLGdCQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztBQUNqQyxnQkFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUIsZ0JBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDM0M7O0FBL0JXLFVBQUEsQ0FTTCxPQUFPLEdBQUEsaUJBQ1osR0FBZ0IsRUFDaEIsSUFBMkIsRUFDM0IsWUFBMEIsRUFDMUIsWUFBMEIsRUFDMUIsSUFBWSxFQUFBO0FBRVosZ0JBQUks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dkYsZ0JBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUVoQyx5QkF0WXdFLE1BQU0sQ0FzWXZFLElBQUksRUFBRSwyQkFBMkIsQ0FBQyxDQUFDO0FBRTFDLGlCQUFJLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUNsQyxvQkFBSSxNQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDOUMscUJBQUssQ0FBQyxHQUFHLENBQUMsTUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE1BQUksQ0FBQyxDQUFDLENBQUM7YUFDdkM7U0FDRjs7ZUEvV1csRUFBQTs7O3NCQUFBLEVBQUEiLCJmaWxlIjoiYXBwZW5kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2NvcGUsIER5bmFtaWNTY29wZSwgRW52aXJvbm1lbnQsIE9wY29kZSB9IGZyb20gJy4uL2Vudmlyb25tZW50JztcbmltcG9ydCB7IEVsZW1lbnRTdGFjayB9IGZyb20gJy4uL2J1aWxkZXInO1xuaW1wb3J0IHsgT3B0aW9uLCBEZXN0cm95YWJsZSwgU3RhY2ssIExpbmtlZExpc3QsIExpc3RTbGljZSwgTE9HR0VSLCBPcGFxdWUsIGFzc2VydCwgZXhwZWN0IH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQgeyBQYXRoUmVmZXJlbmNlLCBjb21iaW5lU2xpY2UgfSBmcm9tICdAZ2xpbW1lci9yZWZlcmVuY2UnO1xuaW1wb3J0IHsgQ29tcGlsZWRCbG9jayB9IGZyb20gJy4uL2NvbXBpbGVkL2Jsb2Nrcyc7XG5pbXBvcnQgeyBJbmxpbmVCbG9jaywgUGFydGlhbEJsb2NrIH0gZnJvbSAnLi4vc2Nhbm5lcic7XG5pbXBvcnQgeyBDb21waWxlZEV4cHJlc3Npb24gfSBmcm9tICcuLi9jb21waWxlZC9leHByZXNzaW9ucyc7XG5pbXBvcnQgeyBDb21waWxlZEFyZ3MsIEV2YWx1YXRlZEFyZ3MgfSBmcm9tICcuLi9jb21waWxlZC9leHByZXNzaW9ucy9hcmdzJztcbmltcG9ydCB7IExhYmVsT3Bjb2RlLCBKdW1wSWZOb3RNb2RpZmllZE9wY29kZSwgRGlkTW9kaWZ5T3Bjb2RlIH0gZnJvbSAnLi4vY29tcGlsZWQvb3Bjb2Rlcy92bSc7XG5pbXBvcnQgeyBDb21wb25lbnQsIENvbXBvbmVudE1hbmFnZXIgfSBmcm9tICcuLi9jb21wb25lbnQvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBWTVN0YXRlLCBMaXN0QmxvY2tPcGNvZGUsIFRyeU9wY29kZSwgQmxvY2tPcGNvZGUgfSBmcm9tICcuL3VwZGF0ZSc7XG5pbXBvcnQgUmVuZGVyUmVzdWx0IGZyb20gJy4vcmVuZGVyLXJlc3VsdCc7XG5pbXBvcnQgeyBDYXB0dXJlZEZyYW1lLCBGcmFtZVN0YWNrIH0gZnJvbSAnLi9mcmFtZSc7XG5cbmltcG9ydCB7XG4gIEFQUEVORF9PUENPREVTLFxuICBTbGljZSxcbiAgVXBkYXRpbmdPcGNvZGUsXG4gIENvbnN0YW50cyxcbiAgQ29uc3RhbnRTdHJpbmcsXG4gIENvbnN0YW50U2xpY2UsXG59IGZyb20gJy4uL29wY29kZXMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFB1YmxpY1ZNIHtcbiAgZW52OiBFbnZpcm9ubWVudDtcbiAgZ2V0QXJncygpOiBPcHRpb248RXZhbHVhdGVkQXJncz47XG4gIGR5bmFtaWNTY29wZSgpOiBEeW5hbWljU2NvcGU7XG4gIGdldFNlbGYoKTogUGF0aFJlZmVyZW5jZTxPcGFxdWU+O1xuICBuZXdEZXN0cm95YWJsZShkOiBEZXN0cm95YWJsZSk6IHZvaWQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFZNIGltcGxlbWVudHMgUHVibGljVk0ge1xuICBwcml2YXRlIGR5bmFtaWNTY29wZVN0YWNrID0gbmV3IFN0YWNrPER5bmFtaWNTY29wZT4oKTtcbiAgcHJpdmF0ZSBzY29wZVN0YWNrID0gbmV3IFN0YWNrPFNjb3BlPigpO1xuICBwdWJsaWMgdXBkYXRpbmdPcGNvZGVTdGFjayA9IG5ldyBTdGFjazxMaW5rZWRMaXN0PFVwZGF0aW5nT3Bjb2RlPj4oKTtcbiAgcHVibGljIGNhY2hlR3JvdXBzID0gbmV3IFN0YWNrPE9wdGlvbjxVcGRhdGluZ09wY29kZT4+KCk7XG4gIHB1YmxpYyBsaXN0QmxvY2tTdGFjayA9IG5ldyBTdGFjazxMaXN0QmxvY2tPcGNvZGU+KCk7XG4gIHB1YmxpYyBmcmFtZSA9IG5ldyBGcmFtZVN0YWNrKCk7XG4gIHB1YmxpYyBjb25zdGFudHM6IENvbnN0YW50cztcblxuICBzdGF0aWMgaW5pdGlhbChcbiAgICBlbnY6IEVudmlyb25tZW50LFxuICAgIHNlbGY6IFBhdGhSZWZlcmVuY2U8T3BhcXVlPixcbiAgICBkeW5hbWljU2NvcGU6IER5bmFtaWNTY29wZSxcbiAgICBlbGVtZW50U3RhY2s6IEVsZW1lbnRTdGFjayxcbiAgICBzaXplOiBudW1iZXJcbiAgKSB7XG4gICAgbGV0IHNjb3BlID0gU2NvcGUucm9vdChzZWxmLCBzaXplKTtcbiAgICByZXR1cm4gbmV3IFZNKGVudiwgc2NvcGUsIGR5bmFtaWNTY29wZSwgZWxlbWVudFN0YWNrKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBlbnY6IEVudmlyb25tZW50LFxuICAgIHNjb3BlOiBTY29wZSxcbiAgICBkeW5hbWljU2NvcGU6IER5bmFtaWNTY29wZSxcbiAgICBwcml2YXRlIGVsZW1lbnRTdGFjazogRWxlbWVudFN0YWNrLFxuICApIHtcbiAgICB0aGlzLmVudiA9IGVudjtcbiAgICB0aGlzLmNvbnN0YW50cyA9IGVudi5jb25zdGFudHM7XG4gICAgdGhpcy5lbGVtZW50U3RhY2sgPSBlbGVtZW50U3RhY2s7XG4gICAgdGhpcy5zY29wZVN0YWNrLnB1c2goc2NvcGUpO1xuICAgIHRoaXMuZHluYW1pY1Njb3BlU3RhY2sucHVzaChkeW5hbWljU2NvcGUpO1xuICB9XG5cbiAgY2FwdHVyZSgpOiBWTVN0YXRlIHtcbiAgICByZXR1cm4ge1xuICAgICAgZW52OiB0aGlzLmVudixcbiAgICAgIHNjb3BlOiB0aGlzLnNjb3BlKCksXG4gICAgICBkeW5hbWljU2NvcGU6IHRoaXMuZHluYW1pY1Njb3BlKCksXG4gICAgICBmcmFtZTogdGhpcy5mcmFtZS5jYXB0dXJlKClcbiAgICB9O1xuICB9XG5cbiAgZ290byhpcDogbnVtYmVyKSB7XG4gICAgLy8gYXNzZXJ0KHRoaXMuZnJhbWUuZ2V0T3BzKCkuY29udGFpbnMob3ApLCBgSWxsZWdhbCBqdW1wIHRvICR7b3AubGFiZWx9YCk7XG4gICAgdGhpcy5mcmFtZS5nb3RvKGlwKTtcbiAgfVxuXG4gIGJlZ2luQ2FjaGVHcm91cCgpIHtcbiAgICB0aGlzLmNhY2hlR3JvdXBzLnB1c2godGhpcy51cGRhdGluZygpLnRhaWwoKSk7XG4gIH1cblxuICBjb21taXRDYWNoZUdyb3VwKCkge1xuICAgIC8vICAgICAgICBKdW1wSWZOb3RNb2RpZmllZChFTkQpXG4gICAgLy8gICAgICAgIChoZWFkKVxuICAgIC8vICAgICAgICAoLi4uLilcbiAgICAvLyAgICAgICAgKHRhaWwpXG4gICAgLy8gICAgICAgIERpZE1vZGlmeVxuICAgIC8vIEVORDogICBOb29wXG5cbiAgICBsZXQgRU5EID0gbmV3IExhYmVsT3Bjb2RlKFwiRU5EXCIpO1xuXG4gICAgbGV0IG9wY29kZXMgPSB0aGlzLnVwZGF0aW5nKCk7XG4gICAgbGV0IG1hcmtlciA9IHRoaXMuY2FjaGVHcm91cHMucG9wKCk7XG4gICAgbGV0IGhlYWQgPSBtYXJrZXIgPyBvcGNvZGVzLm5leHROb2RlKG1hcmtlcikgOiBvcGNvZGVzLmhlYWQoKTtcbiAgICBsZXQgdGFpbCA9IG9wY29kZXMudGFpbCgpO1xuICAgIGxldCB0YWcgPSBjb21iaW5lU2xpY2UobmV3IExpc3RTbGljZShoZWFkLCB0YWlsKSk7XG5cbiAgICBsZXQgZ3VhcmQgPSBuZXcgSnVtcElmTm90TW9kaWZpZWRPcGNvZGUodGFnLCBFTkQpO1xuXG4gICAgb3Bjb2Rlcy5pbnNlcnRCZWZvcmUoZ3VhcmQsIGhlYWQpO1xuICAgIG9wY29kZXMuYXBwZW5kKG5ldyBEaWRNb2RpZnlPcGNvZGUoZ3VhcmQpKTtcbiAgICBvcGNvZGVzLmFwcGVuZChFTkQpO1xuICB9XG5cbiAgZW50ZXIoc2xpY2VJZDogQ29uc3RhbnRTbGljZSkge1xuICAgIGxldCB1cGRhdGluZyA9IG5ldyBMaW5rZWRMaXN0PFVwZGF0aW5nT3Bjb2RlPigpO1xuXG4gICAgbGV0IHRyYWNrZXIgPSB0aGlzLnN0YWNrKCkucHVzaFVwZGF0YWJsZUJsb2NrKCk7XG4gICAgbGV0IHN0YXRlID0gdGhpcy5jYXB0dXJlKCk7XG5cbiAgICBsZXQgc2xpY2UgPSB0aGlzLmNvbnN0YW50cy5nZXRTbGljZShzbGljZUlkKTtcbiAgICBsZXQgdHJ5T3Bjb2RlID0gbmV3IFRyeU9wY29kZShzbGljZSwgc3RhdGUsIHRyYWNrZXIsIHVwZGF0aW5nKTtcblxuICAgIHRoaXMuZGlkRW50ZXIodHJ5T3Bjb2RlLCB1cGRhdGluZyk7XG4gIH1cblxuICBlbnRlcldpdGhLZXkoa2V5OiBzdHJpbmcsIG9wczogU2xpY2UpIHtcbiAgICBsZXQgdXBkYXRpbmcgPSBuZXcgTGlua2VkTGlzdDxVcGRhdGluZ09wY29kZT4oKTtcblxuICAgIGxldCB0cmFja2VyID0gdGhpcy5zdGFjaygpLnB1c2hVcGRhdGFibGVCbG9jaygpO1xuICAgIGxldCBzdGF0ZSA9IHRoaXMuY2FwdHVyZSgpO1xuXG4gICAgbGV0IHRyeU9wY29kZSA9IG5ldyBUcnlPcGNvZGUob3BzLCBzdGF0ZSwgdHJhY2tlciwgdXBkYXRpbmcpO1xuXG4gICAgdGhpcy5saXN0QmxvY2soKS5tYXBba2V5XSA9IHRyeU9wY29kZTtcblxuICAgIHRoaXMuZGlkRW50ZXIodHJ5T3Bjb2RlLCB1cGRhdGluZyk7XG4gIH1cblxuICBlbnRlckxpc3Qob3BzOiBTbGljZSkge1xuICAgIGxldCB1cGRhdGluZyA9IG5ldyBMaW5rZWRMaXN0PEJsb2NrT3Bjb2RlPigpO1xuXG4gICAgbGV0IHRyYWNrZXIgPSB0aGlzLnN0YWNrKCkucHVzaEJsb2NrTGlzdCh1cGRhdGluZyk7XG4gICAgbGV0IHN0YXRlID0gdGhpcy5jYXB0dXJlKCk7XG4gICAgbGV0IGFydGlmYWN0cyA9IHRoaXMuZnJhbWUuZ2V0SXRlcmF0b3IoKS5hcnRpZmFjdHM7XG5cbiAgICBsZXQgb3Bjb2RlID0gbmV3IExpc3RCbG9ja09wY29kZShvcHMsIHN0YXRlLCB0cmFja2VyLCB1cGRhdGluZywgYXJ0aWZhY3RzKTtcblxuICAgIHRoaXMubGlzdEJsb2NrU3RhY2sucHVzaChvcGNvZGUpO1xuXG4gICAgdGhpcy5kaWRFbnRlcihvcGNvZGUsIHVwZGF0aW5nKTtcbiAgfVxuXG4gIHByaXZhdGUgZGlkRW50ZXIob3Bjb2RlOiBCbG9ja09wY29kZSwgdXBkYXRpbmc6IExpbmtlZExpc3Q8VXBkYXRpbmdPcGNvZGU+KSB7XG4gICAgdGhpcy51cGRhdGVXaXRoKG9wY29kZSk7XG4gICAgdGhpcy51cGRhdGluZ09wY29kZVN0YWNrLnB1c2godXBkYXRpbmcpO1xuICB9XG5cbiAgZXhpdCgpIHtcbiAgICB0aGlzLnN0YWNrKCkucG9wQmxvY2soKTtcbiAgICB0aGlzLnVwZGF0aW5nT3Bjb2RlU3RhY2sucG9wKCk7XG5cbiAgICBsZXQgcGFyZW50ID0gdGhpcy51cGRhdGluZygpLnRhaWwoKSBhcyBCbG9ja09wY29kZTtcblxuICAgIHBhcmVudC5kaWRJbml0aWFsaXplQ2hpbGRyZW4oKTtcbiAgfVxuXG4gIGV4aXRMaXN0KCkge1xuICAgIHRoaXMuZXhpdCgpO1xuICAgIHRoaXMubGlzdEJsb2NrU3RhY2sucG9wKCk7XG4gIH1cblxuICB1cGRhdGVXaXRoKG9wY29kZTogVXBkYXRpbmdPcGNvZGUpIHtcbiAgICB0aGlzLnVwZGF0aW5nKCkuYXBwZW5kKG9wY29kZSk7XG4gIH1cblxuICBsaXN0QmxvY2soKTogTGlzdEJsb2NrT3Bjb2RlIHtcbiAgICByZXR1cm4gZXhwZWN0KHRoaXMubGlzdEJsb2NrU3RhY2suY3VycmVudCwgJ2V4cGVjdGVkIGEgbGlzdCBibG9jaycpO1xuICB9XG5cbiAgdXBkYXRpbmcoKTogTGlua2VkTGlzdDxVcGRhdGluZ09wY29kZT4ge1xuICAgIHJldHVybiBleHBlY3QodGhpcy51cGRhdGluZ09wY29kZVN0YWNrLmN1cnJlbnQsICdleHBlY3RlZCB1cGRhdGluZyBvcGNvZGUgb24gdGhlIHVwZGF0aW5nIG9wY29kZSBzdGFjaycpO1xuICB9XG5cbiAgc3RhY2soKTogRWxlbWVudFN0YWNrIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50U3RhY2s7XG4gIH1cblxuICBzY29wZSgpOiBTY29wZSB7XG4gICAgcmV0dXJuIGV4cGVjdCh0aGlzLnNjb3BlU3RhY2suY3VycmVudCwgJ2V4cGVjdGVkIHNjb3BlIG9uIHRoZSBzY29wZSBzdGFjaycpO1xuICB9XG5cbiAgZHluYW1pY1Njb3BlKCk6IER5bmFtaWNTY29wZSB7XG4gICAgcmV0dXJuIGV4cGVjdCh0aGlzLmR5bmFtaWNTY29wZVN0YWNrLmN1cnJlbnQsICdleHBlY3RlZCBkeW5hbWljIHNjb3BlIG9uIHRoZSBkeW5hbWljIHNjb3BlIHN0YWNrJyk7XG4gIH1cblxuICBwdXNoRnJhbWUoXG4gICAgYmxvY2s6IENvbXBpbGVkQmxvY2ssXG4gICAgYXJncz86IE9wdGlvbjxFdmFsdWF0ZWRBcmdzPixcbiAgICBjYWxsZXJTY29wZT86IFNjb3BlXG4gICkge1xuICAgIHRoaXMuZnJhbWUucHVzaChibG9jay5zbGljZSk7XG5cbiAgICBpZiAoYXJncykgdGhpcy5mcmFtZS5zZXRBcmdzKGFyZ3MpO1xuICAgIGlmIChhcmdzICYmIGFyZ3MuYmxvY2tzKSB0aGlzLmZyYW1lLnNldEJsb2NrcyhhcmdzLmJsb2Nrcyk7XG4gICAgaWYgKGNhbGxlclNjb3BlKSB0aGlzLmZyYW1lLnNldENhbGxlclNjb3BlKGNhbGxlclNjb3BlKTtcbiAgfVxuXG4gIHB1c2hDb21wb25lbnRGcmFtZShcbiAgICBsYXlvdXQ6IENvbXBpbGVkQmxvY2ssXG4gICAgYXJnczogRXZhbHVhdGVkQXJncyxcbiAgICBjYWxsZXJTY29wZTogU2NvcGUsXG4gICAgY29tcG9uZW50OiBDb21wb25lbnQsXG4gICAgbWFuYWdlcjogQ29tcG9uZW50TWFuYWdlcjxDb21wb25lbnQ+LFxuICAgIHNoYWRvdzogT3B0aW9uPElubGluZUJsb2NrPlxuICApIHtcbiAgICB0aGlzLmZyYW1lLnB1c2gobGF5b3V0LnNsaWNlLCBjb21wb25lbnQsIG1hbmFnZXIsIHNoYWRvdyk7XG5cbiAgICBpZiAoYXJncykgdGhpcy5mcmFtZS5zZXRBcmdzKGFyZ3MpO1xuICAgIGlmIChhcmdzICYmIGFyZ3MuYmxvY2tzKSB0aGlzLmZyYW1lLnNldEJsb2NrcyhhcmdzLmJsb2Nrcyk7XG4gICAgaWYgKGNhbGxlclNjb3BlKSB0aGlzLmZyYW1lLnNldENhbGxlclNjb3BlKGNhbGxlclNjb3BlKTtcbiAgfVxuXG4gIHB1c2hFdmFsRnJhbWUoc2xpY2U6IFNsaWNlKSB7XG4gICAgdGhpcy5mcmFtZS5wdXNoKHNsaWNlKTtcbiAgfVxuXG4gIHB1c2hDaGlsZFNjb3BlKCkge1xuICAgIHRoaXMuc2NvcGVTdGFjay5wdXNoKHRoaXMuc2NvcGUoKS5jaGlsZCgpKTtcbiAgfVxuXG4gIHB1c2hDYWxsZXJTY29wZSgpIHtcbiAgICB0aGlzLnNjb3BlU3RhY2sucHVzaChleHBlY3QodGhpcy5zY29wZSgpLmdldENhbGxlclNjb3BlKCksICdwdXNoQ2FsbGVyU2NvcGUgaXMgY2FsbGVkIHdoZW4gYSBjYWxsZXIgc2NvcGUgaXMgcHJlc2VudCcpKTtcbiAgfVxuXG4gIHB1c2hEeW5hbWljU2NvcGUoKTogRHluYW1pY1Njb3BlIHtcbiAgICBsZXQgY2hpbGQgPSB0aGlzLmR5bmFtaWNTY29wZSgpLmNoaWxkKCk7XG4gICAgdGhpcy5keW5hbWljU2NvcGVTdGFjay5wdXNoKGNoaWxkKTtcbiAgICByZXR1cm4gY2hpbGQ7XG4gIH1cblxuICBwdXNoUm9vdFNjb3BlKHNlbGY6IFBhdGhSZWZlcmVuY2U8YW55Piwgc2l6ZTogbnVtYmVyKTogU2NvcGUge1xuICAgIGxldCBzY29wZSA9IFNjb3BlLnJvb3Qoc2VsZiwgc2l6ZSk7XG4gICAgdGhpcy5zY29wZVN0YWNrLnB1c2goc2NvcGUpO1xuICAgIHJldHVybiBzY29wZTtcbiAgfVxuXG4gIHBvcFNjb3BlKCkge1xuICAgIHRoaXMuc2NvcGVTdGFjay5wb3AoKTtcbiAgfVxuXG4gIHBvcER5bmFtaWNTY29wZSgpIHtcbiAgICB0aGlzLmR5bmFtaWNTY29wZVN0YWNrLnBvcCgpO1xuICB9XG5cbiAgbmV3RGVzdHJveWFibGUoZDogRGVzdHJveWFibGUpIHtcbiAgICB0aGlzLnN0YWNrKCkubmV3RGVzdHJveWFibGUoZCk7XG4gIH1cblxuICAvLy8gU0NPUEUgSEVMUEVSU1xuXG4gIGdldFNlbGYoKTogUGF0aFJlZmVyZW5jZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5zY29wZSgpLmdldFNlbGYoKTtcbiAgfVxuXG4gIHJlZmVyZW5jZUZvclN5bWJvbChzeW1ib2w6IG51bWJlcik6IFBhdGhSZWZlcmVuY2U8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuc2NvcGUoKS5nZXRTeW1ib2woc3ltYm9sKTtcbiAgfVxuXG4gIGdldEFyZ3MoKTogT3B0aW9uPEV2YWx1YXRlZEFyZ3M+IHtcbiAgICByZXR1cm4gdGhpcy5mcmFtZS5nZXRBcmdzKCk7XG4gIH1cblxuICAvLy8gRVhFQ1VUSU9OXG5cbiAgcmVzdW1lKG9wY29kZXM6IFNsaWNlLCBmcmFtZTogQ2FwdHVyZWRGcmFtZSk6IFJlbmRlclJlc3VsdCB7XG4gICAgcmV0dXJuIHRoaXMuZXhlY3V0ZShvcGNvZGVzLCB2bSA9PiB2bS5mcmFtZS5yZXN0b3JlKGZyYW1lKSk7XG4gIH1cblxuICBleGVjdXRlKG9wY29kZXM6IFNsaWNlLCBpbml0aWFsaXplPzogKHZtOiBWTSkgPT4gdm9pZCk6IFJlbmRlclJlc3VsdCB7XG4gICAgTE9HR0VSLmRlYnVnKFwiW1ZNXSBCZWdpbiBwcm9ncmFtIGV4ZWN1dGlvblwiKTtcblxuICAgIGxldCB7IGVsZW1lbnRTdGFjaywgZnJhbWUsIHVwZGF0aW5nT3Bjb2RlU3RhY2ssIGVudiB9ID0gdGhpcztcblxuICAgIGVsZW1lbnRTdGFjay5wdXNoU2ltcGxlQmxvY2soKTtcblxuICAgIHVwZGF0aW5nT3Bjb2RlU3RhY2sucHVzaChuZXcgTGlua2VkTGlzdDxVcGRhdGluZ09wY29kZT4oKSk7XG4gICAgZnJhbWUucHVzaChvcGNvZGVzKTtcblxuICAgIGlmIChpbml0aWFsaXplKSBpbml0aWFsaXplKHRoaXMpO1xuXG4gICAgbGV0IG9wY29kZTogT3B0aW9uPE9wY29kZT47XG5cbiAgICB3aGlsZSAoZnJhbWUuaGFzT3Bjb2RlcygpKSB7XG4gICAgICBpZiAob3Bjb2RlID0gZnJhbWUubmV4dFN0YXRlbWVudCh0aGlzLmVudikpIHtcbiAgICAgICAgTE9HR0VSLnRyYWNlKG9wY29kZSk7XG4gICAgICAgIEFQUEVORF9PUENPREVTLmV2YWx1YXRlKHRoaXMsIG9wY29kZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgTE9HR0VSLmRlYnVnKFwiW1ZNXSBDb21wbGV0ZWQgcHJvZ3JhbSBleGVjdXRpb25cIik7XG5cbiAgICByZXR1cm4gbmV3IFJlbmRlclJlc3VsdChcbiAgICAgIGVudixcbiAgICAgIGV4cGVjdCh1cGRhdGluZ09wY29kZVN0YWNrLnBvcCgpLCAndGhlcmUgc2hvdWxkIGJlIGEgZmluYWwgdXBkYXRpbmcgb3Bjb2RlIHN0YWNrJyksXG4gICAgICBlbGVtZW50U3RhY2sucG9wQmxvY2soKVxuICAgICk7XG4gIH1cblxuICBldmFsdWF0ZU9wY29kZShvcGNvZGU6IE9wY29kZSkge1xuICAgIEFQUEVORF9PUENPREVTLmV2YWx1YXRlKHRoaXMsIG9wY29kZSk7XG4gIH1cblxuICAvLyBNYWtlIHN1cmUgeW91IGhhdmUgb3Bjb2RlcyB0aGF0IHB1c2ggYW5kIHBvcCBhIHNjb3BlIGFyb3VuZCB0aGlzIG9wY29kZVxuICAvLyBpZiB5b3UgbmVlZCB0byBjaGFuZ2UgdGhlIHNjb3BlLlxuICBpbnZva2VCbG9jayhibG9jazogSW5saW5lQmxvY2ssIGFyZ3M6IE9wdGlvbjxFdmFsdWF0ZWRBcmdzPikge1xuICAgIGxldCBjb21waWxlZCA9IGJsb2NrLmNvbXBpbGUodGhpcy5lbnYpO1xuICAgIHRoaXMucHVzaEZyYW1lKGNvbXBpbGVkLCBhcmdzKTtcbiAgfVxuXG4gIGludm9rZVBhcnRpYWwoYmxvY2s6IFBhcnRpYWxCbG9jaykge1xuICAgIGxldCBjb21waWxlZCA9IGJsb2NrLmNvbXBpbGUodGhpcy5lbnYpO1xuICAgIHRoaXMucHVzaEZyYW1lKGNvbXBpbGVkKTtcbiAgfVxuXG4gIGludm9rZUxheW91dChcbiAgICBhcmdzOiBFdmFsdWF0ZWRBcmdzLFxuICAgIGxheW91dDogQ29tcGlsZWRCbG9jayxcbiAgICBjYWxsZXJTY29wZTogU2NvcGUsXG4gICAgY29tcG9uZW50OiBDb21wb25lbnQsXG4gICAgbWFuYWdlcjogQ29tcG9uZW50TWFuYWdlcjxDb21wb25lbnQ+LFxuICAgIHNoYWRvdzogT3B0aW9uPElubGluZUJsb2NrPlxuICApIHtcbiAgICB0aGlzLnB1c2hDb21wb25lbnRGcmFtZShsYXlvdXQsIGFyZ3MsIGNhbGxlclNjb3BlLCBjb21wb25lbnQsIG1hbmFnZXIsIHNoYWRvdyk7XG4gIH1cblxuICBldmFsdWF0ZU9wZXJhbmQoZXhwcjogQ29tcGlsZWRFeHByZXNzaW9uPGFueT4pIHtcbiAgICB0aGlzLmZyYW1lLnNldE9wZXJhbmQoZXhwci5ldmFsdWF0ZSh0aGlzKSk7XG4gIH1cblxuICBldmFsdWF0ZUFyZ3MoYXJnczogQ29tcGlsZWRBcmdzKSB7XG4gICAgbGV0IGV2YWxlZEFyZ3MgPSB0aGlzLmZyYW1lLnNldEFyZ3MoYXJncy5ldmFsdWF0ZSh0aGlzKSk7XG4gICAgdGhpcy5mcmFtZS5zZXRPcGVyYW5kKGV2YWxlZEFyZ3MucG9zaXRpb25hbC5hdCgwKSk7XG4gIH1cblxuICBiaW5kUG9zaXRpb25hbEFyZ3Moc3ltYm9sczogbnVtYmVyW10pIHtcbiAgICBsZXQgYXJncyA9IGV4cGVjdCh0aGlzLmZyYW1lLmdldEFyZ3MoKSwgJ2JpbmRQb3NpdGlvbmFsQXJncyBhc3N1bWVzIGEgcHJldmlvdXMgc2V0QXJncycpO1xuXG4gICAgbGV0IHsgcG9zaXRpb25hbCB9ID0gYXJncztcblxuICAgIGxldCBzY29wZSA9IHRoaXMuc2NvcGUoKTtcblxuICAgIGZvcihsZXQgaT0wOyBpIDwgc3ltYm9scy5sZW5ndGg7IGkrKykge1xuICAgICAgc2NvcGUuYmluZFN5bWJvbChzeW1ib2xzW2ldLCBwb3NpdGlvbmFsLmF0KGkpKTtcbiAgICB9XG4gIH1cblxuICBiaW5kTmFtZWRBcmdzKG5hbWVzOiBDb25zdGFudFN0cmluZ1tdLCBzeW1ib2xzOiBudW1iZXJbXSkge1xuICAgIGxldCBhcmdzID0gZXhwZWN0KHRoaXMuZnJhbWUuZ2V0QXJncygpLCAnYmluZE5hbWVkQXJncyBhc3N1bWVzIGEgcHJldmlvdXMgc2V0QXJncycpO1xuICAgIGxldCBzY29wZSA9IHRoaXMuc2NvcGUoKTtcblxuICAgIGxldCB7IG5hbWVkIH0gPSBhcmdzO1xuXG4gICAgZm9yKGxldCBpPTA7IGkgPCBuYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IG5hbWUgPSB0aGlzLmNvbnN0YW50cy5nZXRTdHJpbmcobmFtZXNbaV0pO1xuICAgICAgc2NvcGUuYmluZFN5bWJvbChzeW1ib2xzW2ldLCBuYW1lZC5nZXQobmFtZSkpO1xuICAgIH1cbiAgfVxuXG4gIGJpbmRCbG9ja3MobmFtZXM6IENvbnN0YW50U3RyaW5nW10sIHN5bWJvbHM6IG51bWJlcltdKSB7XG4gICAgbGV0IGJsb2NrcyA9IHRoaXMuZnJhbWUuZ2V0QmxvY2tzKCk7XG4gICAgbGV0IHNjb3BlID0gdGhpcy5zY29wZSgpO1xuXG4gICAgZm9yKGxldCBpPTA7IGkgPCBuYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IG5hbWUgPSB0aGlzLmNvbnN0YW50cy5nZXRTdHJpbmcobmFtZXNbaV0pO1xuICAgICAgc2NvcGUuYmluZEJsb2NrKHN5bWJvbHNbaV0sIChibG9ja3MgJiYgYmxvY2tzW25hbWVdKSB8fCBudWxsKTtcbiAgICB9XG4gIH1cblxuICBiaW5kUGFydGlhbEFyZ3Moc3ltYm9sOiBudW1iZXIpIHtcbiAgICBsZXQgYXJncyA9IGV4cGVjdCh0aGlzLmZyYW1lLmdldEFyZ3MoKSwgJ2JpbmRQYXJ0aWFsQXJncyBhc3N1bWVzIGEgcHJldmlvdXMgc2V0QXJncycpO1xuICAgIGxldCBzY29wZSA9IHRoaXMuc2NvcGUoKTtcblxuICAgIGFzc2VydChhcmdzLCBcIkNhbm5vdCBiaW5kIG5hbWVkIGFyZ3NcIik7XG5cbiAgICBzY29wZS5iaW5kUGFydGlhbEFyZ3Moc3ltYm9sLCBhcmdzKTtcbiAgfVxuXG4gIGJpbmRDYWxsZXJTY29wZSgpIHtcbiAgICBsZXQgY2FsbGVyU2NvcGUgPSB0aGlzLmZyYW1lLmdldENhbGxlclNjb3BlKCk7XG4gICAgbGV0IHNjb3BlID0gdGhpcy5zY29wZSgpO1xuXG4gICAgYXNzZXJ0KGNhbGxlclNjb3BlLCBcIkNhbm5vdCBiaW5kIGNhbGxlciBzY29wZVwiKTtcblxuICAgIHNjb3BlLmJpbmRDYWxsZXJTY29wZShjYWxsZXJTY29wZSk7XG4gIH1cblxuICBiaW5kRHluYW1pY1Njb3BlKG5hbWVzOiBDb25zdGFudFN0cmluZ1tdKSB7XG4gICAgbGV0IGFyZ3MgPSBleHBlY3QodGhpcy5mcmFtZS5nZXRBcmdzKCksICdiaW5kRHluYW1pY1Njb3BlIGFzc3VtZXMgYSBwcmV2aW91cyBzZXRBcmdzJyk7XG4gICAgbGV0IHNjb3BlID0gdGhpcy5keW5hbWljU2NvcGUoKTtcblxuICAgIGFzc2VydChhcmdzLCBcIkNhbm5vdCBiaW5kIGR5bmFtaWMgc2NvcGVcIik7XG5cbiAgICBmb3IobGV0IGk9MDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgbmFtZSA9IHRoaXMuY29uc3RhbnRzLmdldFN0cmluZyhuYW1lc1tpXSk7XG4gICAgICBzY29wZS5zZXQobmFtZSwgYXJncy5uYW1lZC5nZXQobmFtZSkpO1xuICAgIH1cbiAgfVxufVxuIl19