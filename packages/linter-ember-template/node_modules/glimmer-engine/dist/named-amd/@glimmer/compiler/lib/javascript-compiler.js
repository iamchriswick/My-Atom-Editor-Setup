enifed("@glimmer/compiler/lib/javascript-compiler", ["exports", "@glimmer/util", "@glimmer/wire-format"], function (exports, _glimmerUtil, _glimmerWireFormat) {
    "use strict";

    function _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }

    function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

    var Block = (function () {
        function Block() {
            _classCallCheck(this, Block);

            this.type = "block";
            this.statements = [];
            this.positionals = [];
        }

        Block.prototype.toJSON = function toJSON() {
            return {
                statements: this.statements,
                locals: this.positionals
            };
        };

        Block.prototype.push = function push(statement) {
            this.statements.push(statement);
        };

        return Block;
    })();

    exports.Block = Block;

    var TemplateBlock = (function (_Block) {
        _inherits(TemplateBlock, _Block);

        function TemplateBlock() {
            _classCallCheck(this, TemplateBlock);

            _Block.apply(this, arguments);
            this.type = "template";
            this.yields = new _glimmerUtil.DictSet();
            this.named = new _glimmerUtil.DictSet();
            this.blocks = [];
            this.hasPartials = false;
        }

        TemplateBlock.prototype.toJSON = function toJSON() {
            return {
                statements: this.statements,
                locals: this.positionals,
                named: this.named.toArray(),
                yields: this.yields.toArray(),
                hasPartials: this.hasPartials
            };
        };

        return TemplateBlock;
    })(Block);

    exports.TemplateBlock = TemplateBlock;

    var ComponentBlock = (function (_Block2) {
        _inherits(ComponentBlock, _Block2);

        function ComponentBlock() {
            _classCallCheck(this, ComponentBlock);

            _Block2.apply(this, arguments);
            this.type = "component";
            this.attributes = [];
            this.arguments = [];
            this.inParams = true;
        }

        ComponentBlock.prototype.push = function push(statement) {
            if (this.inParams) {
                if (_glimmerWireFormat.Statements.isFlushElement(statement)) {
                    this.inParams = false;
                } else if (_glimmerWireFormat.Statements.isArgument(statement)) {
                    this.arguments.push(statement);
                } else if (_glimmerWireFormat.Statements.isAttribute(statement)) {
                    this.attributes.push(statement);
                } else if (_glimmerWireFormat.Statements.isModifier(statement)) {
                    throw new Error('Compile Error: Element modifiers are not allowed in components');
                } else {
                    throw new Error('Compile Error: only parameters allowed before flush-element');
                }
            } else {
                this.statements.push(statement);
            }
        };

        ComponentBlock.prototype.toJSON = function toJSON() {
            var args = this.arguments;
            var keys = args.map(function (arg) {
                return arg[1];
            });
            var values = args.map(function (arg) {
                return arg[2];
            });
            return {
                attrs: this.attributes,
                args: [keys, values],
                locals: this.positionals,
                statements: this.statements
            };
        };

        return ComponentBlock;
    })(Block);

    exports.ComponentBlock = ComponentBlock;

    var Template = (function () {
        function Template(meta) {
            _classCallCheck(this, Template);

            this.meta = meta;
            this.block = new TemplateBlock();
        }

        Template.prototype.toJSON = function toJSON() {
            return {
                block: this.block.toJSON(),
                meta: this.meta
            };
        };

        return Template;
    })();

    exports.Template = Template;

    var JavaScriptCompiler = (function () {
        function JavaScriptCompiler(opcodes, meta) {
            _classCallCheck(this, JavaScriptCompiler);

            this.blocks = new _glimmerUtil.Stack();
            this.values = [];
            this.opcodes = opcodes;
            this.template = new Template(meta);
        }

        JavaScriptCompiler.process = function process(opcodes, meta) {
            var compiler = new JavaScriptCompiler(opcodes, meta);
            return compiler.process();
        };

        JavaScriptCompiler.prototype.process = function process() {
            var _this = this;

            this.opcodes.forEach(function (_ref) {
                var opcode = _ref[0];

                var args = _ref.slice(1);

                if (!_this[opcode]) {
                    throw new Error("unimplemented " + opcode + " on JavaScriptCompiler");
                }
                _this[opcode].apply(_this, args);
            });
            return this.template;
        };

        /// Nesting

        JavaScriptCompiler.prototype.startBlock = function startBlock(_ref2) {
            var program = _ref2[0];

            var block = new Block();
            block.positionals = program.blockParams;
            this.blocks.push(block);
        };

        JavaScriptCompiler.prototype.endBlock = function endBlock() {
            var template = this.template;
            var blocks = this.blocks;

            template.block.blocks.push(blocks.pop().toJSON());
        };

        JavaScriptCompiler.prototype.startProgram = function startProgram() {
            this.blocks.push(this.template.block);
        };

        JavaScriptCompiler.prototype.endProgram = function endProgram() {};

        /// Statements

        JavaScriptCompiler.prototype.text = function text(content) {
            this.push(['text', content]);
        };

        JavaScriptCompiler.prototype.append = function append(trusted) {
            this.push(['append', this.popValue(), trusted]);
        };

        JavaScriptCompiler.prototype.comment = function comment(value) {
            this.push(['comment', value]);
        };

        JavaScriptCompiler.prototype.modifier = function modifier(path) {
            var params = this.popValue();
            var hash = this.popValue();
            this.push(['modifier', path, params, hash]);
        };

        JavaScriptCompiler.prototype.block = function block(path, template, inverse) {
            var params = this.popValue();
            var hash = this.popValue();
            var blocks = this.template.block.blocks;
            _glimmerUtil.assert(typeof template !== 'number' || blocks[template] !== null, 'missing block in the compiler');
            _glimmerUtil.assert(typeof inverse !== 'number' || blocks[inverse] !== null, 'missing block in the compiler');
            this.push(['block', path, params, hash, blocks[template], blocks[inverse]]);
        };

        JavaScriptCompiler.prototype.openElement = function openElement(tag, blockParams) {
            if (tag.indexOf('-') !== -1) {
                this.startComponent(blockParams);
            } else {
                this.push(['open-element', tag, blockParams]);
            }
        };

        JavaScriptCompiler.prototype.flushElement = function flushElement() {
            this.push(['flush-element']);
        };

        JavaScriptCompiler.prototype.closeElement = function closeElement(tag) {
            if (tag.indexOf('-') !== -1) {
                var component = this.endComponent();
                this.push(['component', tag, component]);
            } else {
                this.push(['close-element']);
            }
        };

        JavaScriptCompiler.prototype.staticAttr = function staticAttr(name, namespace) {
            var value = this.popValue();
            this.push(['static-attr', name, value, namespace]);
        };

        JavaScriptCompiler.prototype.dynamicAttr = function dynamicAttr(name, namespace) {
            var value = this.popValue();
            this.push(['dynamic-attr', name, value, namespace]);
        };

        JavaScriptCompiler.prototype.trustingAttr = function trustingAttr(name, namespace) {
            var value = this.popValue();
            this.push(['trusting-attr', name, value, namespace]);
        };

        JavaScriptCompiler.prototype.staticArg = function staticArg(name) {
            var value = this.popValue();
            this.push(['static-arg', name.slice(1), value]);
        };

        JavaScriptCompiler.prototype.dynamicArg = function dynamicArg(name) {
            var value = this.popValue();
            this.push(['dynamic-arg', name.slice(1), value]);
        };

        JavaScriptCompiler.prototype.yield = function _yield(to) {
            var params = this.popValue();
            this.push(['yield', to, params]);
            this.template.block.yields.add(to);
        };

        JavaScriptCompiler.prototype.debugger = function _debugger() {
            this.push(['debugger', null, null]);
        };

        JavaScriptCompiler.prototype.hasBlock = function hasBlock(name) {
            this.pushValue(['has-block', name]);
            this.template.block.yields.add(name);
        };

        JavaScriptCompiler.prototype.hasBlockParams = function hasBlockParams(name) {
            this.pushValue(['has-block-params', name]);
            this.template.block.yields.add(name);
        };

        JavaScriptCompiler.prototype.partial = function partial() {
            var params = this.popValue();
            this.push(['partial', params[0]]);
            this.template.block.hasPartials = true;
        };

        /// Expressions

        JavaScriptCompiler.prototype.literal = function literal(value) {
            if (value === undefined) {
                this.pushValue(['undefined']);
            } else {
                this.pushValue(value);
            }
        };

        JavaScriptCompiler.prototype.unknown = function unknown(path) {
            this.pushValue(['unknown', path]);
        };

        JavaScriptCompiler.prototype.arg = function arg(path) {
            this.template.block.named.add(path[0]);
            this.pushValue(['arg', path]);
        };

        JavaScriptCompiler.prototype.get = function get(path) {
            this.pushValue(['get', path]);
        };

        JavaScriptCompiler.prototype.concat = function concat() {
            this.pushValue(['concat', this.popValue()]);
        };

        JavaScriptCompiler.prototype.helper = function helper(path) {
            var params = this.popValue();
            var hash = this.popValue();
            this.pushValue(['helper', path, params, hash]);
        };

        /// Stack Management Opcodes

        JavaScriptCompiler.prototype.startComponent = function startComponent(blockParams) {
            var component = new ComponentBlock();
            component.positionals = blockParams;
            this.blocks.push(component);
        };

        JavaScriptCompiler.prototype.endComponent = function endComponent() {
            var component = this.blocks.pop();
            _glimmerUtil.assert(component.type === 'component', "Compiler bug: endComponent() should end a component");
            return component.toJSON();
        };

        JavaScriptCompiler.prototype.prepareArray = function prepareArray(size) {
            var values = [];
            for (var i = 0; i < size; i++) {
                values.push(this.popValue());
            }
            this.pushValue(values);
        };

        JavaScriptCompiler.prototype.prepareObject = function prepareObject(size) {
            _glimmerUtil.assert(this.values.length >= size, "Expected " + size + " values on the stack, found " + this.values.length);
            var keys = new Array(size);
            var values = new Array(size);
            for (var i = 0; i < size; i++) {
                keys[i] = this.popValue();
                values[i] = this.popValue();
            }
            this.pushValue([keys, values]);
        };

        /// Utilities

        JavaScriptCompiler.prototype.push = function push(args) {
            while (args[args.length - 1] === null) {
                args.pop();
            }
            this.blocks.current.push(args);
        };

        JavaScriptCompiler.prototype.pushValue = function pushValue(val) {
            this.values.push(val);
        };

        JavaScriptCompiler.prototype.popValue = function popValue() {
            _glimmerUtil.assert(this.values.length, "No expression found on stack");
            return this.values.pop();
        };

        return JavaScriptCompiler;
    })();

    exports.default = JavaScriptCompiler;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL2NvbXBpbGVyL2xpYi9qYXZhc2NyaXB0LWNvbXBpbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztRQXNCTSxLQUFBO0FBQU4saUJBQU0sS0FBQSxHQUFOO2tDQUFNLEtBQUE7O0FBQ0csZ0JBQUEsQ0FBQSxJQUFJLEdBQUcsT0FBTyxDQUFDO0FBQ3RCLGdCQUFBLENBQUEsVUFBVSxHQUFnQixFQUFFLENBQUM7QUFDN0IsZ0JBQUEsQ0FBQSxXQUFXLEdBQWEsRUFBRSxDQUFDO1NBWTVCOztBQWZLLGFBQUEsV0FLSixNQUFNLEdBQUEsa0JBQUE7QUFDSixtQkFBTztBQUNMLDBCQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7QUFDM0Isc0JBQU0sRUFBRSxJQUFJLENBQUMsV0FBVzthQUN6QixDQUFDO1NBQ0g7O0FBVkcsYUFBQSxXQVlKLElBQUksR0FBQSxjQUFDLFNBQW9CLEVBQUE7QUFDdkIsZ0JBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQ2pDOztlQWRHLEtBQUE7Ozs7O1FBaUJBLGFBQXFCO2tCQUFyQixhQUFxQjs7QUFBM0IsaUJBQU0sYUFBcUIsR0FBM0I7a0NBQU0sYUFBcUI7O0FDbEJuQiwrQkFBUyxTQUFTLENBQUMsQ0FBQztBRG1CbkIsZ0JBQUEsQ0FBQSxJQUFJLEdBQUcsVUFBVSxDQUFDO0FBQ2xCLGdCQUFBLENBQUEsTUFBTSxHQUFHLGlCQXhDRixPQUFPLEVBd0NnQixDQUFDO0FBQy9CLGdCQUFBLENBQUEsS0FBSyxHQUFHLGlCQXpDRCxPQUFPLEVBeUNlLENBQUM7QUFDOUIsZ0JBQUEsQ0FBQSxNQUFNLEdBQXNCLEVBQUUsQ0FBQztBQUMvQixnQkFBQSxDQUFBLFdBQVcsR0FBRyxLQUFLLENBQUM7U0FXNUI7O0FBaEJLLHFCQUFxQixXQU96QixNQUFNLEdBQUEsa0JBQUE7QUFDSixtQkFBTztBQUNMLDBCQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7QUFDM0Isc0JB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LEdBQUEsY0FBQyxJQUFlLEVBQUE7QUFDbEIsbUJBQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxFQUFFO0FBQ3JDLG9CQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7YUFDWjtBQUVELGdCQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDaEM7O0FBdE9XLDBCQUFBLFdBd09aLFNBQVMsR0FBQSxtQkFBdUMsR0FBTSxFQUFBO0FBQ3BELGdCQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUN2Qjs7QUExT1csMEJBQUEsV0E0T1osUUFBUSxHQUFBLG9CQUFBO0FBQ04seUJBelZLLE1BQU0sQ0F5VkosSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsOEJBQThCLENBQUMsQ0FBQztBQUMzRCxtQkFBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBTyxDQUFDO1NBQy9COztlQS9PVyxrQkFBQTs7O3NCQUFBLGtCQUFBIiwiZmlsZSI6ImphdmFzY3JpcHQtY29tcGlsZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhc3NlcnQgfSBmcm9tIFwiQGdsaW1tZXIvdXRpbFwiO1xuaW1wb3J0IHsgU3RhY2ssIERpY3RTZXQgfSBmcm9tIFwiQGdsaW1tZXIvdXRpbFwiO1xuXG5pbXBvcnQge1xuICBUZW1wbGF0ZU1ldGEsXG4gIFNlcmlhbGl6ZWRCbG9jayxcbiAgU2VyaWFsaXplZFRlbXBsYXRlQmxvY2ssXG4gIFNlcmlhbGl6ZWRUZW1wbGF0ZSxcbiAgU2VyaWFsaXplZENvbXBvbmVudCxcbiAgQ29yZSxcbiAgU3RhdGVtZW50LFxuICBTdGF0ZW1lbnRzLFxuICBFeHByZXNzaW9uLFxuICBFeHByZXNzaW9uc1xufSBmcm9tICdAZ2xpbW1lci93aXJlLWZvcm1hdCc7XG5cbmV4cG9ydCB0eXBlIHN0ciA9IHN0cmluZztcbmV4cG9ydCB0eXBlIFBhcmFtcyA9IENvcmUuUGFyYW1zO1xuZXhwb3J0IHR5cGUgSGFzaCA9IENvcmUuSGFzaDtcbmV4cG9ydCB0eXBlIFBhdGggPSBDb3JlLlBhdGg7XG5leHBvcnQgdHlwZSBTdGFja1ZhbHVlID0gRXhwcmVzc2lvbiB8IFBhcmFtcyB8IEhhc2ggfCBzdHI7XG5cbmV4cG9ydCBjbGFzcyBCbG9jayB7XG4gIHB1YmxpYyB0eXBlID0gXCJibG9ja1wiO1xuICBzdGF0ZW1lbnRzOiBTdGF0ZW1lbnRbXSA9IFtdO1xuICBwb3NpdGlvbmFsczogc3RyaW5nW10gPSBbXTtcblxuICB0b0pTT04oKTogU2VyaWFsaXplZEJsb2NrIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdGVtZW50czogdGhpcy5zdGF0ZW1lbnRzLFxuICAgICAgbG9jYWxzOiB0aGlzLnBvc2l0aW9uYWxzXG4gICAgfTtcbiAgfVxuXG4gIHB1c2goc3RhdGVtZW50OiBTdGF0ZW1lbnQpIHtcbiAgICB0aGlzLnN0YXRlbWVudHMucHVzaChzdGF0ZW1lbnQpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBUZW1wbGF0ZUJsb2NrIGV4dGVuZHMgQmxvY2sge1xuICBwdWJsaWMgdHlwZSA9IFwidGVtcGxhdGVcIjtcbiAgcHVibGljIHlpZWxkcyA9IG5ldyBEaWN0U2V0PHN0cmluZz4oKTtcbiAgcHVibGljIG5hbWVkID0gbmV3IERpY3RTZXQ8c3RyaW5nPigpO1xuICBwdWJsaWMgYmxvY2tzOiBTZXJpYWxpemVkQmxvY2tbXSA9IFtdO1xuICBwdWJsaWMgaGFzUGFydGlhbHMgPSBmYWxzZTtcblxuICB0b0pTT04oKTogU2VyaWFsaXplZFRlbXBsYXRlQmxvY2sge1xuICAgIHJldHVybiB7XG4gICAgICBzdGF0ZW1lbnRzOiB0aGlzLnN0YXRlbWVudHMsXG4gICAgICBsb2NhbHM6IHRoaXMucG9zaXRpb25hbHMsXG4gICAgICBuYW1lZDogdGhpcy5uYW1lZC50b0FycmF5KCksXG4gICAgICB5aWVsZHM6IHRoaXMueWllbGRzLnRvQXJyYXkoKSxcbiAgICAgIGhhc1BhcnRpYWxzOiB0aGlzLmhhc1BhcnRpYWxzXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQ29tcG9uZW50QmxvY2sgZXh0ZW5kcyBCbG9jayB7XG4gIHB1YmxpYyB0eXBlID0gXCJjb21wb25lbnRcIjtcbiAgcHVibGljIGF0dHJpYnV0ZXM6IFN0YXRlbWVudHMuQXR0cmlidXRlW10gPSBbXTtcbiAgcHVibGljIGFyZ3VtZW50czogU3RhdGVtZW50cy5Bcmd1bWVudFtdID0gW107XG4gIHByaXZhdGUgaW5QYXJhbXMgPSB0cnVlO1xuXG4gIHB1c2goc3RhdGVtZW50OiBTdGF0ZW1lbnQpIHtcbiAgICBpZiAodGhpcy5pblBhcmFtcykge1xuICAgICAgaWYgKFN0YXRlbWVudHMuaXNGbHVzaEVsZW1lbnQoc3RhdGVtZW50KSkge1xuICAgICAgICB0aGlzLmluUGFyYW1zID0gZmFsc2U7XG4gICAgICB9IGVsc2UgaWYgKFN0YXRlbWVudHMuaXNBcmd1bWVudChzdGF0ZW1lbnQpKSB7XG4gICAgICAgIHRoaXMuYXJndW1lbnRzLnB1c2goc3RhdGVtZW50KTtcbiAgICAgIH0gZWxzZSBpZiAoU3RhdGVtZW50cy5pc0F0dHJpYnV0ZShzdGF0ZW1lbnQpKSB7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlcy5wdXNoKHN0YXRlbWVudCk7XG4gICAgICB9IGVsc2UgaWYgKFN0YXRlbWVudHMuaXNNb2RpZmllcihzdGF0ZW1lbnQpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tcGlsZSBFcnJvcjogRWxlbWVudCBtb2RpZmllcnMgYXJlIG5vdCBhbGxvd2VkIGluIGNvbXBvbmVudHMnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tcGlsZSBFcnJvcjogb25seSBwYXJhbWV0ZXJzIGFsbG93ZWQgYmVmb3JlIGZsdXNoLWVsZW1lbnQnKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdGF0ZW1lbnRzLnB1c2goc3RhdGVtZW50KTtcbiAgICB9XG4gIH1cblxuICB0b0pTT04oKTogU2VyaWFsaXplZENvbXBvbmVudCB7XG4gICAgbGV0IGFyZ3MgPSB0aGlzLmFyZ3VtZW50cztcbiAgICBsZXQga2V5cyA9IGFyZ3MubWFwKGFyZyA9PiBhcmdbMV0pO1xuICAgIGxldCB2YWx1ZXMgPSBhcmdzLm1hcChhcmcgPT4gYXJnWzJdKTtcblxuICAgIHJldHVybiB7XG4gICAgICBhdHRyczogdGhpcy5hdHRyaWJ1dGVzLFxuICAgICAgYXJnczogW2tleXMsIHZhbHVlc10sXG4gICAgICBsb2NhbHM6IHRoaXMucG9zaXRpb25hbHMsXG4gICAgICBzdGF0ZW1lbnRzOiB0aGlzLnN0YXRlbWVudHNcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBUZW1wbGF0ZTxUIGV4dGVuZHMgVGVtcGxhdGVNZXRhPiB7XG4gIHB1YmxpYyBibG9jayA9IG5ldyBUZW1wbGF0ZUJsb2NrKCk7XG5cbiAgY29uc3RydWN0b3IocHVibGljIG1ldGE6IFQpIHt9XG5cbiAgdG9KU09OKCk6IFNlcmlhbGl6ZWRUZW1wbGF0ZTxUPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJsb2NrOiB0aGlzLmJsb2NrLnRvSlNPTigpLFxuICAgICAgbWV0YTogdGhpcy5tZXRhXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBKYXZhU2NyaXB0Q29tcGlsZXI8VCBleHRlbmRzIFRlbXBsYXRlTWV0YT4ge1xuICBzdGF0aWMgcHJvY2VzczxUIGV4dGVuZHMgVGVtcGxhdGVNZXRhPihvcGNvZGVzLCBtZXRhKTogVGVtcGxhdGU8VD4ge1xuICAgIGxldCBjb21waWxlciA9IG5ldyBKYXZhU2NyaXB0Q29tcGlsZXI8VD4ob3Bjb2RlcywgbWV0YSk7XG4gICAgcmV0dXJuIGNvbXBpbGVyLnByb2Nlc3MoKTtcbiAgfVxuXG4gIHByaXZhdGUgdGVtcGxhdGU6IFRlbXBsYXRlPFQ+O1xuICBwcml2YXRlIGJsb2NrcyA9IG5ldyBTdGFjazxCbG9jaz4oKTtcbiAgcHJpdmF0ZSBvcGNvZGVzOiBhbnlbXTtcbiAgcHJpdmF0ZSB2YWx1ZXM6IFN0YWNrVmFsdWVbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKG9wY29kZXMsIG1ldGE6IFQpIHtcbiAgICB0aGlzLm9wY29kZXMgPSBvcGNvZGVzO1xuICAgIHRoaXMudGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUobWV0YSk7XG4gIH1cblxuICBwcm9jZXNzKCk6IFRlbXBsYXRlPFQ+IHtcbiAgICB0aGlzLm9wY29kZXMuZm9yRWFjaCgoW29wY29kZSwgLi4uYXJnc10pID0+IHtcbiAgICAgIGlmICghdGhpc1tvcGNvZGVdKSB7IHRocm93IG5ldyBFcnJvcihgdW5pbXBsZW1lbnRlZCAke29wY29kZX0gb24gSmF2YVNjcmlwdENvbXBpbGVyYCk7IH1cbiAgICAgIHRoaXNbb3Bjb2RlXSguLi5hcmdzKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLnRlbXBsYXRlO1xuICB9XG5cbiAgLy8vIE5lc3RpbmdcblxuICBzdGFydEJsb2NrKFtwcm9ncmFtXSkge1xuICAgIGxldCBibG9jazogQmxvY2sgPSBuZXcgQmxvY2soKTtcbiAgICBibG9jay5wb3NpdGlvbmFscyA9IHByb2dyYW0uYmxvY2tQYXJhbXM7XG4gICAgdGhpcy5ibG9ja3MucHVzaChibG9jayk7XG4gIH1cblxuICBlbmRCbG9jaygpIHtcbiAgICBsZXQgeyB0ZW1wbGF0ZSwgYmxvY2tzIH0gPSB0aGlzO1xuICAgIHRlbXBsYXRlLmJsb2NrLmJsb2Nrcy5wdXNoKGJsb2Nrcy5wb3AoKS50b0pTT04oKSk7XG4gIH1cblxuICBzdGFydFByb2dyYW0oKSB7XG4gICAgdGhpcy5ibG9ja3MucHVzaCh0aGlzLnRlbXBsYXRlLmJsb2NrKTtcbiAgfVxuXG4gIGVuZFByb2dyYW0oKSB7XG5cbiAgfVxuXG4gIC8vLyBTdGF0ZW1lbnRzXG5cbiAgdGV4dChjb250ZW50OiBzdHJpbmcpIHtcbiAgICB0aGlzLnB1c2goWyd0ZXh0JywgY29udGVudF0pO1xuICB9XG5cbiAgYXBwZW5kKHRydXN0ZWQ6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnB1c2goWydhcHBlbmQnLCB0aGlzLnBvcFZhbHVlPEV4cHJlc3Npb24+KCksIHRydXN0ZWRdKTtcbiAgfVxuXG4gIGNvbW1lbnQodmFsdWU6IHN0cmluZykge1xuICAgIHRoaXMucHVzaChbJ2NvbW1lbnQnLCB2YWx1ZV0pO1xuICB9XG5cbiAgbW9kaWZpZXIocGF0aDogUGF0aCkge1xuICAgIGxldCBwYXJhbXMgPSB0aGlzLnBvcFZhbHVlPFBhcmFtcz4oKTtcbiAgICBsZXQgaGFzaCA9IHRoaXMucG9wVmFsdWU8SGFzaD4oKTtcblxuICAgIHRoaXMucHVzaChbJ21vZGlmaWVyJywgcGF0aCwgcGFyYW1zLCBoYXNoXSk7XG4gIH1cblxuICBibG9jayhwYXRoOiBQYXRoLCB0ZW1wbGF0ZTogbnVtYmVyLCBpbnZlcnNlOiBudW1iZXIpIHtcbiAgICBsZXQgcGFyYW1zID0gdGhpcy5wb3BWYWx1ZTxQYXJhbXM+KCk7XG4gICAgbGV0IGhhc2ggPSB0aGlzLnBvcFZhbHVlPEhhc2g+KCk7XG5cbiAgICBsZXQgYmxvY2tzID0gdGhpcy50ZW1wbGF0ZS5ibG9jay5ibG9ja3M7XG4gICAgYXNzZXJ0KHR5cGVvZiB0ZW1wbGF0ZSAhPT0gJ251bWJlcicgfHwgYmxvY2tzW3RlbXBsYXRlXSAhPT0gbnVsbCwgJ21pc3NpbmcgYmxvY2sgaW4gdGhlIGNvbXBpbGVyJyk7XG4gICAgYXNzZXJ0KHR5cGVvZiBpbnZlcnNlICE9PSAnbnVtYmVyJyB8fCBibG9ja3NbaW52ZXJzZV0gIT09IG51bGwsICdtaXNzaW5nIGJsb2NrIGluIHRoZSBjb21waWxlcicpO1xuXG4gICAgdGhpcy5wdXNoKFsnYmxvY2snLCBwYXRoLCBwYXJhbXMsIGhhc2gsIGJsb2Nrc1t0ZW1wbGF0ZV0sIGJsb2Nrc1tpbnZlcnNlXV0pO1xuICB9XG5cbiAgb3BlbkVsZW1lbnQodGFnOiBzdHIsIGJsb2NrUGFyYW1zOiBzdHJpbmdbXSkge1xuICAgIGlmICh0YWcuaW5kZXhPZignLScpICE9PSAtMSkge1xuICAgICAgdGhpcy5zdGFydENvbXBvbmVudChibG9ja1BhcmFtcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHVzaChbJ29wZW4tZWxlbWVudCcsIHRhZywgYmxvY2tQYXJhbXNdKTtcbiAgICB9XG4gIH1cblxuICBmbHVzaEVsZW1lbnQoKSB7XG4gICAgdGhpcy5wdXNoKFsnZmx1c2gtZWxlbWVudCddKTtcbiAgfVxuXG4gIGNsb3NlRWxlbWVudCh0YWc6IHN0cikge1xuICAgIGlmICh0YWcuaW5kZXhPZignLScpICE9PSAtMSkge1xuICAgICAgbGV0IGNvbXBvbmVudCA9IHRoaXMuZW5kQ29tcG9uZW50KCk7XG4gICAgICB0aGlzLnB1c2goWydjb21wb25lbnQnLCB0YWcsIGNvbXBvbmVudF0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnB1c2goWydjbG9zZS1lbGVtZW50J10pO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpY0F0dHIobmFtZTogc3RyLCBuYW1lc3BhY2U6IHN0cikge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWU8RXhwcmVzc2lvbj4oKTtcbiAgICB0aGlzLnB1c2goWydzdGF0aWMtYXR0cicsIG5hbWUsIHZhbHVlLCBuYW1lc3BhY2VdKTtcbiAgfVxuXG4gIGR5bmFtaWNBdHRyKG5hbWU6IHN0ciwgbmFtZXNwYWNlOiBzdHIpIHtcbiAgICBsZXQgdmFsdWUgPSB0aGlzLnBvcFZhbHVlPEV4cHJlc3Npb24+KCk7XG4gICAgdGhpcy5wdXNoKFsnZHluYW1pYy1hdHRyJywgbmFtZSwgdmFsdWUsIG5hbWVzcGFjZV0pO1xuICB9XG5cbiAgdHJ1c3RpbmdBdHRyKG5hbWU6IHN0ciwgbmFtZXNwYWNlOiBzdHIpIHtcbiAgICBsZXQgdmFsdWUgPSB0aGlzLnBvcFZhbHVlPEV4cHJlc3Npb24+KCk7XG4gICAgdGhpcy5wdXNoKFsndHJ1c3RpbmctYXR0cicsIG5hbWUsIHZhbHVlLCBuYW1lc3BhY2VdKTtcbiAgfVxuXG4gIHN0YXRpY0FyZyhuYW1lOiBzdHIpIHtcbiAgICBsZXQgdmFsdWUgPSB0aGlzLnBvcFZhbHVlPEV4cHJlc3Npb24+KCk7XG4gICAgdGhpcy5wdXNoKFsnc3RhdGljLWFyZycsIG5hbWUuc2xpY2UoMSksIHZhbHVlXSk7XG4gIH1cblxuICBkeW5hbWljQXJnKG5hbWU6IHN0cikge1xuICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWU8RXhwcmVzc2lvbj4oKTtcbiAgICB0aGlzLnB1c2goWydkeW5hbWljLWFyZycsIG5hbWUuc2xpY2UoMSksIHZhbHVlXSk7XG4gIH1cblxuICB5aWVsZCh0bzogc3RyaW5nKSB7XG4gICAgbGV0IHBhcmFtcyA9IHRoaXMucG9wVmFsdWU8UGFyYW1zPigpO1xuICAgIHRoaXMucHVzaChbJ3lpZWxkJywgdG8sIHBhcmFtc10pO1xuICAgIHRoaXMudGVtcGxhdGUuYmxvY2sueWllbGRzLmFkZCh0byk7XG4gIH1cblxuICBkZWJ1Z2dlcigpIHtcbiAgICB0aGlzLnB1c2goWydkZWJ1Z2dlcicsIG51bGwsIG51bGxdKTtcbiAgfVxuXG4gIGhhc0Jsb2NrKG5hbWU6IHN0cmluZykge1xuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLkhhc0Jsb2NrPihbJ2hhcy1ibG9jaycsIG5hbWVdKTtcbiAgICB0aGlzLnRlbXBsYXRlLmJsb2NrLnlpZWxkcy5hZGQobmFtZSk7XG4gIH1cblxuICBoYXNCbG9ja1BhcmFtcyhuYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLnB1c2hWYWx1ZTxFeHByZXNzaW9ucy5IYXNCbG9ja1BhcmFtcz4oWydoYXMtYmxvY2stcGFyYW1zJywgbmFtZV0pO1xuICAgIHRoaXMudGVtcGxhdGUuYmxvY2sueWllbGRzLmFkZChuYW1lKTtcbiAgfVxuXG4gIHBhcnRpYWwoKSB7XG4gICAgbGV0IHBhcmFtcyA9IHRoaXMucG9wVmFsdWU8UGFyYW1zPigpO1xuICAgIHRoaXMucHVzaChbJ3BhcnRpYWwnLCBwYXJhbXNbMF1dKTtcbiAgICB0aGlzLnRlbXBsYXRlLmJsb2NrLmhhc1BhcnRpYWxzID0gdHJ1ZTtcbiAgfVxuXG4gIC8vLyBFeHByZXNzaW9uc1xuXG4gIGxpdGVyYWwodmFsdWU6IEV4cHJlc3Npb25zLlZhbHVlIHwgdW5kZWZpbmVkKSB7XG4gICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLlVuZGVmaW5lZD4oWyd1bmRlZmluZWQnXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLlZhbHVlPih2YWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgdW5rbm93bihwYXRoOiBzdHJpbmdbXSkge1xuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLlVua25vd24+KFsndW5rbm93bicsIHBhdGhdKTtcbiAgfVxuXG4gIGFyZyhwYXRoOiBzdHJpbmdbXSkge1xuICAgIHRoaXMudGVtcGxhdGUuYmxvY2submFtZWQuYWRkKHBhdGhbMF0pO1xuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLkFyZz4oWydhcmcnLCBwYXRoXSk7XG4gIH1cblxuICBnZXQocGF0aDogc3RyaW5nW10pIHtcbiAgICB0aGlzLnB1c2hWYWx1ZTxFeHByZXNzaW9ucy5HZXQ+KFsnZ2V0JywgcGF0aF0pO1xuICB9XG5cbiAgY29uY2F0KCkge1xuICAgIHRoaXMucHVzaFZhbHVlPEV4cHJlc3Npb25zLkNvbmNhdD4oWydjb25jYXQnLCB0aGlzLnBvcFZhbHVlPFBhcmFtcz4oKV0pO1xuICB9XG5cbiAgaGVscGVyKHBhdGg6IHN0cmluZ1tdKSB7XG4gICAgbGV0IHBhcmFtcyA9IHRoaXMucG9wVmFsdWU8UGFyYW1zPigpO1xuICAgIGxldCBoYXNoID0gdGhpcy5wb3BWYWx1ZTxIYXNoPigpO1xuXG4gICAgdGhpcy5wdXNoVmFsdWU8RXhwcmVzc2lvbnMuSGVscGVyPihbJ2hlbHBlcicsIHBhdGgsIHBhcmFtcywgaGFzaF0pO1xuICB9XG5cbiAgLy8vIFN0YWNrIE1hbmFnZW1lbnQgT3Bjb2Rlc1xuXG4gIHN0YXJ0Q29tcG9uZW50KGJsb2NrUGFyYW1zOiBzdHJpbmdbXSkge1xuICAgIGxldCBjb21wb25lbnQgPSBuZXcgQ29tcG9uZW50QmxvY2soKTtcbiAgICBjb21wb25lbnQucG9zaXRpb25hbHMgPSBibG9ja1BhcmFtcztcbiAgICB0aGlzLmJsb2Nrcy5wdXNoKGNvbXBvbmVudCk7XG4gIH1cblxuICBlbmRDb21wb25lbnQoKTogU2VyaWFsaXplZENvbXBvbmVudCB7XG4gICAgbGV0IGNvbXBvbmVudCA9IHRoaXMuYmxvY2tzLnBvcCgpO1xuICAgIGFzc2VydChjb21wb25lbnQudHlwZSA9PT0gJ2NvbXBvbmVudCcsIFwiQ29tcGlsZXIgYnVnOiBlbmRDb21wb25lbnQoKSBzaG91bGQgZW5kIGEgY29tcG9uZW50XCIpO1xuICAgIHJldHVybiAoY29tcG9uZW50IGFzIENvbXBvbmVudEJsb2NrKS50b0pTT04oKTtcbiAgfVxuXG4gIHByZXBhcmVBcnJheShzaXplOiBudW1iZXIpIHtcbiAgICBsZXQgdmFsdWVzID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykge1xuICAgICAgdmFsdWVzLnB1c2godGhpcy5wb3BWYWx1ZSgpKTtcbiAgICB9XG5cbiAgICB0aGlzLnB1c2hWYWx1ZTxQYXJhbXM+KHZhbHVlcyk7XG4gIH1cblxuICBwcmVwYXJlT2JqZWN0KHNpemU6IG51bWJlcikge1xuICAgIGFzc2VydCh0aGlzLnZhbHVlcy5sZW5ndGggPj0gc2l6ZSwgYEV4cGVjdGVkICR7c2l6ZX0gdmFsdWVzIG9uIHRoZSBzdGFjaywgZm91bmQgJHt0aGlzLnZhbHVlcy5sZW5ndGh9YCk7XG5cbiAgICBsZXQga2V5czogc3RyaW5nW10gPSBuZXcgQXJyYXkoc2l6ZSk7XG4gICAgbGV0IHZhbHVlczogRXhwcmVzc2lvbltdID0gbmV3IEFycmF5KHNpemUpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICAgIGtleXNbaV0gPSB0aGlzLnBvcFZhbHVlPHN0cj4oKTtcbiAgICAgIHZhbHVlc1tpXSA9IHRoaXMucG9wVmFsdWU8RXhwcmVzc2lvbj4oKTtcbiAgICB9XG5cbiAgICB0aGlzLnB1c2hWYWx1ZTxIYXNoPihba2V5cywgdmFsdWVzXSk7XG4gIH1cblxuICAvLy8gVXRpbGl0aWVzXG5cbiAgcHVzaChhcmdzOiBTdGF0ZW1lbnQpIHtcbiAgICB3aGlsZSAoYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBudWxsKSB7XG4gICAgICBhcmdzLnBvcCgpO1xuICAgIH1cblxuICAgIHRoaXMuYmxvY2tzLmN1cnJlbnQucHVzaChhcmdzKTtcbiAgfVxuXG4gIHB1c2hWYWx1ZTxTIGV4dGVuZHMgRXhwcmVzc2lvbiB8IFBhcmFtcyB8IEhhc2g+KHZhbDogUykge1xuICAgIHRoaXMudmFsdWVzLnB1c2godmFsKTtcbiAgfVxuXG4gIHBvcFZhbHVlPFQgZXh0ZW5kcyBTdGFja1ZhbHVlPigpOiBUIHtcbiAgICBhc3NlcnQodGhpcy52YWx1ZXMubGVuZ3RoLCBcIk5vIGV4cHJlc3Npb24gZm91bmQgb24gc3RhY2tcIik7XG4gICAgcmV0dXJuIHRoaXMudmFsdWVzLnBvcCgpIGFzIFQ7XG4gIH1cbn1cbiIsImltcG9ydCB7IGFzc2VydCB9IGZyb20gXCJAZ2xpbW1lci91dGlsXCI7XG5pbXBvcnQgeyBTdGFjaywgRGljdFNldCB9IGZyb20gXCJAZ2xpbW1lci91dGlsXCI7XG5pbXBvcnQgeyBTdGF0ZW1lbnRzIH0gZnJvbSAnQGdsaW1tZXIvd2lyZS1mb3JtYXQnO1xuZXhwb3J0IGNsYXNzIEJsb2NrIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy50eXBlID0gXCJibG9ja1wiO1xuICAgICAgICB0aGlzLnN0YXRlbWVudHMgPSBbXTtcbiAgICAgICAgdGhpcy5wb3NpdGlvbmFscyA9IFtdO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdGF0ZW1lbnRzOiB0aGlzLnN0YXRlbWVudHMsXG4gICAgICAgICAgICBsb2NhbHM6IHRoaXMucG9zaXRpb25hbHNcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcHVzaChzdGF0ZW1lbnQpIHtcbiAgICAgICAgdGhpcy5zdGF0ZW1lbnRzLnB1c2goc3RhdGVtZW50KTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgVGVtcGxhdGVCbG9jayBleHRlbmRzIEJsb2NrIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy50eXBlID0gXCJ0ZW1wbGF0ZVwiO1xuICAgICAgICB0aGlzLnlpZWxkcyA9IG5ldyBEaWN0U2V0KCk7XG4gICAgICAgIHRoaXMubmFtZWQgPSBuZXcgRGljdFNldCgpO1xuICAgICAgICB0aGlzLmJsb2NrcyA9IFtdO1xuICAgICAgICB0aGlzLmhhc1BhcnRpYWxzID0gZmFsc2U7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN0YXRlbWVudHM6IHRoaXMuc3RhdGVtZW50cyxcbiAgICAgICAgICAgIGxvY2FsczogdGhpcy5wb3NpdGlvbmFscyxcbiAgICAgICAgICAgIG5hbWVkOiB0aGlzLm5hbWVkLnRvQXJyYXkoKSxcbiAgICAgICAgICAgIHlpZWxkczogdGhpcy55aWVsZHMudG9BcnJheSgpLFxuICAgICAgICAgICAgaGFzUGFydGlhbHM6IHRoaXMuaGFzUGFydGlhbHNcbiAgICAgICAgfTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgQ29tcG9uZW50QmxvY2sgZXh0ZW5kcyBCbG9jayB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMudHlwZSA9IFwiY29tcG9uZW50XCI7XG4gICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IFtdO1xuICAgICAgICB0aGlzLmFyZ3VtZW50cyA9IFtdO1xuICAgICAgICB0aGlzLmluUGFyYW1zID0gdHJ1ZTtcbiAgICB9XG4gICAgcHVzaChzdGF0ZW1lbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5QYXJhbXMpIHtcbiAgICAgICAgICAgIGlmIChTdGF0ZW1lbnRzLmlzRmx1c2hFbGVtZW50KHN0YXRlbWVudCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmluUGFyYW1zID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChTdGF0ZW1lbnRzLmlzQXJndW1lbnQoc3RhdGVtZW50KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXJndW1lbnRzLnB1c2goc3RhdGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKFN0YXRlbWVudHMuaXNBdHRyaWJ1dGUoc3RhdGVtZW50KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0cmlidXRlcy5wdXNoKHN0YXRlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChTdGF0ZW1lbnRzLmlzTW9kaWZpZXIoc3RhdGVtZW50KSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tcGlsZSBFcnJvcjogRWxlbWVudCBtb2RpZmllcnMgYXJlIG5vdCBhbGxvd2VkIGluIGNvbXBvbmVudHMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ29tcGlsZSBFcnJvcjogb25seSBwYXJhbWV0ZXJzIGFsbG93ZWQgYmVmb3JlIGZsdXNoLWVsZW1lbnQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVtZW50cy5wdXNoKHN0YXRlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICBsZXQgYXJncyA9IHRoaXMuYXJndW1lbnRzO1xuICAgICAgICBsZXQga2V5cyA9IGFyZ3MubWFwKGFyZyA9PiBhcmdbMV0pO1xuICAgICAgICBsZXQgdmFsdWVzID0gYXJncy5tYXAoYXJnID0+IGFyZ1syXSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhdHRyczogdGhpcy5hdHRyaWJ1dGVzLFxuICAgICAgICAgICAgYXJnczogW2tleXMsIHZhbHVlc10sXG4gICAgICAgICAgICBsb2NhbHM6IHRoaXMucG9zaXRpb25hbHMsXG4gICAgICAgICAgICBzdGF0ZW1lbnRzOiB0aGlzLnN0YXRlbWVudHNcbiAgICAgICAgfTtcbiAgICB9XG59XG5leHBvcnQgY2xhc3MgVGVtcGxhdGUge1xuICAgIGNvbnN0cnVjdG9yKG1ldGEpIHtcbiAgICAgICAgdGhpcy5tZXRhID0gbWV0YTtcbiAgICAgICAgdGhpcy5ibG9jayA9IG5ldyBUZW1wbGF0ZUJsb2NrKCk7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJsb2NrOiB0aGlzLmJsb2NrLnRvSlNPTigpLFxuICAgICAgICAgICAgbWV0YTogdGhpcy5tZXRhXG4gICAgICAgIH07XG4gICAgfVxufVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSmF2YVNjcmlwdENvbXBpbGVyIHtcbiAgICBjb25zdHJ1Y3RvcihvcGNvZGVzLCBtZXRhKSB7XG4gICAgICAgIHRoaXMuYmxvY2tzID0gbmV3IFN0YWNrKCk7XG4gICAgICAgIHRoaXMudmFsdWVzID0gW107XG4gICAgICAgIHRoaXMub3Bjb2RlcyA9IG9wY29kZXM7XG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBuZXcgVGVtcGxhdGUobWV0YSk7XG4gICAgfVxuICAgIHN0YXRpYyBwcm9jZXNzKG9wY29kZXMsIG1ldGEpIHtcbiAgICAgICAgbGV0IGNvbXBpbGVyID0gbmV3IEphdmFTY3JpcHRDb21waWxlcihvcGNvZGVzLCBtZXRhKTtcbiAgICAgICAgcmV0dXJuIGNvbXBpbGVyLnByb2Nlc3MoKTtcbiAgICB9XG4gICAgcHJvY2VzcygpIHtcbiAgICAgICAgdGhpcy5vcGNvZGVzLmZvckVhY2goKFtvcGNvZGUsIC4uLmFyZ3NdKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXRoaXNbb3Bjb2RlXSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgdW5pbXBsZW1lbnRlZCAke29wY29kZX0gb24gSmF2YVNjcmlwdENvbXBpbGVyYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzW29wY29kZV0oLi4uYXJncyk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy50ZW1wbGF0ZTtcbiAgICB9XG4gICAgLy8vIE5lc3RpbmdcbiAgICBzdGFydEJsb2NrKFtwcm9ncmFtXSkge1xuICAgICAgICBsZXQgYmxvY2sgPSBuZXcgQmxvY2soKTtcbiAgICAgICAgYmxvY2sucG9zaXRpb25hbHMgPSBwcm9ncmFtLmJsb2NrUGFyYW1zO1xuICAgICAgICB0aGlzLmJsb2Nrcy5wdXNoKGJsb2NrKTtcbiAgICB9XG4gICAgZW5kQmxvY2soKSB7XG4gICAgICAgIGxldCB7IHRlbXBsYXRlLCBibG9ja3MgfSA9IHRoaXM7XG4gICAgICAgIHRlbXBsYXRlLmJsb2NrLmJsb2Nrcy5wdXNoKGJsb2Nrcy5wb3AoKS50b0pTT04oKSk7XG4gICAgfVxuICAgIHN0YXJ0UHJvZ3JhbSgpIHtcbiAgICAgICAgdGhpcy5ibG9ja3MucHVzaCh0aGlzLnRlbXBsYXRlLmJsb2NrKTtcbiAgICB9XG4gICAgZW5kUHJvZ3JhbSgpIHtcbiAgICB9XG4gICAgLy8vIFN0YXRlbWVudHNcbiAgICB0ZXh0KGNvbnRlbnQpIHtcbiAgICAgICAgdGhpcy5wdXNoKFsndGV4dCcsIGNvbnRlbnRdKTtcbiAgICB9XG4gICAgYXBwZW5kKHRydXN0ZWQpIHtcbiAgICAgICAgdGhpcy5wdXNoKFsnYXBwZW5kJywgdGhpcy5wb3BWYWx1ZSgpLCB0cnVzdGVkXSk7XG4gICAgfVxuICAgIGNvbW1lbnQodmFsdWUpIHtcbiAgICAgICAgdGhpcy5wdXNoKFsnY29tbWVudCcsIHZhbHVlXSk7XG4gICAgfVxuICAgIG1vZGlmaWVyKHBhdGgpIHtcbiAgICAgICAgbGV0IHBhcmFtcyA9IHRoaXMucG9wVmFsdWUoKTtcbiAgICAgICAgbGV0IGhhc2ggPSB0aGlzLnBvcFZhbHVlKCk7XG4gICAgICAgIHRoaXMucHVzaChbJ21vZGlmaWVyJywgcGF0aCwgcGFyYW1zLCBoYXNoXSk7XG4gICAgfVxuICAgIGJsb2NrKHBhdGgsIHRlbXBsYXRlLCBpbnZlcnNlKSB7XG4gICAgICAgIGxldCBwYXJhbXMgPSB0aGlzLnBvcFZhbHVlKCk7XG4gICAgICAgIGxldCBoYXNoID0gdGhpcy5wb3BWYWx1ZSgpO1xuICAgICAgICBsZXQgYmxvY2tzID0gdGhpcy50ZW1wbGF0ZS5ibG9jay5ibG9ja3M7XG4gICAgICAgIGFzc2VydCh0eXBlb2YgdGVtcGxhdGUgIT09ICdudW1iZXInIHx8IGJsb2Nrc1t0ZW1wbGF0ZV0gIT09IG51bGwsICdtaXNzaW5nIGJsb2NrIGluIHRoZSBjb21waWxlcicpO1xuICAgICAgICBhc3NlcnQodHlwZW9mIGludmVyc2UgIT09ICdudW1iZXInIHx8IGJsb2Nrc1tpbnZlcnNlXSAhPT0gbnVsbCwgJ21pc3NpbmcgYmxvY2sgaW4gdGhlIGNvbXBpbGVyJyk7XG4gICAgICAgIHRoaXMucHVzaChbJ2Jsb2NrJywgcGF0aCwgcGFyYW1zLCBoYXNoLCBibG9ja3NbdGVtcGxhdGVdLCBibG9ja3NbaW52ZXJzZV1dKTtcbiAgICB9XG4gICAgb3BlbkVsZW1lbnQodGFnLCBibG9ja1BhcmFtcykge1xuICAgICAgICBpZiAodGFnLmluZGV4T2YoJy0nKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRDb21wb25lbnQoYmxvY2tQYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wdXNoKFsnb3Blbi1lbGVtZW50JywgdGFnLCBibG9ja1BhcmFtc10pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZsdXNoRWxlbWVudCgpIHtcbiAgICAgICAgdGhpcy5wdXNoKFsnZmx1c2gtZWxlbWVudCddKTtcbiAgICB9XG4gICAgY2xvc2VFbGVtZW50KHRhZykge1xuICAgICAgICBpZiAodGFnLmluZGV4T2YoJy0nKSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGxldCBjb21wb25lbnQgPSB0aGlzLmVuZENvbXBvbmVudCgpO1xuICAgICAgICAgICAgdGhpcy5wdXNoKFsnY29tcG9uZW50JywgdGFnLCBjb21wb25lbnRdKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucHVzaChbJ2Nsb3NlLWVsZW1lbnQnXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RhdGljQXR0cihuYW1lLCBuYW1lc3BhY2UpIHtcbiAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5wb3BWYWx1ZSgpO1xuICAgICAgICB0aGlzLnB1c2goWydzdGF0aWMtYXR0cicsIG5hbWUsIHZhbHVlLCBuYW1lc3BhY2VdKTtcbiAgICB9XG4gICAgZHluYW1pY0F0dHIobmFtZSwgbmFtZXNwYWNlKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWUoKTtcbiAgICAgICAgdGhpcy5wdXNoKFsnZHluYW1pYy1hdHRyJywgbmFtZSwgdmFsdWUsIG5hbWVzcGFjZV0pO1xuICAgIH1cbiAgICB0cnVzdGluZ0F0dHIobmFtZSwgbmFtZXNwYWNlKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWUoKTtcbiAgICAgICAgdGhpcy5wdXNoKFsndHJ1c3RpbmctYXR0cicsIG5hbWUsIHZhbHVlLCBuYW1lc3BhY2VdKTtcbiAgICB9XG4gICAgc3RhdGljQXJnKG5hbWUpIHtcbiAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5wb3BWYWx1ZSgpO1xuICAgICAgICB0aGlzLnB1c2goWydzdGF0aWMtYXJnJywgbmFtZS5zbGljZSgxKSwgdmFsdWVdKTtcbiAgICB9XG4gICAgZHluYW1pY0FyZyhuYW1lKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMucG9wVmFsdWUoKTtcbiAgICAgICAgdGhpcy5wdXNoKFsnZHluYW1pYy1hcmcnLCBuYW1lLnNsaWNlKDEpLCB2YWx1ZV0pO1xuICAgIH1cbiAgICB5aWVsZCh0bykge1xuICAgICAgICBsZXQgcGFyYW1zID0gdGhpcy5wb3BWYWx1ZSgpO1xuICAgICAgICB0aGlzLnB1c2goWyd5aWVsZCcsIHRvLCBwYXJhbXNdKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZS5ibG9jay55aWVsZHMuYWRkKHRvKTtcbiAgICB9XG4gICAgZGVidWdnZXIoKSB7XG4gICAgICAgIHRoaXMucHVzaChbJ2RlYnVnZ2VyJywgbnVsbCwgbnVsbF0pO1xuICAgIH1cbiAgICBoYXNCbG9jayhuYW1lKSB7XG4gICAgICAgIHRoaXMucHVzaFZhbHVlKFsnaGFzLWJsb2NrJywgbmFtZV0pO1xuICAgICAgICB0aGlzLnRlbXBsYXRlLmJsb2NrLnlpZWxkcy5hZGQobmFtZSk7XG4gICAgfVxuICAgIGhhc0Jsb2NrUGFyYW1zKG5hbWUpIHtcbiAgICAgICAgdGhpcy5wdXNoVmFsdWUoWydoYXMtYmxvY2stcGFyYW1zJywgbmFtZV0pO1xuICAgICAgICB0aGlzLnRlbXBsYXRlLmJsb2NrLnlpZWxkcy5hZGQobmFtZSk7XG4gICAgfVxuICAgIHBhcnRpYWwoKSB7XG4gICAgICAgIGxldCBwYXJhbXMgPSB0aGlzLnBvcFZhbHVlKCk7XG4gICAgICAgIHRoaXMucHVzaChbJ3BhcnRpYWwnLCBwYXJhbXNbMF1dKTtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZS5ibG9jay5oYXNQYXJ0aWFscyA9IHRydWU7XG4gICAgfVxuICAgIC8vLyBFeHByZXNzaW9uc1xuICAgIGxpdGVyYWwodmFsdWUpIHtcbiAgICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMucHVzaFZhbHVlKFsndW5kZWZpbmVkJ10pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5wdXNoVmFsdWUodmFsdWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHVua25vd24ocGF0aCkge1xuICAgICAgICB0aGlzLnB1c2hWYWx1ZShbJ3Vua25vd24nLCBwYXRoXSk7XG4gICAgfVxuICAgIGFyZyhwYXRoKSB7XG4gICAgICAgIHRoaXMudGVtcGxhdGUuYmxvY2submFtZWQuYWRkKHBhdGhbMF0pO1xuICAgICAgICB0aGlzLnB1c2hWYWx1ZShbJ2FyZycsIHBhdGhdKTtcbiAgICB9XG4gICAgZ2V0KHBhdGgpIHtcbiAgICAgICAgdGhpcy5wdXNoVmFsdWUoWydnZXQnLCBwYXRoXSk7XG4gICAgfVxuICAgIGNvbmNhdCgpIHtcbiAgICAgICAgdGhpcy5wdXNoVmFsdWUoWydjb25jYXQnLCB0aGlzLnBvcFZhbHVlKCldKTtcbiAgICB9XG4gICAgaGVscGVyKHBhdGgpIHtcbiAgICAgICAgbGV0IHBhcmFtcyA9IHRoaXMucG9wVmFsdWUoKTtcbiAgICAgICAgbGV0IGhhc2ggPSB0aGlzLnBvcFZhbHVlKCk7XG4gICAgICAgIHRoaXMucHVzaFZhbHVlKFsnaGVscGVyJywgcGF0aCwgcGFyYW1zLCBoYXNoXSk7XG4gICAgfVxuICAgIC8vLyBTdGFjayBNYW5hZ2VtZW50IE9wY29kZXNcbiAgICBzdGFydENvbXBvbmVudChibG9ja1BhcmFtcykge1xuICAgICAgICBsZXQgY29tcG9uZW50ID0gbmV3IENvbXBvbmVudEJsb2NrKCk7XG4gICAgICAgIGNvbXBvbmVudC5wb3NpdGlvbmFscyA9IGJsb2NrUGFyYW1zO1xuICAgICAgICB0aGlzLmJsb2Nrcy5wdXNoKGNvbXBvbmVudCk7XG4gICAgfVxuICAgIGVuZENvbXBvbmVudCgpIHtcbiAgICAgICAgbGV0IGNvbXBvbmVudCA9IHRoaXMuYmxvY2tzLnBvcCgpO1xuICAgICAgICBhc3NlcnQoY29tcG9uZW50LnR5cGUgPT09ICdjb21wb25lbnQnLCBcIkNvbXBpbGVyIGJ1ZzogZW5kQ29tcG9uZW50KCkgc2hvdWxkIGVuZCBhIGNvbXBvbmVudFwiKTtcbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudC50b0pTT04oKTtcbiAgICB9XG4gICAgcHJlcGFyZUFycmF5KHNpemUpIHtcbiAgICAgICAgbGV0IHZhbHVlcyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNpemU7IGkrKykge1xuICAgICAgICAgICAgdmFsdWVzLnB1c2godGhpcy5wb3BWYWx1ZSgpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnB1c2hWYWx1ZSh2YWx1ZXMpO1xuICAgIH1cbiAgICBwcmVwYXJlT2JqZWN0KHNpemUpIHtcbiAgICAgICAgYXNzZXJ0KHRoaXMudmFsdWVzLmxlbmd0aCA+PSBzaXplLCBgRXhwZWN0ZWQgJHtzaXplfSB2YWx1ZXMgb24gdGhlIHN0YWNrLCBmb3VuZCAke3RoaXMudmFsdWVzLmxlbmd0aH1gKTtcbiAgICAgICAgbGV0IGtleXMgPSBuZXcgQXJyYXkoc2l6ZSk7XG4gICAgICAgIGxldCB2YWx1ZXMgPSBuZXcgQXJyYXkoc2l6ZSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7XG4gICAgICAgICAgICBrZXlzW2ldID0gdGhpcy5wb3BWYWx1ZSgpO1xuICAgICAgICAgICAgdmFsdWVzW2ldID0gdGhpcy5wb3BWYWx1ZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucHVzaFZhbHVlKFtrZXlzLCB2YWx1ZXNdKTtcbiAgICB9XG4gICAgLy8vIFV0aWxpdGllc1xuICAgIHB1c2goYXJncykge1xuICAgICAgICB3aGlsZSAoYXJnc1thcmdzLmxlbmd0aCAtIDFdID09PSBudWxsKSB7XG4gICAgICAgICAgICBhcmdzLnBvcCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYmxvY2tzLmN1cnJlbnQucHVzaChhcmdzKTtcbiAgICB9XG4gICAgcHVzaFZhbHVlKHZhbCkge1xuICAgICAgICB0aGlzLnZhbHVlcy5wdXNoKHZhbCk7XG4gICAgfVxuICAgIHBvcFZhbHVlKCkge1xuICAgICAgICBhc3NlcnQodGhpcy52YWx1ZXMubGVuZ3RoLCBcIk5vIGV4cHJlc3Npb24gZm91bmQgb24gc3RhY2tcIik7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlcy5wb3AoKTtcbiAgICB9XG59XG4iXX0=