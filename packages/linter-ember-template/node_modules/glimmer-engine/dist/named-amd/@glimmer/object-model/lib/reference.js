enifed('@glimmer/object-model/lib/reference', ['exports', '@glimmer/object-model/lib/meta', '@glimmer/reference', '@glimmer/util'], function (exports, _glimmerObjectModelLibMeta, _glimmerReference, _glimmerUtil) {
    'use strict';

    exports.set = set;
    exports.root = root;

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

    var classMeta = undefined;
    exports.classMeta = classMeta;
    var meta = undefined;
    exports.meta = meta;
    if (_glimmerUtil.HAS_NATIVE_WEAKMAP) {
        (function () {
            var META = new WeakMap();
            var CLASS_META = new WeakMap();
            exports.classMeta = classMeta = function _classMetaNative(object) {
                var m = CLASS_META.get(object);
                if (m === undefined) {
                    m = new _glimmerObjectModelLibMeta.ClassMeta();
                    CLASS_META.set(object, m);
                }
                return m;
            };
            exports.meta = meta = function _metaNative(object) {
                var m = META.get(object);
                if (m === undefined) {
                    m = new _glimmerObjectModelLibMeta.default();
                    META.set(object, m);
                }
                return m;
            };
        })();
    } else {
        (function () {
            var GLIMMER_META = 'META__glimmer__1484170086860394543206811';
            var GLIMMER_CLASS_META = 'CLASS_META__glimmer__14841708559821468834708062';
            exports.classMeta = classMeta = function _classMetaFaux(object) {
                var m = object[GLIMMER_CLASS_META];
                if (m === undefined) {
                    m = new _glimmerObjectModelLibMeta.ClassMeta();
                    object[GLIMMER_CLASS_META] = m;
                }
                return m;
            };
            exports.meta = meta = function _metaFaux(object) {
                var m = object[GLIMMER_META];
                if (m === undefined) {
                    m = new _glimmerObjectModelLibMeta.default();
                    object[GLIMMER_META] = m;
                }
                return m;
            };
        })();
    }

    function set(object, key, value) {
        object[key] = value;
        meta(object).dirty(key);
    }

    function root(object) {
        return new VersionedRootReference(object);
    }

    var VersionedRootReference = (function () {
        function VersionedRootReference(inner) {
            _classCallCheck(this, VersionedRootReference);

            this.inner = inner;
            this.tag = _glimmerReference.CONSTANT_TAG;
        }

        VersionedRootReference.prototype.value = function value() {
            return this.inner;
        };

        VersionedRootReference.prototype.get = function get(key) {
            return new VersionedObjectReference(this, key);
        };

        return VersionedRootReference;
    })();

    exports.VersionedRootReference = VersionedRootReference;

    var VersionedObjectReference = (function () {
        function VersionedObjectReference(parent, key) {
            _classCallCheck(this, VersionedObjectReference);

            this.parent = parent;
            this.key = key;
            this.tag = _glimmerReference.CURRENT_TAG;
        }

        VersionedObjectReference.prototype.value = function value() {
            var _this = this;

            var parent = this.parent;
            var key = this.key;

            var parentObject = this.parent.value();
            var computed = classMeta(Object.getPrototypeOf(parentObject)).getComputed(key);
            var tags = [meta(parentObject).tag(key)];
            if (computed) {
                tags.push.apply(tags, computed.dependentKeys.map(function (key) {
                    return path(_this, key).tag;
                }));
            }
            this.tag = _glimmerReference.combine(tags);
            return parentObject[key];
        };

        VersionedObjectReference.prototype.get = function get(key) {
            return new VersionedObjectReference(this, key);
        };

        return VersionedObjectReference;
    })();

    exports.VersionedObjectReference = VersionedObjectReference;

    function path(parent, key) {
        return key.split('.').reduce(function (ref, part) {
            return ref.get(part);
        }, parent);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL29iamVjdC1tb2RlbC9saWIvcmVmZXJlbmNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBY08sUUFBSSxTQUFTLFlBQUEsQ0FBQzs7QUFDZCxRQUFJLElBQUksWUFBQSxDQUFDOztBQUVoQixxQkFMeUIsa0JBQWtCLEVBS25COztBQUN0QixnQkFBTSxJQUFJLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUMzQixnQkFBTSxVQUFVLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUNqQyxvQkFOUyxTQUFTLEdBTWxCLFNBQVMsR0FBRyxTQUFBLGdCQUFBLENBQTBCLE1BQXVCLEVBQUE7QUFDM0Qsb0JBQUksQ0FBQyxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFL0Isb0JBQUksQ0FBQyxLQUFLLFNBQVMsRUFBRTtBQUNuQixxQkFBQyxHQUFHLCtCQXZCSyxTQUFTLEVBdUJDLENBQUM7QUFDcEIsOEJBQVUsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUMzQjtBQUVELHVCQUFPLENBQUMsQ0FBQzthQUNWLENBQUM7QUFFRixvQkFoQlMsSUFBSSxHQWdCYixJQUFJLEdBQUcsU0FBQSxXQUFBLENBQXFCLE1BQXVCLEVBQUE7QUFDakQsb0JBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFekIsb0JBQUksQ0FBQyxLQUFLLFNBQVMsRUFBRTtBQUNuQixxQkFBQyxHQUFHLHdDQUFVLENBQUM7QUFDZix3QkFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7aUJBQ3JCO0FBRUQsdUJBQU8sQ0FBQyxDQUFDO2FBQ1YsQ0FBQzs7S0FFSCxNQUFNOztBQUNMLGdCQUFNLFlBQVksR0FBRywwQ0FBMEMsQ0FBQztBQUNoRSxnQkFBTSxrQkFBa0IsR0FBRyxpREFBaUQsQ0FBQztBQUM3RSxvQkEvQlMs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LEdBQUcsa0JBcEdiLE9BQU8sQ0FvR2MsSUFBSSxDQUFDLENBQUM7QUFDekIsbUJBQU8sWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQzFCOztBQWxCRyxnQ0FBQSxXQW9CSixHQUFHLEdBQUEsYUFBQyxHQUFnQixFQUFBO0FBQ2xCLG1CQUFPLElBQUksd0JBQXdCLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ2hEOztlQXRCRyx3QkFBQTs7Ozs7QUF5Qk4sYUFBQSxJQUFBLENBQWMsTUFBc0MsRUFBRSxHQUFXLEVBQUE7QUFDL0QsZUFBTyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQUcsRUFBRSxJQUFJO21CQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDO1NBQUEsRUFBRSxNQUFNLENBQUMsQ0FBQztLQUNwRSIsImZpbGUiOiJyZWZlcmVuY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgR2xpbW1lckluc3RhbmNlIGZyb20gJy4vb2JqZWN0JztcbmltcG9ydCBNZXRhLCB7IENsYXNzTWV0YSB9IGZyb20gJy4vbWV0YSc7XG5pbXBvcnQgeyBDb21wdXRlZCB9IGZyb20gJy4vYmx1ZXByaW50JztcblxuaW1wb3J0IHtcbiAgQ1VSUkVOVF9UQUcsXG4gIENPTlNUQU5UX1RBRyxcbiAgVmVyc2lvbmVkUGF0aFJlZmVyZW5jZSxcbiAgUmV2aXNpb25UYWcsXG4gIGNvbWJpbmVcbn0gZnJvbSAnQGdsaW1tZXIvcmVmZXJlbmNlJztcblxuaW1wb3J0IHsgT3BhcXVlLCBPcHRpb24sIEhBU19OQVRJVkVfV0VBS01BUCB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuXG5leHBvcnQgbGV0IGNsYXNzTWV0YTtcbmV4cG9ydCBsZXQgbWV0YTtcblxuaWYgKEhBU19OQVRJVkVfV0VBS01BUCkge1xuICBjb25zdCBNRVRBID0gbmV3IFdlYWtNYXAoKTtcbiAgY29uc3QgQ0xBU1NfTUVUQSA9IG5ldyBXZWFrTWFwKCk7XG4gIGNsYXNzTWV0YSA9IGZ1bmN0aW9uIF9jbGFzc01ldGFOYXRpdmUob2JqZWN0OiBHbGltbWVySW5zdGFuY2UpOiBDbGFzc01ldGEge1xuICAgIGxldCBtID0gQ0xBU1NfTUVUQS5nZXQob2JqZWN0KTtcblxuICAgIGlmIChtID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG0gPSBuZXcgQ2xhc3NNZXRhKCk7XG4gICAgICBDTEFTU19NRVRBLnNldChvYmplY3QsIG0pO1xuICAgIH1cblxuICAgIHJldHVybiBtO1xuICB9O1xuXG4gIG1ldGEgPSBmdW5jdGlvbiBfbWV0YU5hdGl2ZShvYmplY3Q6IEdsaW1tZXJJbnN0YW5jZSk6IE1ldGEge1xuICAgIGxldCBtID0gTUVUQS5nZXQob2JqZWN0KTtcblxuICAgIGlmIChtID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG0gPSBuZXcgTWV0YSgpO1xuICAgICAgTUVUQS5zZXQob2JqZWN0LCBtKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbTtcbiAgfTtcblxufSBlbHNlIHtcbiAgY29uc3QgR0xJTU1FUl9NRVRBID0gJ01FVEFfX2dsaW1tZXJfXzE0ODQxNzAwODY4NjAzOTQ1NDMyMDY4MTEnO1xuICBjb25zdCBHTElNTUVSX0NMQVNTX01FVEEgPSAnQ0xBU1NfTUVUQV9fZ2xpbW1lcl9fMTQ4NDE3MDg1NTk4MjE0Njg4MzQ3MDgwNjInO1xuICBjbGFzc01ldGEgPSBmdW5jdGlvbiBfY2xhc3NNZXRhRmF1eChvYmplY3Q6IEdsaW1tZXJJbnN0YW5jZSk6IENsYXNzTWV0YSB7XG4gICAgbGV0IG0gPSBvYmplY3RbR0xJTU1FUl9DTEFTU19NRVRBXTtcblxuICAgIGlmIChtID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG0gPSBuZXcgQ2xhc3NNZXRhKCk7XG4gICAgICBvYmplY3RbR0xJTU1FUl9DTEFTU19NRVRBXSA9IG07XG4gICAgfVxuXG4gICAgcmV0dXJuIG07XG4gIH07XG5cbiAgbWV0YSA9IGZ1bmN0aW9uIF9tZXRhRmF1eChvYmplY3Q6IEdsaW1tZXJJbnN0YW5jZSk6IE1ldGEge1xuICAgIGxldCBtID0gb2JqZWN0W0dMSU1NRVJfTUVUQV07XG5cbiAgICBpZiAobSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBtID0gbmV3IE1ldGEoKTtcbiAgICAgIG9iamVjdFtHTElNTUVSX01FVEFdID0gbTtcbiAgICB9XG5cbiAgICByZXR1cm4gbTtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldDxUPihvYmplY3Q6IEdsaW1tZXJJbnN0YW5jZSwga2V5OiBQcm9wZXJ0eUtleSwgdmFsdWU6IFQpIHtcbiAgb2JqZWN0W2tleV0gPSB2YWx1ZTtcbiAgbWV0YShvYmplY3QpLmRpcnR5KGtleSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByb290PFQgZXh0ZW5kcyBHbGltbWVySW5zdGFuY2U+KG9iamVjdDogVCk6IFZlcnNpb25lZFJvb3RSZWZlcmVuY2U8VD4ge1xuICByZXR1cm4gbmV3IFZlcnNpb25lZFJvb3RSZWZlcmVuY2Uob2JqZWN0KTtcbn1cblxuZXhwb3J0IGNsYXNzIFZlcnNpb25lZFJvb3RSZWZlcmVuY2U8VD4gaW1wbGVtZW50cyBWZXJzaW9uZWRQYXRoUmVmZXJlbmNlPE9wYXF1ZT4ge1xuICBwdWJsaWMgdGFnOiBSZXZpc2lvblRhZztcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGlubmVyOiBUKSB7XG4gICAgdGhpcy50YWcgPSBDT05TVEFOVF9UQUc7XG4gIH1cblxuICB2YWx1ZSgpOiBUIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lcjtcbiAgfVxuXG4gIGdldDxUIGV4dGVuZHMgT3BhcXVlPihrZXk6IFByb3BlcnR5S2V5KTogVmVyc2lvbmVkUGF0aFJlZmVyZW5jZTxUPiB7XG4gICAgcmV0dXJuIG5ldyBWZXJzaW9uZWRPYmplY3RSZWZlcmVuY2UodGhpcywga2V5KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgVmVyc2lvbmVkT2JqZWN0UmVmZXJlbmNlIGltcGxlbWVudHMgVmVyc2lvbmVkUGF0aFJlZmVyZW5jZTxPcGFxdWU+IHtcbiAgcHVibGljIHRhZzogUmV2aXNpb25UYWcgPSBDVVJSRU5UX1RBRztcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHBhcmVudDogVmVyc2lvbmVkUGF0aFJlZmVyZW5jZTxPcGFxdWU+LCBwcml2YXRlIGtleTogUHJvcGVydHlLZXkpIHt9XG5cbiAgdmFsdWUoKSB7XG4gICAgbGV0IHsgcGFyZW50LCBrZXkgfSA9IHRoaXM7XG4gICAgbGV0IHBhcmVudE9iamVjdCA9IHRoaXMucGFyZW50LnZhbHVlKCkgYXMgR2xpbW1lckluc3RhbmNlO1xuXG4gICAgbGV0IGNvbXB1dGVkID0gY2xhc3NNZXRhKE9iamVjdC5nZXRQcm90b3R5cGVPZihwYXJlbnRPYmplY3QpKS5nZXRDb21wdXRlZChrZXkpO1xuICAgIGxldCB0YWdzOiBSZXZpc2lvblRhZ1tdID0gW21ldGEocGFyZW50T2JqZWN0KS50YWcoa2V5KV07XG5cbiAgICBpZiAoY29tcHV0ZWQpIHtcbiAgICAgIHRhZ3MucHVzaCguLi5jb21wdXRlZC5kZXBlbmRlbnRLZXlzLm1hcChrZXkgPT4gcGF0aCh0aGlzLCBrZXkpLnRhZykpO1xuICAgIH1cblxuICAgIHRoaXMudGFnID0gY29tYmluZSh0YWdzKTtcbiAgICByZXR1cm4gcGFyZW50T2JqZWN0W2tleV07XG4gIH1cblxuICBnZXQoa2V5OiBQcm9wZXJ0eUtleSk6IFZlcnNpb25lZFBhdGhSZWZlcmVuY2U8T3BhcXVlPiB7XG4gICAgcmV0dXJuIG5ldyBWZXJzaW9uZWRPYmplY3RSZWZlcmVuY2UodGhpcywga2V5KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBwYXRoKHBhcmVudDogVmVyc2lvbmVkUGF0aFJlZmVyZW5jZTxPcGFxdWU+LCBrZXk6IHN0cmluZyk6IFZlcnNpb25lZFBhdGhSZWZlcmVuY2U8T3BhcXVlPiB7XG4gIHJldHVybiBrZXkuc3BsaXQoJy4nKS5yZWR1Y2UoKHJlZiwgcGFydCkgPT4gcmVmLmdldChwYXJ0KSwgcGFyZW50KTtcbn1cbiJdfQ==