enifed("@glimmer/reference/lib/iterable", ["exports", "@glimmer/util"], function (exports, _glimmerUtil) {
    "use strict";

    function _defaults(obj, defaults) { var keys = Object.getOwnPropertyNames(defaults); for (var i = 0; i < keys.length; i++) { var key = keys[i]; var value = Object.getOwnPropertyDescriptor(defaults, key); if (value && value.configurable && obj[key] === undefined) { Object.defineProperty(obj, key, value); } } return obj; }

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

    function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : _defaults(subClass, superClass); }

    var ListItem = (function (_ListNode) {
        _inherits(ListItem, _ListNode);

        function ListItem(iterable, result) {
            _classCallCheck(this, ListItem);

            _ListNode.call(this, iterable.valueReferenceFor(result));
            this.retained = false;
            this.seen = false;
            this.key = result.key;
            this.iterable = iterable;
            this.memo = iterable.memoReferenceFor(result);
        }

        ListItem.prototype.update = function update(item) {
            this.retained = true;
            this.iterable.updateValueReference(this.value, item);
            this.iterable.updateMemoReference(this.memo, item);
        };

        ListItem.prototype.shouldRemove = function shouldRemove() {
            return !this.retained;
        };

        ListItem.prototype.reset = function reset() {
            this.retained = false;
            this.seen = false;
        };

        return ListItem;
    })(_glimmerUtil.ListNode);

    exports.ListItem = ListItem;

    var IterationArtifacts = (function () {
        function IterationArtifacts(iterable) {
            _classCallCheck(this, IterationArtifacts);

            this.map = _glimmerUtil.dict();
            this.list = new _glimmerUtil.LinkedList();
            this.tag = iterable.tag;
            this.iterable = iterable;
        }

        IterationArtifacts.prototype.isEmpty = function isEmpty() {
            var iterator = this.iterator = this.iterable.iterate();
            return iterator.isEmpty();
        };

        IterationArtifacts.prototype.iterate = function iterate() {
            var iterator = this.iterator || this.iterable.iterate();
            this.iterator = null;
            return iterator;
        };

        IterationArtifacts.prototype.has = function has(key) {
            return !!this.map[key];
        };

        IterationArtifacts.prototype.get = function get(key) {
            return this.map[key];
        };

        IterationArtifacts.prototype.wasSeen = function wasSeen(key) {
            var node = this.map[key];
            return node && node.seen;
        };

        IterationArtifacts.prototype.append = function append(item) {
            var map = this.map;
            var list = this.list;
            var iterable = this.iterable;

            var node = map[item.key] = new ListItem(iterable, item);
            list.append(node);
            return node;
        };

        IterationArtifacts.prototype.insertBefore = function insertBefore(item, reference) {
            var map = this.map;
            var list = this.list;
            var iterable = this.iterable;

            var node = map[item.key] = new ListItem(iterable, item);
            node.retained = true;
            list.insertBefore(node, reference);
            return node;
        };

        IterationArtifacts.prototype.move = function move(item, reference) {
            var list = this.list;

            item.retained = true;
            list.remove(item);
            list.insertBefore(item, reference);
        };

        IterationArtifacts.prototype.remove = function remove(item) {
            var list = this.list;

            list.remove(item);
            delete this.map[item.key];
        };

        IterationArtifacts.prototype.nextNode = function nextNode(item) {
            return this.list.nextNode(item);
        };

        IterationArtifacts.prototype.head = function head() {
            return this.list.head();
        };

        return IterationArtifacts;
    })();

    exports.IterationArtifacts = IterationArtifacts;

    var ReferenceIterator = (function () {
        // if anyone needs to construct this object with something other than
        // an iterable, let @wycats know.

        function ReferenceIterator(iterable) {
            _classCallCheck(this, ReferenceIterator);

            this.iterator = null;
            var artifacts = new IterationArtifacts(iterable);
            this.artifacts = artifacts;
        }

        ReferenceIterator.prototype.next = function next() {
            var artifacts = this.artifacts;

            var iterator = this.iterator = this.iterator || artifacts.iterate();
            var item = iterator.next();
            if (!item) return null;
            return artifacts.append(item);
        };

        return ReferenceIterator;
    })();

    exports.ReferenceIterator = ReferenceIterator;

    var Phase;
    (function (Phase) {
        Phase[Phase["Append"] = 0] = "Append";
        Phase[Phase["Prune"] = 1] = "Prune";
        Phase[Phase["Done"] = 2] = "Done";
    })(Phase || (Phase = {}));

    var IteratorSynchronizer = (function () {
        function IteratorSynchronizer(_ref) {
            var target = _ref.target;
            var artifacts = _ref.artifacts;

            _classCallCheck(this, IteratorSynchronizer);

            this.target = target;
            this.artifacts = artifacts;
            this.iterator = artifacts.iterate();
            this.current = artifacts.head();
        }

        IteratorSynchronizer.prototype.sync = function sync() {
            var phase = Phase.Append;
            while (true) {
                switch (phase) {
                    case Phase.Append:
                        phase = this.nextAppend();
                        break;
                    case Phase.Prune:
                        phase = this.nextPrune();
                        break;
                    case Phase.Done:
                        this.nextDone();
                        return;
                }
            }
        };

        IteratorSynchronizer.prototype.advanceToKey = function advanceToKey(key) {
            var current = this.current;
            var artifacts = this.artifacts;

            var seek = current;
            while (seek && seek.key !== key) {
                seek.seen = true;
                seek = artifacts.nextNode(seek);
            }
            this.current = seek && artifacts.nextNode(seek);
        };

        IteratorSynchronizer.prototype.nextAppend = function nextAppend() {
            var iterator = this.iterator;
            var current = this.current;
            var artifacts = this.artifacts;

            var item = iterator.next();
            if (item === null) {
                return this.startPrune();
            }
            var key = item.key;

            if (current && current.key === key) {
                this.nextRetain(item);
            } else if (artifacts.has(key)) {
                this.nextMove(item);
            } else {
                this.nextInsert(item);
            }
            return Phase.Append;
        };

        IteratorSynchronizer.prototype.nextRetain = function nextRetain(item) {
            var artifacts = this.artifacts;
            var current = this.current;

            current = _glimmerUtil.expect(current, 'BUG: current is empty');
            current.update(item);
            this.current = artifacts.nextNode(current);
            this.target.retain(item.key, current.value, current.memo);
        };

        IteratorSynchronizer.prototype.nextMove = function nextMove(item) {
            var current = this.current;
            var artifacts = this.artifacts;
            var target = this.target;
            var key = item.key;

            var found = artifacts.get(item.key);
            found.update(item);
            if (artifacts.wasSeen(item.key)) {
                artifacts.move(found, current);
                target.move(found.key, found.value, found.memo, current ? current.key : null);
            } else {
                this.advanceToKey(key);
            }
        };

        IteratorSynchronizer.prototype.nextInsert = function nextInsert(item) {
            var artifacts = this.artifacts;
            var target = this.target;
            var current = this.current;

            var node = artifacts.insertBefore(item, current);
            target.insert(node.key, node.value, node.memo, current ? current.key : null);
        };

        IteratorSynchronizer.prototype.startPrune = function startPrune() {
            this.current = this.artifacts.head();
            return Phase.Prune;
        };

        IteratorSynchronizer.prototype.nextPrune = function nextPrune() {
            var artifacts = this.artifacts;
            var target = this.target;
            var current = this.current;

            if (current === null) {
                return Phase.Done;
            }
            var node = current;
            this.current = artifacts.nextNode(node);
            if (node.shouldRemove()) {
                artifacts.remove(node);
                target.delete(node.key);
            } else {
                node.reset();
            }
            return Phase.Prune;
        };

        IteratorSynchronizer.prototype.nextDone = function nextDone() {
            this.target.done();
        };

        return IteratorSynchronizer;
    })();

    exports.IteratorSynchronizer = IteratorSynchronizer;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL3JlZmVyZW5jZS9saWIvaXRlcmFibGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O1FBa0NNLFFBQWdCO2tCQUFoQixRQUFnQjs7QUFPcEIsaUJBUEksUUFBZ0IsQ0FPUixRQUF3QixFQUFFLE1BQTJCLEVBQUE7a0NBUDdELFFBQWdCOztBQVFsQixpQ0FBTSxRQUFRLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUxyQyxnQkFBQSxDQUFBLFFBQVEsR0FBWSxLQUFLLENBQUM7QUFDMUIsZ0JBQUEsQ0FBQSxJQUFJLEdBQVksS0FBSyxDQUFDO0FBSzNCLGdCQUFJLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUM7QUFDdEIsZ0JBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0FBQ3pCLGdCQUFJLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMvQzs7QUFaRyxnQkFBZ0IsV0FjcEIsTUFBTSxHQUFBLGdCQUFDLElBQXlCLEVBQUE7QUFDOUIsZ0JBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO0FBQ3JCLGdCQUFJLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDckQsZ0JBQUksQ0FBQyxRQUFRLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztTQUNwRDs7QUFsQkcsZ0JBQWdCLFdBb0JwQixZQUFZLEdBQUEsd0JBQUE7QUFDVixtQkFBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7U0FDdkI7O0FBdEJHLGdCQUFnQixXQXdCcEIsS0FBSyxHQUFBLGlCQUFBO0FBQ0gsZ0JBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0FBQ3RCLGdCQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztTQUNuQjs7ZUEzQkcs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QUFDcEIsdUJBQU8sS0FBSyxDQUFDLElBQUksQ0FBQzthQUNuQjtBQUVELGdCQUFJLElBQUksR0FBRyxPQUFPLENBQUM7QUFDbkIsZ0JBQUksQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUV4QyxnQkFBSSxJQUFJLENBQUMsWUFBWSxFQUFFLEVBQUU7QUFDdkIseUJBQVMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDdkIsc0JBQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3pCLE1BQU07QUFDTCxvQkFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ2Q7QUFFRCxtQkFBTyxLQUFLLENBQUMsS0FBSyxDQUFDO1NBQ3BCOztBQW5IRyw0QkFBQSxXQXFISSxRQUFRLEdBQUEsb0JBQUE7QUFDZCxnQkFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztTQUNwQjs7ZUF2SEcsb0JBQUEiLCJmaWxlIjoiaXRlcmFibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMaW5rZWRMaXN0LCBMaXN0Tm9kZSwgT3BhcXVlLCBPcHRpb24sIGRpY3QsIGV4cGVjdCB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgVmVyc2lvbmVkUGF0aFJlZmVyZW5jZSBhcyBQYXRoUmVmZXJlbmNlLCBSZXZpc2lvblRhZyB9IGZyb20gJy4vdmFsaWRhdG9ycyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSXRlcmF0aW9uSXRlbTxULCBVPiB7XG4gIGtleTogc3RyaW5nO1xuICB2YWx1ZTogVDtcbiAgbWVtbzogVTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBYnN0cmFjdEl0ZXJhdG9yPFQsIFUsIFYgZXh0ZW5kcyBJdGVyYXRpb25JdGVtPFQsIFU+PiB7XG4gIGlzRW1wdHkoKTogYm9vbGVhbjtcbiAgbmV4dCgpOiBWO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFic3RyYWN0SXRlcmFibGU8VCwgVSwgSXRlbVR5cGUgZXh0ZW5kcyBJdGVyYXRpb25JdGVtPFQsIFU+LCBWYWx1ZVJlZmVyZW5jZVR5cGUgZXh0ZW5kcyBQYXRoUmVmZXJlbmNlPFQ+LCBNZW1vUmVmZXJlbmNlVHlwZSBleHRlbmRzIFBhdGhSZWZlcmVuY2U8VT4+IHtcbiAgdGFnOiBSZXZpc2lvblRhZztcbiAgaXRlcmF0ZSgpOiBBYnN0cmFjdEl0ZXJhdG9yPFQsIFUsIEl0ZW1UeXBlPjtcblxuICB2YWx1ZVJlZmVyZW5jZUZvcihpdGVtOiBJdGVtVHlwZSk6IFZhbHVlUmVmZXJlbmNlVHlwZTtcbiAgdXBkYXRlVmFsdWVSZWZlcmVuY2UocmVmZXJlbmNlOiBWYWx1ZVJlZmVyZW5jZVR5cGUsIGl0ZW06IEl0ZW1UeXBlKTogdm9pZDtcblxuICBtZW1vUmVmZXJlbmNlRm9yKGl0ZW06IEl0ZW1UeXBlKTogTWVtb1JlZmVyZW5jZVR5cGU7XG4gIHVwZGF0ZU1lbW9SZWZlcmVuY2UocmVmZXJlbmNlOiBNZW1vUmVmZXJlbmNlVHlwZSwgaXRlbTogSXRlbVR5cGUpOiB2b2lkO1xufVxuXG5leHBvcnQgdHlwZSBJdGVyYXRvcjxULCBVPiA9IEFic3RyYWN0SXRlcmF0b3I8VCwgVSwgSXRlcmF0aW9uSXRlbTxULCBVPj47XG5leHBvcnQgdHlwZSBJdGVyYWJsZTxULCBVPiA9IEFic3RyYWN0SXRlcmFibGU8VCwgVSwgSXRlcmF0aW9uSXRlbTxULCBVPiwgUGF0aFJlZmVyZW5jZTxUPiwgUGF0aFJlZmVyZW5jZTxVPj47XG5cbmV4cG9ydCB0eXBlIE9wYXF1ZUl0ZXJhdGlvbkl0ZW0gPSBJdGVyYXRpb25JdGVtPE9wYXF1ZSwgT3BhcXVlPjtcbmV4cG9ydCB0eXBlIE9wYXF1ZUl0ZXJhdG9yID0gQWJzdHJhY3RJdGVyYXRvcjxPcGFxdWUsIE9wYXF1ZSwgT3BhcXVlSXRlcmF0aW9uSXRlbT47XG5leHBvcnQgdHlwZSBPcGFxdWVQYXRoUmVmZXJlbmNlID0gUGF0aFJlZmVyZW5jZTxPcGFxdWU+O1xuZXhwb3J0IHR5cGUgT3BhcXVlSXRlcmFibGUgPSBBYnN0cmFjdEl0ZXJhYmxlPE9wYXF1ZSwgT3BhcXVlLCBPcGFxdWVJdGVyYXRpb25JdGVtLCBPcGFxdWVQYXRoUmVmZXJlbmNlLCBPcGFxdWVQYXRoUmVmZXJlbmNlPjtcbmV4cG9ydCB0eXBlIE9wYXF1ZVBhdGhSZWZlcmVuY2VJdGVyYXRpb25JdGVtID0gSXRlcmF0aW9uSXRlbTxPcGFxdWVQYXRoUmVmZXJlbmNlLCBPcGFxdWVQYXRoUmVmZXJlbmNlPjtcblxuZXhwb3J0IGNsYXNzIExpc3RJdGVtIGV4dGVuZHMgTGlzdE5vZGU8T3BhcXVlUGF0aFJlZmVyZW5jZT4gaW1wbGVtZW50cyBPcGFxdWVJdGVyYXRpb25JdGVtIHtcbiAgcHVibGljIGtleTogc3RyaW5nO1xuICBwdWJsaWMgbWVtbzogT3BhcXVlUGF0aFJlZmVyZW5jZTtcbiAgcHVibGljIHJldGFpbmVkOiBib29sZWFuID0gZmFsc2U7XG4gIHB1YmxpYyBzZWVuOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgaXRlcmFibGU6IE9wYXF1ZUl0ZXJhYmxlO1xuXG4gIGNvbnN0cnVjdG9yKGl0ZXJhYmxlOiBPcGFxdWVJdGVyYWJsZSwgcmVzdWx0OiBPcGFxdWVJdGVyYXRpb25JdGVtKSB7XG4gICAgc3VwZXIoaXRlcmFibGUudmFsdWVSZWZlcmVuY2VGb3IocmVzdWx0KSk7XG4gICAgdGhpcy5rZXkgPSByZXN1bHQua2V5O1xuICAgIHRoaXMuaXRlcmFibGUgPSBpdGVyYWJsZTtcbiAgICB0aGlzLm1lbW8gPSBpdGVyYWJsZS5tZW1vUmVmZXJlbmNlRm9yKHJlc3VsdCk7XG4gIH1cblxuICB1cGRhdGUoaXRlbTogT3BhcXVlSXRlcmF0aW9uSXRlbSkge1xuICAgIHRoaXMucmV0YWluZWQgPSB0cnVlO1xuICAgIHRoaXMuaXRlcmFibGUudXBkYXRlVmFsdWVSZWZlcmVuY2UodGhpcy52YWx1ZSwgaXRlbSk7XG4gICAgdGhpcy5pdGVyYWJsZS51cGRhdGVNZW1vUmVmZXJlbmNlKHRoaXMubWVtbywgaXRlbSk7XG4gIH1cblxuICBzaG91bGRSZW1vdmUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLnJldGFpbmVkO1xuICB9XG5cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5yZXRhaW5lZCA9IGZhbHNlO1xuICAgIHRoaXMuc2VlbiA9IGZhbHNlO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBJdGVyYXRpb25BcnRpZmFjdHMge1xuICBwdWJsaWMgdGFnOiBSZXZpc2lvblRhZztcblxuICBwcml2YXRlIGl0ZXJhYmxlOiBPcGFxdWVJdGVyYWJsZTtcbiAgcHJpdmF0ZSBpdGVyYXRvcjogT3B0aW9uPE9wYXF1ZUl0ZXJhdG9yPjtcbiAgcHJpdmF0ZSBtYXAgPSBkaWN0PExpc3RJdGVtPigpO1xuICBwcml2YXRlIGxpc3QgPSBuZXcgTGlua2VkTGlzdDxMaXN0SXRlbT4oKTtcblxuICBjb25zdHJ1Y3RvcihpdGVyYWJsZTogT3BhcXVlSXRlcmFibGUpIHtcbiAgICB0aGlzLnRhZyA9IGl0ZXJhYmxlLnRhZztcbiAgICB0aGlzLml0ZXJhYmxlID0gaXRlcmFibGU7XG4gIH1cblxuICBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgIGxldCBpdGVyYXRvciA9IHRoaXMuaXRlcmF0b3IgPSB0aGlzLml0ZXJhYmxlLml0ZXJhdGUoKTtcbiAgICByZXR1cm4gaXRlcmF0b3IuaXNFbXB0eSgpO1xuICB9XG5cbiAgaXRlcmF0ZSgpOiBPcGFxdWVJdGVyYXRvciB7XG4gICAgbGV0IGl0ZXJhdG9yID0gdGhpcy5pdGVyYXRvciB8fCB0aGlzLml0ZXJhYmxlLml0ZXJhdGUoKTtcbiAgICB0aGlzLml0ZXJhdG9yID0gbnVsbDtcblxuICAgIHJldHVybiBpdGVyYXRvcjtcbiAgfVxuXG4gIGhhcyhrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhIXRoaXMubWFwW2tleV07XG4gIH1cblxuICBnZXQoa2V5OiBzdHJpbmcpOiBMaXN0SXRlbSB7XG4gICAgcmV0dXJuIHRoaXMubWFwW2tleV07XG4gIH1cblxuICB3YXNTZWVuKGtleTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgbGV0IG5vZGUgPSB0aGlzLm1hcFtrZXldO1xuICAgIHJldHVybiBub2RlICYmIG5vZGUuc2VlbjtcbiAgfVxuXG4gIGFwcGVuZChpdGVtOiBPcGFxdWVJdGVyYXRpb25JdGVtKTogTGlzdEl0ZW0ge1xuICAgIGxldCB7IG1hcCwgbGlzdCwgaXRlcmFibGUgfSA9IHRoaXM7XG4gICAgbGV0IG5vZGUgPSBtYXBbaXRlbS5rZXldID0gbmV3IExpc3RJdGVtKGl0ZXJhYmxlLCBpdGVtKTtcblxuICAgIGxpc3QuYXBwZW5kKG5vZGUpO1xuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgaW5zZXJ0QmVmb3JlKGl0ZW06IE9wYXF1ZUl0ZXJhdGlvbkl0ZW0sIHJlZmVyZW5jZTogT3B0aW9uPExpc3RJdGVtPik6IExpc3RJdGVtIHtcbiAgICBsZXQgeyBtYXAsIGxpc3QsIGl0ZXJhYmxlIH0gPSB0aGlzO1xuXG4gICAgbGV0IG5vZGUgPSBtYXBbaXRlbS5rZXldID0gbmV3IExpc3RJdGVtKGl0ZXJhYmxlLCBpdGVtKTtcbiAgICBub2RlLnJldGFpbmVkID0gdHJ1ZTtcbiAgICBsaXN0Lmluc2VydEJlZm9yZShub2RlLCByZWZlcmVuY2UpO1xuICAgIHJldHVybiBub2RlO1xuICB9XG5cbiAgbW92ZShpdGVtOiBMaXN0SXRlbSwgcmVmZXJlbmNlOiBPcHRpb248TGlzdEl0ZW0+KTogdm9pZCB7XG4gICAgbGV0IHsgbGlzdCB9ID0gdGhpcztcblxuICAgIGl0ZW0ucmV0YWluZWQgPSB0cnVlO1xuICAgIGxpc3QucmVtb3ZlKGl0ZW0pO1xuICAgIGxpc3QuaW5zZXJ0QmVmb3JlKGl0ZW0sIHJlZmVyZW5jZSk7XG4gIH1cblxuICByZW1vdmUoaXRlbTogTGlzdEl0ZW0pOiB2b2lkIHtcbiAgICBsZXQgeyBsaXN0IH0gPSB0aGlzO1xuXG4gICAgbGlzdC5yZW1vdmUoaXRlbSk7XG4gICAgZGVsZXRlIHRoaXMubWFwW2l0ZW0ua2V5XTtcbiAgfVxuXG4gIG5leHROb2RlKGl0ZW06IExpc3RJdGVtKTogTGlzdEl0ZW0ge1xuICAgIHJldHVybiB0aGlzLmxpc3QubmV4dE5vZGUoaXRlbSk7XG4gIH1cblxuICBoZWFkKCk6IE9wdGlvbjxMaXN0SXRlbT4ge1xuICAgIHJldHVybiB0aGlzLmxpc3QuaGVhZCgpO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBSZWZlcmVuY2VJdGVyYXRvciB7XG4gIHB1YmxpYyBhcnRpZmFjdHM6IEl0ZXJhdGlvbkFydGlmYWN0cztcbiAgcHJpdmF0ZSBpdGVyYXRvcjogT3B0aW9uPE9wYXF1ZUl0ZXJhdG9yPiA9IG51bGw7XG5cbiAgLy8gaWYgYW55b25lIG5lZWRzIHRvIGNvbnN0cnVjdCB0aGlzIG9iamVjdCB3aXRoIHNvbWV0aGluZyBvdGhlciB0aGFuXG4gIC8vIGFuIGl0ZXJhYmxlLCBsZXQgQHd5Y2F0cyBrbm93LlxuICBjb25zdHJ1Y3RvcihpdGVyYWJsZTogT3BhcXVlSXRlcmFibGUpIHtcbiAgICBsZXQgYXJ0aWZhY3RzID0gbmV3IEl0ZXJhdGlvbkFydGlmYWN0cyhpdGVyYWJsZSk7XG4gICAgdGhpcy5hcnRpZmFjdHMgPSBhcnRpZmFjdHM7XG4gIH1cblxuICBuZXh0KCk6IE9wdGlvbjxMaXN0SXRlbT4ge1xuICAgIGxldCB7IGFydGlmYWN0cyB9ID0gdGhpcztcblxuICAgIGxldCBpdGVyYXRvciA9ICh0aGlzLml0ZXJhdG9yID0gdGhpcy5pdGVyYXRvciB8fCBhcnRpZmFjdHMuaXRlcmF0ZSgpKTtcblxuICAgIGxldCBpdGVtID0gaXRlcmF0b3IubmV4dCgpO1xuXG4gICAgaWYgKCFpdGVtKSByZXR1cm4gbnVsbDtcblxuICAgIHJldHVybiBhcnRpZmFjdHMuYXBwZW5kKGl0ZW0pO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSXRlcmF0b3JTeW5jaHJvbml6ZXJEZWxlZ2F0ZSB7XG4gIHJldGFpbihrZXk6IHN0cmluZywgaXRlbTogUGF0aFJlZmVyZW5jZTxPcGFxdWU+LCBtZW1vOiBQYXRoUmVmZXJlbmNlPE9wYXF1ZT4pOiB2b2lkO1xuICBpbnNlcnQoa2V5OiBzdHJpbmcsIGl0ZW06IFBhdGhSZWZlcmVuY2U8T3BhcXVlPiwgbWVtbzogUGF0aFJlZmVyZW5jZTxPcGFxdWU+LCBiZWZvcmU6IE9wdGlvbjxzdHJpbmc+KTogdm9pZDtcbiAgbW92ZShrZXk6IHN0cmluZywgaXRlbTogUGF0aFJlZmVyZW5jZTxPcGFxdWU+LCBtZW1vOiBQYXRoUmVmZXJlbmNlPE9wYXF1ZT4sIGJlZm9yZTogT3B0aW9uPHN0cmluZz4pOiB2b2lkO1xuICBkZWxldGUoa2V5OiBzdHJpbmcpOiB2b2lkO1xuICBkb25lKCk6IHZvaWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSXRlcmF0b3JTeW5jaHJvbml6ZXJPcHRpb25zIHtcbiAgdGFyZ2V0OiBJdGVyYXRvclN5bmNocm9uaXplckRlbGVnYXRlO1xuICBhcnRpZmFjdHM6IEl0ZXJhdGlvbkFydGlmYWN0cztcbn1cblxuZW51bSBQaGFzZSB7XG4gIEFwcGVuZCxcbiAgUHJ1bmUsXG4gIERvbmVcbn1cblxuZXhwb3J0IGNsYXNzIEl0ZXJhdG9yU3luY2hyb25pemVyIHtcbiAgcHJpdmF0ZSB0YXJnZXQ6IEl0ZXJhdG9yU3luY2hyb25pemVyRGVsZWdhdGU7XG4gIHByaXZhdGUgaXRlcmF0b3I6IE9wYXF1ZUl0ZXJhdG9yO1xuICBwcml2YXRlIGN1cnJlbnQ6IE9wdGlvbjxMaXN0SXRlbT47XG4gIHByaXZhdGUgYXJ0aWZhY3RzOiBJdGVyYXRpb25BcnRpZmFjdHM7XG5cbiAgY29uc3RydWN0b3IoeyB0YXJnZXQsIGFydGlmYWN0cyB9OiBJdGVyYXRvclN5bmNocm9uaXplck9wdGlvbnMpIHtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLmFydGlmYWN0cyA9IGFydGlmYWN0cztcbiAgICB0aGlzLml0ZXJhdG9yID0gYXJ0aWZhY3RzLml0ZXJhdGUoKTtcbiAgICB0aGlzLmN1cnJlbnQgPSBhcnRpZmFjdHMuaGVhZCgpO1xuICB9XG5cbiAgc3luYygpIHtcbiAgICBsZXQgcGhhc2U6IFBoYXNlID0gUGhhc2UuQXBwZW5kO1xuXG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgIHN3aXRjaCAocGhhc2UpIHtcbiAgICAgICAgY2FzZSBQaGFzZS5BcHBlbmQ6IHBoYXNlID0gdGhpcy5uZXh0QXBwZW5kKCk7IGJyZWFrO1xuICAgICAgICBjYXNlIFBoYXNlLlBydW5lOiBwaGFzZSA9IHRoaXMubmV4dFBydW5lKCk7IGJyZWFrO1xuICAgICAgICBjYXNlIFBoYXNlLkRvbmU6IHRoaXMubmV4dERvbmUoKTsgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWR2YW5jZVRvS2V5KGtleTogc3RyaW5nKSB7XG4gICAgbGV0IHsgY3VycmVudCwgYXJ0aWZhY3RzIH0gPSB0aGlzO1xuXG4gICAgbGV0IHNlZWsgPSBjdXJyZW50O1xuXG4gICAgd2hpbGUgKHNlZWsgJiYgc2Vlay5rZXkgIT09IGtleSkge1xuICAgICAgc2Vlay5zZWVuID0gdHJ1ZTtcbiAgICAgIHNlZWsgPSBhcnRpZmFjdHMubmV4dE5vZGUoc2Vlayk7XG4gICAgfVxuXG4gICAgdGhpcy5jdXJyZW50ID0gc2VlayAmJiBhcnRpZmFjdHMubmV4dE5vZGUoc2Vlayk7XG4gIH1cblxuICBwcml2YXRlIG5leHRBcHBlbmQoKTogUGhhc2Uge1xuICAgIGxldCB7IGl0ZXJhdG9yLCBjdXJyZW50LCBhcnRpZmFjdHMgfSA9IHRoaXM7XG5cbiAgICBsZXQgaXRlbSA9IGl0ZXJhdG9yLm5leHQoKTtcblxuICAgIGlmIChpdGVtID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gdGhpcy5zdGFydFBydW5lKCk7XG4gICAgfVxuXG4gICAgbGV0IHsga2V5IH0gPSBpdGVtO1xuXG4gICAgaWYgKGN1cnJlbnQgJiYgY3VycmVudC5rZXkgPT09IGtleSkge1xuICAgICAgdGhpcy5uZXh0UmV0YWluKGl0ZW0pO1xuICAgIH0gZWxzZSBpZiAoYXJ0aWZhY3RzLmhhcyhrZXkpKSB7XG4gICAgICB0aGlzLm5leHRNb3ZlKGl0ZW0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5leHRJbnNlcnQoaXRlbSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFBoYXNlLkFwcGVuZDtcbiAgfVxuXG4gIHByaXZhdGUgbmV4dFJldGFpbihpdGVtOiBPcGFxdWVJdGVyYXRpb25JdGVtKSB7XG4gICAgbGV0IHsgYXJ0aWZhY3RzLCBjdXJyZW50IH0gPSB0aGlzO1xuXG4gICAgY3VycmVudCA9IGV4cGVjdChjdXJyZW50LCAnQlVHOiBjdXJyZW50IGlzIGVtcHR5Jyk7XG5cbiAgICBjdXJyZW50LnVwZGF0ZShpdGVtKTtcbiAgICB0aGlzLmN1cnJlbnQgPSBhcnRpZmFjdHMubmV4dE5vZGUoY3VycmVudCk7XG4gICAgdGhpcy50YXJnZXQucmV0YWluKGl0ZW0ua2V5LCBjdXJyZW50LnZhbHVlLCBjdXJyZW50Lm1lbW8pO1xuICB9XG5cbiAgcHJpdmF0ZSBuZXh0TW92ZShpdGVtOiBPcGFxdWVJdGVyYXRpb25JdGVtKSB7XG4gICAgbGV0IHsgY3VycmVudCwgYXJ0aWZhY3RzLCB0YXJnZXQgfSA9IHRoaXM7XG4gICAgbGV0IHsga2V5IH0gPSBpdGVtO1xuXG4gICAgbGV0IGZvdW5kID0gYXJ0aWZhY3RzLmdldChpdGVtLmtleSk7XG4gICAgZm91bmQudXBkYXRlKGl0ZW0pO1xuXG4gICAgaWYgKGFydGlmYWN0cy53YXNTZWVuKGl0ZW0ua2V5KSkge1xuICAgICAgYXJ0aWZhY3RzLm1vdmUoZm91bmQsIGN1cnJlbnQpO1xuICAgICAgdGFyZ2V0Lm1vdmUoZm91bmQua2V5LCBmb3VuZC52YWx1ZSwgZm91bmQubWVtbywgY3VycmVudCA/IGN1cnJlbnQua2V5IDogbnVsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYWR2YW5jZVRvS2V5KGtleSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBuZXh0SW5zZXJ0KGl0ZW06IE9wYXF1ZUl0ZXJhdGlvbkl0ZW0pIHtcbiAgICBsZXQgeyBhcnRpZmFjdHMsIHRhcmdldCwgY3VycmVudCB9ID0gdGhpcztcblxuICAgIGxldCBub2RlID0gYXJ0aWZhY3RzLmluc2VydEJlZm9yZShpdGVtLCBjdXJyZW50KTtcbiAgICB0YXJnZXQuaW5zZXJ0KG5vZGUua2V5LCBub2RlLnZhbHVlLCBub2RlLm1lbW8sIGN1cnJlbnQgPyBjdXJyZW50LmtleSA6IG51bGwpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGFydFBydW5lKCk6IFBoYXNlIHtcbiAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLmFydGlmYWN0cy5oZWFkKCk7XG4gICAgcmV0dXJuIFBoYXNlLlBydW5lO1xuICB9XG5cbiAgcHJpdmF0ZSBuZXh0UHJ1bmUoKTogUGhhc2Uge1xuICAgIGxldCB7IGFydGlmYWN0cywgdGFyZ2V0LCBjdXJyZW50IH0gPSB0aGlzO1xuXG4gICAgaWYgKGN1cnJlbnQgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBQaGFzZS5Eb25lO1xuICAgIH1cblxuICAgIGxldCBub2RlID0gY3VycmVudDtcbiAgICB0aGlzLmN1cnJlbnQgPSBhcnRpZmFjdHMubmV4dE5vZGUobm9kZSk7XG5cbiAgICBpZiAobm9kZS5zaG91bGRSZW1vdmUoKSkge1xuICAgICAgYXJ0aWZhY3RzLnJlbW92ZShub2RlKTtcbiAgICAgIHRhcmdldC5kZWxldGUobm9kZS5rZXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBub2RlLnJlc2V0KCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFBoYXNlLlBydW5lO1xuICB9XG5cbiAgcHJpdmF0ZSBuZXh0RG9uZSgpIHtcbiAgICB0aGlzLnRhcmdldC5kb25lKCk7XG4gIH1cbn1cbiJdfQ==