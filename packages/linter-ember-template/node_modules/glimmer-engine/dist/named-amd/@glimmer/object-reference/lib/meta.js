enifed('@glimmer/object-reference/lib/meta', ['exports', '@glimmer/object-reference/lib/references/descriptors', '@glimmer/object-reference/lib/references/root', '@glimmer/util', '@glimmer/reference'], function (exports, _glimmerObjectReferenceLibReferencesDescriptors, _glimmerObjectReferenceLibReferencesRoot, _glimmerUtil, _glimmerReference) {
    'use strict';

    exports.metaFor = metaFor;

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

    var NOOP_DESTROY = { destroy: function () {} };

    var ConstPath = (function () {
        function ConstPath(parent, property) {
            _classCallCheck(this, ConstPath);

            this.tag = _glimmerReference.VOLATILE_TAG;
            this.parent = parent;
        }

        ConstPath.prototype.chain = function chain() {
            return NOOP_DESTROY;
        };

        ConstPath.prototype.notify = function notify() {};

        ConstPath.prototype.value = function value() {
            return this.parent[this.property];
        };

        ConstPath.prototype.get = function get(prop) {
            return new ConstPath(this.parent[this.property], prop);
        };

        return ConstPath;
    })();

    var ConstRoot = (function () {
        function ConstRoot(value) {
            _classCallCheck(this, ConstRoot);

            this.tag = _glimmerReference.VOLATILE_TAG;
            this.inner = value;
        }

        ConstRoot.prototype.update = function update(inner) {
            this.inner = inner;
        };

        ConstRoot.prototype.chain = function chain() {
            return NOOP_DESTROY;
        };

        ConstRoot.prototype.notify = function notify() {};

        ConstRoot.prototype.value = function value() {
            return this.inner;
        };

        ConstRoot.prototype.referenceFromParts = function referenceFromParts(parts) {
            throw new Error("Not implemented");
        };

        ConstRoot.prototype.chainFor = function chainFor(prop) {
            throw new Error("Not implemented");
        };

        ConstRoot.prototype.get = function get(prop) {
            return new ConstPath(this.inner, prop);
        };

        return ConstRoot;
    })();

    var ConstMeta /*implements IMeta*/ = (function () {
        function ConstMeta(object) {
            _classCallCheck(this, ConstMeta);

            this.object = object;
        }

        ConstMeta.prototype.root = function root() {
            return new ConstRoot(this.object);
        };

        return ConstMeta;
    })();

    var CLASS_META = "df8be4c8-4e89-44e2-a8f9-550c8dacdca7";
    exports.CLASS_META = CLASS_META;
    var hasOwnProperty = Object.hasOwnProperty;

    var Meta = (function () {
        function Meta(object, _ref) {
            var RootReferenceFactory = _ref.RootReferenceFactory;
            var DefaultPathReferenceFactory = _ref.DefaultPathReferenceFactory;

            _classCallCheck(this, Meta);

            this.references = null;
            this.slots = null;
            this.referenceTypes = null;
            this.propertyMetadata = null;
            this.object = object;
            this.RootReferenceFactory = RootReferenceFactory || _glimmerObjectReferenceLibReferencesRoot.default;
            this.DefaultPathReferenceFactory = DefaultPathReferenceFactory || _glimmerObjectReferenceLibReferencesDescriptors.PropertyReference;
        }

        Meta.for = function _for(obj) {
            if (obj === null || obj === undefined) return new Meta(obj, {});
            if (hasOwnProperty.call(obj, '_meta') && obj._meta) return obj._meta;
            if (!Object.isExtensible(obj)) return new ConstMeta(obj);
            var MetaToUse = Meta;
            if (obj.constructor && obj.constructor[CLASS_META]) {
                var classMeta = obj.constructor[CLASS_META];
                MetaToUse = classMeta.InstanceMetaConstructor;
            } else if (obj[CLASS_META]) {
                MetaToUse = obj[CLASS_META].InstanceMetaConstructor;
            }
            return obj._meta = new MetaToUse(obj, {});
        };

        Meta.exists = function exists(obj) {
            return typeof obj === 'object' && obj._meta;
        };

        Meta.metadataForProperty = function metadataForProperty(key) {
            return null;
        };

        Meta.prototype.addReference = function addReference(property, reference) {
            var refs = this.references = this.references || _glimmerUtil.dict();
            var set = refs[property] = refs[property] || new _glimmerUtil.DictSet();
            set.add(reference);
        };

        Meta.prototype.addReferenceTypeFor = function addReferenceTypeFor(property, type) {
            this.referenceTypes = this.referenceTypes || _glimmerUtil.dict();
            this.referenceTypes[property] = type;
        };

        Meta.prototype.referenceTypeFor = function referenceTypeFor(property) {
            if (!this.referenceTypes) return _glimmerObjectReferenceLibReferencesDescriptors.PropertyReference;
            return this.referenceTypes[property] || _glimmerObjectReferenceLibReferencesDescriptors.PropertyReference;
        };

        Meta.prototype.removeReference = function removeReference(property, reference) {
            if (!this.references) return;
            var set = this.references[property];
            set.delete(reference);
        };

        Meta.prototype.getReferenceTypes = function getReferenceTypes() {
            this.referenceTypes = this.referenceTypes || _glimmerUtil.dict();
            return this.referenceTypes;
        };

        Meta.prototype.referencesFor = function referencesFor(property) {
            if (!this.references) return;
            return this.references[property];
        };

        Meta.prototype.getSlots = function getSlots() {
            return this.slots = this.slots || _glimmerUtil.dict();
        };

        Meta.prototype.root = function root() {
            return this.rootCache = this.rootCache || new this.RootReferenceFactory(this.object);
        };

        return Meta;
    })();

    exports.default = Meta;

    function metaFor(obj) {
        return Meta.for(obj);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkBnbGltbWVyL29iamVjdC1yZWZlcmVuY2UvbGliL21ldGEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQWlCQSxRQUFNLFlBQVksR0FBRyxFQUFFLE9BQU8sRUFBQSxZQUFBLEVBQUssRUFBRSxDQUFDOztRQUV0QyxTQUFBO0FBS0UsaUJBTEYsU0FBQSxDQUtjLE1BQVcsRUFBRSxRQUFnQixFQUFBO2tDQUwzQyxTQUFBOztBQUdTLGdCQUFBLENBQUEsR0FBRyxxQkFUOEIsWUFBWSxBQVMzQixDQUFDO0FBR3hCLGdCQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztTQUN0Qjs7QUFQSCxpQkFBQSxXQVNFLEtBQUssR0FBQSxpQkFBQTtBQUFLLG1CQUFPLFlBQVksQ0FBQztTQUFFOztBQVRsQyxpQkFBQSxXQVVFLE1BQU0sR0FBQSxrQkFBQSxFQUFLOztBQVZiLGlCQUFBLFdBWUUsS0FBSyxHQUFBLGlCQUFBO0FBQ0gsbUJBQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDbkM7O0FBZEgsaUJBQUEsV0FnQkUsR0FBRyxHQUFBLGFBQUMsSUFBWSxFQUFBO0FBQ2QsbUJBQU8sSUFBSSxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7U0FDeEQ7O2VBbEJILFNBQUE7OztRQXFCQSxTQUFBO0FBSUUsaUJBSkYsU0FBQSxDQUljLEtBQUssRUFBQTtrQ0FKbkIsU0FBQTs7QUFFUyxnQkFBQSxDQUFBLEdBQUcscUJBN0I4QixZQUFZLEFBNkIzQixDQUFDO0FBR3hCLGdCQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztTQUNwQjs7QUFOSCxpQkFBQSxXQVFFLE1BQU0sR0FBQSxnQkFBQyxLQUFVLEVBQUE7QUFDZixnQkFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7U0FDcEI7O0FBVkgsaUJBQUEsV0FZRSxLQUFLLEdB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c0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJvcGVydHlSZWZlcmVuY2UgfSBmcm9tICcuL3JlZmVyZW5jZXMvZGVzY3JpcHRvcnMnO1xuaW1wb3J0IFJvb3RSZWZlcmVuY2UgZnJvbSAnLi9yZWZlcmVuY2VzL3Jvb3QnO1xuaW1wb3J0IHsgTWV0YU9wdGlvbnMgfSBmcm9tICcuL3R5cGVzJztcblxuaW1wb3J0IHsgRGljdCwgRGljdFNldCwgSGFzR3VpZCwgU2V0LCBkaWN0IH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5cbmltcG9ydCB7XG4gIFJvb3RSZWZlcmVuY2VGYWN0b3J5LFxuICBQYXRoUmVmZXJlbmNlRmFjdG9yeSxcbiAgTWV0YSBhcyBJTWV0YSxcbiAgUm9vdFJlZmVyZW5jZSBhcyBJUm9vdFJlZmVyZW5jZVxufSBmcm9tICcuL3R5cGVzJztcblxuaW1wb3J0IHsgUGF0aFJlZmVyZW5jZSBhcyBJUGF0aFJlZmVyZW5jZSwgVk9MQVRJTEVfVEFHIH0gZnJvbSAnQGdsaW1tZXIvcmVmZXJlbmNlJztcblxuaW1wb3J0IHsgSW5uZXJSZWZlcmVuY2VGYWN0b3J5IH0gZnJvbSAnLi9yZWZlcmVuY2VzL2Rlc2NyaXB0b3JzJztcblxuY29uc3QgTk9PUF9ERVNUUk9ZID0geyBkZXN0cm95KCkge30gfTtcblxuY2xhc3MgQ29uc3RQYXRoIGltcGxlbWVudHMgSVBhdGhSZWZlcmVuY2U8YW55PiB7XG4gIHByaXZhdGUgcGFyZW50OiBhbnk7XG4gIHByaXZhdGUgcHJvcGVydHk6IHN0cmluZztcbiAgcHVibGljIHRhZyA9IFZPTEFUSUxFX1RBRztcblxuICBjb25zdHJ1Y3RvcihwYXJlbnQ6IGFueSwgcHJvcGVydHk6IHN0cmluZykge1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICB9XG5cbiAgY2hhaW4oKSB7IHJldHVybiBOT09QX0RFU1RST1k7IH1cbiAgbm90aWZ5KCkge31cblxuICB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5wYXJlbnRbdGhpcy5wcm9wZXJ0eV07XG4gIH1cblxuICBnZXQocHJvcDogc3RyaW5nKTogSVBhdGhSZWZlcmVuY2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBDb25zdFBhdGgodGhpcy5wYXJlbnRbdGhpcy5wcm9wZXJ0eV0sIHByb3ApO1xuICB9XG59XG5cbmNsYXNzIENvbnN0Um9vdCBpbXBsZW1lbnRzIElSb290UmVmZXJlbmNlPGFueT4ge1xuICBwcml2YXRlIGlubmVyOiBhbnk7XG4gIHB1YmxpYyB0YWcgPSBWT0xBVElMRV9UQUc7XG5cbiAgY29uc3RydWN0b3IodmFsdWUpIHtcbiAgICB0aGlzLmlubmVyID0gdmFsdWU7XG4gIH1cblxuICB1cGRhdGUoaW5uZXI6IGFueSkge1xuICAgIHRoaXMuaW5uZXIgPSBpbm5lcjtcbiAgfVxuXG4gIGNoYWluKCkgeyByZXR1cm4gTk9PUF9ERVNUUk9ZOyB9XG4gIG5vdGlmeSgpIHt9XG5cbiAgdmFsdWUoKTogYW55IHtcbiAgICByZXR1cm4gdGhpcy5pbm5lcjtcbiAgfVxuXG4gIHJlZmVyZW5jZUZyb21QYXJ0cyhwYXJ0czogc3RyaW5nW10pOiBJUGF0aFJlZmVyZW5jZTxhbnk+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50ZWRcIik7XG4gIH1cblxuICBjaGFpbkZvcihwcm9wOiBzdHJpbmcpOiBJUGF0aFJlZmVyZW5jZTxhbnk+IHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJOb3QgaW1wbGVtZW50ZWRcIik7XG4gIH1cblxuICBnZXQocHJvcDogc3RyaW5nKTogSVBhdGhSZWZlcmVuY2U8YW55PiB7XG4gICAgcmV0dXJuIG5ldyBDb25zdFBhdGgodGhpcy5pbm5lciwgcHJvcCk7XG4gIH1cbn1cblxuY2xhc3MgQ29uc3RNZXRhIC8qaW1wbGVtZW50cyBJTWV0YSovIHtcbiAgcHJpdmF0ZSBvYmplY3Q6IGFueTtcblxuICBjb25zdHJ1Y3RvcihvYmplY3Q6IGFueSkge1xuICAgIHRoaXMub2JqZWN0ID0gb2JqZWN0O1xuICB9XG5cbiAgcm9vdCgpOiBDb25zdFJvb3Qge1xuICAgIHJldHVybiBuZXcgQ29uc3RSb290KHRoaXMub2JqZWN0KTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgQ0xBU1NfTUVUQSA9IFwiZGY4YmU0YzgtNGU4OS00NGUyLWE4ZjktNTUwYzhkYWNkY2E3XCI7XG5cbmNvbnN0IGhhc093blByb3BlcnR5ID0gT2JqZWN0Lmhhc093blByb3BlcnR5O1xuXG5jbGFzcyBNZXRhIGltcGxlbWVudHMgSU1ldGEsIEhhc0d1aWQge1xuICBzdGF0aWMgZm9yKG9iajogYW55KTogSU1ldGEge1xuICAgIGlmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB1bmRlZmluZWQpIHJldHVybiBuZXcgTWV0YShvYmosIHt9KTtcbiAgICBpZiAoaGFzT3duUHJvcGVydHkuY2FsbChvYmosICdfbWV0YScpICYmIG9iai5fbWV0YSkgcmV0dXJuIG9iai5fbWV0YTtcbiAgICBpZiAoIU9iamVjdC5pc0V4dGVuc2libGUob2JqKSkgcmV0dXJuIDxhbnk+bmV3IENvbnN0TWV0YShvYmopO1xuXG4gICAgbGV0IE1ldGFUb1VzZTogdHlwZW9mIE1ldGEgPSBNZXRhO1xuXG4gICAgaWYgKG9iai5jb25zdHJ1Y3RvciAmJiBvYmouY29uc3RydWN0b3JbQ0xBU1NfTUVUQV0pIHtcbiAgICAgIGxldCBjbGFzc01ldGE6IENsYXNzTWV0YSA9IG9iai5jb25zdHJ1Y3RvcltDTEFTU19NRVRBXTtcbiAgICAgIE1ldGFUb1VzZSA9IGNsYXNzTWV0YS5JbnN0YW5jZU1ldGFDb25zdHJ1Y3RvcjtcbiAgICB9IGVsc2UgaWYgKG9ialtDTEFTU19NRVRBXSkge1xuICAgICAgTWV0YVRvVXNlID0gb2JqW0NMQVNTX01FVEFdLkluc3RhbmNlTWV0YUNvbnN0cnVjdG9yO1xuICAgIH1cblxuICAgIHJldHVybiAob2JqLl9tZXRhID0gbmV3IE1ldGFUb1VzZShvYmosIHt9KSk7XG4gIH1cblxuICBzdGF0aWMgZXhpc3RzKG9iajogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmIG9iai5fbWV0YTtcbiAgfVxuXG4gIHN0YXRpYyBtZXRhZGF0YUZvclByb3BlcnR5KGtleTogc3RyaW5nKTogYW55IHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgb2JqZWN0OiBhbnk7XG4gIHByaXZhdGUgUm9vdFJlZmVyZW5jZUZhY3Rvcnk6IFJvb3RSZWZlcmVuY2VGYWN0b3J5PGFueT47XG4gIHByaXZhdGUgRGVmYXVsdFBhdGhSZWZlcmVuY2VGYWN0b3J5OiBJbm5lclJlZmVyZW5jZUZhY3Rvcnk8YW55PjtcbiAgcHJpdmF0ZSByb290Q2FjaGU6IElSb290UmVmZXJlbmNlPGFueT47XG4gIHByaXZhdGUgcmVmZXJlbmNlczogRGljdDxEaWN0U2V0PElQYXRoUmVmZXJlbmNlPGFueT4gJiBIYXNHdWlkPj4gPSBudWxsO1xuICBwdWJsaWMgX2d1aWQ7XG4gIHByb3RlY3RlZCBzbG90czogRGljdDxhbnk+ID0gbnVsbDtcbiAgcHJvdGVjdGVkIHJlZmVyZW5jZVR5cGVzOiBEaWN0PElubmVyUmVmZXJlbmNlRmFjdG9yeTxhbnk+PiA9IG51bGw7XG4gIHByb3RlY3RlZCBwcm9wZXJ0eU1ldGFkYXRhOiBEaWN0PGFueT4gPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKG9iamVjdDogYW55LCB7IFJvb3RSZWZlcmVuY2VGYWN0b3J5LCBEZWZhdWx0UGF0aFJlZmVyZW5jZUZhY3RvcnkgfTogTWV0YU9wdGlvbnMpIHtcbiAgICB0aGlzLm9iamVjdCA9IG9iamVjdDtcbiAgICB0aGlzLlJvb3RSZWZlcmVuY2VGYWN0b3J5ID0gUm9vdFJlZmVyZW5jZUZhY3RvcnkgfHwgUm9vdFJlZmVyZW5jZTtcbiAgICB0aGlzLkRlZmF1bHRQYXRoUmVmZXJlbmNlRmFjdG9yeSA9IERlZmF1bHRQYXRoUmVmZXJlbmNlRmFjdG9yeSB8fCBQcm9wZXJ0eVJlZmVyZW5jZTtcbiAgfVxuXG4gIGFkZFJlZmVyZW5jZShwcm9wZXJ0eTogc3RyaW5nLCByZWZlcmVuY2U6IElQYXRoUmVmZXJlbmNlPGFueT4gJiBIYXNHdWlkKSB7XG4gICAgbGV0IHJlZnMgPSB0aGlzLnJlZmVyZW5jZXMgPSB0aGlzLnJlZmVyZW5jZXMgfHwgZGljdDxEaWN0U2V0PElQYXRoUmVmZXJlbmNlPGFueT4gJiBIYXNHdWlkPj4oKTtcbiAgICBsZXQgc2V0ID0gcmVmc1twcm9wZXJ0eV0gPSByZWZzW3Byb3BlcnR5XSB8fCBuZXcgRGljdFNldDxJUGF0aFJlZmVyZW5jZTxhbnk+ICYgSGFzR3VpZD4oKTtcbiAgICBzZXQuYWRkKHJlZmVyZW5jZSk7XG4gIH1cblxuICBhZGRSZWZlcmVuY2VUeXBlRm9yKHByb3BlcnR5OiBzdHJpbmcsIHR5cGU6IFBhdGhSZWZlcmVuY2VGYWN0b3J5PGFueT4pIHtcbiAgICB0aGlzLnJlZmVyZW5jZVR5cGVzID0gdGhpcy5yZWZlcmVuY2VUeXBlcyB8fCBkaWN0PFBhdGhSZWZlcmVuY2VGYWN0b3J5PGFueT4+KCk7XG4gICAgdGhpcy5yZWZlcmVuY2VUeXBlc1twcm9wZXJ0eV0gPSB0eXBlO1xuICB9XG5cbiAgcmVmZXJlbmNlVHlwZUZvcihwcm9wZXJ0eTogc3RyaW5nKTogSW5uZXJSZWZlcmVuY2VGYWN0b3J5PGFueT4ge1xuICAgIGlmICghdGhpcy5yZWZlcmVuY2VUeXBlcykgcmV0dXJuIFByb3BlcnR5UmVmZXJlbmNlO1xuICAgIHJldHVybiB0aGlzLnJlZmVyZW5jZVR5cGVzW3Byb3BlcnR5XSB8fCBQcm9wZXJ0eVJlZmVyZW5jZTtcbiAgfVxuXG4gIHJlbW92ZVJlZmVyZW5jZShwcm9wZXJ0eTogc3RyaW5nLCByZWZlcmVuY2U6IElQYXRoUmVmZXJlbmNlPGFueT4gJiBIYXNHdWlkKSB7XG4gICAgaWYgKCF0aGlzLnJlZmVyZW5jZXMpIHJldHVybjtcbiAgICBsZXQgc2V0ID0gdGhpcy5yZWZlcmVuY2VzW3Byb3BlcnR5XTtcbiAgICBzZXQuZGVsZXRlKHJlZmVyZW5jZSk7XG4gIH1cblxuICBnZXRSZWZlcmVuY2VUeXBlcygpOiBEaWN0PElubmVyUmVmZXJlbmNlRmFjdG9yeTxhbnk+PiB7XG4gICAgdGhpcy5yZWZlcmVuY2VUeXBlcyA9IHRoaXMucmVmZXJlbmNlVHlwZXMgfHwgZGljdDxQYXRoUmVmZXJlbmNlRmFjdG9yeTxhbnk+PigpO1xuICAgIHJldHVybiB0aGlzLnJlZmVyZW5jZVR5cGVzO1xuICB9XG5cbiAgcmVmZXJlbmNlc0Zvcihwcm9wZXJ0eTogc3RyaW5nKTogU2V0PElQYXRoUmVmZXJlbmNlPGFueT4+IHtcbiAgICBpZiAoIXRoaXMucmVmZXJlbmNlcykgcmV0dXJuO1xuICAgIHJldHVybiB0aGlzLnJlZmVyZW5jZXNbcHJvcGVydHldO1xuICB9XG5cbiAgZ2V0U2xvdHMoKSB7XG4gICAgcmV0dXJuICh0aGlzLnNsb3RzID0gdGhpcy5zbG90cyB8fCBkaWN0KCkpO1xuICB9XG5cbiAgcm9vdCgpOiBJUm9vdFJlZmVyZW5jZTxhbnk+IHtcbiAgICByZXR1cm4gKHRoaXMucm9vdENhY2hlID0gdGhpcy5yb290Q2FjaGUgfHwgbmV3IHRoaXMuUm9vdFJlZmVyZW5jZUZhY3RvcnkodGhpcy5vYmplY3QpKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBNZXRhO1xuXG5pbnRlcmZhY2UgQ2xhc3NNZXRhIHtcbiAgSW5zdGFuY2VNZXRhQ29uc3RydWN0b3I6IHR5cGVvZiBNZXRhO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWV0YUZvcihvYmo6IGFueSk6IElNZXRhIHtcbiAgcmV0dXJuIE1ldGEuZm9yKG9iaik7XG59XG4iXX0=