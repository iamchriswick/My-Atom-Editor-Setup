// Goals:
//
// 1. ability to create new benchmark examples with templates etc. (ideally
//    in separate subclasses)
// 2. unit test the examples to make sure they actually work before benchmarking
// 3. clean up the UI of the report (post-MVP)
"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var util_1 = require("@glimmer/util");
Benchmark.support.decompilation = false;
var BenchmarkScenario = (function () {
    function BenchmarkScenario(reporter, env) {
        this.reporter = reporter;
        this.env = env;
    }
    BenchmarkScenario.prototype.start = function () {
    };
    BenchmarkScenario.prototype.tick = function (target, event) {
        var stats = target.stats, times = target.times;
        this.moe = target.stats.moe;
        var elapsed = this.env.elapsed(times.timeStamp);
        this.reporter.progress(stats.sample.length, elapsed / 1000, stats);
    };
    BenchmarkScenario.prototype.error = function (error) {
        this.reporter.error(error);
    };
    BenchmarkScenario.prototype.complete = function (event) {
        this.reporter.complete(event.target, event);
    };
    return BenchmarkScenario;
}());
exports.BenchmarkScenario = BenchmarkScenario;
var BenchmarkEnvironment = (function () {
    function BenchmarkEnvironment() {
    }
    return BenchmarkEnvironment;
}());
exports.BenchmarkEnvironment = BenchmarkEnvironment;
var BenchmarkReporter = (function () {
    function BenchmarkReporter() {
    }
    return BenchmarkReporter;
}());
exports.BenchmarkReporter = BenchmarkReporter;
var BenchmarkSuite = (function () {
    function BenchmarkSuite() {
        this.scenarios = util_1.dict();
    }
    BenchmarkSuite.prototype.add = function (scenario) {
        var bench = new Benchmark({
            minSamples: 200,
            name: scenario.name,
            fn: scenario.run.bind(scenario),
            onStart: scenario.start.bind(scenario),
            onCycle: function (event) {
                if (event.target.aborted)
                    return;
                scenario.tick(event.target, event);
            },
            onError: function (error) {
                scenario.error(error.message);
            },
            onComplete: scenario.complete.bind(scenario)
        });
        this.scenarios[scenario.name] = bench;
    };
    BenchmarkSuite.prototype.run = function (name) {
        return this.scenarios[name].run({ async: true });
    };
    return BenchmarkSuite;
}());
exports.BenchmarkSuite = BenchmarkSuite;
var test_helpers_1 = require("@glimmer/test-helpers");
var object_reference_1 = require("@glimmer/object-reference");
var TemplateBenchmarkScenario = (function (_super) {
    __extends(TemplateBenchmarkScenario, _super);
    function TemplateBenchmarkScenario() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.compiled = null;
        _this.context = null;
        _this.glimmerEnv = new test_helpers_1.TestEnvironment();
        return _this;
    }
    TemplateBenchmarkScenario.prototype.start = function () {
        var _this = this;
        var glimmerEnv = this.glimmerEnv;
        this.compiled = test_helpers_1.compile(this.template(), { env: this.glimmerEnv });
        this.context = this.renderContext();
        try {
            this.test(function () {
                var parent = glimmerEnv.getDOM().createElement('div');
                var contextRef = new object_reference_1.UpdatableReference(_this.context);
                glimmerEnv.begin();
                _this.compiled.render(contextRef, parent, new test_helpers_1.TestDynamicScope());
                glimmerEnv.commit();
                return parent;
            });
        }
        catch (e) {
            // console.assert(e);
            this.error(e);
            throw e;
        }
    };
    TemplateBenchmarkScenario.prototype.run = function () {
        var _a = this, glimmerEnv = _a.glimmerEnv, compiled = _a.compiled;
        var parent = glimmerEnv.getDOM().createElement('div');
        var context = new object_reference_1.UpdatableReference(this.context);
        glimmerEnv.begin();
        compiled.render(context, parent, new test_helpers_1.TestDynamicScope());
        glimmerEnv.commit();
    };
    return TemplateBenchmarkScenario;
}(BenchmarkScenario));
exports.TemplateBenchmarkScenario = TemplateBenchmarkScenario;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmVuY2guanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnbGltbWVyLWJlbmNobWFya3MvbGliL2JlbmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFNBQVM7QUFDVCxFQUFFO0FBQ0YsMkVBQTJFO0FBQzNFLDZCQUE2QjtBQUM3QixnRkFBZ0Y7QUFDaEYsOENBQThDOzs7Ozs7O0FBRTlDLHNDQUFxQztBQUVyQyxTQUFTLENBQUMsT0FBTyxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7QUFJeEM7SUFNRSwyQkFBWSxRQUEyQixFQUFFLEdBQXlCO1FBQ2hFLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxpQ0FBSyxHQUFMO0lBQ0EsQ0FBQztJQUVELGdDQUFJLEdBQUosVUFBSyxNQUFpQixFQUFFLEtBQXVCO1FBQ3ZDLElBQUEsb0JBQUssRUFBRSxvQkFBSyxDQUFZO1FBRTlCLElBQUksQ0FBQyxHQUFHLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7UUFDNUIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE9BQU8sR0FBRyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckUsQ0FBQztJQUVELGlDQUFLLEdBQUwsVUFBTSxLQUFZO1FBQ2hCLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFRCxvQ0FBUSxHQUFSLFVBQVMsS0FBc0I7UUFDN0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE1BQW1CLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFD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QUFDLEtBQUssQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDVixxQkFBcUI7WUFDckIsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNkLE1BQU0sQ0FBQyxDQUFDO1FBQ1YsQ0FBQztJQUNILENBQUM7SUFFRCx1Q0FBRyxHQUFIO1FBQ00sSUFBQSxTQUErQixFQUE3QiwwQkFBVSxFQUFFLHNCQUFRLENBQVU7UUFDcEMsSUFBSSxNQUFNLEdBQUcsVUFBVSxDQUFDLE1BQU0sRUFBRSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN0RCxJQUFJLE9BQU8sR0FBRyxJQUFJLHFDQUFrQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNuRCxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbkIsUUFBUSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksK0JBQWdCLEVBQUUsQ0FBQyxDQUFDO1FBQ3pELFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBQ0gsZ0NBQUM7QUFBRCxDQUFDLEFBeENELENBQXdELGlCQUFpQixHQXdDeEU7QUF4Q3FCLDhEQUF5QiIsInNvdXJjZXNDb250ZW50IjpbIi8vIEdvYWxzOlxuLy9cbi8vIDEuIGFiaWxpdHkgdG8gY3JlYXRlIG5ldyBiZW5jaG1hcmsgZXhhbXBsZXMgd2l0aCB0ZW1wbGF0ZXMgZXRjLiAoaWRlYWxseVxuLy8gICAgaW4gc2VwYXJhdGUgc3ViY2xhc3Nlcylcbi8vIDIuIHVuaXQgdGVzdCB0aGUgZXhhbXBsZXMgdG8gbWFrZSBzdXJlIHRoZXkgYWN0dWFsbHkgd29yayBiZWZvcmUgYmVuY2htYXJraW5nXG4vLyAzLiBjbGVhbiB1cCB0aGUgVUkgb2YgdGhlIHJlcG9ydCAocG9zdC1NVlApXG5cbmltcG9ydCB7IGRpY3QgfSBmcm9tICdAZ2xpbW1lci91dGlsJztcblxuQmVuY2htYXJrLnN1cHBvcnQuZGVjb21waWxhdGlvbiA9IGZhbHNlO1xuXG50eXBlIEJlbmNobWFya0Rlc2NyaXB0aW9uID0gc3RyaW5nO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmVuY2htYXJrU2NlbmFyaW8ge1xuICBwcm90ZWN0ZWQgbW9lOiBudW1iZXI7XG4gIHByb3RlY3RlZCBlbGFwc2VkOiBudW1iZXI7XG4gIHByaXZhdGUgcmVwb3J0ZXI6IEJlbmNobWFya1JlcG9ydGVyO1xuICBwcml2YXRlIGVudjogQmVuY2htYXJrRW52aXJvbm1lbnQ7XG5cbiAgY29uc3RydWN0b3IocmVwb3J0ZXI6IEJlbmNobWFya1JlcG9ydGVyLCBlbnY6IEJlbmNobWFya0Vudmlyb25tZW50KSB7XG4gICAgdGhpcy5yZXBvcnRlciA9IHJlcG9ydGVyO1xuICAgIHRoaXMuZW52ID0gZW52O1xuICB9XG5cbiAgc3RhcnQoKSB7XG4gIH1cblxuICB0aWNrKHRhcmdldDogQmVuY2htYXJrLCBldmVudD86IEJlbmNobWFyay5FdmVudCkge1xuICAgIGxldCB7IHN0YXRzLCB0aW1lcyB9ID0gdGFyZ2V0O1xuXG4gICAgdGhpcy5tb2UgPSB0YXJnZXQuc3RhdHMubW9lO1xuICAgIGxldCBlbGFwc2VkID0gdGhpcy5lbnYuZWxhcHNlZCh0aW1lcy50aW1lU3RhbXApO1xuICAgIHRoaXMucmVwb3J0ZXIucHJvZ3Jlc3Moc3RhdHMuc2FtcGxlLmxlbmd0aCwgZWxhcHNlZCAvIDEwMDAsIHN0YXRzKTtcbiAgfVxuXG4gIGVycm9yKGVycm9yOiBFcnJvcikge1xuICAgIHRoaXMucmVwb3J0ZXIuZXJyb3IoZXJyb3IpO1xuICB9XG5cbiAgY29tcGxldGUoZXZlbnQ6IEJlbmNobWFyay5FdmVudCkge1xuICAgIHRoaXMucmVwb3J0ZXIuY29tcGxldGUoZXZlbnQudGFyZ2V0IGFzIEJlbmNobWFyaywgZXZlbnQpO1xuICB9XG5cbiAgYWJzdHJhY3QgbmFtZTogc3RyaW5nO1xuICBhYnN0cmFjdCBkZXNjcmlwdGlvbjogc3RyaW5nO1xuXG4gIGFic3RyYWN0IHJ1bigpO1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmVuY2htYXJrRW52aXJvbm1lbnQge1xuICBhYnN0cmFjdCBlbGFwc2VkKHRpbWVzdGFtcDogbnVtYmVyKTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgQmVuY2htYXJrUmVwb3J0ZXJDbGFzcyB7XG4gIG5ldyhkZXNjcmlwdGlvbjogQmVuY2htYXJrRGVzY3JpcHRpb24pOiBCZW5jaG1hcmtSZXBvcnRlcjtcbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJlbmNobWFya1JlcG9ydGVyIHtcbiAgYWJzdHJhY3QgcHJvZ3Jlc3MoY291bnQ6IG51bWJlciwgZWxhcHNlZDogbnVtYmVyLCBzdGF0czogQmVuY2htYXJrLlN0YXRzKTtcbiAgYWJzdHJhY3QgZXJyb3IoZXJyb3I6IEVycm9yKTtcbiAgYWJzdHJhY3QgY29tcGxldGUoYmVuY2htYXJrOiBCZW5jaG1hcmssIGV2ZW50OiBCZW5jaG1hcmsuRXZlbnQpO1xufVxuXG5leHBvcnQgY2xhc3MgQmVuY2htYXJrU3VpdGUge1xuICBwdWJsaWMgc2NlbmFyaW9zOiB7XG4gICAgW25hbWU6IHN0cmluZ106IEJlbmNobWFyaztcbiAgfSA9IGRpY3Q8QmVuY2htYXJrPigpO1xuXG4gIGFkZChzY2VuYXJpbzogQmVuY2htYXJrU2NlbmFyaW8pIHtcbiAgICBsZXQgYmVuY2ggPSBuZXcgQmVuY2htYXJrKHtcbiAgICAgIG1pblNhbXBsZXM6IDIwMCxcbiAgICAgIG5hbWU6IHNjZW5hcmlvLm5hbWUsXG4gICAgICBmbjogc2NlbmFyaW8ucnVuLmJpbmQoc2NlbmFyaW8pLFxuICAgICAgb25TdGFydDogc2NlbmFyaW8uc3RhcnQuYmluZChzY2VuYXJpbyksXG4gICAgICBvbkN5Y2xlKGV2ZW50OiBCZW5jaG1hcmsuRXZlbnQpIHtcbiAgICAgICAgaWYgKChldmVudC50YXJnZXQgYXMgQmVuY2htYXJrKS5hYm9ydGVkKSByZXR1cm47XG4gICAgICAgIHNjZW5hcmlvLnRpY2soZXZlbnQudGFyZ2V0IGFzIEJlbmNobWFyaywgZXZlbnQpO1xuICAgICAgfSxcbiAgICAgIG9uRXJyb3I6IChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgIHNjZW5hcmlvLmVycm9yKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfSxcbiAgICAgIG9uQ29tcGxldGU6IHNjZW5hcmlvLmNvbXBsZXRlLmJpbmQoc2NlbmFyaW8pXG4gICAgfSk7XG5cbiAgICB0aGlzLnNjZW5hcmlvc1tzY2VuYXJpby5uYW1lXSA9IGJlbmNoO1xuICB9XG5cbiAgcnVuKG5hbWU6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnNjZW5hcmlvc1tuYW1lXS5ydW4oeyBhc3luYzogdHJ1ZSB9KTtcbiAgfVxufVxuXG4vLy8gSU5JVFxuXG4vLy8gVEVNUExBVEUgQkVOQ0hNQVJLU1xuXG5pbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gJ0BnbGltbWVyL3J1bnRpbWUnO1xuaW1wb3J0IHsgVGVzdEVudmlyb25tZW50LCBUZXN0RHluYW1pY1Njb3BlLCBjb21waWxlIH0gZnJvbSBcIkBnbGltbWVyL3Rlc3QtaGVscGVyc1wiO1xuaW1wb3J0IHsgVXBkYXRhYmxlUmVmZXJlbmNlIH0gZnJvbSAnQGdsaW1tZXIvb2JqZWN0LXJlZmVyZW5jZSc7XG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBUZW1wbGF0ZUJlbmNobWFya1NjZW5hcmlvIGV4dGVuZHMgQmVuY2htYXJrU2NlbmFyaW8ge1xuICBwcml2YXRlIGNvbXBpbGVkOiBUZW1wbGF0ZTx7fT4gPSBudWxsO1xuICBwcml2YXRlIGNvbnRleHQ6IE9iamVjdCA9IG51bGw7XG4gIHByb3RlY3RlZCBnbGltbWVyRW52OiBUZXN0RW52aXJvbm1lbnQgPSBuZXcgVGVzdEVudmlyb25tZW50KCk7XG5cbiAgYWJzdHJhY3QgdGVtcGxhdGUoKTogc3RyaW5nO1xuICBhYnN0cmFjdCByZW5kZXJDb250ZXh0KCk6IE9iamVjdDtcblxuICAvLyBtYWtlIHN1cmUgdG8gd2FybVxuICBhYnN0cmFjdCB0ZXN0KHJlbmRlcjogKCkgPT4gSFRNTEVsZW1lbnQpO1xuXG4gIHN0YXJ0KCkge1xuICAgIGxldCB7IGdsaW1tZXJFbnYgfSA9IHRoaXM7XG4gICAgdGhpcy5jb21waWxlZCA9IGNvbXBpbGUodGhpcy50ZW1wbGF0ZSgpLCB7IGVudjogdGhpcy5nbGltbWVyRW52IH0pO1xuICAgIHRoaXMuY29udGV4dCA9IHRoaXMucmVuZGVyQ29udGV4dCgpO1xuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMudGVzdCgoKSA9PiB7XG4gICAgICAgIGxldCBwYXJlbnQgPSBnbGltbWVyRW52LmdldERPTSgpLmNyZWF0ZUVsZW1lbnQoJ2RpdicpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICBsZXQgY29udGV4dFJlZiA9IG5ldyBVcGRhdGFibGVSZWZlcmVuY2UodGhpcy5jb250ZXh0KTtcbiAgICAgICAgZ2xpbW1lckVudi5iZWdpbigpO1xuICAgICAgICB0aGlzLmNvbXBpbGVkLnJlbmRlcihjb250ZXh0UmVmLCBwYXJlbnQsIG5ldyBUZXN0RHluYW1pY1Njb3BlKCkpO1xuICAgICAgICBnbGltbWVyRW52LmNvbW1pdCgpO1xuICAgICAgICByZXR1cm4gcGFyZW50O1xuICAgICAgfSk7XG4gICAgfSBjYXRjaChlKSB7XG4gICAgICAvLyBjb25zb2xlLmFzc2VydChlKTtcbiAgICAgIHRoaXMuZXJyb3IoZSk7XG4gICAgICB0aHJvdyBlO1xuICAgIH1cbiAgfVxuXG4gIHJ1bigpIHtcbiAgICBsZXQgeyBnbGltbWVyRW52LCBjb21waWxlZCB9ID0gdGhpcztcbiAgICBsZXQgcGFyZW50ID0gZ2xpbW1lckVudi5nZXRET00oKS5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBsZXQgY29udGV4dCA9IG5ldyBVcGRhdGFibGVSZWZlcmVuY2UodGhpcy5jb250ZXh0KTtcbiAgICBnbGltbWVyRW52LmJlZ2luKCk7XG4gICAgY29tcGlsZWQucmVuZGVyKGNvbnRleHQsIHBhcmVudCwgbmV3IFRlc3REeW5hbWljU2NvcGUoKSk7XG4gICAgZ2xpbW1lckVudi5jb21taXQoKTtcbiAgfVxufVxuIl19