"use strict";
var simple_html_tokenizer_1 = require("simple-html-tokenizer");
var runtime_1 = require("@glimmer/runtime");
var compiler_1 = require("@glimmer/compiler");
// For Phantom
function toObject(val) {
    if (val === null || val === undefined) {
        throw new TypeError('Object.assign cannot be called with null or undefined');
    }
    return Object(val);
}
if (typeof Object.assign !== 'function') {
    Object.assign = function (target, source) {
        var from;
        var to = toObject(target);
        var symbols;
        for (var s = 1; s < arguments.length; s++) {
            from = Object(arguments[s]);
            for (var key in from) {
                if (Object.prototype.hasOwnProperty.call(from, key)) {
                    to[key] = from[key];
                }
            }
            if (Object.getOwnPropertySymbols) {
                symbols = Object.getOwnPropertySymbols(from);
                for (var i = 0; i < symbols.length; i++) {
                    if (Object.prototype.propertyIsEnumerable.call(from, symbols[i])) {
                        to[symbols[i]] = from[symbols[i]];
                    }
                }
            }
        }
        return to;
    };
}
exports.assign = Object.assign;
function isMarker(node) {
    var TextNode = window.Text;
    var Comment = window.Comment;
    if (node instanceof Comment && node.textContent === '') {
        return true;
    }
    if (node instanceof TextNode && node.textContent === '') {
        return true;
    }
    return false;
}
function compile(string, options) {
    var js = compiler_1.precompile(string, options);
    var factory = runtime_1.templateFactory(JSON.parse(js));
    return factory.create(options.env);
}
exports.compile = compile;
function compileLayout(string, options) {
    return compile(string, options).asLayout();
}
exports.compileLayout = compileLayout;
function equalInnerHTML(fragment, html, msg) {
    var actualHTML = normalizeInnerHTML(fragment.innerHTML);
    QUnit.push(actualHTML === html, actualHTML, html, msg);
}
exports.equalInnerHTML = equalInnerHTML;
function equalHTML(node, html) {
    var fragment;
    if (!node.nodeType && node.length) {
        fragment = document.createDocumentFragment();
        while (node[0]) {
            fragment.appendChild(node[0]);
        }
    }
    else {
        fragment = node;
    }
    var div = document.createElement("div");
    div.appendChild(fragment.cloneNode(true));
    equalInnerHTML(div, html);
}
exports.equalHTML = equalHTML;
function generateTokens(divOrHTML) {
    var div;
    if (typeof divOrHTML === 'string') {
        div = document.createElement("div");
        div.innerHTML = divOrHTML;
    }
    else {
        div = divOrHTML;
    }
    return { tokens: simple_html_tokenizer_1.tokenize(div.innerHTML), html: div.innerHTML };
}
function equalTokens(fragment, html, message) {
    if (message === void 0) { message = null; }
    if (fragment.fragment) {
        fragment = fragment.fragment;
    }
    if (html.fragment) {
        html = html.fragment;
    }
    var fragTokens = generateTokens(fragment);
    var htmlTokens = generateTokens(html);
    function normalizeTokens(token) {
        if (token.type === 'StartTag') {
            token.attributes = token.attributes.sort(function (a, b) {
                if (a[0] > b[0]) {
                    return 1;
                }
                if (a[0] < b[0]) {
                    return -1;
                }
                return 0;
            });
        }
    }
    fragTokens.tokens.forEach(normalizeTokens);
    htmlTokens.tokens.forEach(normalizeTokens);
    // let msg = "Expected: " + htmlTokens.html + "; Actual: " + fragTokens.html;
    // if (message) { msg += " (" + message + ")"; }
    var equiv = QUnit.equiv(fragTokens.tokens, htmlTokens.tokens);
    if (equiv && fragTokens.html !== htmlTokens.html) {
        QUnit.deepEqual(fragTokens.tokens, htmlTokens.tokens, message);
    }
    else {
        QUnit.push(QUnit.equiv(fragTokens.tokens, htmlTokens.tokens), fragTokens.html, htmlTokens.html, message);
    }
    // deepEqual(fragTokens.tokens, htmlTokens.tokens, msg);
}
exports.equalTokens = equalTokens;
function generateSnapshot(element) {
    var snapshot = [];
    var node = element.firstChild;
    while (node) {
        if (!isMarker(node)) {
            snapshot.push(node);
        }
        node = node.nextSibling;
    }
    return snapshot;
}
exports.generateSnapshot = generateSnapshot;
function equalSnapshots(a, b) {
    QUnit.strictEqual(a.length, b.length, 'Same number of nodes');
    for (var i = 0; i < b.length; i++) {
        QUnit.strictEqual(a[i], b[i], 'Nodes are the same');
    }
}
exports.equalSnapshots = equalSnapshots;
// detect side-effects of cloning svg elements in IE9-11
var ieSVGInnerHTML = (function () {
    if (typeof document === 'undefined' || !document.createElementNS) {
        return false;
    }
    var div = document.createElement('div');
    var node = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    div.appendChild(node);
    var clone = div.cloneNode(true);
    return clone.innerHTML === '<svg xmlns="http://www.w3.org/2000/svg" />';
})();
function normalizeInnerHTML(actualHTML) {
    if (ieSVGInnerHTML) {
        // Replace `<svg xmlns="http://www.w3.org/2000/svg" height="50%" />` with `<svg height="50%"></svg>`, etc.
        // drop namespace attribute
        actualHTML = actualHTML.replace(/ xmlns="[^"]+"/, '');
        // replace self-closing elements
        actualHTML = actualHTML.replace(/<([^ >]+) [^\/>]*\/>/gi, function (tag, tagName) {
            return tag.slice(0, tag.length - 3) + '></' + tagName + '>';
        });
    }
    return actualHTML;
}
exports.normalizeInnerHTML = normalizeInnerHTML;
var isCheckedInputHTML;
exports.isCheckedInputHTML = isCheckedInputHTML;
if (typeof document === 'undefined') {
    exports.isCheckedInputHTML = isCheckedInputHTML = function (element) {
    };
}
else {
    // detect weird IE8 checked element string
    var checkedInput = document.createElement('input');
    checkedInput.setAttribute('checked', 'checked');
    var checkedInputString_1 = checkedInput.outerHTML;
    exports.isCheckedInputHTML = isCheckedInputHTML = function (element) {
        QUnit.equal(element.outerHTML, checkedInputString_1);
    };
}
// check which property has the node's text content
var textProperty = typeof document === 'object' && document.createElement('div').textContent === undefined ? 'innerText' : 'textContent';
function getTextContent(el) {
    // textNode
    if (el.nodeType === 3) {
        return el.nodeValue;
    }
    else {
        return el[textProperty];
    }
}
exports.getTextContent = getTextContent;
function strip(strings) {
    return strings[0].split('\n').map(function (s) { return s.trim(); }).join(' ');
}
exports.strip = strip;
function stripTight(strings) {
    return strings[0].split('\n').map(function (s) { return s.trim(); }).join('');
}
exports.stripTight = stripTight;
function trimLines(strings) {
    return strings[0].trim().split('\n').map(function (s) { return s.trim(); }).join('\n');
}
exports.trimLines = trimLines;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL3Rlc3QtaGVscGVycy9saWIvaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsK0RBQWlEO0FBQ2pELDRDQUFrRjtBQUNsRiw4Q0FBa0U7QUFFbEUsY0FBYztBQUNkLGtCQUFrQixHQUFHO0lBQ25CLEVBQUUsQ0FBQyxDQUFDLEdBQUcsS0FBSyxJQUFJLElBQUksR0FBRyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDdEMsTUFBTSxJQUFJLFNBQVMsQ0FBQyx1REFBdUQsQ0FBQyxDQUFDO0lBQy9FLENBQUM7SUFFRCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3JCLENBQUM7QUFFRCxFQUFFLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxNQUFNLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztJQUN4QyxNQUFNLENBQUMsTUFBTSxHQUFHLFVBQVMsTUFBTSxFQUFFLE1BQU07UUFDckMsSUFBSSxJQUFJLENBQUM7UUFDVCxJQUFJLEVBQUUsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDMUIsSUFBSSxPQUFPLENBQUM7UUFFWixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMxQyxJQUFJLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTVCLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNwRCxFQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcs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LENBQUM7QUFDN0QsQ0FBQztBQUZELHNCQUVDO0FBRUQsb0JBQTJCLE9BQTZCO0lBQ3RELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBUixDQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDNUQsQ0FBQztBQUZELGdDQUVDO0FBRUQsbUJBQTBCLE9BQTZCO0lBQ3JELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBUixDQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDckUsQ0FBQztBQUZELDhCQUVDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdG9rZW5pemUgfSBmcm9tIFwic2ltcGxlLWh0bWwtdG9rZW5pemVyXCI7XG5pbXBvcnQgeyBFbnZpcm9ubWVudCwgVGVtcGxhdGUsIExheW91dCwgdGVtcGxhdGVGYWN0b3J5IH0gZnJvbSBcIkBnbGltbWVyL3J1bnRpbWVcIjtcbmltcG9ydCB7IHByZWNvbXBpbGUsIFByZWNvbXBpbGVPcHRpb25zIH0gZnJvbSBcIkBnbGltbWVyL2NvbXBpbGVyXCI7XG5cbi8vIEZvciBQaGFudG9tXG5mdW5jdGlvbiB0b09iamVjdCh2YWwpIHtcbiAgaWYgKHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ09iamVjdC5hc3NpZ24gY2Fubm90IGJlIGNhbGxlZCB3aXRoIG51bGwgb3IgdW5kZWZpbmVkJyk7XG4gIH1cblxuICByZXR1cm4gT2JqZWN0KHZhbCk7XG59XG5cbmlmICh0eXBlb2YgT2JqZWN0LmFzc2lnbiAhPT0gJ2Z1bmN0aW9uJykge1xuICBPYmplY3QuYXNzaWduID0gZnVuY3Rpb24odGFyZ2V0LCBzb3VyY2UpIHtcbiAgICBsZXQgZnJvbTtcbiAgICBsZXQgdG8gPSB0b09iamVjdCh0YXJnZXQpO1xuICAgIGxldCBzeW1ib2xzO1xuXG4gICAgZm9yIChsZXQgcyA9IDE7IHMgPCBhcmd1bWVudHMubGVuZ3RoOyBzKyspIHtcbiAgICAgIGZyb20gPSBPYmplY3QoYXJndW1lbnRzW3NdKTtcblxuICAgICAgZm9yIChsZXQga2V5IGluIGZyb20pIHtcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChmcm9tLCBrZXkpKSB7XG4gICAgICAgICAgdG9ba2V5XSA9IGZyb21ba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgICAgICBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhmcm9tKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzeW1ib2xzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChmcm9tLCBzeW1ib2xzW2ldKSkge1xuICAgICAgICAgICAgdG9bc3ltYm9sc1tpXV0gPSBmcm9tW3N5bWJvbHNbaV1dO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0bztcbiAgfTtcbn1cblxuZXhwb3J0IGNvbnN0IGFzc2lnbiA9IE9iamVjdC5hc3NpZ247XG5cbmZ1bmN0aW9uIGlzTWFya2VyKG5vZGUpIHtcbiAgY29uc3QgVGV4dE5vZGUgPSAoPGFueT53aW5kb3cpLlRleHQ7XG4gIGNvbnN0IENvbW1lbnQgPSAoPGFueT53aW5kb3cpLkNvbW1lbnQ7XG5cbiAgaWYgKG5vZGUgaW5zdGFuY2VvZiBDb21tZW50ICYmIG5vZGUudGV4dENvbnRlbnQgPT09ICcnKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBpZiAobm9kZSBpbnN0YW5jZW9mIFRleHROb2RlICYmIG5vZGUudGV4dENvbnRlbnQgPT09ICcnKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGVzdENvbXBpbGVPcHRpb25zPFQ+IGV4dGVuZHMgUHJlY29tcGlsZU9wdGlvbnM8VD4ge1xuICBlbnY6IEVudmlyb25tZW50O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29tcGlsZTxUPihzdHJpbmc6IHN0cmluZywgb3B0aW9uczogVGVzdENvbXBpbGVPcHRpb25zPFQ+KTogVGVtcGxhdGU8VD4ge1xuICBsZXQganMgPSBwcmVjb21waWxlKHN0cmluZywgb3B0aW9ucyk7XG4gIGxldCBmYWN0b3J5ID0gdGVtcGxhdGVGYWN0b3J5PFQ+KEpTT04ucGFyc2UoanMpKTtcbiAgcmV0dXJuIGZhY3RvcnkuY3JlYXRlKG9wdGlvbnMuZW52KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBpbGVMYXlvdXQ8VD4oc3RyaW5nOiBzdHJpbmcsIG9wdGlvbnM6IFRlc3RDb21waWxlT3B0aW9uczxUPik6IExheW91dCB7XG4gIHJldHVybiBjb21waWxlKHN0cmluZywgb3B0aW9ucykuYXNMYXlvdXQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFsSW5uZXJIVE1MKGZyYWdtZW50LCBodG1sLCBtc2c/KSB7XG4gIGxldCBhY3R1YWxIVE1MID0gbm9ybWFsaXplSW5uZXJIVE1MKGZyYWdtZW50LmlubmVySFRNTCk7XG4gIFFVbml0LnB1c2goYWN0dWFsSFRNTCA9PT0gaHRtbCwgYWN0dWFsSFRNTCwgaHRtbCwgbXNnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFsSFRNTChub2RlLCBodG1sKSB7XG4gIGxldCBmcmFnbWVudDtcbiAgaWYgKCFub2RlLm5vZGVUeXBlICYmIG5vZGUubGVuZ3RoKSB7XG4gICAgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgd2hpbGUgKG5vZGVbMF0pIHtcbiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5vZGVbMF0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmcmFnbWVudCA9IG5vZGU7XG4gIH1cblxuICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgZGl2LmFwcGVuZENoaWxkKGZyYWdtZW50LmNsb25lTm9kZSh0cnVlKSk7XG5cbiAgZXF1YWxJbm5lckhUTUwoZGl2LCBodG1sKTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVUb2tlbnMoZGl2T3JIVE1MKSB7XG4gIGxldCBkaXY7XG4gIGlmICh0eXBlb2YgZGl2T3JIVE1MID09PSAnc3RyaW5nJykge1xuICAgIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgZGl2LmlubmVySFRNTCA9IGRpdk9ySFRNTDtcbiAgfSBlbHNlIHtcbiAgICBkaXYgPSBkaXZPckhUTUw7XG4gIH1cblxuICByZXR1cm4geyB0b2tlbnM6IHRva2VuaXplKGRpdi5pbm5lckhUTUwpLCBodG1sOiBkaXYuaW5uZXJIVE1MIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbFRva2VucyhmcmFnbWVudCwgaHRtbCwgbWVzc2FnZT1udWxsKSB7XG4gIGlmIChmcmFnbWVudC5mcmFnbWVudCkgeyBmcmFnbWVudCA9IGZyYWdtZW50LmZyYWdtZW50OyB9XG4gIGlmIChodG1sLmZyYWdtZW50KSB7IGh0bWwgPSBodG1sLmZyYWdtZW50OyB9XG5cbiAgbGV0IGZyYWdUb2tlbnMgPSBnZW5lcmF0ZVRva2VucyhmcmFnbWVudCk7XG4gIGxldCBodG1sVG9rZW5zID0gZ2VuZXJhdGVUb2tlbnMoaHRtbCk7XG5cbiAgZnVuY3Rpb24gbm9ybWFsaXplVG9rZW5zKHRva2VuKSB7XG4gICAgaWYgKHRva2VuLnR5cGUgPT09ICdTdGFydFRhZycpIHtcbiAgICAgIHRva2VuLmF0dHJpYnV0ZXMgPSB0b2tlbi5hdHRyaWJ1dGVzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgICAgICBpZiAoYVswXSA+IGJbMF0pIHsgcmV0dXJuIDE7IH1cbiAgICAgICAgaWYgKGFbMF0gPCBiWzBdKSB7IHJldHVybiAtMTsgfVxuICAgICAgICByZXR1cm4gMDtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGZyYWdUb2tlbnMudG9rZW5zLmZvckVhY2gobm9ybWFsaXplVG9rZW5zKTtcbiAgaHRtbFRva2Vucy50b2tlbnMuZm9yRWFjaChub3JtYWxpemVUb2tlbnMpO1xuXG4gIC8vIGxldCBtc2cgPSBcIkV4cGVjdGVkOiBcIiArIGh0bWxUb2tlbnMuaHRtbCArIFwiOyBBY3R1YWw6IFwiICsgZnJhZ1Rva2Vucy5odG1sO1xuXG4gIC8vIGlmIChtZXNzYWdlKSB7IG1zZyArPSBcIiAoXCIgKyBtZXNzYWdlICsgXCIpXCI7IH1cblxuICBsZXQgZXF1aXYgPSBRVW5pdC5lcXVpdihmcmFnVG9rZW5zLnRva2VucywgaHRtbFRva2Vucy50b2tlbnMpO1xuXG4gIGlmIChlcXVpdiAmJiBmcmFnVG9rZW5zLmh0bWwgIT09IGh0bWxUb2tlbnMuaHRtbCkge1xuICAgIFFVbml0LmRlZXBFcXVhbChmcmFnVG9rZW5zLnRva2VucywgaHRtbFRva2Vucy50b2tlbnMsIG1lc3NhZ2UpO1xuICB9IGVsc2Uge1xuICAgIFFVbml0LnB1c2goUVVuaXQuZXF1aXYoZnJhZ1Rva2Vucy50b2tlbnMsIGh0bWxUb2tlbnMudG9rZW5zKSwgZnJhZ1Rva2Vucy5odG1sLCBodG1sVG9rZW5zLmh0bWwsIG1lc3NhZ2UpO1xuICB9XG5cbiAgLy8gZGVlcEVxdWFsKGZyYWdUb2tlbnMudG9rZW5zLCBodG1sVG9rZW5zLnRva2VucywgbXNnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlU25hcHNob3QoZWxlbWVudCkge1xuICBsZXQgc25hcHNob3QgPSBbXTtcbiAgbGV0IG5vZGUgPSBlbGVtZW50LmZpcnN0Q2hpbGQ7XG5cbiAgd2hpbGUgKG5vZGUpIHtcbiAgICBpZiAoIWlzTWFya2VyKG5vZGUpKSB7XG4gICAgICBzbmFwc2hvdC5wdXNoKG5vZGUpO1xuICAgIH1cbiAgICBub2RlID0gbm9kZS5uZXh0U2libGluZztcbiAgfVxuXG4gIHJldHVybiBzbmFwc2hvdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVxdWFsU25hcHNob3RzKGEsIGIpIHtcbiAgUVVuaXQuc3RyaWN0RXF1YWwoYS5sZW5ndGgsIGIubGVuZ3RoLCAnU2FtZSBudW1iZXIgb2Ygbm9kZXMnKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSB7XG4gICAgUVVuaXQuc3RyaWN0RXF1YWwoYVtpXSwgYltpXSwgJ05vZGVzIGFyZSB0aGUgc2FtZScpO1xuICB9XG59XG5cbi8vIGRldGVjdCBzaWRlLWVmZmVjdHMgb2YgY2xvbmluZyBzdmcgZWxlbWVudHMgaW4gSUU5LTExXG5sZXQgaWVTVkdJbm5lckhUTUwgPSAoZnVuY3Rpb24gKCkge1xuICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJyB8fCAhZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGxldCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgbGV0IG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpO1xuICBkaXYuYXBwZW5kQ2hpbGQobm9kZSk7XG4gIGxldCBjbG9uZSA9IDxIVE1MRGl2RWxlbWVudD5kaXYuY2xvbmVOb2RlKHRydWUpO1xuICByZXR1cm4gY2xvbmUuaW5uZXJIVE1MID09PSAnPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgLz4nO1xufSkoKTtcblxuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZUlubmVySFRNTChhY3R1YWxIVE1MKSB7XG4gIGlmIChpZVNWR0lubmVySFRNTCkge1xuICAgIC8vIFJlcGxhY2UgYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIGhlaWdodD1cIjUwJVwiIC8+YCB3aXRoIGA8c3ZnIGhlaWdodD1cIjUwJVwiPjwvc3ZnPmAsIGV0Yy5cbiAgICAvLyBkcm9wIG5hbWVzcGFjZSBhdHRyaWJ1dGVcbiAgICBhY3R1YWxIVE1MID0gYWN0dWFsSFRNTC5yZXBsYWNlKC8geG1sbnM9XCJbXlwiXStcIi8sICcnKTtcbiAgICAvLyByZXBsYWNlIHNlbGYtY2xvc2luZyBlbGVtZW50c1xuICAgIGFjdHVhbEhUTUwgPSBhY3R1YWxIVE1MLnJlcGxhY2UoLzwoW14gPl0rKSBbXlxcLz5dKlxcLz4vZ2ksIGZ1bmN0aW9uKHRhZywgdGFnTmFtZSkge1xuICAgICAgcmV0dXJuIHRhZy5zbGljZSgwLCB0YWcubGVuZ3RoIC0gMykgKyAnPjwvJyArIHRhZ05hbWUgKyAnPic7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gYWN0dWFsSFRNTDtcbn1cblxubGV0IGlzQ2hlY2tlZElucHV0SFRNTDtcblxuaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgaXNDaGVja2VkSW5wdXRIVE1MID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICB9O1xufSBlbHNlIHtcbiAgLy8gZGV0ZWN0IHdlaXJkIElFOCBjaGVja2VkIGVsZW1lbnQgc3RyaW5nXG4gIGxldCBjaGVja2VkSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICBjaGVja2VkSW5wdXQuc2V0QXR0cmlidXRlKCdjaGVja2VkJywgJ2NoZWNrZWQnKTtcbiAgbGV0IGNoZWNrZWRJbnB1dFN0cmluZyA9IGNoZWNrZWRJbnB1dC5vdXRlckhUTUw7XG5cbiAgaXNDaGVja2VkSW5wdXRIVE1MID0gZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIFFVbml0LmVxdWFsKGVsZW1lbnQub3V0ZXJIVE1MLCBjaGVja2VkSW5wdXRTdHJpbmcpO1xuICB9O1xufVxuXG5leHBvcnQgeyBpc0NoZWNrZWRJbnB1dEhUTUwgfTtcblxuLy8gY2hlY2sgd2hpY2ggcHJvcGVydHkgaGFzIHRoZSBub2RlJ3MgdGV4dCBjb250ZW50XG5sZXQgdGV4dFByb3BlcnR5ID0gdHlwZW9mIGRvY3VtZW50ID09PSAnb2JqZWN0JyAmJiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKS50ZXh0Q29udGVudCA9PT0gdW5kZWZpbmVkID8gJ2lubmVyVGV4dCcgOiAndGV4dENvbnRlbnQnO1xuZXhwb3J0IGZ1bmN0aW9uIGdldFRleHRDb250ZW50KGVsKSB7XG4gIC8vIHRleHROb2RlXG4gIGlmIChlbC5ub2RlVHlwZSA9PT0gMykge1xuICAgIHJldHVybiBlbC5ub2RlVmFsdWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGVsW3RleHRQcm9wZXJ0eV07XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmlwKHN0cmluZ3M6IFRlbXBsYXRlU3RyaW5nc0FycmF5KSB7XG4gIHJldHVybiBzdHJpbmdzWzBdLnNwbGl0KCdcXG4nKS5tYXAocyA9PiBzLnRyaW0oKSkuam9pbignICcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBUaWdodChzdHJpbmdzOiBUZW1wbGF0ZVN0cmluZ3NBcnJheSkge1xuICByZXR1cm4gc3RyaW5nc1swXS5zcGxpdCgnXFxuJykubWFwKHMgPT4gcy50cmltKCkpLmpvaW4oJycpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdHJpbUxpbmVzKHN0cmluZ3M6IFRlbXBsYXRlU3RyaW5nc0FycmF5KSB7XG4gIHJldHVybiBzdHJpbmdzWzBdLnRyaW0oKS5zcGxpdCgnXFxuJykubWFwKHMgPT4gcy50cmltKCkpLmpvaW4oJ1xcbicpO1xufVxuIl19