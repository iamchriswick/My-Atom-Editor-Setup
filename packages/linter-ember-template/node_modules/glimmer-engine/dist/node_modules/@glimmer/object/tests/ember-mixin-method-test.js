"use strict";
var support_1 = require("./support");
var object_1 = require("@glimmer/object");
QUnit.module('Mixin.create - Methods');
QUnit.test('defining simple methods', function () {
    var MixinA, obj, props;
    props = {
        publicMethod: function () { return 'publicMethod'; },
        _privateMethod: function () { return 'privateMethod'; }
    };
    MixinA = object_1.Mixin.create(props);
    obj = {};
    MixinA.apply(obj);
    // but should be defined
    equal(props.publicMethod(), 'publicMethod', 'publicMethod is func');
    equal(props._privateMethod(), 'privateMethod', 'privateMethod is func');
});
QUnit.test('overriding public methods', function () {
    var MixinA, MixinB, MixinD, MixinF, obj;
    MixinA = object_1.Mixin.create({
        publicMethod: function () { return 'A'; }
    });
    MixinB = object_1.Mixin.create(MixinA, {
        publicMethod: function () { return this._super.apply(this, arguments) + 'B'; }
    });
    MixinD = object_1.Mixin.create(MixinA, {
        publicMethod: function () { return this._super.apply(this, arguments) + 'D'; }
    });
    MixinF = object_1.Mixin.create({
        publicMethod: function () { return this._super.apply(this, arguments) + 'F'; }
    });
    obj = {};
    MixinB.apply(obj);
    equal(obj.publicMethod(), 'AB', 'should define super for A and B');
    obj = {};
    MixinD.apply(obj);
    equal(obj.publicMethod(), 'AD', 'should define super for A and B');
    obj = {};
    MixinA.apply(obj);
    MixinF.apply(obj);
    equal(obj.publicMethod(), 'AF', 'should define super for A and F');
    obj = { publicMethod: function () { return 'obj'; } };
    MixinF.apply(obj);
    equal(obj.publicMethod(), 'objF', 'should define super for F');
});
QUnit.test('overriding inherited objects', function () {
    var cnt = 0;
    var MixinA = object_1.Mixin.create({
        foo: function () { cnt++; }
    });
    var MixinB = object_1.Mixin.create({
        foo: function () {
            this._super.apply(this, arguments);
            cnt++;
        }
    });
    var objA = {};
    MixinA.apply(objA);
    var objB = Object.create(objA);
    MixinB.apply(objB);
    cnt = 0;
    objB['foo']();
    equal(cnt, 2, 'should invoke both methods');
    cnt = 0;
    objA['foo']();
    equal(cnt, 1, 'should not screw w/ parent obj');
});
QUnit.test('Including the same mixin more than once will only run once', function () {
    var cnt = 0;
    var MixinA = object_1.Mixin.create({
        foo: function () { cnt++; }
    });
    var MixinB = object_1.Mixin.create(MixinA, {
        foo: function () { this._super.apply(this, arguments); }
    });
    var MixinC = object_1.Mixin.create(MixinA, {
        foo: function () { this._super.apply(this, arguments); }
    });
    var MixinD = object_1.Mixin.create(MixinB, MixinC, MixinA, {
        foo: function () { this._super.apply(this, arguments); }
    });
    var obj = {};
    MixinD.apply(obj);
    MixinA.apply(obj); // try to apply again..
    cnt = 0;
    obj['foo']();
    equal(cnt, 1, 'should invoke MixinA.foo one time');
});
QUnit.test('_super from a single mixin with no superclass does not error', function () {
    var MixinA = object_1.Mixin.create({
        foo: function () {
            this._super.apply(this, arguments);
        }
    });
    var obj = {};
    MixinA.apply(obj);
    obj['foo']();
    ok(true);
});
QUnit.test('_super from a first-of-two mixins with no superclass function does not error', function () {
    // _super was previously calling itself in the second assertion.
    // Use remaining count of calls to ensure it doesn't loop indefinitely.
    var remaining = 3;
    var MixinA = object_1.Mixin.create({
        foo: function () {
            if (remaining-- > 0) {
                this._super.apply(this, arguments);
            }
        }
    });
    var MixinB = object_1.Mixin.create({
        foo: function () { this._super.apply(this, arguments); }
    });
    var obj = {};
    MixinA.apply(obj);
    MixinB.apply(obj);
    obj['foo']();
    ok(true);
});
// ..........................................................
// CONFLICTS
//
QUnit.module('Mixin.create - Method Conflicts');
QUnit.test('overriding toString', function () {
    var MixinA = object_1.Mixin.create({
        toString: function () { return 'FOO'; }
    });
    var obj = {};
    MixinA.apply(obj);
    equal(obj.toString(), 'FOO', 'should override toString w/o error');
    obj = {};
    support_1.mixin(obj, { toString: function () { return 'FOO'; } });
    equal(obj.toString(), 'FOO', 'should override toString w/o error');
});
// ..........................................................
// BUGS
//
QUnit.module('Mixin.create - Method Regressions (BUGS)');
QUnit.test('applying several mixins at once with sup already defined causes infinite loop', function () {
    var cnt = 0;
    var MixinA = object_1.Mixin.create({
        foo: function () { cnt++; }
    });
    var MixinB = object_1.Mixin.create({
        foo: function () {
            this._super.apply(this, arguments);
            cnt++;
        }
    });
    var MixinC = object_1.Mixin.create({
        foo: function () {
            this._super.apply(this, arguments);
            cnt++;
        }
    });
    var obj = {};
    support_1.mixin(obj, MixinA); // sup already exists
    support_1.mixin(obj, MixinB, MixinC); // must be more than one mixin
    cnt = 0;
    obj['foo']();
    equal(cnt, 3, 'should invoke all 3 methods');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1iZXItbWl4aW4tbWV0aG9kLXRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJAZ2xpbW1lci9vYmplY3QvdGVzdHMvZW1iZXItbWl4aW4tbWV0aG9kLXRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHFDQUFrQztBQUNsQywwQ0FBd0M7QUFFeEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0FBRXZDLEtBQUssQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUU7SUFDcEMsSUFBSSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssQ0FBQztJQUV2QixLQUFLLEdBQUc7UUFDTixZQUFZLGdCQUFLLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO1FBQ3pDLGNBQWMsZ0JBQUssTUFBTSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7S0FDN0MsQ0FBQztJQUVGLE1BQU0sR0FBRyxjQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzdCLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDVCxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRWxCLHdCQUF3QjtJQUN4QixLQUFLLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxFQUFFLGNBQWMsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO0lBQ3BFLEtBQUssQ0FBQyxLQUFLLENBQUMsY0FBYyxFQUFFLEVBQUUsZUFBZSxFQUFFLHVCQUF1QixDQUFDLENBQUM7QUFDMUUsQ0FBQyxDQUFDLENBQUM7QUFFSCxLQUFLLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFO0lBQ3RDLElBQUksTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQztJQUV4QyxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUNwQixZQUFZLGdCQUFLLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0tBQy9CLENBQUMsQ0FBQztJQUVILE1BQU0sR0FBRyxjQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtRQUM1QixZQUFZLGdCQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztLQUNwRSxDQUFDLENBQUM7SUFFSCxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7UUFDNUIsWUFBWSxnQkFBSyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDcEUsQ0FBQyxDQUFDO0lBRUgsTUFBTSxHQUFHLGNBQUssQ0FBQyxNQUFNLENBQUM7UUFDcEIsWUFBWSxnQkFBSyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7S0FDcEUsQ0FBQyxDQUFDO0lBRUgsR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNULE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsaUNBQWlDLENBQUMsQ0FBQztJQUVuRSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ1QsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsQixLQUFLLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxFQUFFLElBQUksRUFBRSxpQ0FBaUMsQ0FBQyxDQUFDO0lBRW5FLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDVCxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsRUFBRSxJQUFJLEVBQUUsaUNBQWlDLENBQUMsQ0FBQztJQUVuRSxHQUFHLEdBQUcsRUFBRSxZQUFZLGdCQUFLLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUMzQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLEtBQUssQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLEVBQUUsTUFBTSxFQUFFLDJCQUEyQixDQUFDLENBQUM7QUFDakUsQ0FBQyxDQUFDLENBQUM7QUFFSCxLQUFLLENBQUMsSUFBSSxDQUFDLDhCQUE4QixFQUFFO0lBQ3pDLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQztJQUNaLElBQUksTUFBTSxHQUFHLGNBQUssQ0FBQyxNQUFNLENBQUM7UUFDeEIsR0FBRyxnQkFBSyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDakIsQ0FBQyxDQUFDO0lBRUgsSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4QixHQUFHO1lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ25DLEdBQUcsRUFBRSxDQUFDO1FBQ1IsQ0FBQztLQUNGLENBQUMsQ0FBQztJQUVILElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUNkLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFbkIsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvQixNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRW5CLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDUixJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztJQUNkLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLDRCQUE0QixDQUFDLENBQUM7SUFFNUMsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUNSLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO0lBQ2QsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsZ0NBQWdDLENBQUMsQ0FBQztBQUNsRCxDQUFDLENBQUMsQ0FBQztBQUVILEtBQUssQ0FBQyxJQUFJLENBQUMsNERBQTRELEVBQUU7SUFDdkUsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ1osSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4QixHQUFHLGdCQUFLLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUNqQixDQUFDLENBQUM7SUFFSCxJQUFJLE1BQU0sR0FBRyxjQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRTtRQUNoQyxHQUFHLGdCQUFLLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDOUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7UUFDaEMsR0FBRyxnQkFBSyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQzlDLENBQUMsQ0FBQztJQUVILElBQUksTUFBTSxHQUFHLGNBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUU7UUFDaEQsR0FBRyxnQkFBSyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQzlDLENBQUMsQ0FBQztJQUVILElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNiLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLHVCQUF1QjtJQUUxQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ1IsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7SUFFYixLQUFLLENBQUMsR0FBRyxFQUFFLENBQUMsRUFBRSxtQ0FBbUMsQ0FBQyxDQUFDO0FBQ3JELENBQUMsQ0FBQyxDQUFDO0FBRUgsS0FBSyxDQUFDLElBQUksQ0FBQyw4REFBOEQsRUFBRTtJQUN6RSxJQUFJLE1BQU0sR0FBRyxjQUFLLENBQUMsTUFBTSxDQUFDO1FBQ3hCLEdBQUc7WUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDckMsQ0FBQztLQUNGLENBQUMsQ0FBQztJQUVILElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNiLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFbEIsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7SUFDYixFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDWCxDQUFDLENBQUMsQ0FBQztBQUVILEtBQUssQ0FBQyxJQUFJLENBQUMsOEVBQThFLEVBQUU7SUFDekYsZ0VBQWdFO0lBQ2hFLHVFQUF1RTtJQUN2RSxJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7SUFDbEIsSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4QixHQUFHO1lBQ0QsRUFBRSxDQUFDLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDcEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ3JDLENBQUM7UUFDSCxDQUFDO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4QixHQUFHLGdCQUFLLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7S0FDOUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsQixNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRWxCLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO0lBQ2IsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ1gsQ0FBQyxDQUFDLENBQUM7QUFFSCw2REFBNkQ7QUFDN0QsWUFBWTtBQUNaLEVBQUU7QUFFRixLQUFLLENBQUMsTUFBTSxDQUFDLGlDQUFpQyxDQUFDLENBQUM7QUFFaEQsS0FBSyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsRUFBRTtJQUNoQyxJQUFJLE1BQU0sR0FBRyxjQUFLLENBQUMsTUFBTSxDQUFDO1FBQ3hCLFFBQVEsZ0JBQUssTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7S0FDN0IsQ0FBQyxDQUFDO0lBRUgsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsQixLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsQ0FBQyxDQUFDO0lBRW5FLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDVCxlQUFLLENBQUMsR0FBRyxFQUFFLEVBQUUsUUFBUSxnQkFBSyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM3QyxLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFFLEtBQUssRUFBRSxvQ0FBb0MsQ0FBQyxDQUFDO0FBQ3JFLENBQUMsQ0FBQyxDQUFDO0FBRUgsNkRBQTZEO0FBQzdELE9BQU87QUFDUCxFQUFFO0FBRUYsS0FBSyxDQUFDLE1BQU0sQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO0FBRXpELEtBQUssQ0FBQyxJQUFJLENBQUMsK0VBQStFLEVBQUU7SUFDMUYsSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ1osSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4QixHQUFHLGdCQUFLLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztLQUNqQixDQUFDLENBQUM7SUFFSCxJQUFJLE1BQU0sR0FBRyxjQUFLLENBQUMsTUFBTSxDQUFDO1FBQ3hCLEdBQUc7WUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDbkMsR0FBRyxFQUFFLENBQUM7UUFDUixDQUFDO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4QixHQUFHO1lBQ0QsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQ25DLEdBQUcsRUFBRSxDQUFDO1FBQ1IsQ0FBQztLQUNGLENBQUMsQ0FBQztJQUVILElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNiLGVBQUssQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxxQkFBcUI7SUFDekMsZUFBSyxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyw4QkFBOEI7SUFFMUQsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUNSLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO0lBQ2IsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsNkJBQTZCLENBQUMsQ0FBQztBQUMvQyxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1peGluIH0gZnJvbSAnLi9zdXBwb3J0JztcbmltcG9ydCB7IE1peGluIH0gZnJvbSAnQGdsaW1tZXIvb2JqZWN0JztcblxuUVVuaXQubW9kdWxlKCdNaXhpbi5jcmVhdGUgLSBNZXRob2RzJyk7XG5cblFVbml0LnRlc3QoJ2RlZmluaW5nIHNpbXBsZSBtZXRob2RzJywgZnVuY3Rpb24oKSB7XG4gIGxldCBNaXhpbkEsIG9iaiwgcHJvcHM7XG5cbiAgcHJvcHMgPSB7XG4gICAgcHVibGljTWV0aG9kKCkgeyByZXR1cm4gJ3B1YmxpY01ldGhvZCc7IH0sXG4gICAgX3ByaXZhdGVNZXRob2QoKSB7IHJldHVybiAncHJpdmF0ZU1ldGhvZCc7IH1cbiAgfTtcblxuICBNaXhpbkEgPSBNaXhpbi5jcmVhdGUocHJvcHMpO1xuICBvYmogPSB7fTtcbiAgTWl4aW5BLmFwcGx5KG9iaik7XG5cbiAgLy8gYnV0IHNob3VsZCBiZSBkZWZpbmVkXG4gIGVxdWFsKHByb3BzLnB1YmxpY01ldGhvZCgpLCAncHVibGljTWV0aG9kJywgJ3B1YmxpY01ldGhvZCBpcyBmdW5jJyk7XG4gIGVxdWFsKHByb3BzLl9wcml2YXRlTWV0aG9kKCksICdwcml2YXRlTWV0aG9kJywgJ3ByaXZhdGVNZXRob2QgaXMgZnVuYycpO1xufSk7XG5cblFVbml0LnRlc3QoJ292ZXJyaWRpbmcgcHVibGljIG1ldGhvZHMnLCBmdW5jdGlvbigpIHtcbiAgbGV0IE1peGluQSwgTWl4aW5CLCBNaXhpbkQsIE1peGluRiwgb2JqO1xuXG4gIE1peGluQSA9IE1peGluLmNyZWF0ZSh7XG4gICAgcHVibGljTWV0aG9kKCkgeyByZXR1cm4gJ0EnOyB9XG4gIH0pO1xuXG4gIE1peGluQiA9IE1peGluLmNyZWF0ZShNaXhpbkEsIHtcbiAgICBwdWJsaWNNZXRob2QoKSB7IHJldHVybiB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpICsgJ0InOyB9XG4gIH0pO1xuXG4gIE1peGluRCA9IE1peGluLmNyZWF0ZShNaXhpbkEsIHtcbiAgICBwdWJsaWNNZXRob2QoKSB7IHJldHVybiB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpICsgJ0QnOyB9XG4gIH0pO1xuXG4gIE1peGluRiA9IE1peGluLmNyZWF0ZSh7XG4gICAgcHVibGljTWV0aG9kKCkgeyByZXR1cm4gdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSArICdGJzsgfVxuICB9KTtcblxuICBvYmogPSB7fTtcbiAgTWl4aW5CLmFwcGx5KG9iaik7XG4gIGVxdWFsKG9iai5wdWJsaWNNZXRob2QoKSwgJ0FCJywgJ3Nob3VsZCBkZWZpbmUgc3VwZXIgZm9yIEEgYW5kIEInKTtcblxuICBvYmogPSB7fTtcbiAgTWl4aW5ELmFwcGx5KG9iaik7XG4gIGVxdWFsKG9iai5wdWJsaWNNZXRob2QoKSwgJ0FEJywgJ3Nob3VsZCBkZWZpbmUgc3VwZXIgZm9yIEEgYW5kIEInKTtcblxuICBvYmogPSB7fTtcbiAgTWl4aW5BLmFwcGx5KG9iaik7XG4gIE1peGluRi5hcHBseShvYmopO1xuICBlcXVhbChvYmoucHVibGljTWV0aG9kKCksICdBRicsICdzaG91bGQgZGVmaW5lIHN1cGVyIGZvciBBIGFuZCBGJyk7XG5cbiAgb2JqID0geyBwdWJsaWNNZXRob2QoKSB7IHJldHVybiAnb2JqJzsgfSB9O1xuICBNaXhpbkYuYXBwbHkob2JqKTtcbiAgZXF1YWwob2JqLnB1YmxpY01ldGhvZCgpLCAnb2JqRicsICdzaG91bGQgZGVmaW5lIHN1cGVyIGZvciBGJyk7XG59KTtcblxuUVVuaXQudGVzdCgnb3ZlcnJpZGluZyBpbmhlcml0ZWQgb2JqZWN0cycsIGZ1bmN0aW9uKCkge1xuICBsZXQgY250ID0gMDtcbiAgbGV0IE1peGluQSA9IE1peGluLmNyZWF0ZSh7XG4gICAgZm9vKCkgeyBjbnQrKzsgfVxuICB9KTtcblxuICBsZXQgTWl4aW5CID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb28oKSB7XG4gICAgICB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgY250Kys7XG4gICAgfVxuICB9KTtcblxuICBsZXQgb2JqQSA9IHt9O1xuICBNaXhpbkEuYXBwbHkob2JqQSk7XG5cbiAgbGV0IG9iakIgPSBPYmplY3QuY3JlYXRlKG9iakEpO1xuICBNaXhpbkIuYXBwbHkob2JqQik7XG5cbiAgY250ID0gMDtcbiAgb2JqQlsnZm9vJ10oKTtcbiAgZXF1YWwoY250LCAyLCAnc2hvdWxkIGludm9rZSBib3RoIG1ldGhvZHMnKTtcblxuICBjbnQgPSAwO1xuICBvYmpBWydmb28nXSgpO1xuICBlcXVhbChjbnQsIDEsICdzaG91bGQgbm90IHNjcmV3IHcvIHBhcmVudCBvYmonKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdJbmNsdWRpbmcgdGhlIHNhbWUgbWl4aW4gbW9yZSB0aGFuIG9uY2Ugd2lsbCBvbmx5IHJ1biBvbmNlJywgZnVuY3Rpb24oKSB7XG4gIGxldCBjbnQgPSAwO1xuICBsZXQgTWl4aW5BID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb28oKSB7IGNudCsrOyB9XG4gIH0pO1xuXG4gIGxldCBNaXhpbkIgPSBNaXhpbi5jcmVhdGUoTWl4aW5BLCB7XG4gICAgZm9vKCkgeyB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9XG4gIH0pO1xuXG4gIGxldCBNaXhpbkMgPSBNaXhpbi5jcmVhdGUoTWl4aW5BLCB7XG4gICAgZm9vKCkgeyB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9XG4gIH0pO1xuXG4gIGxldCBNaXhpbkQgPSBNaXhpbi5jcmVhdGUoTWl4aW5CLCBNaXhpbkMsIE1peGluQSwge1xuICAgIGZvbygpIHsgdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxuICB9KTtcblxuICBsZXQgb2JqID0ge307XG4gIE1peGluRC5hcHBseShvYmopO1xuICBNaXhpbkEuYXBwbHkob2JqKTsgLy8gdHJ5IHRvIGFwcGx5IGFnYWluLi5cblxuICBjbnQgPSAwO1xuICBvYmpbJ2ZvbyddKCk7XG5cbiAgZXF1YWwoY250LCAxLCAnc2hvdWxkIGludm9rZSBNaXhpbkEuZm9vIG9uZSB0aW1lJyk7XG59KTtcblxuUVVuaXQudGVzdCgnX3N1cGVyIGZyb20gYSBzaW5nbGUgbWl4aW4gd2l0aCBubyBzdXBlcmNsYXNzIGRvZXMgbm90IGVycm9yJywgZnVuY3Rpb24oKSB7XG4gIGxldCBNaXhpbkEgPSBNaXhpbi5jcmVhdGUoe1xuICAgIGZvbygpIHtcbiAgICAgIHRoaXMuX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuICB9KTtcblxuICBsZXQgb2JqID0ge307XG4gIE1peGluQS5hcHBseShvYmopO1xuXG4gIG9ialsnZm9vJ10oKTtcbiAgb2sodHJ1ZSk7XG59KTtcblxuUVVuaXQudGVzdCgnX3N1cGVyIGZyb20gYSBmaXJzdC1vZi10d28gbWl4aW5zIHdpdGggbm8gc3VwZXJjbGFzcyBmdW5jdGlvbiBkb2VzIG5vdCBlcnJvcicsIGZ1bmN0aW9uKCkge1xuICAvLyBfc3VwZXIgd2FzIHByZXZpb3VzbHkgY2FsbGluZyBpdHNlbGYgaW4gdGhlIHNlY29uZCBhc3NlcnRpb24uXG4gIC8vIFVzZSByZW1haW5pbmcgY291bnQgb2YgY2FsbHMgdG8gZW5zdXJlIGl0IGRvZXNuJ3QgbG9vcCBpbmRlZmluaXRlbHkuXG4gIGxldCByZW1haW5pbmcgPSAzO1xuICBsZXQgTWl4aW5BID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb28oKSB7XG4gICAgICBpZiAocmVtYWluaW5nLS0gPiAwKSB7XG4gICAgICAgIHRoaXMuX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBsZXQgTWl4aW5CID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb28oKSB7IHRoaXMuX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cbiAgfSk7XG5cbiAgbGV0IG9iaiA9IHt9O1xuICBNaXhpbkEuYXBwbHkob2JqKTtcbiAgTWl4aW5CLmFwcGx5KG9iaik7XG5cbiAgb2JqWydmb28nXSgpO1xuICBvayh0cnVlKTtcbn0pO1xuXG4vLyAuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uXG4vLyBDT05GTElDVFNcbi8vXG5cblFVbml0Lm1vZHVsZSgnTWl4aW4uY3JlYXRlIC0gTWV0aG9kIENvbmZsaWN0cycpO1xuXG5RVW5pdC50ZXN0KCdvdmVycmlkaW5nIHRvU3RyaW5nJywgZnVuY3Rpb24oKSB7XG4gIGxldCBNaXhpbkEgPSBNaXhpbi5jcmVhdGUoe1xuICAgIHRvU3RyaW5nKCkgeyByZXR1cm4gJ0ZPTyc7IH1cbiAgfSk7XG5cbiAgbGV0IG9iaiA9IHt9O1xuICBNaXhpbkEuYXBwbHkob2JqKTtcbiAgZXF1YWwob2JqLnRvU3RyaW5nKCksICdGT08nLCAnc2hvdWxkIG92ZXJyaWRlIHRvU3RyaW5nIHcvbyBlcnJvcicpO1xuXG4gIG9iaiA9IHt9O1xuICBtaXhpbihvYmosIHsgdG9TdHJpbmcoKSB7IHJldHVybiAnRk9PJzsgfSB9KTtcbiAgZXF1YWwob2JqLnRvU3RyaW5nKCksICdGT08nLCAnc2hvdWxkIG92ZXJyaWRlIHRvU3RyaW5nIHcvbyBlcnJvcicpO1xufSk7XG5cbi8vIC4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi5cbi8vIEJVR1Ncbi8vXG5cblFVbml0Lm1vZHVsZSgnTWl4aW4uY3JlYXRlIC0gTWV0aG9kIFJlZ3Jlc3Npb25zIChCVUdTKScpO1xuXG5RVW5pdC50ZXN0KCdhcHBseWluZyBzZXZlcmFsIG1peGlucyBhdCBvbmNlIHdpdGggc3VwIGFscmVhZHkgZGVmaW5lZCBjYXVzZXMgaW5maW5pdGUgbG9vcCcsIGZ1bmN0aW9uKCkge1xuICBsZXQgY250ID0gMDtcbiAgbGV0IE1peGluQSA9IE1peGluLmNyZWF0ZSh7XG4gICAgZm9vKCkgeyBjbnQrKzsgfVxuICB9KTtcblxuICBsZXQgTWl4aW5CID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb28oKSB7XG4gICAgICB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgY250Kys7XG4gICAgfVxuICB9KTtcblxuICBsZXQgTWl4aW5DID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb28oKSB7XG4gICAgICB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgY250Kys7XG4gICAgfVxuICB9KTtcblxuICBsZXQgb2JqID0ge307XG4gIG1peGluKG9iaiwgTWl4aW5BKTsgLy8gc3VwIGFscmVhZHkgZXhpc3RzXG4gIG1peGluKG9iaiwgTWl4aW5CLCBNaXhpbkMpOyAvLyBtdXN0IGJlIG1vcmUgdGhhbiBvbmUgbWl4aW5cblxuICBjbnQgPSAwO1xuICBvYmpbJ2ZvbyddKCk7XG4gIGVxdWFsKGNudCwgMywgJ3Nob3VsZCBpbnZva2UgYWxsIDMgbWV0aG9kcycpO1xufSk7XG4iXX0=