"use strict";
var object_1 = require("@glimmer/object");
var test_helpers_1 = require("@glimmer/test-helpers");
var moduleOptions;
QUnit.module('GlimmerObject.create', moduleOptions);
QUnit.test('simple properties are set', function () {
    var o = object_1.default.create({ ohai: 'there' });
    equal(o.get('ohai'), 'there');
});
QUnit.test('reopening a parent flushes the child', function (assert) {
    var MyClass = object_1.default.extend();
    var SubClass = MyClass.extend();
    MyClass.reopen({
        hello: function () {
            return "hello";
        }
    });
    var sub = SubClass.create();
    assert.equal(sub.hello(), "hello");
});
QUnit.test('reopening a parent flushes the child', function (assert) {
    var MyClass = object_1.default.extend({
        hello: function () {
            return "original hello";
        }
    });
    var SubClass = MyClass.extend({
        hello: function () {
            return this._super();
        }
    });
    var GrandChild = SubClass.extend({
        hello: function () {
            return this._super();
        }
    });
    MyClass.reopen({
        hello: function () {
            return this._super() + " new hello";
        }
    });
    var sub = GrandChild.create();
    assert.equal(sub.hello(), "original hello new hello");
});
QUnit.test('reopening a parent with a computed property flushes the child', function (assert) {
    var MyClass = object_1.default.extend({
        hello: object_1.computed(function () {
            return "original hello";
        })
    });
    var SubClass = MyClass.extend({
        hello: object_1.computed(function () {
            return this._super();
        })
    });
    var GrandChild = SubClass.extend({
        hello: object_1.computed(function () {
            return this._super();
        })
    });
    MyClass.reopen({
        hello: object_1.computed(function () {
            return this._super() + " new hello";
        })
    });
    var sub = GrandChild.create();
    assert.equal(sub.hello, "original hello new hello");
});
QUnit.test('calls computed property setters', function (assert) {
    var MyClass = object_1.default.extend({
        foo: object_1.computed({
            get: function () {
                return 'this is not the value you\'re looking for';
            },
            set: function (key, value) {
                return value;
            }
        })
    });
    var o = MyClass.create({ foo: 'bar' });
    assert.equal(o.get('foo'), 'bar');
});
QUnit.skip('allows bindings to be defined', function () {
    var obj = object_1.default.create({
        foo: 'foo',
        barBinding: 'foo'
    });
    equal(obj.get('bar'), 'foo', 'The binding value is correct');
});
QUnit.skip('calls setUnknownProperty if defined', function () {
    var setUnknownPropertyCalled = false;
    var MyClass = object_1.default.extend({
        setUnknownProperty: function (key, value) {
            setUnknownPropertyCalled = true;
        }
    });
    MyClass.create({ foo: 'bar' });
    ok(setUnknownPropertyCalled, 'setUnknownProperty was called');
});
QUnit.skip('throws if you try to define a computed property', function (assert) {
    assert.throws(function () {
        object_1.default.create({
            foo: object_1.computed(function () { })
        });
    }, (_a = ["Ember.Object.create no longer supports defining computed properties.\n           Define computed properties using extend() or reopen() before calling create()."], _a.raw = ["Ember.Object.create no longer supports defining computed properties.\n           Define computed properties using extend() or reopen() before calling create()."], test_helpers_1.strip(_a)));
    var _a;
});
QUnit.skip('throws if you try to call _super in a method', function (assert) {
    assert.throws(function () {
        object_1.default.create({
            foo: function () {
                this._super.apply(this, arguments);
            }
        });
    }, 'Ember.Object.create no longer supports defining methods that call _super.');
});
QUnit.skip('throws if you try to \'mixin\' a definition', function (assert) {
    var myMixin = object_1.Mixin.create({
        adder: function (arg1, arg2) {
            return arg1 + arg2;
        }
    });
    assert.throws(function () {
        object_1.default.create(myMixin);
    }, 'Ember.Object.create no longer supports mixing in other definitions, use .extend & .create seperately instead.');
});
// This test is for IE8.
QUnit.test('property name is the same as own prototype property', function () {
    var MyClass = object_1.default.extend({
        toString: function () { return 'MyClass'; }
    });
    equal(MyClass.create().toString(), 'MyClass', 'should inherit property from the arguments of `EmberObject.create`');
});
QUnit.test('inherits properties from passed in EmberObject', function () {
    var baseObj = object_1.default.create({ foo: 'bar' });
    var secondaryObj = object_1.default.create(baseObj);
    equal(secondaryObj['foo'], baseObj['foo'], 'Em.O.create inherits properties from EmberObject parameter');
});
QUnit.skip('throws if you try to pass anything a string as a parameter', function () {
    var expected = 'EmberObject.create only accepts an objects.';
    throws(function () {
        object_1.default.create('some-string');
    }, expected);
});
QUnit.skip('EmberObject.create can take undefined as a parameter', function () {
    var o = object_1.default.create(undefined);
    deepEqual(object_1.default.create(), o);
});
QUnit.skip('EmberObject.create can take null as a parameter', function () {
    var o = object_1.default.create(null);
    deepEqual(object_1.default.create(), o);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1iZXItY3JlYXRlLXRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJAZ2xpbW1lci9vYmplY3QvdGVzdHMvZW1iZXItY3JlYXRlLXRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDBDQUErRDtBQUMvRCxzREFBOEM7QUFFOUMsSUFBSSxhQUFhLENBQUM7QUFFbEIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRSxhQUFhLENBQUMsQ0FBQztBQUVwRCxLQUFLLENBQUMsSUFBSSxDQUFDLDJCQUEyQixFQUFFO0lBQ3RDLElBQUksQ0FBQyxHQUFHLGdCQUFXLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7SUFDOUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDaEMsQ0FBQyxDQUFDLENBQUM7QUFFSCxLQUFLLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxFQUFFLFVBQUEsTUFBTTtJQUN2RCxJQUFJLE9BQU8sR0FBRyxnQkFBVyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBRW5DLElBQUksUUFBUSxHQUFHLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUVoQyxPQUFPLENBQUMsTUFBTSxDQUFDO1FBQ2IsS0FBSztZQUNILE1BQU0sQ0FBQyxPQUFPLENBQUM7UUFDakIsQ0FBQztLQUNGLENBQUMsQ0FBQztJQUVILElBQUksR0FBRyxHQUFRLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUVqQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNyQyxDQUFDLENBQUMsQ0FBQztBQUVILEtBQUssQ0FBQyxJQUFJLENBQUMsc0NBQXNDLEVBQUUsVUFBQSxNQUFNO0lBQ3ZELElBQUksT0FBTyxHQUFHLGdCQUFXLENBQUMsTUFBTSxDQUFDO1FBQy9CLEtBQUs7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USxHQUFHLDZDQUE2QyxDQUFDO0lBRTdELE1BQU0sQ0FBQztRQUNMLGdCQUFXLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3BDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUNmLENBQUMsQ0FBQyxDQUFDO0FBRUgsS0FBSyxDQUFDLElBQUksQ0FBQyxzREFBc0QsRUFBRTtJQUNqRSxJQUFJLENBQUMsR0FBRyxnQkFBVyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUN0QyxTQUFTLENBQUMsZ0JBQVcsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNyQyxDQUFDLENBQUMsQ0FBQztBQUVILEtBQUssQ0FBQyxJQUFJLENBQUMsaURBQWlELEVBQUU7SUFDNUQsSUFBSSxDQUFDLEdBQUcsZ0JBQVcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakMsU0FBUyxDQUFDLGdCQUFXLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDckMsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRW1iZXJPYmplY3QsIHsgTWl4aW4sIGNvbXB1dGVkIH0gZnJvbSAnQGdsaW1tZXIvb2JqZWN0JztcbmltcG9ydCB7IHN0cmlwIH0gZnJvbSAnQGdsaW1tZXIvdGVzdC1oZWxwZXJzJztcblxubGV0IG1vZHVsZU9wdGlvbnM7XG5cblFVbml0Lm1vZHVsZSgnR2xpbW1lck9iamVjdC5jcmVhdGUnLCBtb2R1bGVPcHRpb25zKTtcblxuUVVuaXQudGVzdCgnc2ltcGxlIHByb3BlcnRpZXMgYXJlIHNldCcsIGZ1bmN0aW9uKCkge1xuICBsZXQgbyA9IEVtYmVyT2JqZWN0LmNyZWF0ZSh7IG9oYWk6ICd0aGVyZScgfSk7XG4gIGVxdWFsKG8uZ2V0KCdvaGFpJyksICd0aGVyZScpO1xufSk7XG5cblFVbml0LnRlc3QoJ3Jlb3BlbmluZyBhIHBhcmVudCBmbHVzaGVzIHRoZSBjaGlsZCcsIGFzc2VydCA9PiB7XG4gIGxldCBNeUNsYXNzID0gRW1iZXJPYmplY3QuZXh0ZW5kKCk7XG5cbiAgbGV0IFN1YkNsYXNzID0gTXlDbGFzcy5leHRlbmQoKTtcblxuICBNeUNsYXNzLnJlb3Blbih7XG4gICAgaGVsbG8oKSB7XG4gICAgICByZXR1cm4gXCJoZWxsb1wiO1xuICAgIH1cbiAgfSk7XG5cbiAgbGV0IHN1YjogYW55ID0gU3ViQ2xhc3MuY3JlYXRlKCk7XG5cbiAgYXNzZXJ0LmVxdWFsKHN1Yi5oZWxsbygpLCBcImhlbGxvXCIpO1xufSk7XG5cblFVbml0LnRlc3QoJ3Jlb3BlbmluZyBhIHBhcmVudCBmbHVzaGVzIHRoZSBjaGlsZCcsIGFzc2VydCA9PiB7XG4gIGxldCBNeUNsYXNzID0gRW1iZXJPYmplY3QuZXh0ZW5kKHtcbiAgICBoZWxsbygpIHtcbiAgICAgIHJldHVybiBcIm9yaWdpbmFsIGhlbGxvXCI7XG4gICAgfVxuICB9KTtcblxuICBsZXQgU3ViQ2xhc3MgPSBNeUNsYXNzLmV4dGVuZCh7XG4gICAgaGVsbG8oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3VwZXIoKTtcbiAgICB9XG4gIH0pO1xuXG4gIGxldCBHcmFuZENoaWxkID0gU3ViQ2xhc3MuZXh0ZW5kKHtcbiAgICBoZWxsbygpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zdXBlcigpO1xuICAgIH1cbiAgfSk7XG5cbiAgTXlDbGFzcy5yZW9wZW4oe1xuICAgIGhlbGxvKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyKCkgKyBcIiBuZXcgaGVsbG9cIjtcbiAgICB9XG4gIH0pO1xuXG4gIGxldCBzdWI6IGFueSA9IEdyYW5kQ2hpbGQuY3JlYXRlKCk7XG5cbiAgYXNzZXJ0LmVxdWFsKHN1Yi5oZWxsbygpLCBcIm9yaWdpbmFsIGhlbGxvIG5ldyBoZWxsb1wiKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdyZW9wZW5pbmcgYSBwYXJlbnQgd2l0aCBhIGNvbXB1dGVkIHByb3BlcnR5IGZsdXNoZXMgdGhlIGNoaWxkJywgYXNzZXJ0ID0+IHtcbiAgbGV0IE15Q2xhc3MgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGhlbGxvOiBjb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBcIm9yaWdpbmFsIGhlbGxvXCI7XG4gICAgfSlcbiAgfSk7XG5cbiAgbGV0IFN1YkNsYXNzID0gTXlDbGFzcy5leHRlbmQoe1xuICAgIGhlbGxvOiBjb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zdXBlcigpO1xuICAgIH0pXG4gIH0pO1xuXG4gIGxldCBHcmFuZENoaWxkID0gU3ViQ2xhc3MuZXh0ZW5kKHtcbiAgICBoZWxsbzogY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3VwZXIoKTtcbiAgICB9KVxuICB9KTtcblxuICBNeUNsYXNzLnJlb3Blbih7XG4gICAgaGVsbG86IGNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyKCkgKyBcIiBuZXcgaGVsbG9cIjtcbiAgICB9KVxuICB9KTtcblxuICBsZXQgc3ViOiBhbnkgPSBHcmFuZENoaWxkLmNyZWF0ZSgpO1xuXG4gIGFzc2VydC5lcXVhbChzdWIuaGVsbG8sIFwib3JpZ2luYWwgaGVsbG8gbmV3IGhlbGxvXCIpO1xufSk7XG5cblFVbml0LnRlc3QoJ2NhbGxzIGNvbXB1dGVkIHByb3BlcnR5IHNldHRlcnMnLCBhc3NlcnQgPT4ge1xuICBsZXQgTXlDbGFzcyA9IEVtYmVyT2JqZWN0LmV4dGVuZCh7XG4gICAgZm9vOiBjb21wdXRlZCh7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gJ3RoaXMgaXMgbm90IHRoZSB2YWx1ZSB5b3VcXCdyZSBsb29raW5nIGZvcic7XG4gICAgICB9LFxuICAgICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcblxuICBsZXQgbyA9IE15Q2xhc3MuY3JlYXRlKHsgZm9vOiAnYmFyJyB9KTtcbiAgYXNzZXJ0LmVxdWFsKG8uZ2V0KCdmb28nKSwgJ2JhcicpO1xufSk7XG5cblFVbml0LnNraXAoJ2FsbG93cyBiaW5kaW5ncyB0byBiZSBkZWZpbmVkJywgZnVuY3Rpb24oKSB7XG4gIGxldCBvYmogPSBFbWJlck9iamVjdC5jcmVhdGUoe1xuICAgIGZvbzogJ2ZvbycsXG4gICAgYmFyQmluZGluZzogJ2ZvbydcbiAgfSk7XG5cbiAgZXF1YWwob2JqLmdldCgnYmFyJyksICdmb28nLCAnVGhlIGJpbmRpbmcgdmFsdWUgaXMgY29ycmVjdCcpO1xufSk7XG5cblFVbml0LnNraXAoJ2NhbGxzIHNldFVua25vd25Qcm9wZXJ0eSBpZiBkZWZpbmVkJywgZnVuY3Rpb24oKSB7XG4gIGxldCBzZXRVbmtub3duUHJvcGVydHlDYWxsZWQgPSBmYWxzZTtcblxuICBsZXQgTXlDbGFzcyA9IEVtYmVyT2JqZWN0LmV4dGVuZCh7XG4gICAgc2V0VW5rbm93blByb3BlcnR5KGtleSwgdmFsdWUpIHtcbiAgICAgIHNldFVua25vd25Qcm9wZXJ0eUNhbGxlZCA9IHRydWU7XG4gICAgfVxuICB9KTtcblxuICBNeUNsYXNzLmNyZWF0ZSh7IGZvbzogJ2JhcicgfSk7XG4gIG9rKHNldFVua25vd25Qcm9wZXJ0eUNhbGxlZCwgJ3NldFVua25vd25Qcm9wZXJ0eSB3YXMgY2FsbGVkJyk7XG59KTtcblxuUVVuaXQuc2tpcCgndGhyb3dzIGlmIHlvdSB0cnkgdG8gZGVmaW5lIGEgY29tcHV0ZWQgcHJvcGVydHknLCBhc3NlcnQgPT4ge1xuICBhc3NlcnQudGhyb3dzKGZ1bmN0aW9uKCkge1xuICAgIEVtYmVyT2JqZWN0LmNyZWF0ZSh7XG4gICAgICBmb286IGNvbXB1dGVkKGZ1bmN0aW9uKCkge30pXG4gICAgfSk7XG4gIH0sIHN0cmlwYEVtYmVyLk9iamVjdC5jcmVhdGUgbm8gbG9uZ2VyIHN1cHBvcnRzIGRlZmluaW5nIGNvbXB1dGVkIHByb3BlcnRpZXMuXG4gICAgICAgICAgIERlZmluZSBjb21wdXRlZCBwcm9wZXJ0aWVzIHVzaW5nIGV4dGVuZCgpIG9yIHJlb3BlbigpIGJlZm9yZSBjYWxsaW5nIGNyZWF0ZSgpLmApO1xufSk7XG5cblFVbml0LnNraXAoJ3Rocm93cyBpZiB5b3UgdHJ5IHRvIGNhbGwgX3N1cGVyIGluIGEgbWV0aG9kJywgYXNzZXJ0ID0+IHtcbiAgYXNzZXJ0LnRocm93cyhmdW5jdGlvbigpIHtcbiAgICBFbWJlck9iamVjdC5jcmVhdGUoe1xuICAgICAgZm9vKCkge1xuICAgICAgICB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LCAnRW1iZXIuT2JqZWN0LmNyZWF0ZSBubyBsb25nZXIgc3VwcG9ydHMgZGVmaW5pbmcgbWV0aG9kcyB0aGF0IGNhbGwgX3N1cGVyLicpO1xufSk7XG5cblFVbml0LnNraXAoJ3Rocm93cyBpZiB5b3UgdHJ5IHRvIFxcJ21peGluXFwnIGEgZGVmaW5pdGlvbicsIGFzc2VydCA9PiB7XG4gIGxldCBteU1peGluID0gTWl4aW4uY3JlYXRlKHtcbiAgICBhZGRlcihhcmcxLCBhcmcyKSB7XG4gICAgICByZXR1cm4gYXJnMSArIGFyZzI7XG4gICAgfVxuICB9KTtcblxuICBhc3NlcnQudGhyb3dzKGZ1bmN0aW9uKCkge1xuICAgIEVtYmVyT2JqZWN0LmNyZWF0ZShteU1peGluKTtcbiAgfSwgJ0VtYmVyLk9iamVjdC5jcmVhdGUgbm8gbG9uZ2VyIHN1cHBvcnRzIG1peGluZyBpbiBvdGhlciBkZWZpbml0aW9ucywgdXNlIC5leHRlbmQgJiAuY3JlYXRlIHNlcGVyYXRlbHkgaW5zdGVhZC4nKTtcbn0pO1xuXG4vLyBUaGlzIHRlc3QgaXMgZm9yIElFOC5cblFVbml0LnRlc3QoJ3Byb3BlcnR5IG5hbWUgaXMgdGhlIHNhbWUgYXMgb3duIHByb3RvdHlwZSBwcm9wZXJ0eScsIGZ1bmN0aW9uKCkge1xuICBsZXQgTXlDbGFzcyA9IEVtYmVyT2JqZWN0LmV4dGVuZCh7XG4gICAgdG9TdHJpbmcoKSB7IHJldHVybiAnTXlDbGFzcyc7IH1cbiAgfSk7XG5cbiAgZXF1YWwoTXlDbGFzcy5jcmVhdGUoKS50b1N0cmluZygpLCAnTXlDbGFzcycsICdzaG91bGQgaW5oZXJpdCBwcm9wZXJ0eSBmcm9tIHRoZSBhcmd1bWVudHMgb2YgYEVtYmVyT2JqZWN0LmNyZWF0ZWAnKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdpbmhlcml0cyBwcm9wZXJ0aWVzIGZyb20gcGFzc2VkIGluIEVtYmVyT2JqZWN0JywgZnVuY3Rpb24oKSB7XG4gIGxldCBiYXNlT2JqID0gRW1iZXJPYmplY3QuY3JlYXRlKHsgZm9vOiAnYmFyJyB9KTtcbiAgbGV0IHNlY29uZGFyeU9iaiA9IEVtYmVyT2JqZWN0LmNyZWF0ZShiYXNlT2JqKTtcblxuICBlcXVhbChzZWNvbmRhcnlPYmpbJ2ZvbyddLCBiYXNlT2JqWydmb28nXSwgJ0VtLk8uY3JlYXRlIGluaGVyaXRzIHByb3BlcnRpZXMgZnJvbSBFbWJlck9iamVjdCBwYXJhbWV0ZXInKTtcbn0pO1xuXG5RVW5pdC5za2lwKCd0aHJvd3MgaWYgeW91IHRyeSB0byBwYXNzIGFueXRoaW5nIGEgc3RyaW5nIGFzIGEgcGFyYW1ldGVyJywgZnVuY3Rpb24oKSB7XG4gIGxldCBleHBlY3RlZCA9ICdFbWJlck9iamVjdC5jcmVhdGUgb25seSBhY2NlcHRzIGFuIG9iamVjdHMuJztcblxuICB0aHJvd3MoZnVuY3Rpb24oKSB7XG4gICAgRW1iZXJPYmplY3QuY3JlYXRlKCdzb21lLXN0cmluZycpO1xuICB9LCBleHBlY3RlZCk7XG59KTtcblxuUVVuaXQuc2tpcCgnRW1iZXJPYmplY3QuY3JlYXRlIGNhbiB0YWtlIHVuZGVmaW5lZCBhcyBhIHBhcmFtZXRlcicsIGZ1bmN0aW9uKCkge1xuICBsZXQgbyA9IEVtYmVyT2JqZWN0LmNyZWF0ZSh1bmRlZmluZWQpO1xuICBkZWVwRXF1YWwoRW1iZXJPYmplY3QuY3JlYXRlKCksIG8pO1xufSk7XG5cblFVbml0LnNraXAoJ0VtYmVyT2JqZWN0LmNyZWF0ZSBjYW4gdGFrZSBudWxsIGFzIGEgcGFyYW1ldGVyJywgZnVuY3Rpb24oKSB7XG4gIGxldCBvID0gRW1iZXJPYmplY3QuY3JlYXRlKG51bGwpO1xuICBkZWVwRXF1YWwoRW1iZXJPYmplY3QuY3JlYXRlKCksIG8pO1xufSk7XG4iXX0=