"use strict";
var object_1 = require("@glimmer/object");
var emberGet = function aget(x, y) { return x[y]; };
var emberSet = function aset(x, y, z) { return (x[y] = z); };
function testWithDefault(name, callback) {
    QUnit.test(name, function (assert) {
        callback(emberGet, emberSet);
    });
}
var EmberObject = object_1.default;
function K() { return this; }
QUnit.module('GlimmerObject.extend - Computed Properties');
testWithDefault('computed property on instance', function (get, set) {
    var MyClass = EmberObject.extend({
        foo: object_1.computed(function () { return 'FOO'; })
    });
    equal(get(new MyClass(), 'foo'), 'FOO');
});
testWithDefault('computed property on subclass', function (get, set) {
    var MyClass = EmberObject.extend({
        foo: object_1.computed(function () { return 'FOO'; })
    });
    var Subclass = MyClass.extend({
        foo: object_1.computed(function () { return 'BAR'; })
    });
    equal(get(new Subclass(), 'foo'), 'BAR');
});
testWithDefault('replacing computed property with regular val', function (get, set) {
    var MyClass = EmberObject.extend({
        foo: object_1.computed(function () { return 'FOO'; })
    });
    var Subclass = MyClass.extend({
        foo: 'BAR'
    });
    equal(get(new Subclass(), 'foo'), 'BAR');
});
testWithDefault('complex dependent keys', function (get, set) {
    var MyClass = EmberObject.extend({
        init: function () {
            this._super.apply(this, arguments);
            set(this, 'bar', { baz: 'BIFF' });
        },
        foo: object_1.computed(function () {
            return get(get(this, 'bar'), 'baz');
        }).property('bar.baz')
    });
    var Subclass = MyClass.extend({});
    var obj1 = new MyClass();
    var obj2 = new Subclass();
    equal(get(obj1, 'foo'), 'BIFF');
    equal(get(obj2, 'foo'), 'BIFF');
    set(get(obj1, 'bar'), 'baz', 'BLARG');
    equal(get(obj1, 'foo'), 'BLARG');
    equal(get(obj2, 'foo'), 'BIFF');
    set(get(obj2, 'bar'), 'baz', 'BOOM');
    equal(get(obj1, 'foo'), 'BLARG');
    equal(get(obj2, 'foo'), 'BOOM');
});
testWithDefault('complex dependent keys changing complex dependent keys', function (get, set) {
    var MyClass = EmberObject.extend({
        init: function () {
            this._super.apply(this, arguments);
            set(this, 'bar', { baz: 'BIFF' });
        },
        foo: object_1.computed(function () {
            return get(get(this, 'bar'), 'baz');
        }).property('bar.baz')
    });
    var Subclass = MyClass.extend({
        init: function () {
            this._super.apply(this, arguments);
            set(this, 'bar2', { baz: 'BIFF2' });
        },
        foo: object_1.computed(function () {
            return get(get(this, 'bar2'), 'baz');
        }).property('bar2.baz')
    });
    var obj2 = new Subclass();
    equal(get(obj2, 'foo'), 'BIFF2');
    set(get(obj2, 'bar'), 'baz', 'BLARG');
    equal(get(obj2, 'foo'), 'BIFF2', 'should not invalidate property');
    set(get(obj2, 'bar2'), 'baz', 'BLARG');
    equal(get(obj2, 'foo'), 'BLARG', 'should invalidate property');
});
QUnit.test('can retrieve metadata for a computed property', function (assert) {
    var MyClass = EmberObject.extend({
        computedProperty: object_1.computed(function () { }).meta({ key: 'keyValue' })
    });
    equal(emberGet(MyClass.metaForProperty('computedProperty'), 'key'), 'keyValue', 'metadata saved on the computed property can be retrieved');
    var ClassWithNoMetadata = EmberObject.extend({
        computedProperty: object_1.computed(function () {
        }).volatile(),
        staticProperty: 12
    });
    equal(typeof ClassWithNoMetadata.metaForProperty('computedProperty'), 'object', 'returns empty hash if no metadata has been saved');
    assert.throws(function () {
        ClassWithNoMetadata.metaForProperty('nonexistentProperty');
    }, 'metaForProperty() could not find a computed property with key \'nonexistentProperty\'.');
    assert.throws(function () {
        ClassWithNoMetadata.metaForProperty('staticProperty');
    }, 'metaForProperty() could not find a computed property with key \'staticProperty\'.');
});
QUnit.test('can iterate over a list of computed properties for a class', function () {
    var MyClass = EmberObject.extend({
        foo: object_1.computed(function () { }),
        fooDidChange: object_1.observer('foo', function () { }),
        bar: object_1.computed(function () { }),
        qux: object_1.alias('foo')
    });
    var SubClass = MyClass.extend({
        baz: object_1.computed(function () { })
    });
    SubClass.reopen({
        bat: object_1.computed(function () { }).meta({ iAmBat: true })
    });
    var list = [];
    MyClass.eachComputedProperty(function (name) {
        list.push(name);
    });
    deepEqual(list.sort(), ['bar', 'foo', 'qux'], 'watched and unwatched computed properties are iterated');
    list = [];
    SubClass.eachComputedProperty(function (name, meta) {
        list.push(name);
        if (name === 'bat') {
            deepEqual(meta, { iAmBat: true });
        }
        else {
            deepEqual(meta, {});
        }
    });
    deepEqual(list.sort(), ['bar', 'bat', 'baz', 'foo', 'qux'], 'all inherited properties are included');
});
QUnit.test('list of properties updates when an additional property is added (such cache busting)', function () {
    var MyClass = EmberObject.extend({
        foo: object_1.computed(K),
        fooDidChange: object_1.observer('foo', function () { }),
        bar: object_1.computed(K)
    });
    var list = [];
    MyClass.eachComputedProperty(function (name) {
        list.push(name);
    });
    deepEqual(list.sort(), ['bar', 'foo'].sort(), 'expected two computed properties');
    MyClass.reopen({
        baz: object_1.computed(K)
    });
    MyClass.create(); // force apply mixins
    list = [];
    MyClass.eachComputedProperty(function (name) {
        list.push(name);
    });
    deepEqual(list.sort(), ['bar', 'foo', 'baz'].sort(), 'expected three computed properties');
});
QUnit.test('Calling _super in call outside the immediate function of a CP getter works', function () {
    function macro(callback) {
        return object_1.computed(function () {
            return callback.call(this);
        });
    }
    var MyClass = EmberObject.extend({
        foo: object_1.computed(function () {
            return 'FOO';
        })
    });
    var SubClass = MyClass.extend({
        foo: macro(function () {
            return this._super();
        })
    });
    equal(emberGet(SubClass.create(), 'foo'), 'FOO', 'super value is fetched');
});
QUnit.test('Calling _super in apply outside the immediate function of a CP getter works', function () {
    function macro(callback) {
        return object_1.computed(function () {
            return callback.apply(this);
        });
    }
    var MyClass = EmberObject.extend({
        foo: object_1.computed(function () {
            return 'FOO';
        })
    });
    var SubClass = MyClass.extend({
        foo: macro(function () {
            return this._super();
        })
    });
    equal(emberGet(SubClass.create(), 'foo'), 'FOO', 'super value is fetched');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1iZXItY29tcHV0ZWQtdGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL29iamVjdC90ZXN0cy9lbWJlci1jb21wdXRlZC10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwwQ0FBMkU7QUFVM0UsSUFBSSxRQUFRLEdBQUcsY0FBYyxDQUFDLEVBQUUsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDcEQsSUFBSSxRQUFRLEdBQUcsY0FBYyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFN0QseUJBQXlCLElBQVksRUFBRSxRQUE0QjtJQUNqRSxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxVQUFBLE1BQU07UUFDckIsUUFBUSxDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUMvQixDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxJQUFJLFdBQVcsR0FBRyxnQkFBYSxDQUFDO0FBRWhDLGVBQWUsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7QUFFN0IsS0FBSyxDQUFDLE1BQU0sQ0FBQyw0Q0FBNEMsQ0FBQyxDQUFDO0FBRTNELGVBQWUsQ0FBQywrQkFBK0IsRUFBRSxVQUFTLEdBQUcsRUFBRSxHQUFHO0lBQ2hFLElBQUksT0FBTyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUM7UUFDL0IsR0FBRyxFQUFFLGlCQUFRLENBQUMsY0FBYSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0tBQzVDLENBQUMsQ0FBQztJQUVILEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxPQUFPLEVBQUUsRUFBRSxLQUFLLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztBQUMxQyxDQUFDLENB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QUFDO0FBQzdFLENBQUMsQ0FBQyxDQUFDO0FBRUgsS0FBSyxDQUFDLElBQUksQ0FBQyw2RUFBNkUsRUFBRTtJQUN4RixlQUFlLFFBQVE7UUFDckIsTUFBTSxDQUFDLGlCQUFRLENBQUM7WUFDZCxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxJQUFJLE9BQU8sR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDO1FBQy9CLEdBQUcsRUFBRSxpQkFBUSxDQUFDO1lBQ1osTUFBTSxDQUFDLEtBQUssQ0FBQztRQUNmLENBQUMsQ0FBQztLQUNILENBQUMsQ0FBQztJQUVILElBQUksUUFBUSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFDNUIsR0FBRyxFQUFFLEtBQUssQ0FBQztZQUNULE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDdkIsQ0FBQyxDQUFDO0tBQ0gsQ0FBQyxDQUFDO0lBRUgsS0FBSyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLHdCQUF3QixDQUFDLENBQUM7QUFDN0UsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgR2xpbW1lck9iamVjdCwgeyBjb21wdXRlZCwgb2JzZXJ2ZXIsIGFsaWFzIH0gZnJvbSAnQGdsaW1tZXIvb2JqZWN0JztcblxuaW50ZXJmYWNlIEdldCB7XG4gIChvYmo6IGFueSwga2V5OiBzdHJpbmcpOiBhbnk7XG59XG5cbmludGVyZmFjZSBTZXQge1xuICAob2JqOiBhbnksIGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTtcbn1cblxubGV0IGVtYmVyR2V0ID0gZnVuY3Rpb24gYWdldCh4LCB5KSB7IHJldHVybiB4W3ldOyB9O1xubGV0IGVtYmVyU2V0ID0gZnVuY3Rpb24gYXNldCh4LCB5LCB6KSB7IHJldHVybiAoeFt5XSA9IHopOyB9O1xuXG5mdW5jdGlvbiB0ZXN0V2l0aERlZmF1bHQobmFtZTogc3RyaW5nLCBjYWxsYmFjazogKEdldCwgU2V0KSA9PiB2b2lkKSB7XG4gIFFVbml0LnRlc3QobmFtZSwgYXNzZXJ0ID0+IHtcbiAgICBjYWxsYmFjayhlbWJlckdldCwgZW1iZXJTZXQpO1xuICB9KTtcbn1cblxubGV0IEVtYmVyT2JqZWN0ID0gR2xpbW1lck9iamVjdDtcblxuZnVuY3Rpb24gSygpIHsgcmV0dXJuIHRoaXM7IH1cblxuUVVuaXQubW9kdWxlKCdHbGltbWVyT2JqZWN0LmV4dGVuZCAtIENvbXB1dGVkIFByb3BlcnRpZXMnKTtcblxudGVzdFdpdGhEZWZhdWx0KCdjb21wdXRlZCBwcm9wZXJ0eSBvbiBpbnN0YW5jZScsIGZ1bmN0aW9uKGdldCwgc2V0KSB7XG4gIGxldCBNeUNsYXNzID0gRW1iZXJPYmplY3QuZXh0ZW5kKHtcbiAgICBmb286IGNvbXB1dGVkKGZ1bmN0aW9uKCkgeyByZXR1cm4gJ0ZPTyc7IH0pXG4gIH0pO1xuXG4gIGVxdWFsKGdldChuZXcgTXlDbGFzcygpLCAnZm9vJyksICdGT08nKTtcbn0pO1xuXG50ZXN0V2l0aERlZmF1bHQoJ2NvbXB1dGVkIHByb3BlcnR5IG9uIHN1YmNsYXNzJywgZnVuY3Rpb24oZ2V0LCBzZXQpIHtcbiAgbGV0IE15Q2xhc3MgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGZvbzogY29tcHV0ZWQoZnVuY3Rpb24oKSB7IHJldHVybiAnRk9PJzsgfSlcbiAgfSk7XG5cbiAgbGV0IFN1YmNsYXNzID0gTXlDbGFzcy5leHRlbmQoe1xuICAgIGZvbzogY29tcHV0ZWQoZnVuY3Rpb24oKSB7IHJldHVybiAnQkFSJzsgfSlcbiAgfSk7XG5cbiAgZXF1YWwoZ2V0KG5ldyBTdWJjbGFzcygpLCAnZm9vJyksICdCQVInKTtcbn0pO1xuXG50ZXN0V2l0aERlZmF1bHQoJ3JlcGxhY2luZyBjb21wdXRlZCBwcm9wZXJ0eSB3aXRoIHJlZ3VsYXIgdmFsJywgZnVuY3Rpb24oZ2V0LCBzZXQpIHtcbiAgbGV0IE15Q2xhc3MgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGZvbzogY29tcHV0ZWQoZnVuY3Rpb24oKSB7IHJldHVybiAnRk9PJzsgfSlcbiAgfSk7XG5cbiAgbGV0IFN1YmNsYXNzID0gTXlDbGFzcy5leHRlbmQoe1xuICAgIGZvbzogJ0JBUidcbiAgfSk7XG5cbiAgZXF1YWwoZ2V0KG5ldyBTdWJjbGFzcygpLCAnZm9vJyksICdCQVInKTtcbn0pO1xuXG50ZXN0V2l0aERlZmF1bHQoJ2NvbXBsZXggZGVwZW5kZW50IGtleXMnLCBmdW5jdGlvbihnZXQsIHNldCkge1xuICBsZXQgTXlDbGFzcyA9IEVtYmVyT2JqZWN0LmV4dGVuZCh7XG5cbiAgICBpbml0KCkge1xuICAgICAgdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHNldCh0aGlzLCAnYmFyJywgeyBiYXo6ICdCSUZGJyB9KTtcbiAgICB9LFxuXG4gICAgZm9vOiBjb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBnZXQoZ2V0KHRoaXMsICdiYXInKSwgJ2JheicpO1xuICAgIH0pLnByb3BlcnR5KCdiYXIuYmF6JylcblxuICB9KTtcblxuICBsZXQgU3ViY2xhc3MgPSBNeUNsYXNzLmV4dGVuZCh7XG4gIH0pO1xuXG4gIGxldCBvYmoxID0gbmV3IE15Q2xhc3MoKTtcbiAgbGV0IG9iajIgPSBuZXcgU3ViY2xhc3MoKTtcblxuICBlcXVhbChnZXQob2JqMSwgJ2ZvbycpLCAnQklGRicpO1xuICBlcXVhbChnZXQob2JqMiwgJ2ZvbycpLCAnQklGRicpO1xuXG4gIHNldChnZXQob2JqMSwgJ2JhcicpLCAnYmF6JywgJ0JMQVJHJyk7XG5cbiAgZXF1YWwoZ2V0KG9iajEsICdmb28nKSwgJ0JMQVJHJyk7XG4gIGVxdWFsKGdldChvYmoyLCAnZm9vJyksICdCSUZGJyk7XG5cbiAgc2V0KGdldChvYmoyLCAnYmFyJyksICdiYXonLCAnQk9PTScpO1xuXG4gIGVxdWFsKGdldChvYmoxLCAnZm9vJyksICdCTEFSRycpO1xuICBlcXVhbChnZXQob2JqMiwgJ2ZvbycpLCAnQk9PTScpO1xufSk7XG5cbnRlc3RXaXRoRGVmYXVsdCgnY29tcGxleCBkZXBlbmRlbnQga2V5cyBjaGFuZ2luZyBjb21wbGV4IGRlcGVuZGVudCBrZXlzJywgZnVuY3Rpb24oZ2V0LCBzZXQpIHtcbiAgbGV0IE15Q2xhc3MgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGluaXQoKSB7XG4gICAgICB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgc2V0KHRoaXMsICdiYXInLCB7IGJhejogJ0JJRkYnIH0pO1xuICAgIH0sXG5cbiAgICBmb286IGNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGdldChnZXQodGhpcywgJ2JhcicpLCAnYmF6Jyk7XG4gICAgfSkucHJvcGVydHkoJ2Jhci5iYXonKVxuICB9KTtcblxuICBsZXQgU3ViY2xhc3MgPSBNeUNsYXNzLmV4dGVuZCh7XG4gICAgaW5pdCgpIHtcbiAgICAgIHRoaXMuX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBzZXQodGhpcywgJ2JhcjInLCB7IGJhejogJ0JJRkYyJyB9KTtcbiAgICB9LFxuXG4gICAgZm9vOiBjb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBnZXQoZ2V0KHRoaXMsICdiYXIyJyksICdiYXonKTtcbiAgICB9KS5wcm9wZXJ0eSgnYmFyMi5iYXonKVxuICB9KTtcblxuICBsZXQgb2JqMiA9IG5ldyBTdWJjbGFzcygpO1xuXG4gIGVxdWFsKGdldChvYmoyLCAnZm9vJyksICdCSUZGMicpO1xuXG4gIHNldChnZXQob2JqMiwgJ2JhcicpLCAnYmF6JywgJ0JMQVJHJyk7XG4gIGVxdWFsKGdldChvYmoyLCAnZm9vJyksICdCSUZGMicsICdzaG91bGQgbm90IGludmFsaWRhdGUgcHJvcGVydHknKTtcblxuICBzZXQoZ2V0KG9iajIsICdiYXIyJyksICdiYXonLCAnQkxBUkcnKTtcbiAgZXF1YWwoZ2V0KG9iajIsICdmb28nKSwgJ0JMQVJHJywgJ3Nob3VsZCBpbnZhbGlkYXRlIHByb3BlcnR5Jyk7XG59KTtcblxuUVVuaXQudGVzdCgnY2FuIHJldHJpZXZlIG1ldGFkYXRhIGZvciBhIGNvbXB1dGVkIHByb3BlcnR5JywgYXNzZXJ0ID0+IHtcbiAgbGV0IE15Q2xhc3MgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGNvbXB1dGVkUHJvcGVydHk6IGNvbXB1dGVkKCgpID0+IHt9KS5tZXRhKHsga2V5OiAna2V5VmFsdWUnIH0pXG4gIH0pO1xuXG4gIGVxdWFsKGVtYmVyR2V0KE15Q2xhc3MubWV0YUZvclByb3BlcnR5KCdjb21wdXRlZFByb3BlcnR5JyksICdrZXknKSwgJ2tleVZhbHVlJywgJ21ldGFkYXRhIHNhdmVkIG9uIHRoZSBjb21wdXRlZCBwcm9wZXJ0eSBjYW4gYmUgcmV0cmlldmVkJyk7XG5cbiAgbGV0IENsYXNzV2l0aE5vTWV0YWRhdGEgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGNvbXB1dGVkUHJvcGVydHk6IGNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgIH0pLnZvbGF0aWxlKCksXG5cbiAgICBzdGF0aWNQcm9wZXJ0eTogMTJcbiAgfSk7XG5cbiAgZXF1YWwodHlwZW9mIENsYXNzV2l0aE5vTWV0YWRhdGEubWV0YUZvclByb3BlcnR5KCdjb21wdXRlZFByb3BlcnR5JyksICdvYmplY3QnLCAncmV0dXJucyBlbXB0eSBoYXNoIGlmIG5vIG1ldGFkYXRhIGhhcyBiZWVuIHNhdmVkJyk7XG5cbiAgYXNzZXJ0LnRocm93cyhmdW5jdGlvbigpIHtcbiAgICBDbGFzc1dpdGhOb01ldGFkYXRhLm1ldGFGb3JQcm9wZXJ0eSgnbm9uZXhpc3RlbnRQcm9wZXJ0eScpO1xuICB9LCAnbWV0YUZvclByb3BlcnR5KCkgY291bGQgbm90IGZpbmQgYSBjb21wdXRlZCBwcm9wZXJ0eSB3aXRoIGtleSBcXCdub25leGlzdGVudFByb3BlcnR5XFwnLicpO1xuXG4gIGFzc2VydC50aHJvd3MoZnVuY3Rpb24oKSB7XG4gICAgQ2xhc3NXaXRoTm9NZXRhZGF0YS5tZXRhRm9yUHJvcGVydHkoJ3N0YXRpY1Byb3BlcnR5Jyk7XG4gIH0sICdtZXRhRm9yUHJvcGVydHkoKSBjb3VsZCBub3QgZmluZCBhIGNvbXB1dGVkIHByb3BlcnR5IHdpdGgga2V5IFxcJ3N0YXRpY1Byb3BlcnR5XFwnLicpO1xufSk7XG5cblFVbml0LnRlc3QoJ2NhbiBpdGVyYXRlIG92ZXIgYSBsaXN0IG9mIGNvbXB1dGVkIHByb3BlcnRpZXMgZm9yIGEgY2xhc3MnLCBmdW5jdGlvbigpIHtcbiAgbGV0IE15Q2xhc3MgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGZvbzogY29tcHV0ZWQoZnVuY3Rpb24oKSB7fSksXG5cbiAgICBmb29EaWRDaGFuZ2U6IG9ic2VydmVyKCdmb28nLCBmdW5jdGlvbigpIHt9KSxcblxuICAgIGJhcjogY29tcHV0ZWQoZnVuY3Rpb24oKSB7fSksXG5cbiAgICBxdXg6IGFsaWFzKCdmb28nKVxuICB9KTtcblxuICBsZXQgU3ViQ2xhc3MgPSBNeUNsYXNzLmV4dGVuZCh7XG4gICAgYmF6OiBjb21wdXRlZChmdW5jdGlvbigpIHt9KVxuICB9KTtcblxuICBTdWJDbGFzcy5yZW9wZW4oe1xuICAgIGJhdDogY29tcHV0ZWQoZnVuY3Rpb24oKSB7fSkubWV0YSh7IGlBbUJhdDogdHJ1ZSB9KVxuICB9KTtcblxuICBsZXQgbGlzdCA9IFtdO1xuXG4gIE15Q2xhc3MuZWFjaENvbXB1dGVkUHJvcGVydHkoZnVuY3Rpb24obmFtZSkge1xuICAgIGxpc3QucHVzaChuYW1lKTtcbiAgfSk7XG5cbiAgZGVlcEVxdWFsKGxpc3Quc29ydCgpLCBbJ2JhcicsICdmb28nLCAncXV4J10sICd3YXRjaGVkIGFuZCB1bndhdGNoZWQgY29tcHV0ZWQgcHJvcGVydGllcyBhcmUgaXRlcmF0ZWQnKTtcblxuICBsaXN0ID0gW107XG5cbiAgU3ViQ2xhc3MuZWFjaENvbXB1dGVkUHJvcGVydHkoZnVuY3Rpb24obmFtZSwgbWV0YSkge1xuICAgIGxpc3QucHVzaChuYW1lKTtcblxuICAgIGlmIChuYW1lID09PSAnYmF0Jykge1xuICAgICAgZGVlcEVxdWFsKG1ldGEsIHsgaUFtQmF0OiB0cnVlIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWVwRXF1YWwobWV0YSwge30pO1xuICAgIH1cbiAgfSk7XG5cbiAgZGVlcEVxdWFsKGxpc3Quc29ydCgpLCBbJ2JhcicsICdiYXQnLCAnYmF6JywgJ2ZvbycsICdxdXgnXSwgJ2FsbCBpbmhlcml0ZWQgcHJvcGVydGllcyBhcmUgaW5jbHVkZWQnKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdsaXN0IG9mIHByb3BlcnRpZXMgdXBkYXRlcyB3aGVuIGFuIGFkZGl0aW9uYWwgcHJvcGVydHkgaXMgYWRkZWQgKHN1Y2ggY2FjaGUgYnVzdGluZyknLCBmdW5jdGlvbigpIHtcbiAgbGV0IE15Q2xhc3MgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGZvbzogY29tcHV0ZWQoSyksXG5cbiAgICBmb29EaWRDaGFuZ2U6IG9ic2VydmVyKCdmb28nLCBmdW5jdGlvbigpIHt9KSxcblxuICAgIGJhcjogY29tcHV0ZWQoSylcbiAgfSk7XG5cbiAgbGV0IGxpc3QgPSBbXTtcblxuICBNeUNsYXNzLmVhY2hDb21wdXRlZFByb3BlcnR5KGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBsaXN0LnB1c2gobmFtZSk7XG4gIH0pO1xuXG4gIGRlZXBFcXVhbChsaXN0LnNvcnQoKSwgWydiYXInLCAnZm9vJ10uc29ydCgpLCAnZXhwZWN0ZWQgdHdvIGNvbXB1dGVkIHByb3BlcnRpZXMnKTtcblxuICBNeUNsYXNzLnJlb3Blbih7XG4gICAgYmF6OiBjb21wdXRlZChLKVxuICB9KTtcblxuICBNeUNsYXNzLmNyZWF0ZSgpOyAvLyBmb3JjZSBhcHBseSBtaXhpbnNcblxuICBsaXN0ID0gW107XG5cbiAgTXlDbGFzcy5lYWNoQ29tcHV0ZWRQcm9wZXJ0eShmdW5jdGlvbihuYW1lKSB7XG4gICAgbGlzdC5wdXNoKG5hbWUpO1xuICB9KTtcblxuICBkZWVwRXF1YWwobGlzdC5zb3J0KCksIFsnYmFyJywgJ2ZvbycsICdiYXonXS5zb3J0KCksICdleHBlY3RlZCB0aHJlZSBjb21wdXRlZCBwcm9wZXJ0aWVzJyk7XG59KTtcblxuUVVuaXQudGVzdCgnQ2FsbGluZyBfc3VwZXIgaW4gY2FsbCBvdXRzaWRlIHRoZSBpbW1lZGlhdGUgZnVuY3Rpb24gb2YgYSBDUCBnZXR0ZXIgd29ya3MnLCBmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gbWFjcm8oY2FsbGJhY2spIHtcbiAgICByZXR1cm4gY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgICB9KTtcbiAgfVxuXG4gIGxldCBNeUNsYXNzID0gRW1iZXJPYmplY3QuZXh0ZW5kKHtcbiAgICBmb286IGNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuICdGT08nO1xuICAgIH0pXG4gIH0pO1xuXG4gIGxldCBTdWJDbGFzcyA9IE15Q2xhc3MuZXh0ZW5kKHtcbiAgICBmb286IG1hY3JvKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyKCk7XG4gICAgfSlcbiAgfSk7XG5cbiAgZXF1YWwoZW1iZXJHZXQoU3ViQ2xhc3MuY3JlYXRlKCksICdmb28nKSwgJ0ZPTycsICdzdXBlciB2YWx1ZSBpcyBmZXRjaGVkJyk7XG59KTtcblxuUVVuaXQudGVzdCgnQ2FsbGluZyBfc3VwZXIgaW4gYXBwbHkgb3V0c2lkZSB0aGUgaW1tZWRpYXRlIGZ1bmN0aW9uIG9mIGEgQ1AgZ2V0dGVyIHdvcmtzJywgZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIG1hY3JvKGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIGNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrLmFwcGx5KHRoaXMpO1xuICAgIH0pO1xuICB9XG5cbiAgbGV0IE15Q2xhc3MgPSBFbWJlck9iamVjdC5leHRlbmQoe1xuICAgIGZvbzogY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gJ0ZPTyc7XG4gICAgfSlcbiAgfSk7XG5cbiAgbGV0IFN1YkNsYXNzID0gTXlDbGFzcy5leHRlbmQoe1xuICAgIGZvbzogbWFjcm8oZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3VwZXIoKTtcbiAgICB9KVxuICB9KTtcblxuICBlcXVhbChlbWJlckdldChTdWJDbGFzcy5jcmVhdGUoKSwgJ2ZvbycpLCAnRk9PJywgJ3N1cGVyIHZhbHVlIGlzIGZldGNoZWQnKTtcbn0pO1xuIl19