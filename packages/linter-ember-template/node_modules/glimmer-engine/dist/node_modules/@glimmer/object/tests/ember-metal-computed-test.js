"use strict";
var support_1 = require("./support");
var object_1 = require("@glimmer/object");
function K() { return this; }
QUnit.module('Mixin.create - Computed Properties');
QUnit.test('overriding computed properties', function () {
    var MixinA, MixinB, MixinC, MixinD;
    var obj;
    MixinA = support_1.Mixin.create({
        aProp: object_1.computed(function () {
            return 'A';
        })
    });
    MixinB = support_1.Mixin.create({
        aProp: object_1.computed(function () {
            return this._super.apply(this, arguments) + 'B';
        })
    });
    MixinC = support_1.Mixin.create({
        aProp: object_1.computed(function () {
            return this._super.apply(this, arguments) + 'C';
        })
    });
    MixinD = support_1.Mixin.create({
        aProp: object_1.computed(function () {
            return this._super.apply(this, arguments) + 'D';
        })
    });
    obj = {};
    MixinA.apply(obj);
    MixinB.apply(obj);
    equal(support_1.get(obj, 'aProp'), 'AB', 'should expose super for B');
    obj = {};
    MixinA.apply(obj);
    MixinC.apply(obj);
    equal(support_1.get(obj, 'aProp'), 'AC', 'should expose super for C');
    obj = {};
    MixinA.apply(obj);
    MixinD.apply(obj);
    equal(support_1.get(obj, 'aProp'), 'AD', 'should define super for D');
    obj = {};
    support_1.mixin(obj, {
        aProp: object_1.computed(function (key) {
            return 'obj';
        })
    });
    MixinD.apply(obj);
    equal(support_1.get(obj, 'aProp'), 'objD', 'should preserve original computed property');
});
QUnit.test('calling set on overridden computed properties', function () {
    var SuperMixin, SubMixin;
    var obj;
    var superGetOccurred = false;
    var superSetOccurred = false;
    SuperMixin = support_1.Mixin.create({
        aProp: object_1.computed({
            get: function (key) { superGetOccurred = true; },
            set: function (key, value) { superSetOccurred = true; }
        })
    });
    SubMixin = support_1.Mixin.create(SuperMixin, {
        aProp: object_1.computed({
            get: function (key) { return this._super.apply(this, arguments); },
            set: function (key, value) { return this._super.apply(this, arguments); }
        })
    });
    obj = {};
    SubMixin.apply(obj);
    support_1.set(obj, 'aProp', 'set thyself');
    ok(superSetOccurred, 'should pass set to _super');
    superSetOccurred = false; // reset the set assertion
    obj = {};
    SubMixin.apply(obj);
    support_1.get(obj, 'aProp');
    ok(superGetOccurred, 'should pass get to _super');
    support_1.set(obj, 'aProp', 'set thyself');
    ok(superSetOccurred, 'should pass set to _super after getting');
});
QUnit.test('setter behavior works properly when overriding computed properties', function () {
    var obj = {};
    var MixinA = support_1.Mixin.create({
        cpWithSetter2: object_1.computed(K),
        cpWithSetter3: object_1.computed(K),
        cpWithoutSetter: object_1.computed(K)
    });
    var cpWasCalled = false;
    var MixinB = support_1.Mixin.create({
        cpWithSetter2: object_1.computed({
            get: K,
            set: function (k, v) { cpWasCalled = true; }
        }),
        cpWithSetter3: object_1.computed({
            get: K,
            set: function (k, v) { cpWasCalled = true; }
        }),
        cpWithoutSetter: object_1.computed(function (k) {
            cpWasCalled = true;
        })
    });
    MixinA.apply(obj);
    MixinB.apply(obj);
    support_1.set(obj, 'cpWithSetter2', 'test');
    ok(cpWasCalled, 'The computed property setter was called when defined with two args');
    cpWasCalled = false;
    support_1.set(obj, 'cpWithSetter3', 'test');
    ok(cpWasCalled, 'The computed property setter was called when defined with three args');
    cpWasCalled = false;
    support_1.set(obj, 'cpWithoutSetter', 'test');
    equal(support_1.get(obj, 'cpWithoutSetter'), 'test', 'The default setter was called, the value is correct');
    ok(!cpWasCalled, 'The default setter was called, not the CP itself');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1iZXItbWV0YWwtY29tcHV0ZWQtdGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL29iamVjdC90ZXN0cy9lbWJlci1tZXRhbC1jb21wdXRlZC10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxxQ0FBbUQ7QUFDbkQsMENBQTJDO0FBRTNDLGVBQWUsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7QUFFN0IsS0FBSyxDQUFDLE1BQU0sQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO0FBRW5ELEtBQUssQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLEVBQUU7SUFDM0MsSUFBSSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUM7SUFDbkMsSUFBSSxHQUFHLENBQUM7SUFFUixNQUFNLEdBQUcsZUFBSyxDQUFDLE1BQU0sQ0FBQztRQUNwQixLQUFLLEVBQUUsaUJBQVEsQ0FBQztZQUNkLE1BQU0sQ0FBQyxHQUFHLENBQUM7UUFDYixDQUFDLENBQUM7S0FDSCxDQUFDLENBQUM7SUFFSCxNQUFNLEdBQUcsZUFBSyxDQUFDLE1BQU0sQ0FBQztRQUNwQixLQUFLLEVBQUUsaUJBQVEsQ0FBQztZQUNkLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQ2xELENBQUMsQ0FBQztLQUNILENBQUMsQ0FBQztJQUVILE1BQU0sR0FBRyxlQUFLLENBQUMsTUFBTSxDQUFDO1FBQ3BCLEtBQUssRUFBRSxpQkFBUSxDQUFDO1lBQ2QsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDbEQsQ0FBQyxDQUFDO0tBQ0gsQ0FBQyxDQUFDO0lBRUgsTUFBTSxHQUFHLGVBQUssQ0FBQyxNQUFNLENBQUM7UUFDcEIsS0FBSyxFQUFFLGlCQUFRLENBQUM7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QUMsVUFBUyxDQUFDO1lBQ2xDLFdBQVcsR0FBRyxJQUFJLENBQUM7UUFDckIsQ0FBQyxDQUFDO0tBQ0gsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNsQixNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRWxCLGFBQUcsQ0FBQyxHQUFHLEVBQUUsZUFBZSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ2xDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsb0VBQW9FLENBQUMsQ0FBQztJQUN0RixXQUFXLEdBQUcsS0FBSyxDQUFDO0lBRXBCLGFBQUcsQ0FBQyxHQUFHLEVBQUUsZUFBZSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ2xDLEVBQUUsQ0FBQyxXQUFXLEVBQUUsc0VBQXNFLENBQUMsQ0FBQztJQUN4RixXQUFXLEdBQUcsS0FBSyxDQUFDO0lBRXBCLGFBQUcsQ0FBQyxHQUFHLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDcEMsS0FBSyxDQUFDLGFBQUcsQ0FBQyxHQUFHLEVBQUUsaUJBQWlCLENBQUMsRUFBRSxNQUFNLEVBQUUscURBQXFELENBQUMsQ0FBQztJQUNsRyxFQUFFLENBQUMsQ0FBQyxXQUFXLEVBQUUsa0RBQWtELENBQUMsQ0FBQztBQUN2RSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1peGluLCBnZXQsIHNldCwgbWl4aW4gfSBmcm9tICcuL3N1cHBvcnQnO1xuaW1wb3J0IHsgY29tcHV0ZWQgfSBmcm9tICdAZ2xpbW1lci9vYmplY3QnO1xuXG5mdW5jdGlvbiBLKCkgeyByZXR1cm4gdGhpczsgfVxuXG5RVW5pdC5tb2R1bGUoJ01peGluLmNyZWF0ZSAtIENvbXB1dGVkIFByb3BlcnRpZXMnKTtcblxuUVVuaXQudGVzdCgnb3ZlcnJpZGluZyBjb21wdXRlZCBwcm9wZXJ0aWVzJywgZnVuY3Rpb24oKSB7XG4gIGxldCBNaXhpbkEsIE1peGluQiwgTWl4aW5DLCBNaXhpbkQ7XG4gIGxldCBvYmo7XG5cbiAgTWl4aW5BID0gTWl4aW4uY3JlYXRlKHtcbiAgICBhUHJvcDogY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gJ0EnO1xuICAgIH0pXG4gIH0pO1xuXG4gIE1peGluQiA9IE1peGluLmNyZWF0ZSh7XG4gICAgYVByb3A6IGNvbXB1dGVkKGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgKyAnQic7XG4gICAgfSlcbiAgfSk7XG5cbiAgTWl4aW5DID0gTWl4aW4uY3JlYXRlKHtcbiAgICBhUHJvcDogY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSArICdDJztcbiAgICB9KVxuICB9KTtcblxuICBNaXhpbkQgPSBNaXhpbi5jcmVhdGUoe1xuICAgIGFQcm9wOiBjb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpICsgJ0QnO1xuICAgIH0pXG4gIH0pO1xuXG4gIG9iaiA9IHt9O1xuICBNaXhpbkEuYXBwbHkob2JqKTtcbiAgTWl4aW5CLmFwcGx5KG9iaik7XG4gIGVxdWFsKGdldChvYmosICdhUHJvcCcpLCAnQUInLCAnc2hvdWxkIGV4cG9zZSBzdXBlciBmb3IgQicpO1xuXG4gIG9iaiA9IHt9O1xuICBNaXhpbkEuYXBwbHkob2JqKTtcbiAgTWl4aW5DLmFwcGx5KG9iaik7XG4gIGVxdWFsKGdldChvYmosICdhUHJvcCcpLCAnQUMnLCAnc2hvdWxkIGV4cG9zZSBzdXBlciBmb3IgQycpO1xuXG4gIG9iaiA9IHt9O1xuXG4gIE1peGluQS5hcHBseShvYmopO1xuICBNaXhpbkQuYXBwbHkob2JqKTtcbiAgZXF1YWwoZ2V0KG9iaiwgJ2FQcm9wJyksICdBRCcsICdzaG91bGQgZGVmaW5lIHN1cGVyIGZvciBEJyk7XG5cbiAgb2JqID0geyB9O1xuICBtaXhpbihvYmosIHtcbiAgICBhUHJvcDogY29tcHV0ZWQoZnVuY3Rpb24oa2V5KSB7XG4gICAgICByZXR1cm4gJ29iaic7XG4gICAgfSlcbiAgfSk7XG5cbiAgTWl4aW5ELmFwcGx5KG9iaik7XG4gIGVxdWFsKGdldChvYmosICdhUHJvcCcpLCAnb2JqRCcsICdzaG91bGQgcHJlc2VydmUgb3JpZ2luYWwgY29tcHV0ZWQgcHJvcGVydHknKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdjYWxsaW5nIHNldCBvbiBvdmVycmlkZGVuIGNvbXB1dGVkIHByb3BlcnRpZXMnLCBmdW5jdGlvbigpIHtcbiAgbGV0IFN1cGVyTWl4aW4sIFN1Yk1peGluO1xuICBsZXQgb2JqO1xuXG4gIGxldCBzdXBlckdldE9jY3VycmVkID0gZmFsc2U7XG4gIGxldCBzdXBlclNldE9jY3VycmVkID0gZmFsc2U7XG5cbiAgU3VwZXJNaXhpbiA9IE1peGluLmNyZWF0ZSh7XG4gICAgYVByb3A6IGNvbXB1dGVkKHtcbiAgICAgIGdldDogZnVuY3Rpb24oa2V5KSB7IHN1cGVyR2V0T2NjdXJyZWQgPSB0cnVlOyB9LFxuICAgICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7IHN1cGVyU2V0T2NjdXJyZWQgPSB0cnVlOyB9XG4gICAgfSlcbiAgfSk7XG5cbiAgU3ViTWl4aW4gPSBNaXhpbi5jcmVhdGUoU3VwZXJNaXhpbiwge1xuICAgIGFQcm9wOiBjb21wdXRlZCh7XG4gICAgICBnZXQ6IGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfSxcbiAgICAgIHNldDogZnVuY3Rpb24oa2V5LCB2YWx1ZSkgeyByZXR1cm4gdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsgfVxuICAgIH0pXG4gIH0pO1xuXG4gIG9iaiA9IHt9O1xuICBTdWJNaXhpbi5hcHBseShvYmopO1xuXG4gIHNldChvYmosICdhUHJvcCcsICdzZXQgdGh5c2VsZicpO1xuICBvayhzdXBlclNldE9jY3VycmVkLCAnc2hvdWxkIHBhc3Mgc2V0IHRvIF9zdXBlcicpO1xuXG4gIHN1cGVyU2V0T2NjdXJyZWQgPSBmYWxzZTsgLy8gcmVzZXQgdGhlIHNldCBhc3NlcnRpb25cblxuICBvYmogPSB7fTtcbiAgU3ViTWl4aW4uYXBwbHkob2JqKTtcblxuICBnZXQob2JqLCAnYVByb3AnKTtcbiAgb2soc3VwZXJHZXRPY2N1cnJlZCwgJ3Nob3VsZCBwYXNzIGdldCB0byBfc3VwZXInKTtcblxuICBzZXQob2JqLCAnYVByb3AnLCAnc2V0IHRoeXNlbGYnKTtcbiAgb2soc3VwZXJTZXRPY2N1cnJlZCwgJ3Nob3VsZCBwYXNzIHNldCB0byBfc3VwZXIgYWZ0ZXIgZ2V0dGluZycpO1xufSk7XG5cblFVbml0LnRlc3QoJ3NldHRlciBiZWhhdmlvciB3b3JrcyBwcm9wZXJseSB3aGVuIG92ZXJyaWRpbmcgY29tcHV0ZWQgcHJvcGVydGllcycsIGZ1bmN0aW9uKCkge1xuICBsZXQgb2JqID0ge307XG5cbiAgbGV0IE1peGluQSA9IE1peGluLmNyZWF0ZSh7XG4gICAgY3BXaXRoU2V0dGVyMjogY29tcHV0ZWQoSyksXG4gICAgY3BXaXRoU2V0dGVyMzogY29tcHV0ZWQoSyksXG4gICAgY3BXaXRob3V0U2V0dGVyOiBjb21wdXRlZChLKVxuICB9KTtcblxuICBsZXQgY3BXYXNDYWxsZWQgPSBmYWxzZTtcblxuICBsZXQgTWl4aW5CID0gTWl4aW4uY3JlYXRlKHtcbiAgICBjcFdpdGhTZXR0ZXIyOiBjb21wdXRlZCh7XG4gICAgICBnZXQ6IEssXG4gICAgICBzZXQ6IGZ1bmN0aW9uKGssIHYpIHsgY3BXYXNDYWxsZWQgPSB0cnVlOyB9XG4gICAgfSksXG5cbiAgICBjcFdpdGhTZXR0ZXIzOiBjb21wdXRlZCh7XG4gICAgICBnZXQ6IEssXG4gICAgICBzZXQ6IGZ1bmN0aW9uKGssIHYpIHsgY3BXYXNDYWxsZWQgPSB0cnVlOyB9XG4gICAgfSksXG5cbiAgICBjcFdpdGhvdXRTZXR0ZXI6IGNvbXB1dGVkKGZ1bmN0aW9uKGspIHtcbiAgICAgIGNwV2FzQ2FsbGVkID0gdHJ1ZTtcbiAgICB9KVxuICB9KTtcblxuICBNaXhpbkEuYXBwbHkob2JqKTtcbiAgTWl4aW5CLmFwcGx5KG9iaik7XG5cbiAgc2V0KG9iaiwgJ2NwV2l0aFNldHRlcjInLCAndGVzdCcpO1xuICBvayhjcFdhc0NhbGxlZCwgJ1RoZSBjb21wdXRlZCBwcm9wZXJ0eSBzZXR0ZXIgd2FzIGNhbGxlZCB3aGVuIGRlZmluZWQgd2l0aCB0d28gYXJncycpO1xuICBjcFdhc0NhbGxlZCA9IGZhbHNlO1xuXG4gIHNldChvYmosICdjcFdpdGhTZXR0ZXIzJywgJ3Rlc3QnKTtcbiAgb2soY3BXYXNDYWxsZWQsICdUaGUgY29tcHV0ZWQgcHJvcGVydHkgc2V0dGVyIHdhcyBjYWxsZWQgd2hlbiBkZWZpbmVkIHdpdGggdGhyZWUgYXJncycpO1xuICBjcFdhc0NhbGxlZCA9IGZhbHNlO1xuXG4gIHNldChvYmosICdjcFdpdGhvdXRTZXR0ZXInLCAndGVzdCcpO1xuICBlcXVhbChnZXQob2JqLCAnY3BXaXRob3V0U2V0dGVyJyksICd0ZXN0JywgJ1RoZSBkZWZhdWx0IHNldHRlciB3YXMgY2FsbGVkLCB0aGUgdmFsdWUgaXMgY29ycmVjdCcpO1xuICBvayghY3BXYXNDYWxsZWQsICdUaGUgZGVmYXVsdCBzZXR0ZXIgd2FzIGNhbGxlZCwgbm90IHRoZSBDUCBpdHNlbGYnKTtcbn0pO1xuIl19