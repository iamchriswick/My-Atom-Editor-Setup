"use strict";
var object_1 = require("@glimmer/object");
var support_1 = require("./support");
QUnit.module('Mixin.create - mergedProperties');
QUnit.test('defining mergedProperties should merge future version', function () {
    var MixinA = object_1.Mixin.create({
        mergedProperties: ['foo'],
        foo: { a: true, b: true, c: true }
    });
    var MixinB = object_1.Mixin.create({
        foo: { d: true, e: true, f: true }
    });
    var obj = support_1.mixin({}, MixinA, MixinB);
    deepEqual(support_1.get(obj, 'foo'), { a: true, b: true, c: true, d: true, e: true, f: true });
});
QUnit.test('defining mergedProperties on future mixin should merged into past', function () {
    var MixinA = object_1.Mixin.create({
        foo: { a: true, b: true, c: true }
    });
    var MixinB = object_1.Mixin.create({
        mergedProperties: ['foo'],
        foo: { d: true, e: true, f: true }
    });
    var obj = support_1.mixin({}, MixinA, MixinB);
    deepEqual(support_1.get(obj, 'foo'), { a: true, b: true, c: true, d: true, e: true, f: true });
});
QUnit.test('defining mergedProperties with null properties should keep properties null', function () {
    var MixinA = object_1.Mixin.create({
        mergedProperties: ['foo'],
        foo: null
    });
    var MixinB = object_1.Mixin.create({
        foo: null
    });
    var obj = support_1.mixin({}, MixinA, MixinB);
    equal(support_1.get(obj, 'foo'), null);
});
QUnit.test('mergedProperties\' properties can get overwritten', function () {
    var MixinA = object_1.Mixin.create({
        mergedProperties: ['foo'],
        foo: { a: 1 }
    });
    var MixinB = object_1.Mixin.create({
        foo: { a: 2 }
    });
    var obj = support_1.mixin({}, MixinA, MixinB);
    deepEqual(support_1.get(obj, 'foo'), { a: 2 });
});
QUnit.test('mergedProperties should be concatenated', function () {
    var MixinA = object_1.Mixin.create({
        mergedProperties: ['foo'],
        foo: { a: true, b: true, c: true }
    });
    var MixinB = object_1.Mixin.create({
        mergedProperties: 'bar',
        foo: { d: true, e: true, f: true },
        bar: { a: true, l: true }
    });
    var MixinC = object_1.Mixin.create({
        bar: { e: true, x: true }
    });
    var obj = support_1.mixin({}, MixinA, MixinB, MixinC);
    deepEqual(support_1.get(obj, 'mergedProperties'), ['foo', 'bar'], 'get mergedProperties');
    deepEqual(support_1.get(obj, 'foo'), { a: true, b: true, c: true, d: true, e: true, f: true }, 'get foo');
    deepEqual(support_1.get(obj, 'bar'), { a: true, l: true, e: true, x: true }, 'get bar');
});
QUnit.test('mergedProperties should exist even if not explicitly set on create', function () {
    var AnObj = object_1.default.extend({
        mergedProperties: ['options'],
        options: {
            a: 'a',
            b: {
                c: 'ccc'
            }
        }
    });
    var obj = AnObj.create({
        options: {
            a: 'A'
        }
    });
    equal(support_1.get(obj, 'options').a, 'A');
    equal(support_1.get(obj, 'options').b.c, 'ccc');
});
QUnit.test('mergedProperties\' overwriting methods can call _super', function () {
    expect(4);
    var MixinA = object_1.Mixin.create({
        mergedProperties: ['foo'],
        foo: {
            meth: function (a) {
                equal(a, 'WOOT', '_super successfully called MixinA\'s `foo.meth` method');
                return 'WAT';
            }
        }
    });
    var MixinB = object_1.Mixin.create({
        foo: {
            meth: function (a) {
                ok(true, 'MixinB\'s `foo.meth` method called');
                return this._super.apply(this, arguments);
            }
        }
    });
    var MixinC = object_1.Mixin.create({
        foo: {
            meth: function (a) {
                ok(true, 'MixinC\'s `foo.meth` method called');
                return this._super(a);
            }
        }
    });
    var obj = support_1.mixin({}, MixinA, MixinB, MixinC);
    equal(obj.foo.meth('WOOT'), 'WAT');
});
QUnit.test('Merging an Array should raise an error', function (assert) {
    expect(1);
    var MixinA = object_1.Mixin.create({
        mergedProperties: ['foo'],
        foo: { a: true, b: true, c: true }
    });
    var MixinB = object_1.Mixin.create({
        foo: ['a']
    });
    assert.throws(function () {
        support_1.mixin({}, MixinA, MixinB);
    }, /You passed in `\["a"\]` as the value for `foo` but `foo` cannot be an Array/);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1iZXItbWV0YWwtbWVyZ2VkLXByb3BlcnRpZXMtdGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL29iamVjdC90ZXN0cy9lbWJlci1tZXRhbC1tZXJnZWQtcHJvcGVydGllcy10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwwQ0FBcUQ7QUFDckQscUNBQXVDO0FBRXZDLEtBQUssQ0FBQyxNQUFNLENBQUMsaUNBQWlDLENBQUMsQ0FBQztBQUVoRCxLQUFLLENBQUMsSUFBSSxDQUFDLHVEQUF1RCxFQUFFO0lBQ2xFLElBQUksTUFBTSxHQUFHLGNBQUssQ0FBQyxNQUFNLENBQUM7UUFDeEIsZ0JBQWdCLEVBQUUsQ0FBQyxLQUFLLENBQUM7UUFDekIsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUU7S0FDbkMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4QixHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtLQUNuQyxDQUFDLENBQUM7SUFFSCxJQUFJLEdBQUcsR0FBRyxlQUFLLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNwQyxTQUFTLENBQUMsYUFBRyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFDdkIsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFDOUQsQ0FBQyxDQUFDLENBQUM7QUFFSCxLQUFLLENBQUMsSUFBSSxDQUFDLG1FQUFtRSxFQUFFO0lB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QUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN4QixDQUFDO1NBQ0Y7S0FDRixDQUFDLENBQUM7SUFFSCxJQUFJLEdBQUcsR0FBRyxlQUFLLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDNUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ3JDLENBQUMsQ0FBQyxDQUFDO0FBRUgsS0FBSyxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsRUFBRSxVQUFBLE1BQU07SUFDekQsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRVYsSUFBSSxNQUFNLEdBQUcsY0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4QixnQkFBZ0IsRUFBRSxDQUFDLEtBQUssQ0FBQztRQUN6QixHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRTtLQUNuQyxDQUFDLENBQUM7SUFFSCxJQUFJLE1BQU0sR0FBRyxjQUFLLENBQUMsTUFBTSxDQUFDO1FBQ3hCLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQztLQUNYLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDWixlQUFLLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM1QixDQUFDLEVBQUUsNkVBQTZFLENBQUMsQ0FBQztBQUNwRixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBFbWJlck9iamVjdCwgeyBNaXhpbiB9IGZyb20gJ0BnbGltbWVyL29iamVjdCc7XG5pbXBvcnQgeyBnZXQsIG1peGluIH0gZnJvbSAnLi9zdXBwb3J0JztcblxuUVVuaXQubW9kdWxlKCdNaXhpbi5jcmVhdGUgLSBtZXJnZWRQcm9wZXJ0aWVzJyk7XG5cblFVbml0LnRlc3QoJ2RlZmluaW5nIG1lcmdlZFByb3BlcnRpZXMgc2hvdWxkIG1lcmdlIGZ1dHVyZSB2ZXJzaW9uJywgZnVuY3Rpb24oKSB7XG4gIGxldCBNaXhpbkEgPSBNaXhpbi5jcmVhdGUoe1xuICAgIG1lcmdlZFByb3BlcnRpZXM6IFsnZm9vJ10sXG4gICAgZm9vOiB7IGE6IHRydWUsIGI6IHRydWUsIGM6IHRydWUgfVxuICB9KTtcblxuICBsZXQgTWl4aW5CID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb286IHsgZDogdHJ1ZSwgZTogdHJ1ZSwgZjogdHJ1ZSB9XG4gIH0pO1xuXG4gIGxldCBvYmogPSBtaXhpbih7fSwgTWl4aW5BLCBNaXhpbkIpO1xuICBkZWVwRXF1YWwoZ2V0KG9iaiwgJ2ZvbycpLFxuICAgIHsgYTogdHJ1ZSwgYjogdHJ1ZSwgYzogdHJ1ZSwgZDogdHJ1ZSwgZTogdHJ1ZSwgZjogdHJ1ZSB9KTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdkZWZpbmluZyBtZXJnZWRQcm9wZXJ0aWVzIG9uIGZ1dHVyZSBtaXhpbiBzaG91bGQgbWVyZ2VkIGludG8gcGFzdCcsIGZ1bmN0aW9uKCkge1xuICBsZXQgTWl4aW5BID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb286IHsgYTogdHJ1ZSwgYjogdHJ1ZSwgYzogdHJ1ZSB9XG4gIH0pO1xuXG4gIGxldCBNaXhpbkIgPSBNaXhpbi5jcmVhdGUoe1xuICAgIG1lcmdlZFByb3BlcnRpZXM6IFsnZm9vJ10sXG4gICAgZm9vOiB7IGQ6IHRydWUsIGU6IHRydWUsIGY6IHRydWUgfVxuICB9KTtcblxuICBsZXQgb2JqID0gbWl4aW4oe30sIE1peGluQSwgTWl4aW5CKTtcbiAgZGVlcEVxdWFsKGdldChvYmosICdmb28nKSxcbiAgICB7IGE6IHRydWUsIGI6IHRydWUsIGM6IHRydWUsIGQ6IHRydWUsIGU6IHRydWUsIGY6IHRydWUgfSk7XG59KTtcblxuUVVuaXQudGVzdCgnZGVmaW5pbmcgbWVyZ2VkUHJvcGVydGllcyB3aXRoIG51bGwgcHJvcGVydGllcyBzaG91bGQga2VlcCBwcm9wZXJ0aWVzIG51bGwnLCBmdW5jdGlvbigpIHtcbiAgbGV0IE1peGluQSA9IE1peGluLmNyZWF0ZSh7XG4gICAgbWVyZ2VkUHJvcGVydGllczogWydmb28nXSxcbiAgICBmb286IG51bGxcbiAgfSk7XG5cbiAgbGV0IE1peGluQiA9IE1peGluLmNyZWF0ZSh7XG4gICAgZm9vOiBudWxsXG4gIH0pO1xuXG4gIGxldCBvYmogPSBtaXhpbih7fSwgTWl4aW5BLCBNaXhpbkIpO1xuICBlcXVhbChnZXQob2JqLCAnZm9vJyksIG51bGwpO1xufSk7XG5cblFVbml0LnRlc3QoJ21lcmdlZFByb3BlcnRpZXNcXCcgcHJvcGVydGllcyBjYW4gZ2V0IG92ZXJ3cml0dGVuJywgZnVuY3Rpb24oKSB7XG4gIGxldCBNaXhpbkEgPSBNaXhpbi5jcmVhdGUoe1xuICAgIG1lcmdlZFByb3BlcnRpZXM6IFsnZm9vJ10sXG4gICAgZm9vOiB7IGE6IDEgfVxuICB9KTtcblxuICBsZXQgTWl4aW5CID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb286IHsgYTogMiB9XG4gIH0pO1xuXG4gIGxldCBvYmogPSBtaXhpbih7fSwgTWl4aW5BLCBNaXhpbkIpO1xuICBkZWVwRXF1YWwoZ2V0KG9iaiwgJ2ZvbycpLCB7IGE6IDIgfSk7XG59KTtcblxuUVVuaXQudGVzdCgnbWVyZ2VkUHJvcGVydGllcyBzaG91bGQgYmUgY29uY2F0ZW5hdGVkJywgZnVuY3Rpb24oKSB7XG4gIGxldCBNaXhpbkEgPSBNaXhpbi5jcmVhdGUoe1xuICAgIG1lcmdlZFByb3BlcnRpZXM6IFsnZm9vJ10sXG4gICAgZm9vOiB7IGE6IHRydWUsIGI6IHRydWUsIGM6IHRydWUgfVxuICB9KTtcblxuICBsZXQgTWl4aW5CID0gTWl4aW4uY3JlYXRlKHtcbiAgICBtZXJnZWRQcm9wZXJ0aWVzOiAnYmFyJyxcbiAgICBmb286IHsgZDogdHJ1ZSwgZTogdHJ1ZSwgZjogdHJ1ZSB9LFxuICAgIGJhcjogeyBhOiB0cnVlLCBsOiB0cnVlIH1cbiAgfSk7XG5cbiAgbGV0IE1peGluQyA9IE1peGluLmNyZWF0ZSh7XG4gICAgYmFyOiB7IGU6IHRydWUsIHg6IHRydWUgfVxuICB9KTtcblxuICBsZXQgb2JqID0gbWl4aW4oe30sIE1peGluQSwgTWl4aW5CLCBNaXhpbkMpO1xuICBkZWVwRXF1YWwoZ2V0KG9iaiwgJ21lcmdlZFByb3BlcnRpZXMnKSwgWydmb28nLCAnYmFyJ10sICdnZXQgbWVyZ2VkUHJvcGVydGllcycpO1xuICBkZWVwRXF1YWwoZ2V0KG9iaiwgJ2ZvbycpLCB7IGE6IHRydWUsIGI6IHRydWUsIGM6IHRydWUsIGQ6IHRydWUsIGU6IHRydWUsIGY6IHRydWUgfSwgJ2dldCBmb28nKTtcbiAgZGVlcEVxdWFsKGdldChvYmosICdiYXInKSwgeyBhOiB0cnVlLCBsOiB0cnVlLCBlOiB0cnVlLCB4OiB0cnVlIH0sICdnZXQgYmFyJyk7XG59KTtcblxuUVVuaXQudGVzdCgnbWVyZ2VkUHJvcGVydGllcyBzaG91bGQgZXhpc3QgZXZlbiBpZiBub3QgZXhwbGljaXRseSBzZXQgb24gY3JlYXRlJywgZnVuY3Rpb24oKSB7XG4gIGxldCBBbk9iaiA9IEVtYmVyT2JqZWN0LmV4dGVuZCh7XG4gICAgbWVyZ2VkUHJvcGVydGllczogWydvcHRpb25zJ10sXG4gICAgb3B0aW9uczoge1xuICAgICAgYTogJ2EnLFxuICAgICAgYjoge1xuICAgICAgICBjOiAnY2NjJ1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgbGV0IG9iaiA9IEFuT2JqLmNyZWF0ZSh7XG4gICAgb3B0aW9uczoge1xuICAgICAgYTogJ0EnXG4gICAgfVxuICB9KTtcblxuICBlcXVhbChnZXQob2JqLCAnb3B0aW9ucycpLmEsICdBJyk7XG4gIGVxdWFsKGdldChvYmosICdvcHRpb25zJykuYi5jLCAnY2NjJyk7XG59KTtcblxuUVVuaXQudGVzdCgnbWVyZ2VkUHJvcGVydGllc1xcJyBvdmVyd3JpdGluZyBtZXRob2RzIGNhbiBjYWxsIF9zdXBlcicsIGZ1bmN0aW9uKCkge1xuICBleHBlY3QoNCk7XG5cbiAgbGV0IE1peGluQSA9IE1peGluLmNyZWF0ZSh7XG4gICAgbWVyZ2VkUHJvcGVydGllczogWydmb28nXSxcbiAgICBmb286IHtcbiAgICAgIG1ldGgoYSkge1xuICAgICAgICBlcXVhbChhLCAnV09PVCcsICdfc3VwZXIgc3VjY2Vzc2Z1bGx5IGNhbGxlZCBNaXhpbkFcXCdzIGBmb28ubWV0aGAgbWV0aG9kJyk7XG4gICAgICAgIHJldHVybiAnV0FUJztcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGxldCBNaXhpbkIgPSBNaXhpbi5jcmVhdGUoe1xuICAgIGZvbzoge1xuICAgICAgbWV0aChhKSB7XG4gICAgICAgIG9rKHRydWUsICdNaXhpbkJcXCdzIGBmb28ubWV0aGAgbWV0aG9kIGNhbGxlZCcpO1xuICAgICAgICByZXR1cm4gdGhpcy5fc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGxldCBNaXhpbkMgPSBNaXhpbi5jcmVhdGUoe1xuICAgIGZvbzoge1xuICAgICAgbWV0aChhKSB7XG4gICAgICAgIG9rKHRydWUsICdNaXhpbkNcXCdzIGBmb28ubWV0aGAgbWV0aG9kIGNhbGxlZCcpO1xuICAgICAgICByZXR1cm4gdGhpcy5fc3VwZXIoYSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBsZXQgb2JqID0gbWl4aW4oe30sIE1peGluQSwgTWl4aW5CLCBNaXhpbkMpO1xuICBlcXVhbChvYmouZm9vLm1ldGgoJ1dPT1QnKSwgJ1dBVCcpO1xufSk7XG5cblFVbml0LnRlc3QoJ01lcmdpbmcgYW4gQXJyYXkgc2hvdWxkIHJhaXNlIGFuIGVycm9yJywgYXNzZXJ0ID0+IHtcbiAgZXhwZWN0KDEpO1xuXG4gIGxldCBNaXhpbkEgPSBNaXhpbi5jcmVhdGUoe1xuICAgIG1lcmdlZFByb3BlcnRpZXM6IFsnZm9vJ10sXG4gICAgZm9vOiB7IGE6IHRydWUsIGI6IHRydWUsIGM6IHRydWUgfVxuICB9KTtcblxuICBsZXQgTWl4aW5CID0gTWl4aW4uY3JlYXRlKHtcbiAgICBmb286IFsnYSddXG4gIH0pO1xuXG4gIGFzc2VydC50aHJvd3MoZnVuY3Rpb24oKSB7XG4gICAgbWl4aW4oe30sIE1peGluQSwgTWl4aW5CKTtcbiAgfSwgL1lvdSBwYXNzZWQgaW4gYFxcW1wiYVwiXFxdYCBhcyB0aGUgdmFsdWUgZm9yIGBmb29gIGJ1dCBgZm9vYCBjYW5ub3QgYmUgYW4gQXJyYXkvKTtcbn0pO1xuIl19