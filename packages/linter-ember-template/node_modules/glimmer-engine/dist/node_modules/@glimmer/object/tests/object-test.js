"use strict";
var object_1 = require("@glimmer/object");
var object_reference_1 = require("@glimmer/object-reference");
var Wrapper = object_1.default.extend({
    fullName: object_1.computed(function () {
        return this.model && this.model.fullName;
    }).property('model.fullName')
});
var Model = object_1.default.extend({
    fullName: object_1.computed(function () {
        return this.person && this.person.fullName;
    }).property('person.fullName')
});
var Person = object_1.default.extend({
    fullName: object_1.computed(function () {
        return this.name && this.name.fullName;
    }).property('name.fullName')
});
var Name = object_1.default.extend({
    fullName: object_1.computed(function () {
        return this.first + " " + this.last;
    }).property('first', 'last')
});
QUnit.module('the object model');
QUnit.test('the simple object model allows you to derive references', function () {
    var obj1 = new Wrapper({
        model: new Model({
            person: new Person({
                name: new Name({ first: "Yehuda", last: "Katz" })
            })
        })
    });
    var originalPerson = obj1.model.person;
    var obj2 = new Wrapper({
        model: new Model({
            person: new Person({
                name: obj1.model.person.name
            })
        })
    });
    var obj3 = new Wrapper({
        model: new Model({
            person: obj1.model.person
        })
    });
    var obj4 = new Wrapper({
        model: obj1.model
    });
    var o1 = referencesFor(obj1);
    var o2 = referencesFor(obj2);
    var o3 = referencesFor(obj3);
    var o4 = referencesFor(obj4);
    allDirty(o1, "Yehuda");
    allDirty(o2, "Yehuda");
    allDirty(o3, "Yehuda");
    allDirty(o4, "Yehuda");
    allClean(o1);
    allClean(o2);
    allClean(o3);
    allClean(o4);
    object_reference_1.setProperty(obj1.model, 'person', new Person({ name: new Name({ first: 'Godfrey', last: 'Chan' }) }));
    isDirty(o1[0], "Godfrey");
    isDirty(o1[1], "Godfrey");
    isClean(o1[2]);
    isClean(o1[3]);
    allClean(o2);
    allClean(o3);
    isDirty(o4[0], "Godfrey");
    isDirty(o4[1], "Godfrey");
    isClean(o4[2]);
    isClean(o4[3]);
    object_reference_1.setProperty(originalPerson.name, 'first', "Godhuda");
    isClean(o1[0]);
    isClean(o1[1]);
    isDirty(o1[2], "Godhuda");
    isDirty(o1[3], "Godhuda");
    allDirty(o2, "Godhuda");
    allDirty(o3, "Godhuda");
    isClean(o4[0]);
    isClean(o4[1]);
    isDirty(o4[2], "Godhuda");
    isDirty(o4[3], "Godhuda");
    object_reference_1.setProperty(obj1.model, 'person', undefined);
    isDirty(o1[0], undefined);
    isDirty(o1[1], undefined);
    isClean(o1[2]);
    isClean(o1[3]);
    allClean(o2);
    allClean(o3);
    isDirty(o4[0], undefined);
    isDirty(o4[1], undefined);
    isClean(o4[2]);
    isClean(o4[3]);
    object_reference_1.setProperty(obj1.model, 'person', originalPerson);
    isDirty(o1[0], "Godhuda");
    isDirty(o1[1], "Godhuda");
    isClean(o1[2]);
    isClean(o1[3]);
    allClean(o2);
    allClean(o3);
    isDirty(o4[0], "Godhuda");
    isDirty(o4[1], "Godhuda");
    isClean(o4[2]);
    isClean(o4[3]);
    function referencesFor(obj) {
        return [
            root(obj).path('model.person.name.first'),
            root(obj.model).path('person.name.first'),
            root(obj.model.person).path('name.first'),
            root(obj.model.person.name).path('first'),
        ];
    }
});
function root(obj) {
    return object_reference_1.metaFor(obj).root();
}
QUnit.test("Simple computed properties", function () {
    var name = new Name({ first: "Godfrey", last: "Chan" });
    var ref = object_reference_1.metaFor(name).root().get('fullName');
    equal(name.fullName, "Godfrey Chan");
    equal(ref.value(), "Godfrey Chan");
    isClean(ref);
    object_reference_1.setProperty(name, 'first', "Godhuda");
    isDirty(ref, 'Godhuda Chan');
    equal(name.fullName, "Godhuda Chan");
    equal(ref.value(), "Godhuda Chan");
    isClean(ref);
});
QUnit.test("Computed properties", function () {
    var obj1 = new Wrapper({
        model: new Model({
            person: new Person({
                name: new Name({ first: "Yehuda", last: "Katz" })
            })
        })
    });
    var originalPerson = obj1.model.person;
    var ref = object_reference_1.metaFor(obj1).root().get('fullName');
    equal(obj1.fullName, "Yehuda Katz");
    equal(ref.value(), "Yehuda Katz");
    isClean(ref);
    object_reference_1.setProperty(obj1.model, 'person', new Person({ name: new Name({ first: 'Godfrey', last: 'Chan' }) }));
    isDirty(ref, "Godfrey Chan");
    equal(obj1.fullName, "Godfrey Chan");
    equal(ref.value(), "Godfrey Chan");
    isClean(ref);
    object_reference_1.setProperty(originalPerson.name, 'first', "Godhuda");
    isDirty(ref, "Godfrey Chan");
    equal(obj1.fullName, "Godfrey Chan");
    equal(ref.value(), "Godfrey Chan");
    isClean(ref);
    object_reference_1.setProperty(obj1.model, 'person', undefined);
    isDirty(ref, undefined);
    equal(obj1.fullName, undefined);
    equal(ref.value(), undefined);
    isClean(ref);
    object_reference_1.setProperty(obj1.model, 'person', originalPerson);
    isDirty(ref, "Godhuda Katz");
    equal(obj1.fullName, "Godhuda Katz");
    equal(ref.value(), "Godhuda Katz");
    isClean(ref);
});
function isDirty(ref, newValue) {
    ok(ref.value() === newValue, ref.label() + " has new value " + newValue);
}
function isClean(ref) {
    // clean references are allowed to report dirty
}
function allDirty(refs, newValue) {
    refs.forEach(function (ref) { isDirty(ref, newValue); });
}
function allClean(refs) {
    refs.forEach(function (ref) { isClean(ref); });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JqZWN0LXRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJAZ2xpbW1lci9vYmplY3QvdGVzdHMvb2JqZWN0LXRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDBDQUEwRDtBQUMxRCw4REFBcUY7QUFFckYsSUFBSSxPQUFPLEdBQVEsZ0JBQWEsQ0FBQyxNQUFNLENBQUM7SUFDdEMsUUFBUSxFQUFFLGlCQUFRLENBQUM7UUFDakIsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUM7SUFDM0MsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDO0NBQzlCLENBQUMsQ0FBQztBQUVILElBQUksS0FBSyxHQUFHLGdCQUFhLENBQUMsTUFBTSxDQUFDO0lBQy9CLFFBQVEsRUFBRSxpQkFBUSxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO0lBQzdDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQztDQUMvQixDQUFDLENBQUM7QUFFSCxJQUFJLE1BQU0sR0FBRyxnQkFBYSxDQUFDLE1BQU0sQ0FBQztJQUNoQyxRQUFRLEVBQUUsaUJBQVEsQ0FBQztRQUNqQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN6QyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDO0NBQzdCLENBQUMsQ0FBQztBQUVILElBQUksSUFBSSxHQUFHLGdCQUFhLENBQUMsTUFBTSxDQUFDO0lBQzlCLFFBQVEsRUFBRSxpQkFBUSxDQUFDO1FBQ2pCLE1BQU0sQ0FBSSxJQUFJLENBQUMsS0FBSyxTQUFJLElBQUksQ0FBQyxJQUFNLENBQUM7SUFDdEMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUM7Q0FDN0IsQ0FBQyxDQUFDO0FBRUgsS0FBSyxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBRWpDLEtBQUssQ0FBQyxJQUFJLENBQUMseURBQXlELEVBQUU7SUFDcEUsSUFBSSxJQUFJLEdBQUcsSUFBSSxPQUFPLENBQUM7UUFDckIsS0FBSyxFQUFFLElBQUksS0FBSyxDQUFDO1lBQ2YsTUFBTSxFQUFFLElBQUksTUFBTSxDQUFDO2dCQUNqQixJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUMsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQzthQUNsRCxDQUFDO1NBQ0gsQ0FBQztLQUNILENBQUMsQ0FBQztJQUVILElBQUksY0FBYyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO0lBRXZDLElBQUksSUFBSSxHQUFHLElBQUksT0FBTyxDQUFDO1FBQ3JCLEtBQUssRUFBRSxJQUFJLEtBQUssQ0FBQztZQUNmLE1BQU0sRUFBRSxJQUFJLE1BQU0sQ0FBQztnQkFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUk7YUFDN0IsQ0FBQztTQUNILENBQUM7S0FDSCxDQUFDLENBQUM7SUFFSCxJQUFJLElBQUksR0FBRyxJQUFJLE9BQU8sQ0FBQztRQUNyQixLQUFLLEVBQUUsSUFBSSxLQUFLLENBQUM7WUFDZixNQUFNLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNO1NBQzFCLENBQUM7S0FDSCxDQUFDLENBQUM7SUFFSCxJQUFJLElBQUksR0FBRyxJQUFJLE9BQU8sQ0FBQztRQUNyQixLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUs7S0FDbEIsQ0FBQyxDQUFDO0lBRUgsSUFBSSxFQUFFLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdCLElBQUksRUFBRSxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3QixJQUFJLEVBQUUsR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsSUFBSSxFQUFFLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTdCLFFBQVEsQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDdkIsUUFBUSxDQUFDLEVBQUUsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN2QixRQUFRLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3ZCLFFBQVEsQ0FBQyxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFFdkIsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2IsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2IsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2IsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBRWIsOEJBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFdEcsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUMxQixPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQzFCLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNmLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUVmLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNiLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUViLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDMUIsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUMxQixPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMs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UUFBUTtJQUM5QixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVMsR0FBRyxJQUFJLE9BQU8sQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMxRCxDQUFDO0FBRUQsa0JBQWtCLElBQUk7SUFDcEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFTLEdBQUcsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNoRCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEdsaW1tZXJPYmplY3QsIHsgY29tcHV0ZWQgfSBmcm9tICdAZ2xpbW1lci9vYmplY3QnO1xuaW1wb3J0IHsgVXBkYXRhYmxlUmVmZXJlbmNlLCBtZXRhRm9yLCBzZXRQcm9wZXJ0eSB9IGZyb20gJ0BnbGltbWVyL29iamVjdC1yZWZlcmVuY2UnO1xuXG5sZXQgV3JhcHBlciA9IDxhbnk+R2xpbW1lck9iamVjdC5leHRlbmQoe1xuICBmdWxsTmFtZTogY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwgJiYgdGhpcy5tb2RlbC5mdWxsTmFtZTtcbiAgfSkucHJvcGVydHkoJ21vZGVsLmZ1bGxOYW1lJylcbn0pO1xuXG5sZXQgTW9kZWwgPSBHbGltbWVyT2JqZWN0LmV4dGVuZCh7XG4gIGZ1bGxOYW1lOiBjb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5wZXJzb24gJiYgdGhpcy5wZXJzb24uZnVsbE5hbWU7XG4gIH0pLnByb3BlcnR5KCdwZXJzb24uZnVsbE5hbWUnKVxufSk7XG5cbmxldCBQZXJzb24gPSBHbGltbWVyT2JqZWN0LmV4dGVuZCh7XG4gIGZ1bGxOYW1lOiBjb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5uYW1lICYmIHRoaXMubmFtZS5mdWxsTmFtZTtcbiAgfSkucHJvcGVydHkoJ25hbWUuZnVsbE5hbWUnKVxufSk7XG5cbmxldCBOYW1lID0gR2xpbW1lck9iamVjdC5leHRlbmQoe1xuICBmdWxsTmFtZTogY29tcHV0ZWQoZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIGAke3RoaXMuZmlyc3R9ICR7dGhpcy5sYXN0fWA7XG4gIH0pLnByb3BlcnR5KCdmaXJzdCcsICdsYXN0Jylcbn0pO1xuXG5RVW5pdC5tb2R1bGUoJ3RoZSBvYmplY3QgbW9kZWwnKTtcblxuUVVuaXQudGVzdCgndGhlIHNpbXBsZSBvYmplY3QgbW9kZWwgYWxsb3dzIHlvdSB0byBkZXJpdmUgcmVmZXJlbmNlcycsIGZ1bmN0aW9uKCkge1xuICBsZXQgb2JqMSA9IG5ldyBXcmFwcGVyKHtcbiAgICBtb2RlbDogbmV3IE1vZGVsKHtcbiAgICAgIHBlcnNvbjogbmV3IFBlcnNvbih7XG4gICAgICAgIG5hbWU6IG5ldyBOYW1lKHsgZmlyc3Q6IFwiWWVodWRhXCIsIGxhc3Q6IFwiS2F0elwiIH0pXG4gICAgICB9KVxuICAgIH0pXG4gIH0pO1xuXG4gIGxldCBvcmlnaW5hbFBlcnNvbiA9IG9iajEubW9kZWwucGVyc29uO1xuXG4gIGxldCBvYmoyID0gbmV3IFdyYXBwZXIoe1xuICAgIG1vZGVsOiBuZXcgTW9kZWwoe1xuICAgICAgcGVyc29uOiBuZXcgUGVyc29uKHtcbiAgICAgICAgbmFtZTogb2JqMS5tb2RlbC5wZXJzb24ubmFtZVxuICAgICAgfSlcbiAgICB9KVxuICB9KTtcblxuICBsZXQgb2JqMyA9IG5ldyBXcmFwcGVyKHtcbiAgICBtb2RlbDogbmV3IE1vZGVsKHtcbiAgICAgIHBlcnNvbjogb2JqMS5tb2RlbC5wZXJzb25cbiAgICB9KVxuICB9KTtcblxuICBsZXQgb2JqNCA9IG5ldyBXcmFwcGVyKHtcbiAgICBtb2RlbDogb2JqMS5tb2RlbFxuICB9KTtcblxuICBsZXQgbzEgPSByZWZlcmVuY2VzRm9yKG9iajEpO1xuICBsZXQgbzIgPSByZWZlcmVuY2VzRm9yKG9iajIpO1xuICBsZXQgbzMgPSByZWZlcmVuY2VzRm9yKG9iajMpO1xuICBsZXQgbzQgPSByZWZlcmVuY2VzRm9yKG9iajQpO1xuXG4gIGFsbERpcnR5KG8xLCBcIlllaHVkYVwiKTtcbiAgYWxsRGlydHkobzIsIFwiWWVodWRhXCIpO1xuICBhbGxEaXJ0eShvMywgXCJZZWh1ZGFcIik7XG4gIGFsbERpcnR5KG80LCBcIlllaHVkYVwiKTtcblxuICBhbGxDbGVhbihvMSk7XG4gIGFsbENsZWFuKG8yKTtcbiAgYWxsQ2xlYW4obzMpO1xuICBhbGxDbGVhbihvNCk7XG5cbiAgc2V0UHJvcGVydHkob2JqMS5tb2RlbCwgJ3BlcnNvbicsIG5ldyBQZXJzb24oeyBuYW1lOiBuZXcgTmFtZSh7IGZpcnN0OiAnR29kZnJleScsIGxhc3Q6ICdDaGFuJyB9KSB9KSk7XG5cbiAgaXNEaXJ0eShvMVswXSwgXCJHb2RmcmV5XCIpO1xuICBpc0RpcnR5KG8xWzFdLCBcIkdvZGZyZXlcIik7XG4gIGlzQ2xlYW4obzFbMl0pO1xuICBpc0NsZWFuKG8xWzNdKTtcblxuICBhbGxDbGVhbihvMik7XG4gIGFsbENsZWFuKG8zKTtcblxuICBpc0RpcnR5KG80WzBdLCBcIkdvZGZyZXlcIik7XG4gIGlzRGlydHkobzRbMV0sIFwiR29kZnJleVwiKTtcbiAgaXNDbGVhbihvNFsyXSk7XG4gIGlzQ2xlYW4obzRbM10pO1xuXG4gIHNldFByb3BlcnR5KG9yaWdpbmFsUGVyc29uLm5hbWUsICdmaXJzdCcsIFwiR29kaHVkYVwiKTtcblxuICBpc0NsZWFuKG8xWzBdKTtcbiAgaXNDbGVhbihvMVsxXSk7XG4gIGlzRGlydHkobzFbMl0sIFwiR29kaHVkYVwiKTtcbiAgaXNEaXJ0eShvMVszXSwgXCJHb2RodWRhXCIpO1xuXG4gIGFsbERpcnR5KG8yLCBcIkdvZGh1ZGFcIik7XG4gIGFsbERpcnR5KG8zLCBcIkdvZGh1ZGFcIik7XG5cbiAgaXNDbGVhbihvNFswXSk7XG4gIGlzQ2xlYW4obzRbMV0pO1xuICBpc0RpcnR5KG80WzJdLCBcIkdvZGh1ZGFcIik7XG4gIGlzRGlydHkobzRbM10sIFwiR29kaHVkYVwiKTtcblxuICBzZXRQcm9wZXJ0eShvYmoxLm1vZGVsLCAncGVyc29uJywgdW5kZWZpbmVkKTtcblxuICBpc0RpcnR5KG8xWzBdLCB1bmRlZmluZWQpO1xuICBpc0RpcnR5KG8xWzFdLCB1bmRlZmluZWQpO1xuICBpc0NsZWFuKG8xWzJdKTtcbiAgaXNDbGVhbihvMVszXSk7XG5cbiAgYWxsQ2xlYW4obzIpO1xuICBhbGxDbGVhbihvMyk7XG5cbiAgaXNEaXJ0eShvNFswXSwgdW5kZWZpbmVkKTtcbiAgaXNEaXJ0eShvNFsxXSwgdW5kZWZpbmVkKTtcbiAgaXNDbGVhbihvNFsyXSk7XG4gIGlzQ2xlYW4obzRbM10pO1xuXG4gIHNldFByb3BlcnR5KG9iajEubW9kZWwsICdwZXJzb24nLCBvcmlnaW5hbFBlcnNvbik7XG5cbiAgaXNEaXJ0eShvMVswXSwgXCJHb2RodWRhXCIpO1xuICBpc0RpcnR5KG8xWzFdLCBcIkdvZGh1ZGFcIik7XG4gIGlzQ2xlYW4obzFbMl0pO1xuICBpc0NsZWFuKG8xWzNdKTtcblxuICBhbGxDbGVhbihvMik7XG4gIGFsbENsZWFuKG8zKTtcblxuICBpc0RpcnR5KG80WzBdLCBcIkdvZGh1ZGFcIik7XG4gIGlzRGlydHkobzRbMV0sIFwiR29kaHVkYVwiKTtcbiAgaXNDbGVhbihvNFsyXSk7XG4gIGlzQ2xlYW4obzRbM10pO1xuXG4gIGZ1bmN0aW9uIHJlZmVyZW5jZXNGb3Iob2JqKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHJvb3Qob2JqKS5wYXRoKCdtb2RlbC5wZXJzb24ubmFtZS5maXJzdCcpLFxuICAgICAgcm9vdChvYmoubW9kZWwpLnBhdGgoJ3BlcnNvbi5uYW1lLmZpcnN0JyksXG4gICAgICByb290KG9iai5tb2RlbC5wZXJzb24pLnBhdGgoJ25hbWUuZmlyc3QnKSxcbiAgICAgIHJvb3Qob2JqLm1vZGVsLnBlcnNvbi5uYW1lKS5wYXRoKCdmaXJzdCcpLFxuICAgIF07XG4gIH1cbn0pO1xuXG5mdW5jdGlvbiByb290PFQ+KG9iajogVCk6IFVwZGF0YWJsZVJlZmVyZW5jZTxUPiB7XG4gIHJldHVybiBtZXRhRm9yKG9iaikucm9vdCgpIGFzIFVwZGF0YWJsZVJlZmVyZW5jZTxUPjtcbn1cblxuUVVuaXQudGVzdChcIlNpbXBsZSBjb21wdXRlZCBwcm9wZXJ0aWVzXCIsIGZ1bmN0aW9uKCkge1xuICBsZXQgbmFtZSA9IDxhbnk+bmV3IE5hbWUoeyBmaXJzdDogXCJHb2RmcmV5XCIsIGxhc3Q6IFwiQ2hhblwiIH0pO1xuXG4gIGxldCByZWYgPSBtZXRhRm9yKG5hbWUpLnJvb3QoKS5nZXQoJ2Z1bGxOYW1lJyk7XG5cbiAgZXF1YWwobmFtZS5mdWxsTmFtZSwgXCJHb2RmcmV5IENoYW5cIik7XG4gIGVxdWFsKHJlZi52YWx1ZSgpLCBcIkdvZGZyZXkgQ2hhblwiKTtcbiAgaXNDbGVhbihyZWYpO1xuXG4gIHNldFByb3BlcnR5KG5hbWUsICdmaXJzdCcsIFwiR29kaHVkYVwiKTtcbiAgaXNEaXJ0eShyZWYsICdHb2RodWRhIENoYW4nKTtcblxuICBlcXVhbChuYW1lLmZ1bGxOYW1lLCBcIkdvZGh1ZGEgQ2hhblwiKTtcbiAgZXF1YWwocmVmLnZhbHVlKCksIFwiR29kaHVkYSBDaGFuXCIpO1xuICBpc0NsZWFuKHJlZik7XG59KTtcblxuUVVuaXQudGVzdChcIkNvbXB1dGVkIHByb3BlcnRpZXNcIiwgZnVuY3Rpb24oKSB7XG4gIGxldCBvYmoxID0gbmV3IFdyYXBwZXIoe1xuICAgIG1vZGVsOiBuZXcgTW9kZWwoe1xuICAgICAgcGVyc29uOiBuZXcgUGVyc29uKHtcbiAgICAgICAgbmFtZTogbmV3IE5hbWUoeyBmaXJzdDogXCJZZWh1ZGFcIiwgbGFzdDogXCJLYXR6XCIgfSlcbiAgICAgIH0pXG4gICAgfSlcbiAgfSk7XG5cbiAgbGV0IG9yaWdpbmFsUGVyc29uID0gb2JqMS5tb2RlbC5wZXJzb247XG4gIGxldCByZWYgPSBtZXRhRm9yKG9iajEpLnJvb3QoKS5nZXQoJ2Z1bGxOYW1lJyk7XG5cbiAgZXF1YWwob2JqMS5mdWxsTmFtZSwgXCJZZWh1ZGEgS2F0elwiKTtcbiAgZXF1YWwocmVmLnZhbHVlKCksIFwiWWVodWRhIEthdHpcIik7XG4gIGlzQ2xlYW4ocmVmKTtcblxuICBzZXRQcm9wZXJ0eShvYmoxLm1vZGVsLCAncGVyc29uJywgbmV3IFBlcnNvbih7IG5hbWU6IG5ldyBOYW1lKHsgZmlyc3Q6ICdHb2RmcmV5JywgbGFzdDogJ0NoYW4nIH0pIH0pKTtcbiAgaXNEaXJ0eShyZWYsIFwiR29kZnJleSBDaGFuXCIpO1xuICBlcXVhbChvYmoxLmZ1bGxOYW1lLCBcIkdvZGZyZXkgQ2hhblwiKTtcbiAgZXF1YWwocmVmLnZhbHVlKCksIFwiR29kZnJleSBDaGFuXCIpO1xuICBpc0NsZWFuKHJlZik7XG5cbiAgc2V0UHJvcGVydHkob3JpZ2luYWxQZXJzb24ubmFtZSwgJ2ZpcnN0JywgXCJHb2RodWRhXCIpO1xuICBpc0RpcnR5KHJlZiwgXCJHb2RmcmV5IENoYW5cIik7XG4gIGVxdWFsKG9iajEuZnVsbE5hbWUsIFwiR29kZnJleSBDaGFuXCIpO1xuICBlcXVhbChyZWYudmFsdWUoKSwgXCJHb2RmcmV5IENoYW5cIik7XG4gIGlzQ2xlYW4ocmVmKTtcblxuICBzZXRQcm9wZXJ0eShvYmoxLm1vZGVsLCAncGVyc29uJywgdW5kZWZpbmVkKTtcbiAgaXNEaXJ0eShyZWYsIHVuZGVmaW5lZCk7XG4gIGVxdWFsKG9iajEuZnVsbE5hbWUsIHVuZGVmaW5lZCk7XG4gIGVxdWFsKHJlZi52YWx1ZSgpLCB1bmRlZmluZWQpO1xuICBpc0NsZWFuKHJlZik7XG5cbiAgc2V0UHJvcGVydHkob2JqMS5tb2RlbCwgJ3BlcnNvbicsIG9yaWdpbmFsUGVyc29uKTtcbiAgaXNEaXJ0eShyZWYsIFwiR29kaHVkYSBLYXR6XCIpO1xuICBlcXVhbChvYmoxLmZ1bGxOYW1lLCBcIkdvZGh1ZGEgS2F0elwiKTtcbiAgZXF1YWwocmVmLnZhbHVlKCksIFwiR29kaHVkYSBLYXR6XCIpO1xuICBpc0NsZWFuKHJlZik7XG59KTtcblxuZnVuY3Rpb24gaXNEaXJ0eShyZWYsIG5ld1ZhbHVlKSB7XG4gIG9rKHJlZi52YWx1ZSgpID09PSBuZXdWYWx1ZSwgcmVmLmxhYmVsKCkgKyBcIiBoYXMgbmV3IHZhbHVlIFwiICsgbmV3VmFsdWUpO1xufVxuXG5mdW5jdGlvbiBpc0NsZWFuKHJlZikge1xuICAvLyBjbGVhbiByZWZlcmVuY2VzIGFyZSBhbGxvd2VkIHRvIHJlcG9ydCBkaXJ0eVxufVxuXG5mdW5jdGlvbiBhbGxEaXJ0eShyZWZzLCBuZXdWYWx1ZSkge1xuICByZWZzLmZvckVhY2goZnVuY3Rpb24ocmVmKSB7IGlzRGlydHkocmVmLCBuZXdWYWx1ZSk7IH0pO1xufVxuXG5mdW5jdGlvbiBhbGxDbGVhbihyZWZzKSB7XG4gIHJlZnMuZm9yRWFjaChmdW5jdGlvbihyZWYpIHsgaXNDbGVhbihyZWYpOyB9KTtcbn1cbiJdfQ==