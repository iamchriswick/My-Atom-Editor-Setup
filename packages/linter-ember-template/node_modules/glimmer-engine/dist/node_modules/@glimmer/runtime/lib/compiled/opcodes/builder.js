"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var content = require("./content");
var vm = require("./vm");
var has_block_1 = require("../../compiled/expressions/has-block");
var util_1 = require("@glimmer/util");
var functions_1 = require("../../syntax/functions");
var expressions_1 = require("../expressions");
var compiler_1 = require("../../compiler");
var opcodes_1 = require("../../opcodes");
function appendOpcode(name, op1, op2, op3) {
    return opcodes_1.APPEND_OPCODES.construct(name, null, op1, op2, op3);
}
var Labels = (function () {
    function Labels() {
        this.labels = util_1.dict();
        this.jumps = [];
        this.ranges = [];
    }
    Labels.prototype.label = function (name, index) {
        this.labels[name] = index;
    };
    Labels.prototype.jump = function (at, Target, target) {
        this.jumps.push({ at: at, target: target, Target: Target });
    };
    Labels.prototype.range = function (at, Range, start, end) {
        this.ranges.push({ at: at, start: start, end: end, Range: Range });
    };
    Labels.prototype.patch = function (constants, opcodes) {
        for (var i = 0; i < this.jumps.length; i++) {
            var _a = this.jumps[i], at = _a.at, target = _a.target, Target = _a.Target;
            opcodes.set(at, opcodes_1.APPEND_OPCODES.construct(Target, null, this.labels[target]));
        }
        for (var i = 0; i < this.ranges.length; i++) {
            var _b = this.ranges[i], at = _b.at, start = _b.start, end = _b.end, Range = _b.Range;
            var slice = constants.slice([this.labels[start], this.labels[end] - 1]);
            opcodes.set(at, opcodes_1.APPEND_OPCODES.construct(Range, null, slice));
        }
    };
    return Labels;
}());
var BasicOpcodeBuilder = (function () {
    function BasicOpcodeBuilder(symbolTable, env, program) {
        this.symbolTable = symbolTable;
        this.env = env;
        this.program = program;
        this.labelsStack = new util_1.Stack();
        this.constants = env.constants;
        this.start = program.next;
    }
    Object.defineProperty(BasicOpcodeBuilder.prototype, "pos", {
        get: function () {
            return this.program.current;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BasicOpcodeBuilder.prototype, "nextPos", {
        get: function () {
            return this.program.next;
        },
        enumerable: true,
        configurable: true
    });
    BasicOpcodeBuilder.prototype.opcode = function (name, op1, op2, op3) {
        this.push(appendOpcode(name, op1, op2, op3));
    };
    BasicOpcodeBuilder.prototype.push = function (op) {
        // console.log(`pushing ${op && op.type}`);
        if (op === null) {
            this.program.push([0, 0, 0, 0]);
        }
        else {
            this.program.push(op);
        }
    };
    BasicOpcodeBuilder.prototype.toSlice = function () {
        return [this.start, this.program.current];
    };
    Object.defineProperty(BasicOpcodeBuilder.prototype, "labels", {
        // helpers
        get: function () {
            return util_1.expect(this.labelsStack.current, 'bug: not in a label stack');
        },
        enumerable: true,
        configurable: true
    });
    BasicOpcodeBuilder.prototype.startLabels = function () {
        this.labelsStack.push(new Labels());
    };
    BasicOpcodeBuilder.prototype.stopLabels = function () {
        var label = util_1.expect(this.labelsStack.pop(), 'unbalanced push and pop labels');
        label.patch(this.constants, this.program);
    };
    // partials
    BasicOpcodeBuilder.prototype.putPartialDefinition = function (_definition) {
        var definition = this.constants.other(_definition);
        this.opcode(opcodes_1.OpcodeName.PutPartial, definition);
    };
    BasicOpcodeBuilder.prototype.putDynamicPartialDefinition = function () {
        this.opcode(opcodes_1.OpcodeName.PutDynamicPartial, this.constants.other(this.symbolTable));
    };
    BasicOpcodeBuilder.prototype.evaluatePartial = function () {
        this.opcode(opcodes_1.OpcodeName.EvaluatePartial, this.constants.other(this.symbolTable), this.constants.other(util_1.dict()));
    };
    // components
    BasicOpcodeBuilder.prototype.putComponentDefinition = function (definition) {
        this.opcode(opcodes_1.OpcodeName.PutComponent, this.other(definition));
    };
    BasicOpcodeBuilder.prototype.putDynamicComponentDefinition = function () {
        this.opcode(opcodes_1.OpcodeName.PutDynamicComponent);
    };
    BasicOpcodeBuilder.prototype.openComponent = function (args, shadow) {
        this.opcode(opcodes_1.OpcodeName.OpenComponent, this.args(args), shadow ? this.block(shadow) : 0);
    };
    BasicOpcodeBuilder.prototype.didCreateElement = function () {
        this.opcode(opcodes_1.OpcodeName.DidCreateElement);
    };
    BasicOpcodeBuilder.prototype.shadowAttributes = function () {
        this.opcode(opcodes_1.OpcodeName.ShadowAttributes);
        this.opcode(opcodes_1.OpcodeName.CloseBlock);
    };
    BasicOpcodeBuilder.prototype.didRenderLayout = function () {
        this.opcode(opcodes_1.OpcodeName.DidRenderLayout);
    };
    BasicOpcodeBuilder.prototype.closeComponent = function () {
        this.opcode(opcodes_1.OpcodeName.CloseComponent);
    };
    // content
    BasicOpcodeBuilder.prototype.dynamicContent = function (Opcode) {
        this.opcode(opcodes_1.OpcodeName.DynamicContent, this.other(Opcode));
    };
    BasicOpcodeBuilder.prototype.cautiousAppend = function () {
        this.dynamicContent(new content.OptimizedCautiousAppendOpcode());
    };
    BasicOpcodeBuilder.prototype.trustingAppend = function () {
        this.dynamicContent(new content.OptimizedTrustingAppendOpcode());
    };
    BasicOpcodeBuilder.prototype.guardedCautiousAppend = function (expression) {
        this.dynamicContent(new content.GuardedCautiousAppendOpcode(this.compileExpression(expression), this.symbolTable));
    };
    BasicOpcodeBuilder.prototype.guardedTrustingAppend = function (expression) {
        this.dynamicContent(new content.GuardedTrustingAppendOpcode(this.compileExpression(expression), this.symbolTable));
    };
    // dom
    BasicOpcodeBuilder.prototype.text = function (text) {
        this.opcode(opcodes_1.OpcodeName.Text, this.constants.string(text));
    };
    BasicOpcodeBuilder.prototype.openPrimitiveElement = function (tag) {
        this.opcode(opcodes_1.OpcodeName.OpenElement, this.constants.string(tag));
    };
    BasicOpcodeBuilder.prototype.openComponentElement = function (tag) {
        this.opcode(opcodes_1.OpcodeName.OpenComponentElement, this.constants.string(tag));
    };
    BasicOpcodeBuilder.prototype.openDynamicPrimitiveElement = function () {
        this.opcode(opcodes_1.OpcodeName.OpenDynamicElement);
    };
    BasicOpcodeBuilder.prototype.flushElement = function () {
        this.opcode(opcodes_1.OpcodeName.FlushElement);
    };
    BasicOpcodeBuilder.prototype.closeElement = function () {
        this.opcode(opcodes_1.OpcodeName.CloseElement);
    };
    BasicOpcodeBuilder.prototype.staticAttr = function (_name, _namespace, _value) {
        var name = this.constants.string(_name);
        var namespace = _namespace ? this.constants.string(_namespace) : 0;
        var value = this.constants.string(_value);
        this.opcode(opcodes_1.OpcodeName.StaticAttr, name, value, namespace);
    };
    BasicOpcodeBuilder.prototype.dynamicAttrNS = function (_name, _namespace, trusting) {
        var name = this.constants.string(_name);
        var namespace = this.constants.string(_namespace);
        this.opcode(opcodes_1.OpcodeName.DynamicAttrNS, name, namespace, trusting | 0);
    };
    BasicOpcodeBuilder.prototype.dynamicAttr = function (_name, trusting) {
        var name = this.constants.string(_name);
        this.opcode(opcodes_1.OpcodeName.DynamicAttr, name, trusting | 0);
    };
    BasicOpcodeBuilder.prototype.comment = function (_comment) {
        var comment = this.constants.string(_comment);
        this.opcode(opcodes_1.OpcodeName.Comment, comment);
    };
    BasicOpcodeBuilder.prototype.modifier = function (_name, _args) {
        var args = this.constants.expression(this.compile(_args));
        var _modifierManager = this.env.lookupModifier([_name], this.symbolTable);
        var modifierManager = this.constants.other(_modifierManager);
        var name = this.constants.string(_name);
        this.opcode(opcodes_1.OpcodeName.Modifier, name, modifierManager, args);
    };
    // lists
    BasicOpcodeBuilder.prototype.putIterator = function () {
        this.opcode(opcodes_1.OpcodeName.PutIterator);
    };
    BasicOpcodeBuilder.prototype.enterList = function (start, end) {
        this.push(null);
        this.labels.range(this.pos, opcodes_1.OpcodeName.EnterList, start, end);
    };
    BasicOpcodeBuilder.prototype.exitList = function () {
        this.opcode(opcodes_1.OpcodeName.ExitList);
    };
    BasicOpcodeBuilder.prototype.enterWithKey = function (start, end) {
        this.push(null);
        this.labels.range(this.pos, opcodes_1.OpcodeName.EnterWithKey, start, end);
    };
    BasicOpcodeBuilder.prototype.nextIter = function (end) {
        this.push(null);
        this.labels.jump(this.pos, opcodes_1.OpcodeName.NextIter, end);
    };
    // vm
    BasicOpcodeBuilder.prototype.openBlock = function (_args, _inner) {
        var args = this.constants.expression(this.compile(_args));
        var inner = this.constants.other(_inner);
        this.opcode(opcodes_1.OpcodeName.OpenBlock, inner, args);
    };
    BasicOpcodeBuilder.prototype.closeBlock = function () {
        this.opcode(opcodes_1.OpcodeName.CloseBlock);
    };
    BasicOpcodeBuilder.prototype.pushRemoteElement = function () {
        this.opcode(opcodes_1.OpcodeName.PushRemoteElement);
    };
    BasicOpcodeBuilder.prototype.popRemoteElement = function () {
        this.opcode(opcodes_1.OpcodeName.PopRemoteElement);
    };
    BasicOpcodeBuilder.prototype.popElement = function () {
        this.opcode(opcodes_1.OpcodeName.PopElement);
    };
    BasicOpcodeBuilder.prototype.label = function (name) {
        this.labels.label(name, this.nextPos);
    };
    BasicOpcodeBuilder.prototype.pushChildScope = function () {
        this.opcode(opcodes_1.OpcodeName.PushChildScope);
    };
    BasicOpcodeBuilder.prototype.popScope = function () {
        this.opcode(opcodes_1.OpcodeName.PopScope);
    };
    BasicOpcodeBuilder.prototype.pushDynamicScope = function () {
        this.opcode(opcodes_1.OpcodeName.PushDynamicScope);
    };
    BasicOpcodeBuilder.prototype.popDynamicScope = function () {
        this.opcode(opcodes_1.OpcodeName.PopDynamicScope);
    };
    BasicOpcodeBuilder.prototype.putNull = function () {
        this.opcode(opcodes_1.OpcodeName.Put, this.constants.NULL_REFERENCE);
    };
    BasicOpcodeBuilder.prototype.putValue = function (_expression) {
        var expr = this.constants.expression(this.compileExpression(_expression));
        this.opcode(opcodes_1.OpcodeName.EvaluatePut, expr);
    };
    BasicOpcodeBuilder.prototype.putArgs = function (_args) {
        var args = this.constants.expression(this.compile(_args));
        this.opcode(opcodes_1.OpcodeName.PutArgs, args);
    };
    BasicOpcodeBuilder.prototype.bindDynamicScope = function (_names) {
        this.opcode(opcodes_1.OpcodeName.BindDynamicScope, this.names(_names));
    };
    BasicOpcodeBuilder.prototype.bindPositionalArgs = function (_names, _symbols) {
        this.opcode(opcodes_1.OpcodeName.BindPositionalArgs, this.names(_names), this.symbols(_symbols));
    };
    BasicOpcodeBuilder.prototype.bindNamedArgs = function (_names, _symbols) {
        this.opcode(opcodes_1.OpcodeName.BindNamedArgs, this.names(_names), this.symbols(_symbols));
    };
    BasicOpcodeBuilder.prototype.bindBlocks = function (_names, _symbols) {
        this.opcode(opcodes_1.OpcodeName.BindBlocks, this.names(_names), this.symbols(_symbols));
    };
    BasicOpcodeBuilder.prototype.enter = function (enter, exit) {
        this.push(null);
        this.labels.range(this.pos, opcodes_1.OpcodeName.Enter, enter, exit);
    };
    BasicOpcodeBuilder.prototype.exit = function () {
        this.opcode(opcodes_1.OpcodeName.Exit);
    };
    BasicOpcodeBuilder.prototype.evaluate = function (_block) {
        var block = this.constants.block(_block);
        this.opcode(opcodes_1.OpcodeName.Evaluate, block);
    };
    BasicOpcodeBuilder.prototype.test = function (testFunc) {
        var _func;
        if (testFunc === 'const') {
            _func = vm.ConstTest;
        }
        else if (testFunc === 'simple') {
            _func = vm.SimpleTest;
        }
        else if (testFunc === 'environment') {
            _func = vm.EnvironmentTest;
        }
        else if (typeof testFunc === 'function') {
            _func = testFunc;
        }
        else {
            throw new Error('unreachable');
        }
        var func = this.constants.function(_func);
        this.opcode(opcodes_1.OpcodeName.Test, func);
    };
    BasicOpcodeBuilder.prototype.jump = function (target) {
        this.push(null);
        this.labels.jump(this.pos, opcodes_1.OpcodeName.Jump, target);
    };
    BasicOpcodeBuilder.prototype.jumpIf = function (target) {
        this.push(null);
        this.labels.jump(this.pos, opcodes_1.OpcodeName.JumpIf, target);
    };
    BasicOpcodeBuilder.prototype.jumpUnless = function (target) {
        this.push(null);
        this.labels.jump(this.pos, opcodes_1.OpcodeName.JumpUnless, target);
    };
    BasicOpcodeBuilder.prototype.names = function (_names) {
        var _this = this;
        var names = _names.map(function (n) { return _this.constants.string(n); });
        return this.constants.array(names);
    };
    BasicOpcodeBuilder.prototype.symbols = function (symbols) {
        return this.constants.array(symbols);
    };
    BasicOpcodeBuilder.prototype.other = function (value) {
        return this.constants.other(value);
    };
    BasicOpcodeBuilder.prototype.args = function (args) {
        return this.constants.expression(this.compile(args));
    };
    BasicOpcodeBuilder.prototype.block = function (block) {
        return this.constants.block(block);
    };
    return BasicOpcodeBuilder;
}());
exports.BasicOpcodeBuilder = BasicOpcodeBuilder;
function isCompilableExpression(expr) {
    return expr && typeof expr['compile'] === 'function';
}
var OpcodeBuilder = (function (_super) {
    __extends(OpcodeBuilder, _super);
    function OpcodeBuilder(symbolTable, env, program) {
        if (program === void 0) { program = env.program; }
        var _this = _super.call(this, symbolTable, env, program) || this;
        _this.component = new compiler_1.ComponentBuilder(_this);
        return _this;
    }
    OpcodeBuilder.prototype.compile = function (expr) {
        if (isCompilableExpression(expr)) {
            return expr.compile(this);
        }
        else {
            return expr;
        }
    };
    OpcodeBuilder.prototype.compileExpression = function (expression) {
        if (expression instanceof expressions_1.CompiledExpression) {
            return expression;
        }
        else {
            return functions_1.expr(expression, this);
        }
    };
    OpcodeBuilder.prototype.bindPositionalArgsForLocals = function (locals) {
        var symbols = Object.keys(locals).map(function (name) { return locals[name]; });
        this.opcode(opcodes_1.OpcodeName.BindPositionalArgs, this.symbols(symbols));
    };
    OpcodeBuilder.prototype.preludeForLayout = function (layout) {
        var symbols = layout.symbolTable.getSymbols();
        if (symbols.named) {
            var named_1 = symbols.named;
            var namedNames = Object.keys(named_1);
            var namedSymbols = namedNames.map(function (n) { return named_1[n]; });
            this.opcode(opcodes_1.OpcodeName.BindNamedArgs, this.names(namedNames), this.symbols(namedSymbols));
        }
        this.opcode(opcodes_1.OpcodeName.BindCallerScope);
        if (symbols.yields) {
            var yields_1 = symbols.yields;
            var yieldNames = Object.keys(yields_1);
            var yieldSymbols = yieldNames.map(function (n) { return yields_1[n]; });
            this.opcode(opcodes_1.OpcodeName.BindBlocks, this.names(yieldNames), this.symbols(yieldSymbols));
        }
        if (symbols.partialArgs) {
            this.opcode(opcodes_1.OpcodeName.BindPartialArgs, symbols.partialArgs);
        }
    };
    OpcodeBuilder.prototype.yield = function (args, to) {
        var yields, partial;
        var inner;
        if (yields = this.symbolTable.getSymbol('yields', to)) {
            inner = new has_block_1.CompiledGetBlockBySymbol(yields, to);
        }
        else if (partial = this.symbolTable.getPartialArgs()) {
            inner = new has_block_1.CompiledInPartialGetBlock(partial, to);
        }
        else {
            throw new Error('[BUG] ${to} is not a valid block name.');
        }
        this.openBlock(args, inner);
        this.closeBlock();
    };
    // TODO
    // come back to this
    OpcodeBuilder.prototype.labelled = function (args, callback) {
        if (args)
            this.putArgs(args);
        this.startLabels();
        this.enter('BEGIN', 'END');
        this.label('BEGIN');
        callback(this, 'BEGIN', 'END');
        this.label('END');
        this.exit();
        this.stopLabels();
    };
    // TODO
    // come back to this
    OpcodeBuilder.prototype.iter = function (callback) {
        this.startLabels();
        this.enterList('BEGIN', 'END');
        this.label('ITER');
        this.nextIter('BREAK');
        this.enterWithKey('BEGIN', 'END');
        this.label('BEGIN');
        callback(this, 'BEGIN', 'END');
        this.label('END');
        this.exit();
        this.jump('ITER');
        this.label('BREAK');
        this.exitList();
        this.stopLabels();
    };
    // TODO
    // come back to this
    OpcodeBuilder.prototype.unit = function (callback) {
        this.startLabels();
        callback(this);
        this.stopLabels();
    };
    return OpcodeBuilder;
}(BasicOpcodeBuilder));
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = OpcodeBuilder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL2NvbXBpbGVkL29wY29kZXMvYnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxtQ0FBcUM7QUFDckMseUJBQTJCO0FBSTNCLGtFQUk4QztBQUU5QyxzQ0FBMEU7QUFDMUUsb0RBQThDO0FBRzlDLDhDQUFvRDtBQU1wRCwyQ0FBa0Q7QUFHbEQseUNBUXVCO0FBRXZCLHNCQUFzQixJQUFRLEVBQUUsR0FBWSxFQUFFLEdBQVksRUFBRSxHQUFZO0lBQ3RFLE1BQU0sQ0FBQyx3QkFBYyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDN0QsQ0FBQztBQW1CRDtJQUFBO1FBQ0UsV0FBTSxHQUFHLFdBQUksRUFBVSxDQUFDO1FBQ3hCLFVBQUssR0FBMkQsRUFBRSxDQUFDO1FBQ25FLFdBQU0sR0FBcUUsRUFBRSxDQUFDO0lBMEJoRixDQUFDO0lBeEJDLHNCQUFLLEdBQUwsVUFBTSxJQUFZLEVBQUUsS0FBYTtRQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztJQUM1QixDQUFDO0lBRUQscUJBQUksR0FBSixVQUFLLEVBQVUsRUFBRSxNQUFvQixFQUFFLE1BQWM7UUFDbkQsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUVELHNCQUFLLEdBQUwsVUFBTSxFQUFVLEVBQUUsS0FBa0IsRUFBRSxLQUFhLEVBQUUsR0FBVztRQUM5RCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBQSxFQUFFLEtBQUssT0FBQSxFQUFFLEdBQUcsS0FBQSxFQUFFLEtBQUssT0FBQSxFQUFFLENBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsc0JBQUssR0FBTCxVQUFNLFNBQW9CLEVBQUUsT0FBZ0I7UUFDMUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3ZDLElBQUEsa0JBQXNDLEVBQXBDLFVBQUUsRUFBRSxrQkFBTSxFQUFFLGtCQUFNLENBQW1CO1lBQzNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLHdCQUFjLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0UsQ0FBQztRQUVELEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUN4QyxJQUFBLG1CQUEwQyxFQUF4QyxVQUFFLEVBQUUsZ0JBQUssRUFBRSxZQUFHLEVBQUUsZ0JBQUssQ0FBb0I7WUFDL0MsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hFLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLHdCQUFjLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNoRSxDQUFDO0lBQ0gsQ0FBQztJQUNILGFBQUM7QUFBRCxDQUFDLEFBN0JELElBNkJDO0FBRUQ7SUFLRSw0QkFBbUIsV0FBd0IsRUFBUyxHQUFnQixFQUFTLE9BQWdCO1FBQTFFLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVMsUUFBRyxHQUFILEdBQUcsQ0FBYTtRQUFTLFlBQU8sR0FBUCxPQUFPLENBQVM7UUFKckYsZ0JBQVcsR0FBRyxJQUFJLFlBQUssRUFBVSxDQUFDO1FBS3hDLElBQUksQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQztRQUMvQixJQUFJLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFDNUIsQ0FBQztJQUtELHNCQUFZLG1DQUFHO2FBQWY7WUFDRSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUM7UUFDOUIsQ0FBQzs7O09BQUE7SUFFRCxzQkFBWSx1Q0FBTzthQUFuQjtZQUNFLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztRQUMzQixDQUFDOzs7T0FBQTtJQUVTLG1DQUFNLEdBQWhCLFVBQWlCLElBQVEsRUFBRSxHQUFZLEVBQUUsR0FBWSxFQUFFLEdBQVk7UUFDakUsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUQsaUNBQUksR0FBSixVQUFLLEVBQXdCO1FBQzNCLDJDQUEyQztRQUMzQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEMsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDeEIsQ0FBQztJQUNILENBQUM7SUFFRCxvQ0FBTyxHQUFQO1FBQ0UsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFJRCxzQkFBWSxzQ0FBTTtRQUZsQixVQUFVO2FBRVY7WUFDRSxNQUFNLENBQUMsYUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLDJCQUEyQixDQUFDLENBQUM7UUFDdkUsQ0FBQzs7O09BQUE7SUFFRCx3Q0FBVyxHQUFYO1FBQ0UsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFFRCx1Q0FBVSxHQUFWO1FBQ0UsSUFBSSxLQUFLLEdBQUcsYUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLEVBQUUsZ0NBQWdDLENBQUMsQ0FBQztRQUM3RSxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRCxXQUFXO0lBRVgsaURBQW9CLEdBQXBCLFVBQXFCLFdBQXNDO1FBQ3pELElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVELHdEQUEyQixHQUEzQjtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBRUQsNENBQWUsR0FBZjtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLFdBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN4RyxDQUFDO0lBRUQsYUFBYTtJQUViLG1EQUFzQixHQUF0QixVQUF1QixVQUF1QztRQUM1RCxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRUQsMERBQTZCLEdBQTdCO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLG1CQUFtQixDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUVELDBDQUFhLEdBQWIsVUFBYyxJQUE4QixFQUFFLE1BQW9CO1FBQ2hFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBRUQsNkNBQWdCLEdBQWhCO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVELDZDQUFnQixHQUFoQjtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsNENBQWUsR0FBZjtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQsMkNBQWMsR0FBZDtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsVUFBVTtJQUVWLDJDQUFjLEdBQWQsVUFBZSxNQUE4QztRQUMzRCxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsMkNBQWMsR0FBZDtRQUNFLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxPQUFPLENBQUMsNkJBQTZCLEVBQUUsQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUFFRCwyQ0FBYyxHQUFkO1FBQ0UsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyw2QkFBNkIsRUFBRSxDQUFDLENBQUM7SUFDbkUsQ0FBQztJQUVELGtEQUFxQixHQUFyQixVQUFzQixVQUFnQztRQUNwRCxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksT0FBTyxDQUFDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUNySCxDQUFDO0lBRUQsa0RBQXFCLEdBQXJCLFVBQXNCLFVBQWdDO1FBQ3BELElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxPQUFPLENBQUMsMkJBQTJCLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQ3JILENBQUM7SUFFRCxNQUFNO0lBRU4saUNBQUksR0FBSixVQUFLLElBQVk7UUFDZixJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUVELGlEQUFvQixHQUFwQixVQUFxQixHQUFXO1FBQzlCLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRUQsaURBQW9CLEdBQXBCLFVBQXFCLEdBQVc7UUFDOUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDbkUsQ0FBQztJQUVELHdEQUEyQixHQUEzQjtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFRCx5Q0FBWSxHQUFaO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFRCx5Q0FBWSxHQUFaO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFFRCx1Q0FBVSxHQUFWLFVBQVcsS0FBYSxFQUFFLFVBQTBCLEVBQUUsTUFBYztRQUNsRSxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QyxJQUFJLFNBQVMsR0FBRyxVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ25FLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRTFDLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxVQUFVLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxTQUFTLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQsMENBQWEsR0FBYixVQUFjLEtBQWEsRUFBRSxVQUFrQixFQUFFLFFBQWlCO1FBQ2hFLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRWxELElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxhQUFhLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRyxRQUFnQixHQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFRCx3Q0FBVyxHQUFYLFVBQVksS0FBYSxFQUFFLFFBQWlCO1FBQzFDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFHLFFBQWdCLEdBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekQsQ0FBQztJQUVELG9DQUFPLEdBQVAsVUFBUSxRQUFnQjtRQUN0QixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRCxxQ0FBUSxHQUFSLFVBQVMsS0FBYSxFQUFFLEtBQStCO1FBQ3JELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMxRCxJQUFJLGdCQUFnQixHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzFFLElBQUksZUFBZSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDN0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFRCxRQUFRO0lBRVIsd0NBQVcsR0FBWDtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsc0NBQVMsR0FBVCxVQUFVLEtBQWEsRUFBRSxHQUFXO1FBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxvQkFBRSxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVELHFDQUFRLEdBQVI7UUFDRSxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUVELHlDQUFZLEdBQVosVUFBYSxLQUFhLEVBQUUsR0FBVztRQUNyQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsb0JBQUUsQ0FBQyxZQUFZLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFFRCxxQ0FBUSxHQUFSLFVBQVMsR0FBVztRQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsb0JBQUUsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVELEtBQUs7SUFFTCxzQ0FBUyxHQUFULFVBQVUsS0FBK0IsRUFBRSxNQUF3QjtRQUNqRSxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDMUQsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVELHVDQUFVLEdBQVY7UUFDRSxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELDhDQUFpQixHQUFqQjtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCw2Q0FBZ0IsR0FBaEI7UUFDRSxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUQsdUNBQVUsR0FBVjtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsa0NBQUssR0FBTCxVQUFNLElBQVk7UUFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRUQsMkNBQWMsR0FBZDtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQscUNBQVEsR0FBUjtRQUNFLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMzQixDQUFDO0lBRUQsNkNBQWdCLEdBQWhCO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVELDRDQUFlLEdBQWY7UUFDRSxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDbEMsQ0FBQztJQUVELG9DQUFPLEdBQVA7UUFDRSxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDckQsQ0FBQztJQUVELHFDQUFRLEdBQVIsVUFBUyxXQUFpQztRQUN4QyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUMxRSxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxvQ0FBTyxHQUFQLFVBQVEsS0FBK0I7UUFDckMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzFELElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELDZDQUFnQixHQUFoQixVQUFpQixNQUFnQjtRQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFRCwrQ0FBa0IsR0FBbEIsVUFBbUIsTUFBZ0IsRUFBRSxRQUFrQjtRQUNyRCxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDakYsQ0FBQztJQUVELDBDQUFhLEdBQWIsVUFBYyxNQUFnQixFQUFFLFFBQWtCO1FBQ2hELElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUVELHVDQUFVLEdBQVYsVUFBVyxNQUFnQixFQUFFLFFBQWtCO1FBQzdDLElBQUksQ0FBQyxNQUFNLENBQUMsb0JBQUUsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDekUsQ0FBQztJQUVELGtDQUFLLEdBQUwsVUFBTSxLQUFhLEVBQUUsSUFBWTtRQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsb0JBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFRCxpQ0FBSSxHQUFKO1FBQ0UsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFFRCxxQ0FBUSxHQUFSLFVBQVMsTUFBbUI7UUFDMUIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLFFBQVEsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQsaUNBQUksR0FBSixVQUFLLFFBQThEO1FBQ2pFLElBQUksS0FBc0IsQ0FBQztRQUUzQixFQUFFLENBQUMsQ0FBQyxRQUFRLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQztZQUN6QixLQUFLLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQztRQUN2QixDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLEtBQUssR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDO1FBQ3hCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsUUFBUSxLQUFLLGFBQWEsQ0FBQyxDQUFDLENBQUM7WUFDdEMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxlQUFlLENBQUM7UUFDN0IsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLFFBQVEsS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQzFDLEtBQUssR0FBRyxRQUFRLENBQUM7UUFDbkIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUNqQyxDQUFDO1FBRUQsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRUQsaUNBQUksR0FBSixVQUFLLE1BQWM7UUFDakIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLG9CQUFFLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzlDLENBQUM7SUFFRCxtQ0FBTSxHQUFOLFVBQU8sTUFBYztRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsb0JBQUUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVELHVDQUFVLEdBQVYsVUFBVyxNQUFjO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxvQkFBRSxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRVMsa0NBQUssR0FBZixVQUFnQixNQUFnQjtRQUFoQyxpQkFHQztRQUZDLElBQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxLQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBeEIsQ0FBd0IsQ0FBQyxDQUFDO1FBQ3RELE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRVMsb0NBQU8sR0FBakIsVUFBa0IsT0FBaUI7UUFDakMsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFFUyxrQ0FBSyxHQUFmLFVBQWdCLEtBQWE7UUFDM0IsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFUyxpQ0FBSSxHQUFkLFVBQWUsSUFBOEI7UUFDM0MsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN2RCxDQUFDO0lBRVMsa0NBQUssR0FBZixVQUFnQixLQUFrQjtRQUNoQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUNILHlCQUFDO0FBQUQsQ0FBQyxBQTNWRCxJQTJWQztBQTNWcUIsZ0RBQWtCO0FBNlZ4QyxnQ0FBbUMsSUFBbUI7SUFDcEQsTUFBTSxDQUFDLElBQUksSUFBSSxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxVQUFVLENBQUM7QUFDdkQsQ0FBQztBQUVEO0lBQTJDLGlDQUFrQjtJQUczRCx1QkFBWSxXQUF3QixFQUFFLEdBQWdCLEVBQUUsT0FBOEI7UUFBOUIsd0JBQUEsRUFBQSxVQUFtQixHQUFHLENBQUMsT0FBTztRQUF0RixZQUNFLGtCQUFNLFdBQVcsRUFBRSxHQUFHLEVBQUUsT0FBTyxDQUFDLFNBRWpDO1FBREMsS0FBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLDJCQUFnQixDQUFDLEtBQUksQ0FBQyxDQUFDOztJQUM5QyxDQUFDO0lBRUQsK0JBQU8sR0FBUCxVQUFXLElBQW1CO1FBQzVCLEVBQUUsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM1QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRCx5Q0FBaUIsR0FBakIsVUFBa0IsVUFBZ0M7UUFDaEQsRUFBRSxDQUFDLENBQUMsVUFBVSxZQUFZLGdDQUFrQixDQUFDLENBQUMsQ0FBQztZQUM3QyxNQUFNLENBQUMsVUFBVSxDQUFDO1FBQ3BCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLE1BQU0sQ0FBQyxnQkFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNoQyxDQUFDO0lBQ0gsQ0FBQztJQUVELG1EQUEyQixHQUEzQixVQUE0QixNQUFvQjtRQUM5QyxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBWixDQUFZLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQzVELENBQUM7SUFFRCx3Q0FBZ0IsR0FBaEIsVUFBaUIsTUFBZ0I7UUFDL0IsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUU5QyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNsQixJQUFJLE9BQUssR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO1lBQzFCLElBQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBSyxDQUFDLENBQUM7WUFDcEMsSUFBSSxZQUFZLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLE9BQUssQ0FBQyxDQUFDLENBQUMsRUFBUixDQUFRLENBQUMsQ0FBQztZQUNqRCxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQ3BGLENBQUM7UUFFRCxJQUFJLENBQUMsTUFBTSxDQUFDLG9CQUFFLENBQUMsZUFBZSxDQUFDLENBQUM7UUFFaEMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDbkIsSUFBSSxRQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUM1QixJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQU0sQ0FBQyxDQUFDO1lBQ3JDLElBQUksWUFBWSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxRQUFNLENBQUMsQ0FBQyxDQUFDLEVBQVQsQ0FBUyxDQUFDLENBQUM7WUFDbEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUNqRixDQUFDO1FBRUQsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxvQkFBRSxDQUFDLGVBQWUsRUFBRSxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDdkQsQ0FBQztJQUNILENBQUM7SUFFRCw2QkFBSyxHQUFMLFVBQU0sSUFBOEIsRUFBRSxFQUFVO1FBQzlDLElBQUksTUFBc0IsRUFBRSxPQUF1QixDQUFDO1FBQ3BELElBQUksS0FBdUIsQ0FBQztRQUU1QixFQUFFLENBQUMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0RCxLQUFLLEdBQUcsSUFBSSxvQ0FBd0IsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDbkQsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDdkQsS0FBSyxHQUFHLElBQUkscUNBQXlCLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLE1BQU0sSUFBSSxLQUFLLENBQUMsd0NBQXdDLENBQUMsQ0FBQztRQUM1RCxDQUFDO1FBRUQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxPQUFPO0lBQ1Asb0JBQW9CO0lBQ3BCLGdDQUFRLEdBQVIsVUFBUyxJQUFzQyxFQUFFLFFBQXVCO1FBQ3RFLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFN0IsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25CLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFcEIsUUFBUSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFL0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDWixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDcEIsQ0FBQztJQUVELE9BQU87SUFDUCxvQkFBb0I7SUFDcEIsNEJBQUksR0FBSixVQUFLLFFBQXVCO1FBQzFCLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUMvQixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25CLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdkIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVwQixRQUFRLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQztRQUUvQixJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNaLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxPQUFPO0lBQ1Asb0JBQW9CO0lBQ3BCLDRCQUFJLEdBQUosVUFBSyxRQUEwQztRQUM3QyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDbkIsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFDSCxvQkFBQztBQUFELENBQUMsQUFoSEQsQ0FBMkMsa0JBQWtCLEdBZ0g1RCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGNvbnRlbnQgZnJvbSAnLi9jb250ZW50JztcbmltcG9ydCAqIGFzIHZtIGZyb20gJy4vdm0nO1xuXG5pbXBvcnQgeyBJbnNlcnRpb24gfSBmcm9tICcuLi8uLi91cHNlcnQnO1xuXG5pbXBvcnQge1xuICBDb21waWxlZEdldEJsb2NrLFxuICBDb21waWxlZEdldEJsb2NrQnlTeW1ib2wsXG4gIENvbXBpbGVkSW5QYXJ0aWFsR2V0QmxvY2tcbn0gZnJvbSAnLi4vLi4vY29tcGlsZWQvZXhwcmVzc2lvbnMvaGFzLWJsb2NrJztcblxuaW1wb3J0IHsgT3B0aW9uLCBTdGFjaywgRGljdCwgT3BhcXVlLCBkaWN0LCBleHBlY3QgfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IGV4cHIgfSBmcm9tICcuLi8uLi9zeW50YXgvZnVuY3Rpb25zJztcbmltcG9ydCB7IENvbnN0YW50cywgU2xpY2UgfSBmcm9tICcuLi8uLi9vcGNvZGVzJztcbmltcG9ydCB7IENvbXBpbGVkQXJncyB9IGZyb20gJy4uL2V4cHJlc3Npb25zL2FyZ3MnO1xuaW1wb3J0IHsgQ29tcGlsZWRFeHByZXNzaW9uIH0gZnJvbSAnLi4vZXhwcmVzc2lvbnMnO1xuaW1wb3J0IHsgQ29tcG9uZW50RGVmaW5pdGlvbiB9IGZyb20gJy4uLy4uL2NvbXBvbmVudC9pbnRlcmZhY2VzJztcbmltcG9ydCB7IFBhcnRpYWxEZWZpbml0aW9uIH0gZnJvbSAnLi4vLi4vcGFydGlhbCc7XG5pbXBvcnQgRW52aXJvbm1lbnQsIHsgUHJvZ3JhbSB9IGZyb20gJy4uLy4uL2Vudmlyb25tZW50JztcbmltcG9ydCB7IFN5bWJvbFRhYmxlIH0gZnJvbSAnQGdsaW1tZXIvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBDb21wb25lbnRCdWlsZGVyIGFzIElDb21wb25lbnRCdWlsZGVyIH0gZnJvbSAnLi4vLi4vb3Bjb2RlLWJ1aWxkZXInO1xuaW1wb3J0IHsgQ29tcG9uZW50QnVpbGRlciB9IGZyb20gJy4uLy4uL2NvbXBpbGVyJztcbmltcG9ydCB7IEJhc2VsaW5lU3ludGF4LCBJbmxpbmVCbG9jaywgVGVtcGxhdGUgfSBmcm9tICcuLi8uLi9zY2FubmVyJztcblxuaW1wb3J0IHtcbiAgQVBQRU5EX09QQ09ERVMsXG4gIE9wY29kZU5hbWUgYXMgT3AsXG4gIEFwcGVuZE9wY29kZSxcbiAgQ29uc3RhbnRBcnJheSxcbiAgQ29uc3RhbnRPdGhlcixcbiAgQ29uc3RhbnRFeHByZXNzaW9uLFxuICBDb25zdGFudEJsb2NrXG59IGZyb20gJy4uLy4uL29wY29kZXMnO1xuXG5mdW5jdGlvbiBhcHBlbmRPcGNvZGUobmFtZTogT3AsIG9wMT86IG51bWJlciwgb3AyPzogbnVtYmVyLCBvcDM/OiBudW1iZXIpOiBBcHBlbmRPcGNvZGUge1xuICByZXR1cm4gQVBQRU5EX09QQ09ERVMuY29uc3RydWN0KG5hbWUsIG51bGwsIG9wMSwgb3AyLCBvcDMpO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbXBpbGVzSW50bzxFPiB7XG4gIGNvbXBpbGUoYnVpbGRlcjogT3Bjb2RlQnVpbGRlcik6IEU7XG59XG5cbmV4cG9ydCB0eXBlIFJlcHJlc2VudHNFeHByZXNzaW9uID0gQmFzZWxpbmVTeW50YXguQW55RXhwcmVzc2lvbiB8IENvbXBpbGVkRXhwcmVzc2lvbjxPcGFxdWU+O1xuXG5leHBvcnQgdHlwZSBSZXByZXNlbnRzPEU+ID0gQ29tcGlsZXNJbnRvPEU+IHwgRTtcblxuZXhwb3J0IHR5cGUgTGFiZWwgPSBzdHJpbmc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3ltYm9sTG9va3VwIHtcbiAgc3ltYm9sVGFibGU6IFN5bWJvbFRhYmxlO1xufVxuXG50eXBlIFRhcmdldE9wY29kZSA9IE9wLkp1bXAgfCBPcC5KdW1wSWYgfCBPcC5KdW1wVW5sZXNzIHwgT3AuTmV4dEl0ZXI7XG50eXBlIFJhbmdlT3Bjb2RlID0gT3AuRW50ZXIgfCBPcC5FbnRlckxpc3QgfCBPcC5FbnRlcldpdGhLZXkgfCBPcC5OZXh0SXRlcjtcblxuY2xhc3MgTGFiZWxzIHtcbiAgbGFiZWxzID0gZGljdDxudW1iZXI+KCk7XG4gIGp1bXBzOiB7IGF0OiBudW1iZXIsIHRhcmdldDogc3RyaW5nLCBUYXJnZXQ6IFRhcmdldE9wY29kZSB9W10gPSBbXTtcbiAgcmFuZ2VzOiB7IGF0OiBudW1iZXIsIHN0YXJ0OiBzdHJpbmcsIGVuZDogc3RyaW5nLCBSYW5nZTogUmFuZ2VPcGNvZGUgfVtdID0gW107XG5cbiAgbGFiZWwobmFtZTogc3RyaW5nLCBpbmRleDogbnVtYmVyKSB7XG4gICAgdGhpcy5sYWJlbHNbbmFtZV0gPSBpbmRleDtcbiAgfVxuXG4gIGp1bXAoYXQ6IG51bWJlciwgVGFyZ2V0OiBUYXJnZXRPcGNvZGUsIHRhcmdldDogc3RyaW5nKSB7XG4gICAgdGhpcy5qdW1wcy5wdXNoKHsgYXQsIHRhcmdldCwgVGFyZ2V0IH0pO1xuICB9XG5cbiAgcmFuZ2UoYXQ6IG51bWJlciwgUmFuZ2U6IFJhbmdlT3Bjb2RlLCBzdGFydDogc3RyaW5nLCBlbmQ6IHN0cmluZykge1xuICAgIHRoaXMucmFuZ2VzLnB1c2goeyBhdCwgc3RhcnQsIGVuZCwgUmFuZ2UgfSk7XG4gIH1cblxuICBwYXRjaChjb25zdGFudHM6IENvbnN0YW50cywgb3Bjb2RlczogUHJvZ3JhbSk6IHZvaWQge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5qdW1wcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IHsgYXQsIHRhcmdldCwgVGFyZ2V0IH0gPSB0aGlzLmp1bXBzW2ldO1xuICAgICAgb3Bjb2Rlcy5zZXQoYXQsIEFQUEVORF9PUENPREVTLmNvbnN0cnVjdChUYXJnZXQsIG51bGwsIHRoaXMubGFiZWxzW3RhcmdldF0pKTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgeyBhdCwgc3RhcnQsIGVuZCwgUmFuZ2UgfSA9IHRoaXMucmFuZ2VzW2ldO1xuICAgICAgbGV0IHNsaWNlID0gY29uc3RhbnRzLnNsaWNlKFt0aGlzLmxhYmVsc1tzdGFydF0sIHRoaXMubGFiZWxzW2VuZF0gLSAxXSk7XG4gICAgICBvcGNvZGVzLnNldChhdCwgQVBQRU5EX09QQ09ERVMuY29uc3RydWN0KFJhbmdlLCBudWxsLCBzbGljZSkpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzaWNPcGNvZGVCdWlsZGVyIGltcGxlbWVudHMgU3ltYm9sTG9va3VwIHtcbiAgcHJpdmF0ZSBsYWJlbHNTdGFjayA9IG5ldyBTdGFjazxMYWJlbHM+KCk7XG4gIHB1YmxpYyBjb25zdGFudHM6IENvbnN0YW50cztcbiAgcHJpdmF0ZSBzdGFydDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBzeW1ib2xUYWJsZTogU3ltYm9sVGFibGUsIHB1YmxpYyBlbnY6IEVudmlyb25tZW50LCBwdWJsaWMgcHJvZ3JhbTogUHJvZ3JhbSkge1xuICAgIHRoaXMuY29uc3RhbnRzID0gZW52LmNvbnN0YW50cztcbiAgICB0aGlzLnN0YXJ0ID0gcHJvZ3JhbS5uZXh0O1xuICB9XG5cbiAgYWJzdHJhY3QgY29tcGlsZTxFPihleHByOiBSZXByZXNlbnRzPEU+KTogRTtcbiAgYWJzdHJhY3QgY29tcGlsZUV4cHJlc3Npb24oZXhwcjogUmVwcmVzZW50c0V4cHJlc3Npb24pOiBDb21waWxlZEV4cHJlc3Npb248T3BhcXVlPjtcblxuICBwcml2YXRlIGdldCBwb3MoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvZ3JhbS5jdXJyZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXQgbmV4dFBvcygpIHtcbiAgICByZXR1cm4gdGhpcy5wcm9ncmFtLm5leHQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgb3Bjb2RlKG5hbWU6IE9wLCBvcDE/OiBudW1iZXIsIG9wMj86IG51bWJlciwgb3AzPzogbnVtYmVyKSB7XG4gICAgdGhpcy5wdXNoKGFwcGVuZE9wY29kZShuYW1lLCBvcDEsIG9wMiwgb3AzKSk7XG4gIH1cblxuICBwdXNoKG9wOiBPcHRpb248QXBwZW5kT3Bjb2RlPikge1xuICAgIC8vIGNvbnNvbGUubG9nKGBwdXNoaW5nICR7b3AgJiYgb3AudHlwZX1gKTtcbiAgICBpZiAob3AgPT09IG51bGwpIHtcbiAgICAgIHRoaXMucHJvZ3JhbS5wdXNoKFswLCAwLCAwLCAwXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHJvZ3JhbS5wdXNoKG9wKTtcbiAgICB9XG4gIH1cblxuICB0b1NsaWNlKCk6IFNsaWNlIHtcbiAgICByZXR1cm4gW3RoaXMuc3RhcnQsIHRoaXMucHJvZ3JhbS5jdXJyZW50XTtcbiAgfVxuXG4gIC8vIGhlbHBlcnNcblxuICBwcml2YXRlIGdldCBsYWJlbHMoKTogTGFiZWxzIHtcbiAgICByZXR1cm4gZXhwZWN0KHRoaXMubGFiZWxzU3RhY2suY3VycmVudCwgJ2J1Zzogbm90IGluIGEgbGFiZWwgc3RhY2snKTtcbiAgfVxuXG4gIHN0YXJ0TGFiZWxzKCkge1xuICAgIHRoaXMubGFiZWxzU3RhY2sucHVzaChuZXcgTGFiZWxzKCkpO1xuICB9XG5cbiAgc3RvcExhYmVscygpIHtcbiAgICBsZXQgbGFiZWwgPSBleHBlY3QodGhpcy5sYWJlbHNTdGFjay5wb3AoKSwgJ3VuYmFsYW5jZWQgcHVzaCBhbmQgcG9wIGxhYmVscycpO1xuICAgIGxhYmVsLnBhdGNoKHRoaXMuY29uc3RhbnRzLCB0aGlzLnByb2dyYW0pO1xuICB9XG5cbiAgLy8gcGFydGlhbHNcblxuICBwdXRQYXJ0aWFsRGVmaW5pdGlvbihfZGVmaW5pdGlvbjogUGFydGlhbERlZmluaXRpb248T3BhcXVlPikge1xuICAgIGxldCBkZWZpbml0aW9uID0gdGhpcy5jb25zdGFudHMub3RoZXIoX2RlZmluaXRpb24pO1xuICAgIHRoaXMub3Bjb2RlKE9wLlB1dFBhcnRpYWwsIGRlZmluaXRpb24pO1xuICB9XG5cbiAgcHV0RHluYW1pY1BhcnRpYWxEZWZpbml0aW9uKCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLlB1dER5bmFtaWNQYXJ0aWFsLCB0aGlzLmNvbnN0YW50cy5vdGhlcih0aGlzLnN5bWJvbFRhYmxlKSk7XG4gIH1cblxuICBldmFsdWF0ZVBhcnRpYWwoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuRXZhbHVhdGVQYXJ0aWFsLCB0aGlzLmNvbnN0YW50cy5vdGhlcih0aGlzLnN5bWJvbFRhYmxlKSwgdGhpcy5jb25zdGFudHMub3RoZXIoZGljdCgpKSk7XG4gIH1cblxuICAvLyBjb21wb25lbnRzXG5cbiAgcHV0Q29tcG9uZW50RGVmaW5pdGlvbihkZWZpbml0aW9uOiBDb21wb25lbnREZWZpbml0aW9uPE9wYXF1ZT4pIHtcbiAgICB0aGlzLm9wY29kZShPcC5QdXRDb21wb25lbnQsIHRoaXMub3RoZXIoZGVmaW5pdGlvbikpO1xuICB9XG5cbiAgcHV0RHluYW1pY0NvbXBvbmVudERlZmluaXRpb24oKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUHV0RHluYW1pY0NvbXBvbmVudCk7XG4gIH1cblxuICBvcGVuQ29tcG9uZW50KGFyZ3M6IFJlcHJlc2VudHM8Q29tcGlsZWRBcmdzPiwgc2hhZG93PzogSW5saW5lQmxvY2spIHtcbiAgICB0aGlzLm9wY29kZShPcC5PcGVuQ29tcG9uZW50LCB0aGlzLmFyZ3MoYXJncyksIHNoYWRvdyA/IHRoaXMuYmxvY2soc2hhZG93KSA6IDApO1xuICB9XG5cbiAgZGlkQ3JlYXRlRWxlbWVudCgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5EaWRDcmVhdGVFbGVtZW50KTtcbiAgfVxuXG4gIHNoYWRvd0F0dHJpYnV0ZXMoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuU2hhZG93QXR0cmlidXRlcyk7XG4gICAgdGhpcy5vcGNvZGUoT3AuQ2xvc2VCbG9jayk7XG4gIH1cblxuICBkaWRSZW5kZXJMYXlvdXQoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuRGlkUmVuZGVyTGF5b3V0KTtcbiAgfVxuXG4gIGNsb3NlQ29tcG9uZW50KCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkNsb3NlQ29tcG9uZW50KTtcbiAgfVxuXG4gIC8vIGNvbnRlbnRcblxuICBkeW5hbWljQ29udGVudChPcGNvZGU6IGNvbnRlbnQuQXBwZW5kRHluYW1pY09wY29kZTxJbnNlcnRpb24+KSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuRHluYW1pY0NvbnRlbnQsIHRoaXMub3RoZXIoT3Bjb2RlKSk7XG4gIH1cblxuICBjYXV0aW91c0FwcGVuZCgpIHtcbiAgICB0aGlzLmR5bmFtaWNDb250ZW50KG5ldyBjb250ZW50Lk9wdGltaXplZENhdXRpb3VzQXBwZW5kT3Bjb2RlKCkpO1xuICB9XG5cbiAgdHJ1c3RpbmdBcHBlbmQoKSB7XG4gICAgdGhpcy5keW5hbWljQ29udGVudChuZXcgY29udGVudC5PcHRpbWl6ZWRUcnVzdGluZ0FwcGVuZE9wY29kZSgpKTtcbiAgfVxuXG4gIGd1YXJkZWRDYXV0aW91c0FwcGVuZChleHByZXNzaW9uOiBSZXByZXNlbnRzRXhwcmVzc2lvbikge1xuICAgIHRoaXMuZHluYW1pY0NvbnRlbnQobmV3IGNvbnRlbnQuR3VhcmRlZENhdXRpb3VzQXBwZW5kT3Bjb2RlKHRoaXMuY29tcGlsZUV4cHJlc3Npb24oZXhwcmVzc2lvbiksIHRoaXMuc3ltYm9sVGFibGUpKTtcbiAgfVxuXG4gIGd1YXJkZWRUcnVzdGluZ0FwcGVuZChleHByZXNzaW9uOiBSZXByZXNlbnRzRXhwcmVzc2lvbikge1xuICAgIHRoaXMuZHluYW1pY0NvbnRlbnQobmV3IGNvbnRlbnQuR3VhcmRlZFRydXN0aW5nQXBwZW5kT3Bjb2RlKHRoaXMuY29tcGlsZUV4cHJlc3Npb24oZXhwcmVzc2lvbiksIHRoaXMuc3ltYm9sVGFibGUpKTtcbiAgfVxuXG4gIC8vIGRvbVxuXG4gIHRleHQodGV4dDogc3RyaW5nKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuVGV4dCwgdGhpcy5jb25zdGFudHMuc3RyaW5nKHRleHQpKTtcbiAgfVxuXG4gIG9wZW5QcmltaXRpdmVFbGVtZW50KHRhZzogc3RyaW5nKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuT3BlbkVsZW1lbnQsIHRoaXMuY29uc3RhbnRzLnN0cmluZyh0YWcpKTtcbiAgfVxuXG4gIG9wZW5Db21wb25lbnRFbGVtZW50KHRhZzogc3RyaW5nKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuT3BlbkNvbXBvbmVudEVsZW1lbnQsIHRoaXMuY29uc3RhbnRzLnN0cmluZyh0YWcpKTtcbiAgfVxuXG4gIG9wZW5EeW5hbWljUHJpbWl0aXZlRWxlbWVudCgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5PcGVuRHluYW1pY0VsZW1lbnQpO1xuICB9XG5cbiAgZmx1c2hFbGVtZW50KCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkZsdXNoRWxlbWVudCk7XG4gIH1cblxuICBjbG9zZUVsZW1lbnQoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuQ2xvc2VFbGVtZW50KTtcbiAgfVxuXG4gIHN0YXRpY0F0dHIoX25hbWU6IHN0cmluZywgX25hbWVzcGFjZTogT3B0aW9uPHN0cmluZz4sIF92YWx1ZTogc3RyaW5nKSB7XG4gICAgbGV0IG5hbWUgPSB0aGlzLmNvbnN0YW50cy5zdHJpbmcoX25hbWUpO1xuICAgIGxldCBuYW1lc3BhY2UgPSBfbmFtZXNwYWNlID8gdGhpcy5jb25zdGFudHMuc3RyaW5nKF9uYW1lc3BhY2UpIDogMDtcbiAgICBsZXQgdmFsdWUgPSB0aGlzLmNvbnN0YW50cy5zdHJpbmcoX3ZhbHVlKTtcblxuICAgIHRoaXMub3Bjb2RlKE9wLlN0YXRpY0F0dHIsIG5hbWUsIHZhbHVlLCBuYW1lc3BhY2UpO1xuICB9XG5cbiAgZHluYW1pY0F0dHJOUyhfbmFtZTogc3RyaW5nLCBfbmFtZXNwYWNlOiBzdHJpbmcsIHRydXN0aW5nOiBib29sZWFuKSB7XG4gICAgbGV0IG5hbWUgPSB0aGlzLmNvbnN0YW50cy5zdHJpbmcoX25hbWUpO1xuICAgIGxldCBuYW1lc3BhY2UgPSB0aGlzLmNvbnN0YW50cy5zdHJpbmcoX25hbWVzcGFjZSk7XG5cbiAgICB0aGlzLm9wY29kZShPcC5EeW5hbWljQXR0ck5TLCBuYW1lLCBuYW1lc3BhY2UsICh0cnVzdGluZyBhcyBhbnkpfDApO1xuICB9XG5cbiAgZHluYW1pY0F0dHIoX25hbWU6IHN0cmluZywgdHJ1c3Rpbmc6IGJvb2xlYW4pIHtcbiAgICBsZXQgbmFtZSA9IHRoaXMuY29uc3RhbnRzLnN0cmluZyhfbmFtZSk7XG4gICAgdGhpcy5vcGNvZGUoT3AuRHluYW1pY0F0dHIsIG5hbWUsICh0cnVzdGluZyBhcyBhbnkpfDApO1xuICB9XG5cbiAgY29tbWVudChfY29tbWVudDogc3RyaW5nKSB7XG4gICAgbGV0IGNvbW1lbnQgPSB0aGlzLmNvbnN0YW50cy5zdHJpbmcoX2NvbW1lbnQpO1xuICAgIHRoaXMub3Bjb2RlKE9wLkNvbW1lbnQsIGNvbW1lbnQpO1xuICB9XG5cbiAgbW9kaWZpZXIoX25hbWU6IHN0cmluZywgX2FyZ3M6IFJlcHJlc2VudHM8Q29tcGlsZWRBcmdzPikge1xuICAgIGxldCBhcmdzID0gdGhpcy5jb25zdGFudHMuZXhwcmVzc2lvbih0aGlzLmNvbXBpbGUoX2FyZ3MpKTtcbiAgICBsZXQgX21vZGlmaWVyTWFuYWdlciA9IHRoaXMuZW52Lmxvb2t1cE1vZGlmaWVyKFtfbmFtZV0sIHRoaXMuc3ltYm9sVGFibGUpO1xuICAgIGxldCBtb2RpZmllck1hbmFnZXIgPSB0aGlzLmNvbnN0YW50cy5vdGhlcihfbW9kaWZpZXJNYW5hZ2VyKTtcbiAgICBsZXQgbmFtZSA9IHRoaXMuY29uc3RhbnRzLnN0cmluZyhfbmFtZSk7XG4gICAgdGhpcy5vcGNvZGUoT3AuTW9kaWZpZXIsIG5hbWUsIG1vZGlmaWVyTWFuYWdlciwgYXJncyk7XG4gIH1cblxuICAvLyBsaXN0c1xuXG4gIHB1dEl0ZXJhdG9yKCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLlB1dEl0ZXJhdG9yKTtcbiAgfVxuXG4gIGVudGVyTGlzdChzdGFydDogc3RyaW5nLCBlbmQ6IHN0cmluZykge1xuICAgIHRoaXMucHVzaChudWxsKTtcbiAgICB0aGlzLmxhYmVscy5yYW5nZSh0aGlzLnBvcywgT3AuRW50ZXJMaXN0LCBzdGFydCwgZW5kKTtcbiAgfVxuXG4gIGV4aXRMaXN0KCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkV4aXRMaXN0KTtcbiAgfVxuXG4gIGVudGVyV2l0aEtleShzdGFydDogc3RyaW5nLCBlbmQ6IHN0cmluZykge1xuICAgIHRoaXMucHVzaChudWxsKTtcbiAgICB0aGlzLmxhYmVscy5yYW5nZSh0aGlzLnBvcywgT3AuRW50ZXJXaXRoS2V5LCBzdGFydCwgZW5kKTtcbiAgfVxuXG4gIG5leHRJdGVyKGVuZDogc3RyaW5nKSB7XG4gICAgdGhpcy5wdXNoKG51bGwpO1xuICAgIHRoaXMubGFiZWxzLmp1bXAodGhpcy5wb3MsIE9wLk5leHRJdGVyLCBlbmQpO1xuICB9XG5cbiAgLy8gdm1cblxuICBvcGVuQmxvY2soX2FyZ3M6IFJlcHJlc2VudHM8Q29tcGlsZWRBcmdzPiwgX2lubmVyOiBDb21waWxlZEdldEJsb2NrKSB7XG4gICAgbGV0IGFyZ3MgPSB0aGlzLmNvbnN0YW50cy5leHByZXNzaW9uKHRoaXMuY29tcGlsZShfYXJncykpO1xuICAgIGxldCBpbm5lciA9IHRoaXMuY29uc3RhbnRzLm90aGVyKF9pbm5lcik7XG4gICAgdGhpcy5vcGNvZGUoT3AuT3BlbkJsb2NrLCBpbm5lciwgYXJncyk7XG4gIH1cblxuICBjbG9zZUJsb2NrKCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkNsb3NlQmxvY2spO1xuICB9XG5cbiAgcHVzaFJlbW90ZUVsZW1lbnQoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUHVzaFJlbW90ZUVsZW1lbnQpO1xuICB9XG5cbiAgcG9wUmVtb3RlRWxlbWVudCgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5Qb3BSZW1vdGVFbGVtZW50KTtcbiAgfVxuXG4gIHBvcEVsZW1lbnQoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUG9wRWxlbWVudCk7XG4gIH1cblxuICBsYWJlbChuYW1lOiBzdHJpbmcpIHtcbiAgICB0aGlzLmxhYmVscy5sYWJlbChuYW1lLCB0aGlzLm5leHRQb3MpO1xuICB9XG5cbiAgcHVzaENoaWxkU2NvcGUoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUHVzaENoaWxkU2NvcGUpO1xuICB9XG5cbiAgcG9wU2NvcGUoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUG9wU2NvcGUpO1xuICB9XG5cbiAgcHVzaER5bmFtaWNTY29wZSgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5QdXNoRHluYW1pY1Njb3BlKTtcbiAgfVxuXG4gIHBvcER5bmFtaWNTY29wZSgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5Qb3BEeW5hbWljU2NvcGUpO1xuICB9XG5cbiAgcHV0TnVsbCgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5QdXQsIHRoaXMuY29uc3RhbnRzLk5VTExfUkVGRVJFTkNFKTtcbiAgfVxuXG4gIHB1dFZhbHVlKF9leHByZXNzaW9uOiBSZXByZXNlbnRzRXhwcmVzc2lvbikge1xuICAgIGxldCBleHByID0gdGhpcy5jb25zdGFudHMuZXhwcmVzc2lvbih0aGlzLmNvbXBpbGVFeHByZXNzaW9uKF9leHByZXNzaW9uKSk7XG4gICAgdGhpcy5vcGNvZGUoT3AuRXZhbHVhdGVQdXQsIGV4cHIpO1xuICB9XG5cbiAgcHV0QXJncyhfYXJnczogUmVwcmVzZW50czxDb21waWxlZEFyZ3M+KSB7XG4gICAgbGV0IGFyZ3MgPSB0aGlzLmNvbnN0YW50cy5leHByZXNzaW9uKHRoaXMuY29tcGlsZShfYXJncykpO1xuICAgIHRoaXMub3Bjb2RlKE9wLlB1dEFyZ3MsIGFyZ3MpO1xuICB9XG5cbiAgYmluZER5bmFtaWNTY29wZShfbmFtZXM6IHN0cmluZ1tdKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuQmluZER5bmFtaWNTY29wZSwgdGhpcy5uYW1lcyhfbmFtZXMpKTtcbiAgfVxuXG4gIGJpbmRQb3NpdGlvbmFsQXJncyhfbmFtZXM6IHN0cmluZ1tdLCBfc3ltYm9sczogbnVtYmVyW10pIHtcbiAgICB0aGlzLm9wY29kZShPcC5CaW5kUG9zaXRpb25hbEFyZ3MsIHRoaXMubmFtZXMoX25hbWVzKSwgdGhpcy5zeW1ib2xzKF9zeW1ib2xzKSk7XG4gIH1cblxuICBiaW5kTmFtZWRBcmdzKF9uYW1lczogc3RyaW5nW10sIF9zeW1ib2xzOiBudW1iZXJbXSkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkJpbmROYW1lZEFyZ3MsIHRoaXMubmFtZXMoX25hbWVzKSwgdGhpcy5zeW1ib2xzKF9zeW1ib2xzKSk7XG4gIH1cblxuICBiaW5kQmxvY2tzKF9uYW1lczogc3RyaW5nW10sIF9zeW1ib2xzOiBudW1iZXJbXSkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkJpbmRCbG9ja3MsIHRoaXMubmFtZXMoX25hbWVzKSwgdGhpcy5zeW1ib2xzKF9zeW1ib2xzKSk7XG4gIH1cblxuICBlbnRlcihlbnRlcjogc3RyaW5nLCBleGl0OiBzdHJpbmcpIHtcbiAgICB0aGlzLnB1c2gobnVsbCk7XG4gICAgdGhpcy5sYWJlbHMucmFuZ2UodGhpcy5wb3MsIE9wLkVudGVyLCBlbnRlciwgZXhpdCk7XG4gIH1cblxuICBleGl0KCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkV4aXQpO1xuICB9XG5cbiAgZXZhbHVhdGUoX2Jsb2NrOiBJbmxpbmVCbG9jaykge1xuICAgIGxldCBibG9jayA9IHRoaXMuY29uc3RhbnRzLmJsb2NrKF9ibG9jayk7XG4gICAgdGhpcy5vcGNvZGUoT3AuRXZhbHVhdGUsIGJsb2NrKTtcbiAgfVxuXG4gIHRlc3QodGVzdEZ1bmM6ICdjb25zdCcgfCAnc2ltcGxlJyB8ICdlbnZpcm9ubWVudCcgfCB2bS5UZXN0RnVuY3Rpb24pIHtcbiAgICBsZXQgX2Z1bmM6IHZtLlRlc3RGdW5jdGlvbjtcblxuICAgIGlmICh0ZXN0RnVuYyA9PT0gJ2NvbnN0Jykge1xuICAgICAgX2Z1bmMgPSB2bS5Db25zdFRlc3Q7XG4gICAgfSBlbHNlIGlmICh0ZXN0RnVuYyA9PT0gJ3NpbXBsZScpIHtcbiAgICAgIF9mdW5jID0gdm0uU2ltcGxlVGVzdDtcbiAgICB9IGVsc2UgaWYgKHRlc3RGdW5jID09PSAnZW52aXJvbm1lbnQnKSB7XG4gICAgICBfZnVuYyA9IHZtLkVudmlyb25tZW50VGVzdDtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiB0ZXN0RnVuYyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgX2Z1bmMgPSB0ZXN0RnVuYztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd1bnJlYWNoYWJsZScpO1xuICAgIH1cblxuICAgIGxldCBmdW5jID0gdGhpcy5jb25zdGFudHMuZnVuY3Rpb24oX2Z1bmMpO1xuICAgIHRoaXMub3Bjb2RlKE9wLlRlc3QsIGZ1bmMpO1xuICB9XG5cbiAganVtcCh0YXJnZXQ6IHN0cmluZykge1xuICAgIHRoaXMucHVzaChudWxsKTtcbiAgICB0aGlzLmxhYmVscy5qdW1wKHRoaXMucG9zLCBPcC5KdW1wLCB0YXJnZXQpO1xuICB9XG5cbiAganVtcElmKHRhcmdldDogc3RyaW5nKSB7XG4gICAgdGhpcy5wdXNoKG51bGwpO1xuICAgIHRoaXMubGFiZWxzLmp1bXAodGhpcy5wb3MsIE9wLkp1bXBJZiwgdGFyZ2V0KTtcbiAgfVxuXG4gIGp1bXBVbmxlc3ModGFyZ2V0OiBzdHJpbmcpIHtcbiAgICB0aGlzLnB1c2gobnVsbCk7XG4gICAgdGhpcy5sYWJlbHMuanVtcCh0aGlzLnBvcywgT3AuSnVtcFVubGVzcywgdGFyZ2V0KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBuYW1lcyhfbmFtZXM6IHN0cmluZ1tdKTogQ29uc3RhbnRBcnJheSB7XG4gICAgbGV0IG5hbWVzID0gX25hbWVzLm1hcChuID0+IHRoaXMuY29uc3RhbnRzLnN0cmluZyhuKSk7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzLmFycmF5KG5hbWVzKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBzeW1ib2xzKHN5bWJvbHM6IG51bWJlcltdKTogQ29uc3RhbnRBcnJheSB7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzLmFycmF5KHN5bWJvbHMpO1xuICB9XG5cbiAgcHJvdGVjdGVkIG90aGVyKHZhbHVlOiBPcGFxdWUpOiBDb25zdGFudE90aGVyIHtcbiAgICByZXR1cm4gdGhpcy5jb25zdGFudHMub3RoZXIodmFsdWUpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGFyZ3MoYXJnczogUmVwcmVzZW50czxDb21waWxlZEFyZ3M+KTogQ29uc3RhbnRFeHByZXNzaW9uIHtcbiAgICByZXR1cm4gdGhpcy5jb25zdGFudHMuZXhwcmVzc2lvbih0aGlzLmNvbXBpbGUoYXJncykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGJsb2NrKGJsb2NrOiBJbmxpbmVCbG9jayk6IENvbnN0YW50QmxvY2sge1xuICAgIHJldHVybiB0aGlzLmNvbnN0YW50cy5ibG9jayhibG9jayk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNDb21waWxhYmxlRXhwcmVzc2lvbjxFPihleHByOiBSZXByZXNlbnRzPEU+KTogZXhwciBpcyBDb21waWxlc0ludG88RT4ge1xuICByZXR1cm4gZXhwciAmJiB0eXBlb2YgZXhwclsnY29tcGlsZSddID09PSAnZnVuY3Rpb24nO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBPcGNvZGVCdWlsZGVyIGV4dGVuZHMgQmFzaWNPcGNvZGVCdWlsZGVyIHtcbiAgcHVibGljIGNvbXBvbmVudDogSUNvbXBvbmVudEJ1aWxkZXI7XG5cbiAgY29uc3RydWN0b3Ioc3ltYm9sVGFibGU6IFN5bWJvbFRhYmxlLCBlbnY6IEVudmlyb25tZW50LCBwcm9ncmFtOiBQcm9ncmFtID0gZW52LnByb2dyYW0pIHtcbiAgICBzdXBlcihzeW1ib2xUYWJsZSwgZW52LCBwcm9ncmFtKTtcbiAgICB0aGlzLmNvbXBvbmVudCA9IG5ldyBDb21wb25lbnRCdWlsZGVyKHRoaXMpO1xuICB9XG5cbiAgY29tcGlsZTxFPihleHByOiBSZXByZXNlbnRzPEU+KTogRSB7XG4gICAgaWYgKGlzQ29tcGlsYWJsZUV4cHJlc3Npb24oZXhwcikpIHtcbiAgICAgIHJldHVybiBleHByLmNvbXBpbGUodGhpcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBleHByO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBpbGVFeHByZXNzaW9uKGV4cHJlc3Npb246IFJlcHJlc2VudHNFeHByZXNzaW9uKTogQ29tcGlsZWRFeHByZXNzaW9uPE9wYXF1ZT4ge1xuICAgIGlmIChleHByZXNzaW9uIGluc3RhbmNlb2YgQ29tcGlsZWRFeHByZXNzaW9uKSB7XG4gICAgICByZXR1cm4gZXhwcmVzc2lvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGV4cHIoZXhwcmVzc2lvbiwgdGhpcyk7XG4gICAgfVxuICB9XG5cbiAgYmluZFBvc2l0aW9uYWxBcmdzRm9yTG9jYWxzKGxvY2FsczogRGljdDxudW1iZXI+KSB7XG4gICAgbGV0IHN5bWJvbHMgPSBPYmplY3Qua2V5cyhsb2NhbHMpLm1hcChuYW1lID0+IGxvY2Fsc1tuYW1lXSk7XG4gICAgdGhpcy5vcGNvZGUoT3AuQmluZFBvc2l0aW9uYWxBcmdzLCB0aGlzLnN5bWJvbHMoc3ltYm9scykpO1xuICB9XG5cbiAgcHJlbHVkZUZvckxheW91dChsYXlvdXQ6IFRlbXBsYXRlKSB7XG4gICAgbGV0IHN5bWJvbHMgPSBsYXlvdXQuc3ltYm9sVGFibGUuZ2V0U3ltYm9scygpO1xuXG4gICAgaWYgKHN5bWJvbHMubmFtZWQpIHtcbiAgICAgIGxldCBuYW1lZCA9IHN5bWJvbHMubmFtZWQ7XG4gICAgICBsZXQgbmFtZWROYW1lcyA9IE9iamVjdC5rZXlzKG5hbWVkKTtcbiAgICAgIGxldCBuYW1lZFN5bWJvbHMgPSBuYW1lZE5hbWVzLm1hcChuID0+IG5hbWVkW25dKTtcbiAgICAgIHRoaXMub3Bjb2RlKE9wLkJpbmROYW1lZEFyZ3MsIHRoaXMubmFtZXMobmFtZWROYW1lcyksIHRoaXMuc3ltYm9scyhuYW1lZFN5bWJvbHMpKTtcbiAgICB9XG5cbiAgICB0aGlzLm9wY29kZShPcC5CaW5kQ2FsbGVyU2NvcGUpO1xuXG4gICAgaWYgKHN5bWJvbHMueWllbGRzKSB7XG4gICAgICBsZXQgeWllbGRzID0gc3ltYm9scy55aWVsZHM7XG4gICAgICBsZXQgeWllbGROYW1lcyA9IE9iamVjdC5rZXlzKHlpZWxkcyk7XG4gICAgICBsZXQgeWllbGRTeW1ib2xzID0geWllbGROYW1lcy5tYXAobiA9PiB5aWVsZHNbbl0pO1xuICAgICAgdGhpcy5vcGNvZGUoT3AuQmluZEJsb2NrcywgdGhpcy5uYW1lcyh5aWVsZE5hbWVzKSwgdGhpcy5zeW1ib2xzKHlpZWxkU3ltYm9scykpO1xuICAgIH1cblxuICAgIGlmIChzeW1ib2xzLnBhcnRpYWxBcmdzKSB7XG4gICAgICB0aGlzLm9wY29kZShPcC5CaW5kUGFydGlhbEFyZ3MsIHN5bWJvbHMucGFydGlhbEFyZ3MpO1xuICAgIH1cbiAgfVxuXG4gIHlpZWxkKGFyZ3M6IFJlcHJlc2VudHM8Q29tcGlsZWRBcmdzPiwgdG86IHN0cmluZykge1xuICAgIGxldCB5aWVsZHM6IE9wdGlvbjxudW1iZXI+LCBwYXJ0aWFsOiBPcHRpb248bnVtYmVyPjtcbiAgICBsZXQgaW5uZXI6IENvbXBpbGVkR2V0QmxvY2s7XG5cbiAgICBpZiAoeWllbGRzID0gdGhpcy5zeW1ib2xUYWJsZS5nZXRTeW1ib2woJ3lpZWxkcycsIHRvKSkge1xuICAgICAgaW5uZXIgPSBuZXcgQ29tcGlsZWRHZXRCbG9ja0J5U3ltYm9sKHlpZWxkcywgdG8pO1xuICAgIH0gZWxzZSBpZiAocGFydGlhbCA9IHRoaXMuc3ltYm9sVGFibGUuZ2V0UGFydGlhbEFyZ3MoKSkge1xuICAgICAgaW5uZXIgPSBuZXcgQ29tcGlsZWRJblBhcnRpYWxHZXRCbG9jayhwYXJ0aWFsLCB0byk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignW0JVR10gJHt0b30gaXMgbm90IGEgdmFsaWQgYmxvY2sgbmFtZS4nKTtcbiAgICB9XG5cbiAgICB0aGlzLm9wZW5CbG9jayhhcmdzLCBpbm5lcik7XG4gICAgdGhpcy5jbG9zZUJsb2NrKCk7XG4gIH1cblxuICAvLyBUT0RPXG4gIC8vIGNvbWUgYmFjayB0byB0aGlzXG4gIGxhYmVsbGVkKGFyZ3M6IE9wdGlvbjxSZXByZXNlbnRzPENvbXBpbGVkQXJncz4+LCBjYWxsYmFjazogQmxvY2tDYWxsYmFjaykge1xuICAgIGlmIChhcmdzKSB0aGlzLnB1dEFyZ3MoYXJncyk7XG5cbiAgICB0aGlzLnN0YXJ0TGFiZWxzKCk7XG4gICAgdGhpcy5lbnRlcignQkVHSU4nLCAnRU5EJyk7XG4gICAgdGhpcy5sYWJlbCgnQkVHSU4nKTtcblxuICAgIGNhbGxiYWNrKHRoaXMsICdCRUdJTicsICdFTkQnKTtcblxuICAgIHRoaXMubGFiZWwoJ0VORCcpO1xuICAgIHRoaXMuZXhpdCgpO1xuICAgIHRoaXMuc3RvcExhYmVscygpO1xuICB9XG5cbiAgLy8gVE9ET1xuICAvLyBjb21lIGJhY2sgdG8gdGhpc1xuICBpdGVyKGNhbGxiYWNrOiBCbG9ja0NhbGxiYWNrKSB7XG4gICAgdGhpcy5zdGFydExhYmVscygpO1xuICAgIHRoaXMuZW50ZXJMaXN0KCdCRUdJTicsICdFTkQnKTtcbiAgICB0aGlzLmxhYmVsKCdJVEVSJyk7XG4gICAgdGhpcy5uZXh0SXRlcignQlJFQUsnKTtcbiAgICB0aGlzLmVudGVyV2l0aEtleSgnQkVHSU4nLCAnRU5EJyk7XG4gICAgdGhpcy5sYWJlbCgnQkVHSU4nKTtcblxuICAgIGNhbGxiYWNrKHRoaXMsICdCRUdJTicsICdFTkQnKTtcblxuICAgIHRoaXMubGFiZWwoJ0VORCcpO1xuICAgIHRoaXMuZXhpdCgpO1xuICAgIHRoaXMuanVtcCgnSVRFUicpO1xuICAgIHRoaXMubGFiZWwoJ0JSRUFLJyk7XG4gICAgdGhpcy5leGl0TGlzdCgpO1xuICAgIHRoaXMuc3RvcExhYmVscygpO1xuICB9XG5cbiAgLy8gVE9ET1xuICAvLyBjb21lIGJhY2sgdG8gdGhpc1xuICB1bml0KGNhbGxiYWNrOiAoYnVpbGRlcjogT3Bjb2RlQnVpbGRlcikgPT4gdm9pZCkge1xuICAgIHRoaXMuc3RhcnRMYWJlbHMoKTtcbiAgICBjYWxsYmFjayh0aGlzKTtcbiAgICB0aGlzLnN0b3BMYWJlbHMoKTtcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBCbG9ja0NhbGxiYWNrID0gKGRzbDogT3Bjb2RlQnVpbGRlciwgQkVHSU46IExhYmVsLCBFTkQ6IExhYmVsKSA9PiB2b2lkO1xuIl19