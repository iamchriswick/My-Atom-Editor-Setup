"use strict";
var util_1 = require("@glimmer/util");
function entryPoint(meta) {
    return new ProgramSymbolTable(meta);
}
exports.entryPoint = entryPoint;
function layout(meta, wireNamed, wireYields, hasPartials) {
    var _a = symbols(wireNamed, wireYields, hasPartials), named = _a.named, yields = _a.yields, partialSymbol = _a.partialSymbol, size = _a.size;
    return new ProgramSymbolTable(meta, named, yields, partialSymbol, size);
}
exports.layout = layout;
function block(parent, locals) {
    var localsMap = null;
    var program = parent['program'];
    if (locals.length !== 0) {
        var map_1 = localsMap = util_1.dict();
        locals.forEach(function (l) { return map_1[l] = program.size++; });
    }
    return new BlockSymbolTable(parent, program, localsMap);
}
exports.block = block;
function symbols(named, yields, hasPartials) {
    var yieldsMap = null;
    var namedMap = null;
    var size = 1;
    if (yields.length !== 0) {
        var map_2 = yieldsMap = util_1.dict();
        yields.forEach(function (y) { return map_2[y] = size++; });
    }
    if (named.length !== 0) {
        var map_3 = namedMap = util_1.dict();
        named.forEach(function (y) { return map_3[y] = size++; });
    }
    var partialSymbol = hasPartials ? size++ : null;
    return { named: namedMap, yields: yieldsMap, partialSymbol: partialSymbol, size: size };
}
var ProgramSymbolTable = (function () {
    function ProgramSymbolTable(meta, named, yields, partialArgs, size) {
        if (named === void 0) { named = null; }
        if (yields === void 0) { yields = null; }
        if (partialArgs === void 0) { partialArgs = null; }
        if (size === void 0) { size = 1; }
        this.meta = meta;
        this.named = named;
        this.yields = yields;
        this.partialArgs = partialArgs;
        this.size = size;
        this.program = this;
    }
    ProgramSymbolTable.prototype.getMeta = function () {
        return this.meta;
    };
    ProgramSymbolTable.prototype.getSymbols = function () {
        return {
            named: this.named,
            yields: this.yields,
            locals: null,
            partialArgs: this.partialArgs
        };
    };
    ProgramSymbolTable.prototype.getSymbol = function (kind, name) {
        if (kind === 'local')
            return null;
        return this[kind] && this[kind][name];
    };
    ProgramSymbolTable.prototype.getPartialArgs = function () {
        return this.partialArgs || 0;
    };
    return ProgramSymbolTable;
}());
exports.ProgramSymbolTable = ProgramSymbolTable;
var BlockSymbolTable = (function () {
    function BlockSymbolTable(parent, program, locals) {
        this.parent = parent;
        this.program = program;
        this.locals = locals;
    }
    BlockSymbolTable.prototype.getMeta = function () {
        return this.program.getMeta();
    };
    BlockSymbolTable.prototype.getSymbols = function () {
        return {
            named: null,
            yields: null,
            locals: this.locals,
            partialArgs: null
        };
    };
    BlockSymbolTable.prototype.getSymbol = function (kind, name) {
        if (kind === 'local') {
            return this.getLocal(name);
        }
        else {
            return this.program.getSymbol(kind, name);
        }
    };
    BlockSymbolTable.prototype.getLocal = function (name) {
        var _a = this, locals = _a.locals, parent = _a.parent;
        var symbol = locals && locals[name];
        if (!symbol && parent) {
            symbol = parent.getSymbol('local', name);
        }
        return symbol;
    };
    BlockSymbolTable.prototype.getPartialArgs = function () {
        return this.program.getPartialArgs();
    };
    return BlockSymbolTable;
}());
exports.BlockSymbolTable = BlockSymbolTable;
exports.EMPTY_SYMBOL_TABLE = {
    getMeta: function () {
        return null;
    },
    getSymbols: function () {
        return {
            named: null,
            yields: null,
            locals: null,
            partialArgs: null
        };
    },
    getSymbol: function (_kind, _name) {
        throw new Error("BUG: Calling getSymbol on EMPTY_SYMBOL_TABLE");
    },
    getPartialArgs: function () {
        return null;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ltYm9sLXRhYmxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQGdsaW1tZXIvcnVudGltZS9saWIvc3ltYm9sLXRhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxzQ0FBbUQ7QUFTbkQsb0JBQTJCLElBQTBCO0lBQ25ELE1BQU0sQ0FBQyxJQUFJLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3RDLENBQUM7QUFGRCxnQ0FFQztBQUVELGdCQUF1QixJQUFrQixFQUFFLFNBQW1CLEVBQUUsVUFBb0IsRUFBRSxXQUFvQjtJQUNwRyxJQUFBLGdEQUFvRixFQUFsRixnQkFBSyxFQUFFLGtCQUFNLEVBQUUsZ0NBQWEsRUFBRSxjQUFJLENBQWlEO0lBQ3pGLE1BQU0sQ0FBQyxJQUFJLGtCQUFrQixDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUMxRSxDQUFDO0FBSEQsd0JBR0M7QUFFRCxlQUFzQixNQUFtQixFQUFFLE1BQWdCO0lBQ3pELElBQUksU0FBUyxHQUF5QixJQUFJLENBQUM7SUFDM0MsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBRWhDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFJLEtBQUcsR0FBRyxTQUFTLEdBQUcsV0FBSSxFQUFVLENBQUM7UUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLEtBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQXZCLENBQXVCLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUksZ0JBQWdCLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztBQUMxRCxDQUFDO0FBVkQsc0JBVUM7QUFFRCxpQkFBaUIsS0FB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O0lBRUQsVUFBVSxFQUFWO1FBQ0UsTUFBTSxDQUFDO1lBQ0wsS0FBSyxFQUFFLElBQUk7WUFDWCxNQUFNLEVBQUUsSUFBSTtZQUNaLE1BQU0sRUFBRSxJQUFJO1lBQ1osV0FBVyxFQUFFLElBQUk7U0FDbEIsQ0FBQztJQUNKLENBQUM7SUFFRCxTQUFTLEVBQVQsVUFBVSxLQUFZLEVBQUUsS0FBYTtRQUNuQyxNQUFNLElBQUksS0FBSyxDQUFDLDhDQUE4QyxDQUFDLENBQUM7SUFDbEUsQ0FBQztJQUVELGNBQWMsRUFBZDtRQUNFLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9wdGlvbiwgRGljdCwgZGljdCB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xuaW1wb3J0IHsgVGVtcGxhdGVNZXRhIH0gZnJvbSAnQGdsaW1tZXIvd2lyZS1mb3JtYXQnO1xuaW1wb3J0IHtcbiAgU3ltYm9sVGFibGUsXG4gIFByb2dyYW1TeW1ib2xUYWJsZSBhcyBJUHJvZ3JhbVN5bWJvbFRhYmxlLFxuICBCbG9ja1N5bWJvbFRhYmxlIGFzIElCbG9ja1N5bWJvbFRhYmxlLFxuICBTeW1ib2xzXG59IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgZnVuY3Rpb24gZW50cnlQb2ludChtZXRhOiBPcHRpb248VGVtcGxhdGVNZXRhPik6IFByb2dyYW1TeW1ib2xUYWJsZSB7XG4gIHJldHVybiBuZXcgUHJvZ3JhbVN5bWJvbFRhYmxlKG1ldGEpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbGF5b3V0KG1ldGE6IFRlbXBsYXRlTWV0YSwgd2lyZU5hbWVkOiBzdHJpbmdbXSwgd2lyZVlpZWxkczogc3RyaW5nW10sIGhhc1BhcnRpYWxzOiBib29sZWFuKTogUHJvZ3JhbVN5bWJvbFRhYmxlIHtcbiAgbGV0IHsgbmFtZWQsIHlpZWxkcywgcGFydGlhbFN5bWJvbCwgc2l6ZSB9ID0gc3ltYm9scyh3aXJlTmFtZWQsIHdpcmVZaWVsZHMsIGhhc1BhcnRpYWxzKTtcbiAgcmV0dXJuIG5ldyBQcm9ncmFtU3ltYm9sVGFibGUobWV0YSwgbmFtZWQsIHlpZWxkcywgcGFydGlhbFN5bWJvbCwgc2l6ZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBibG9jayhwYXJlbnQ6IFN5bWJvbFRhYmxlLCBsb2NhbHM6IHN0cmluZ1tdKTogU3ltYm9sVGFibGUge1xuICBsZXQgbG9jYWxzTWFwOiBPcHRpb248RGljdDxudW1iZXI+PiA9IG51bGw7XG4gIGxldCBwcm9ncmFtID0gcGFyZW50Wydwcm9ncmFtJ107XG5cbiAgaWYgKGxvY2Fscy5sZW5ndGggIT09IDApIHtcbiAgICBsZXQgbWFwID0gbG9jYWxzTWFwID0gZGljdDxudW1iZXI+KCk7XG4gICAgbG9jYWxzLmZvckVhY2gobCA9PiBtYXBbbF0gPSBwcm9ncmFtLnNpemUrKyk7XG4gIH1cblxuICByZXR1cm4gbmV3IEJsb2NrU3ltYm9sVGFibGUocGFyZW50LCBwcm9ncmFtLCBsb2NhbHNNYXApO1xufVxuXG5mdW5jdGlvbiBzeW1ib2xzKG5hbWVkOiBzdHJpbmdbXSwgeWllbGRzOiBzdHJpbmdbXSwgaGFzUGFydGlhbHM6IGJvb2xlYW4pOiB7IG5hbWVkOiBPcHRpb248RGljdDxudW1iZXI+PiwgeWllbGRzOiBPcHRpb248RGljdDxudW1iZXI+PiwgcGFydGlhbFN5bWJvbDogT3B0aW9uPG51bWJlcj4sIHNpemU6IG51bWJlciB9IHtcbiAgbGV0IHlpZWxkc01hcDogT3B0aW9uPERpY3Q8bnVtYmVyPj4gPSBudWxsO1xuICBsZXQgbmFtZWRNYXA6IE9wdGlvbjxEaWN0PG51bWJlcj4+ID0gbnVsbDtcblxuICBsZXQgc2l6ZSA9IDE7XG5cbiAgaWYgKHlpZWxkcy5sZW5ndGggIT09IDApIHtcbiAgICBsZXQgbWFwID0geWllbGRzTWFwID0gZGljdDxudW1iZXI+KCk7XG4gICAgeWllbGRzLmZvckVhY2goeSA9PiBtYXBbeV0gPSBzaXplKyspO1xuICB9XG5cbiAgaWYgKG5hbWVkLmxlbmd0aCAhPT0gMCkge1xuICAgIGxldCBtYXAgPSBuYW1lZE1hcCA9IGRpY3Q8bnVtYmVyPigpO1xuICAgIG5hbWVkLmZvckVhY2goeSA9PiBtYXBbeV0gPSBzaXplKyspO1xuICB9XG5cbiAgbGV0IHBhcnRpYWxTeW1ib2w6IE9wdGlvbjxudW1iZXI+ID0gaGFzUGFydGlhbHMgPyBzaXplKysgOiBudWxsO1xuXG4gIHJldHVybiB7IG5hbWVkOiBuYW1lZE1hcCwgeWllbGRzOiB5aWVsZHNNYXAsIHBhcnRpYWxTeW1ib2wsIHNpemUgfTtcbn1cblxuZXhwb3J0IGNsYXNzIFByb2dyYW1TeW1ib2xUYWJsZSBpbXBsZW1lbnRzIElQcm9ncmFtU3ltYm9sVGFibGUge1xuICBwcm9ncmFtOiB0aGlzO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgbWV0YTogT3B0aW9uPFRlbXBsYXRlTWV0YT4sXG4gICAgcHJpdmF0ZSBuYW1lZDogT3B0aW9uPERpY3Q8bnVtYmVyPj4gPSBudWxsLFxuICAgIHByaXZhdGUgeWllbGRzOiBPcHRpb248RGljdDxudW1iZXI+PiA9IG51bGwsXG4gICAgcHJpdmF0ZSBwYXJ0aWFsQXJnczogT3B0aW9uPG51bWJlcj4gPSBudWxsLFxuICAgIHB1YmxpYyBzaXplID0gMVxuICApIHtcbiAgICB0aGlzLnByb2dyYW0gPSB0aGlzO1xuICB9XG5cbiAgZ2V0TWV0YSgpOiBPcHRpb248VGVtcGxhdGVNZXRhPiB7XG4gICAgcmV0dXJuIHRoaXMubWV0YTtcbiAgfVxuXG4gIGdldFN5bWJvbHMoKTogU3ltYm9scyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWVkOiB0aGlzLm5hbWVkLFxuICAgICAgeWllbGRzOiB0aGlzLnlpZWxkcyxcbiAgICAgIGxvY2FsczogbnVsbCxcbiAgICAgIHBhcnRpYWxBcmdzOiB0aGlzLnBhcnRpYWxBcmdzXG4gICAgfTtcbiAgfVxuXG4gIGdldFN5bWJvbChraW5kOiAnbG9jYWwnLCBuYW1lOiBzdHJpbmcpOiBudWxsO1xuICBnZXRTeW1ib2woa2luZDogJ2xvY2FsJyB8ICduYW1lZCcgfCAneWllbGRzJywgbmFtZTogc3RyaW5nKTogT3B0aW9uPG51bWJlcj47XG4gIGdldFN5bWJvbChraW5kOiBzdHJpbmcsIG5hbWU6IHN0cmluZyk6IE9wdGlvbjxudW1iZXI+IHtcbiAgICBpZiAoa2luZCA9PT0gJ2xvY2FsJykgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHRoaXNba2luZF0gJiYgdGhpc1traW5kXVtuYW1lXTtcbiAgfVxuXG4gIGdldFBhcnRpYWxBcmdzKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMucGFydGlhbEFyZ3MgfHwgMDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgQmxvY2tTeW1ib2xUYWJsZSBpbXBsZW1lbnRzIElCbG9ja1N5bWJvbFRhYmxlIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwYXJlbnQ6IFN5bWJvbFRhYmxlLCBwcm90ZWN0ZWQgcHJvZ3JhbTogUHJvZ3JhbVN5bWJvbFRhYmxlLCBwcml2YXRlIGxvY2FsczogT3B0aW9uPERpY3Q8bnVtYmVyPj4pIHtcbiAgfVxuXG4gIGdldE1ldGEoKTogT3B0aW9uPFRlbXBsYXRlTWV0YT4ge1xuICAgIHJldHVybiB0aGlzLnByb2dyYW0uZ2V0TWV0YSgpO1xuICB9XG5cbiAgZ2V0U3ltYm9scygpOiBTeW1ib2xzIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZWQ6IG51bGwsXG4gICAgICB5aWVsZHM6IG51bGwsXG4gICAgICBsb2NhbHM6IHRoaXMubG9jYWxzLFxuICAgICAgcGFydGlhbEFyZ3M6IG51bGxcbiAgICB9O1xuICB9XG5cbiAgZ2V0U3ltYm9sKGtpbmQ6ICdsb2NhbCcgfCAnbmFtZWQnIHwgJ3lpZWxkcycsIG5hbWU6IHN0cmluZyk6IE9wdGlvbjxudW1iZXI+IHtcbiAgICBpZiAoa2luZCA9PT0gJ2xvY2FsJykge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0TG9jYWwobmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLnByb2dyYW0uZ2V0U3ltYm9sKGtpbmQsIG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0TG9jYWwobmFtZTogc3RyaW5nKTogT3B0aW9uPG51bWJlcj4ge1xuICAgIGxldCB7IGxvY2FscywgcGFyZW50IH0gPSB0aGlzO1xuXG4gICAgbGV0IHN5bWJvbDogT3B0aW9uPG51bWJlcj4gPSBsb2NhbHMgJiYgbG9jYWxzW25hbWVdO1xuXG4gICAgaWYgKCFzeW1ib2wgJiYgcGFyZW50KSB7XG4gICAgICBzeW1ib2wgPSBwYXJlbnQuZ2V0U3ltYm9sKCdsb2NhbCcsIG5hbWUpO1xuICAgIH1cblxuICAgIHJldHVybiBzeW1ib2w7XG4gIH1cblxuICBnZXRQYXJ0aWFsQXJncygpOiBPcHRpb248bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMucHJvZ3JhbS5nZXRQYXJ0aWFsQXJncygpO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBFTVBUWV9TWU1CT0xfVEFCTEU6IFN5bWJvbFRhYmxlID0ge1xuICBnZXRNZXRhKCkge1xuICAgIHJldHVybiBudWxsO1xuICB9LFxuXG4gIGdldFN5bWJvbHMoKTogU3ltYm9scyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWVkOiBudWxsLFxuICAgICAgeWllbGRzOiBudWxsLFxuICAgICAgbG9jYWxzOiBudWxsLFxuICAgICAgcGFydGlhbEFyZ3M6IG51bGxcbiAgICB9O1xuICB9LFxuXG4gIGdldFN5bWJvbChfa2luZDogbmV2ZXIsIF9uYW1lOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkJVRzogQ2FsbGluZyBnZXRTeW1ib2wgb24gRU1QVFlfU1lNQk9MX1RBQkxFXCIpO1xuICB9LFxuXG4gIGdldFBhcnRpYWxBcmdzKCk6IE9wdGlvbjxudW1iZXI+IHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufTtcbiJdfQ==