"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var references_1 = require("../../references");
var utils_1 = require("../../utils");
var reference_1 = require("@glimmer/reference");
var util_1 = require("@glimmer/util");
var CompiledNamedArgs = (function () {
    function CompiledNamedArgs(keys, values) {
        this.keys = keys;
        this.values = values;
        this.length = keys.length;
        util_1.assert(keys.length === values.length, 'Keys and values do not have the same length');
    }
    CompiledNamedArgs.empty = function () {
        return exports.COMPILED_EMPTY_NAMED_ARGS;
    };
    CompiledNamedArgs.create = function (map) {
        var keys = Object.keys(map);
        var length = keys.length;
        if (length > 0) {
            var values = [];
            for (var i = 0; i < length; i++) {
                values[i] = map[keys[i]];
            }
            return new this(keys, values);
        }
        else {
            return exports.COMPILED_EMPTY_NAMED_ARGS;
        }
    };
    CompiledNamedArgs.prototype.evaluate = function (vm) {
        var _a = this, keys = _a.keys, values = _a.values, length = _a.length;
        var evaluated = new Array(length);
        for (var i = 0; i < length; i++) {
            evaluated[i] = values[i].evaluate(vm);
        }
        return new EvaluatedNamedArgs(keys, evaluated);
    };
    CompiledNamedArgs.prototype.toJSON = function () {
        var _a = this, keys = _a.keys, values = _a.values;
        var inner = keys.map(function (key, i) { return key + ": " + values[i].toJSON(); }).join(", ");
        return "{" + inner + "}";
    };
    return CompiledNamedArgs;
}());
exports.CompiledNamedArgs = CompiledNamedArgs;
exports.COMPILED_EMPTY_NAMED_ARGS = new ((function (_super) {
    __extends(class_1, _super);
    function class_1() {
        return _super.call(this, utils_1.EMPTY_ARRAY, utils_1.EMPTY_ARRAY) || this;
    }
    class_1.prototype.evaluate = function (_vm) {
        return exports.EVALUATED_EMPTY_NAMED_ARGS;
    };
    class_1.prototype.toJSON = function () {
        return "<EMPTY>";
    };
    return class_1;
}(CompiledNamedArgs)));
var EvaluatedNamedArgs = (function () {
    function EvaluatedNamedArgs(keys, values, _map) {
        if (_map === void 0) { _map = null; }
        this.keys = keys;
        this.values = values;
        this._map = _map;
        this.tag = reference_1.combineTagged(values);
        this.length = keys.length;
        util_1.assert(keys.length === values.length, 'Keys and values do not have the same length');
    }
    EvaluatedNamedArgs.create = function (map) {
        var keys = Object.keys(map);
        var length = keys.length;
        if (length > 0) {
            var values = new Array(length);
            for (var i = 0; i < length; i++) {
                values[i] = map[keys[i]];
            }
            return new this(keys, values, map);
        }
        else {
            return exports.EVALUATED_EMPTY_NAMED_ARGS;
        }
    };
    EvaluatedNamedArgs.empty = function () {
        return exports.EVALUATED_EMPTY_NAMED_ARGS;
    };
    Object.defineProperty(EvaluatedNamedArgs.prototype, "map", {
        get: function () {
            var map = this._map;
            if (map) {
                return map;
            }
            map = this._map = util_1.dict();
            var _a = this, keys = _a.keys, values = _a.values, length = _a.length;
            for (var i = 0; i < length; i++) {
                map[keys[i]] = values[i];
            }
            return map;
        },
        enumerable: true,
        configurable: true
    });
    EvaluatedNamedArgs.prototype.get = function (key) {
        var _a = this, keys = _a.keys, values = _a.values;
        var index = keys.indexOf(key);
        return (index === -1) ? references_1.UNDEFINED_REFERENCE : values[index];
    };
    EvaluatedNamedArgs.prototype.has = function (key) {
        return this.keys.indexOf(key) !== -1;
    };
    EvaluatedNamedArgs.prototype.value = function () {
        var _a = this, keys = _a.keys, values = _a.values;
        var out = util_1.dict();
        for (var i = 0; i < keys.length; i++) {
            var key = keys[i];
            var ref = values[i];
            out[key] = ref.value();
        }
        return out;
    };
    return EvaluatedNamedArgs;
}());
exports.EvaluatedNamedArgs = EvaluatedNamedArgs;
exports.EVALUATED_EMPTY_NAMED_ARGS = new ((function (_super) {
    __extends(class_2, _super);
    function class_2() {
        return _super.call(this, utils_1.EMPTY_ARRAY, utils_1.EMPTY_ARRAY, utils_1.EMPTY_DICT) || this;
    }
    class_2.prototype.get = function () {
        return references_1.UNDEFINED_REFERENCE;
    };
    class_2.prototype.has = function (_key) {
        return false;
    };
    class_2.prototype.value = function () {
        return utils_1.EMPTY_DICT;
    };
    return class_2;
}(EvaluatedNamedArgs)));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmFtZWQtYXJncy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL2NvbXBpbGVkL2V4cHJlc3Npb25zL25hbWVkLWFyZ3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsK0NBQXVEO0FBR3ZELHFDQUFzRDtBQUN0RCxnREFBK0U7QUFDL0Usc0NBQW1FO0FBRW5FO0lBd0JFLDJCQUNTLElBQTJCLEVBQzNCLE1BQWlEO1FBRGpELFNBQUksR0FBSixJQUFJLENBQXVCO1FBQzNCLFdBQU0sR0FBTixNQUFNLENBQTJDO1FBRXhELElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUMxQixhQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsTUFBTSxFQUFFLDZDQUE2QyxDQUFDLENBQUM7SUFDdkYsQ0FBQztJQTdCTSx1QkFBSyxHQUFaO1FBQ0UsTUFBTSxDQUFDLGlDQUF5QixDQUFDO0lBQ25DLENBQUM7SUFFTSx3QkFBTSxHQUFiLFVBQWMsR0FBcUM7UUFDakQsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUM1QixJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBRXpCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2YsSUFBSSxNQUFNLEdBQWlDLEVBQUUsQ0FBQztZQUU5QyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNoQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNCLENBQUM7WUFFRCxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FB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QUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVELGtDQUFLLEdBQUw7UUFDTSxJQUFBLFNBQXVCLEVBQXJCLGNBQUksRUFBRSxrQkFBTSxDQUFVO1FBRTVCLElBQUksR0FBRyxHQUFHLFdBQUksRUFBVSxDQUFDO1FBRXpCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3JDLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNsQixJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN6QixDQUFDO1FBRUQsTUFBTSxDQUFDLEdBQUcsQ0FBQztJQUNiLENBQUM7SUFDSCx5QkFBQztBQUFELENBQUMsQUE1RUQsSUE0RUM7QUE1RVksZ0RBQWtCO0FBOEVsQixRQUFBLDBCQUEwQixHQUF1QixJQUFJO0lBQWUsMkJBQWtCO0lBQ2pHO2VBQ0Usa0JBQU0sbUJBQVcsRUFBRSxtQkFBVyxFQUFFLGtCQUFVLENBQUM7SUFDN0MsQ0FBQztJQUVELHFCQUFHLEdBQUg7UUFDRSxNQUFNLENBQUMsZ0NBQW1CLENBQUM7SUFDN0IsQ0FBQztJQUVELHFCQUFHLEdBQUgsVUFBSSxJQUFZO1FBQ2QsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRCx1QkFBSyxHQUFMO1FBQ0UsTUFBTSxDQUFDLGtCQUFVLENBQUM7SUFDcEIsQ0FBQztJQUNILGNBQUM7QUFBRCxDQUFDLEFBaEJrRSxDQUFjLGtCQUFrQixHQWdCakcsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVOREVGSU5FRF9SRUZFUkVOQ0UgfSBmcm9tICcuLi8uLi9yZWZlcmVuY2VzJztcbmltcG9ydCB7IENvbXBpbGVkRXhwcmVzc2lvbiB9IGZyb20gJy4uL2V4cHJlc3Npb25zJztcbmltcG9ydCBWTSBmcm9tICcuLi8uLi92bS9hcHBlbmQnO1xuaW1wb3J0IHsgRU1QVFlfQVJSQVksIEVNUFRZX0RJQ1QgfSBmcm9tICcuLi8uLi91dGlscyc7XG5pbXBvcnQgeyBQYXRoUmVmZXJlbmNlLCBSZXZpc2lvblRhZywgY29tYmluZVRhZ2dlZCB9IGZyb20gJ0BnbGltbWVyL3JlZmVyZW5jZSc7XG5pbXBvcnQgeyBPcHRpb24sIERpY3QsIE9wYXF1ZSwgYXNzZXJ0LCBkaWN0IH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5cbmV4cG9ydCBjbGFzcyBDb21waWxlZE5hbWVkQXJncyB7XG4gIHN0YXRpYyBlbXB0eSgpOiBDb21waWxlZE5hbWVkQXJncyB7XG4gICAgcmV0dXJuIENPTVBJTEVEX0VNUFRZX05BTUVEX0FSR1M7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlKG1hcDogRGljdDxDb21waWxlZEV4cHJlc3Npb248T3BhcXVlPj4pOiBDb21waWxlZE5hbWVkQXJncyB7XG4gICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhtYXApO1xuICAgIGxldCBsZW5ndGggPSBrZXlzLmxlbmd0aDtcblxuICAgIGlmIChsZW5ndGggPiAwKSB7XG4gICAgICBsZXQgdmFsdWVzOiBDb21waWxlZEV4cHJlc3Npb248T3BhcXVlPltdID0gW107XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFsdWVzW2ldID0gbWFwW2tleXNbaV1dO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IHRoaXMoa2V5cywgdmFsdWVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIENPTVBJTEVEX0VNUFRZX05BTUVEX0FSR1M7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGxlbmd0aDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBrZXlzOiBSZWFkb25seUFycmF5PHN0cmluZz4sXG4gICAgcHVibGljIHZhbHVlczogUmVhZG9ubHlBcnJheTxDb21waWxlZEV4cHJlc3Npb248T3BhcXVlPj5cbiAgKSB7XG4gICAgdGhpcy5sZW5ndGggPSBrZXlzLmxlbmd0aDtcbiAgICBhc3NlcnQoa2V5cy5sZW5ndGggPT09IHZhbHVlcy5sZW5ndGgsICdLZXlzIGFuZCB2YWx1ZXMgZG8gbm90IGhhdmUgdGhlIHNhbWUgbGVuZ3RoJyk7XG4gIH1cblxuICBldmFsdWF0ZSh2bTogVk0pOiBFdmFsdWF0ZWROYW1lZEFyZ3Mge1xuICAgIGxldCB7IGtleXMsIHZhbHVlcywgbGVuZ3RoIH0gPSB0aGlzO1xuICAgIGxldCBldmFsdWF0ZWQ6IFBhdGhSZWZlcmVuY2U8T3BhcXVlPltdID0gbmV3IEFycmF5KGxlbmd0aCk7XG5cbiAgICBmb3IgKGxldCBpPTA7IGk8bGVuZ3RoOyBpKyspIHtcbiAgICAgIGV2YWx1YXRlZFtpXSA9IHZhbHVlc1tpXS5ldmFsdWF0ZSh2bSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ldyBFdmFsdWF0ZWROYW1lZEFyZ3Moa2V5cywgZXZhbHVhdGVkKTtcbiAgfVxuXG4gIHRvSlNPTigpOiBzdHJpbmcge1xuICAgIGxldCB7IGtleXMsIHZhbHVlcyB9ID0gdGhpcztcbiAgICBsZXQgaW5uZXIgPSBrZXlzLm1hcCgoa2V5LCBpKSA9PiBgJHtrZXl9OiAke3ZhbHVlc1tpXS50b0pTT04oKX1gKS5qb2luKFwiLCBcIik7XG4gICAgcmV0dXJuIGB7JHtpbm5lcn19YDtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgQ09NUElMRURfRU1QVFlfTkFNRURfQVJHUzogQ29tcGlsZWROYW1lZEFyZ3MgPSBuZXcgKGNsYXNzIGV4dGVuZHMgQ29tcGlsZWROYW1lZEFyZ3Mge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcihFTVBUWV9BUlJBWSwgRU1QVFlfQVJSQVkpO1xuICB9XG5cbiAgZXZhbHVhdGUoX3ZtOiBWTSk6IEV2YWx1YXRlZE5hbWVkQXJncyB7XG4gICAgcmV0dXJuIEVWQUxVQVRFRF9FTVBUWV9OQU1FRF9BUkdTO1xuICB9XG5cbiAgdG9KU09OKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGA8RU1QVFk+YDtcbiAgfVxufSk7XG5cbmV4cG9ydCBjbGFzcyBFdmFsdWF0ZWROYW1lZEFyZ3Mge1xuICBzdGF0aWMgY3JlYXRlKG1hcDogRGljdDxQYXRoUmVmZXJlbmNlPE9wYXF1ZT4+KSB7XG4gICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhtYXApO1xuICAgIGxldCBsZW5ndGggPSBrZXlzLmxlbmd0aDtcblxuICAgIGlmIChsZW5ndGggPiAwKSB7XG4gICAgICBsZXQgdmFsdWVzOiBQYXRoUmVmZXJlbmNlPE9wYXF1ZT5bXSA9IG5ldyBBcnJheShsZW5ndGgpO1xuXG4gICAgICBmb3IgKGxldCBpPTA7IGk8bGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFsdWVzW2ldID0gbWFwW2tleXNbaV1dO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbmV3IHRoaXMoa2V5cywgdmFsdWVzLCBtYXApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gRVZBTFVBVEVEX0VNUFRZX05BTUVEX0FSR1M7XG4gICAgfVxuICB9XG5cbiAgc3RhdGljIGVtcHR5KCk6IEV2YWx1YXRlZE5hbWVkQXJncyB7XG4gICAgcmV0dXJuIEVWQUxVQVRFRF9FTVBUWV9OQU1FRF9BUkdTO1xuICB9XG5cbiAgcHVibGljIHRhZzogUmV2aXNpb25UYWc7XG4gIHB1YmxpYyBsZW5ndGg6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMga2V5czogUmVhZG9ubHlBcnJheTxzdHJpbmc+LFxuICAgIHB1YmxpYyB2YWx1ZXM6IFJlYWRvbmx5QXJyYXk8UGF0aFJlZmVyZW5jZTxPcGFxdWU+PixcbiAgICBwcml2YXRlIF9tYXA6IE9wdGlvbjxEaWN0PFBhdGhSZWZlcmVuY2U8T3BhcXVlPj4+ID0gbnVsbFxuICApIHtcbiAgICB0aGlzLnRhZyA9IGNvbWJpbmVUYWdnZWQodmFsdWVzKTtcbiAgICB0aGlzLmxlbmd0aCA9IGtleXMubGVuZ3RoO1xuICAgIGFzc2VydChrZXlzLmxlbmd0aCA9PT0gdmFsdWVzLmxlbmd0aCwgJ0tleXMgYW5kIHZhbHVlcyBkbyBub3QgaGF2ZSB0aGUgc2FtZSBsZW5ndGgnKTtcbiAgfVxuXG4gIGdldCBtYXAoKTogRGljdDxQYXRoUmVmZXJlbmNlPE9wYXF1ZT4+IHtcbiAgICBsZXQgeyBfbWFwOiBtYXAgfSA9IHRoaXM7XG5cbiAgICBpZiAobWFwKSB7XG4gICAgICByZXR1cm4gbWFwO1xuICAgIH1cblxuICAgIG1hcCA9IHRoaXMuX21hcCA9IGRpY3Q8UGF0aFJlZmVyZW5jZTxPcGFxdWU+PigpO1xuXG4gICAgbGV0IHsga2V5cywgdmFsdWVzLCBsZW5ndGggfSA9IHRoaXM7XG5cbiAgICBmb3IobGV0IGk9MDsgaTxsZW5ndGg7IGkrKykge1xuICAgICAgbWFwW2tleXNbaV1dID0gdmFsdWVzW2ldO1xuICAgIH1cblxuICAgIHJldHVybiBtYXA7XG4gIH1cblxuICBnZXQoa2V5OiBzdHJpbmcpOiBQYXRoUmVmZXJlbmNlPE9wYXF1ZT4ge1xuICAgIGxldCB7IGtleXMsIHZhbHVlcyB9ID0gdGhpcztcbiAgICBsZXQgaW5kZXggPSBrZXlzLmluZGV4T2Yoa2V5KTtcbiAgICByZXR1cm4gKGluZGV4ID09PSAtMSkgPyBVTkRFRklORURfUkVGRVJFTkNFIDogdmFsdWVzW2luZGV4XTtcbiAgfVxuXG4gIGhhcyhrZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmtleXMuaW5kZXhPZihrZXkpICE9PSAtMTtcbiAgfVxuXG4gIHZhbHVlKCk6IERpY3Q8T3BhcXVlPiB7XG4gICAgbGV0IHsga2V5cywgdmFsdWVzIH0gPSB0aGlzO1xuXG4gICAgbGV0IG91dCA9IGRpY3Q8T3BhcXVlPigpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQga2V5ID0ga2V5c1tpXTtcbiAgICAgIGxldCByZWYgPSB2YWx1ZXNbaV07XG4gICAgICBvdXRba2V5XSA9IHJlZi52YWx1ZSgpO1xuICAgIH1cblxuICAgIHJldHVybiBvdXQ7XG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IEVWQUxVQVRFRF9FTVBUWV9OQU1FRF9BUkdTOiBFdmFsdWF0ZWROYW1lZEFyZ3MgPSBuZXcgKGNsYXNzIGV4dGVuZHMgRXZhbHVhdGVkTmFtZWRBcmdzIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoRU1QVFlfQVJSQVksIEVNUFRZX0FSUkFZLCBFTVBUWV9ESUNUKTtcbiAgfVxuXG4gIGdldCgpOiBQYXRoUmVmZXJlbmNlPE9wYXF1ZT4ge1xuICAgIHJldHVybiBVTkRFRklORURfUkVGRVJFTkNFO1xuICB9XG5cbiAgaGFzKF9rZXk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHZhbHVlKCk6IERpY3Q8T3BhcXVlPiB7XG4gICAgcmV0dXJuIEVNUFRZX0RJQ1Q7XG4gIH1cbn0pO1xuIl19