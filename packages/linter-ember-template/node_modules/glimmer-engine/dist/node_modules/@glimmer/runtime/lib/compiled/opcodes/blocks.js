"use strict";
var opcodes_1 = require("../../opcodes");
opcodes_1.APPEND_OPCODES.add(opcodes_1.OpcodeName.OpenBlock, function (vm, _a) {
    var _getBlock = _a.op1, _args = _a.op2;
    var inner = vm.constants.getOther(_getBlock);
    var rawArgs = vm.constants.getExpression(_args);
    var args = null;
    var block = inner.evaluate(vm);
    if (block) {
        args = rawArgs.evaluate(vm);
    }
    // FIXME: can we avoid doing this when we don't have a block?
    vm.pushCallerScope();
    if (block) {
        vm.invokeBlock(block, args || null);
    }
});
opcodes_1.APPEND_OPCODES.add(opcodes_1.OpcodeName.CloseBlock, function (vm) { return vm.popScope(); });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxvY2tzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQGdsaW1tZXIvcnVudGltZS9saWIvY29tcGlsZWQvb3Bjb2Rlcy9ibG9ja3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUVBLHlDQUFpRTtBQUdqRSx3QkFBYyxDQUFDLEdBQUcsQ0FBQyxvQkFBRSxDQUFDLFNBQVMsRUFBRSxVQUFDLEVBQUUsRUFBRSxFQUE4QjtRQUE1QixrQkFBYyxFQUFFLGNBQVU7SUFDaEUsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQW1CLFNBQVMsQ0FBQyxDQUFDO0lBQy9ELElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFlLEtBQUssQ0FBQyxDQUFDO0lBQzlELElBQUksSUFBSSxHQUEwQixJQUFJLENBQUM7SUFFdkMsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUUvQixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELDZEQUE2RDtJQUM3RCxFQUFFLENBQUMsZUFBZSxFQUFFLENBQUM7SUFFckIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNWLEVBQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQztJQUN0QyxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSCx3QkFBYyxDQUFDLEdBQUcsQ0FBQyxvQkFBRSxDQUFDLFVBQVUsRUFBRSxVQUFBLEVBQUUsSUFBSSxPQUFBLEVBQUUsQ0FBQyxRQUFRLEVBQUUsRUFBYixDQUFhLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBpbGVkR2V0QmxvY2sgfSBmcm9tICcuLi9leHByZXNzaW9ucy9oYXMtYmxvY2snO1xyXG5pbXBvcnQgeyBDb21waWxlZEFyZ3MsIEV2YWx1YXRlZEFyZ3MgfSBmcm9tICcuLi9leHByZXNzaW9ucy9hcmdzJztcclxuaW1wb3J0IHsgQVBQRU5EX09QQ09ERVMsIE9wY29kZU5hbWUgYXMgT3AgfSBmcm9tICcuLi8uLi9vcGNvZGVzJztcclxuaW1wb3J0IHsgT3B0aW9uIH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XHJcblxyXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuT3BlbkJsb2NrLCAodm0sIHsgb3AxOiBfZ2V0QmxvY2ssIG9wMjogX2FyZ3MgfSkgPT4ge1xyXG4gIGxldCBpbm5lciA9IHZtLmNvbnN0YW50cy5nZXRPdGhlcjxDb21waWxlZEdldEJsb2NrPihfZ2V0QmxvY2spO1xyXG4gIGxldCByYXdBcmdzID0gdm0uY29uc3RhbnRzLmdldEV4cHJlc3Npb248Q29tcGlsZWRBcmdzPihfYXJncyk7XHJcbiAgbGV0IGFyZ3M6IE9wdGlvbjxFdmFsdWF0ZWRBcmdzPiA9IG51bGw7XHJcblxyXG4gIGxldCBibG9jayA9IGlubmVyLmV2YWx1YXRlKHZtKTtcclxuXHJcbiAgaWYgKGJsb2NrKSB7XHJcbiAgICBhcmdzID0gcmF3QXJncy5ldmFsdWF0ZSh2bSk7XHJcbiAgfVxyXG5cclxuICAvLyBGSVhNRTogY2FuIHdlIGF2b2lkIGRvaW5nIHRoaXMgd2hlbiB3ZSBkb24ndCBoYXZlIGEgYmxvY2s/XHJcbiAgdm0ucHVzaENhbGxlclNjb3BlKCk7XHJcblxyXG4gIGlmIChibG9jaykge1xyXG4gICAgdm0uaW52b2tlQmxvY2soYmxvY2ssIGFyZ3MgfHwgbnVsbCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbkFQUEVORF9PUENPREVTLmFkZChPcC5DbG9zZUJsb2NrLCB2bSA9PiB2bS5wb3BTY29wZSgpKTtcclxuIl19