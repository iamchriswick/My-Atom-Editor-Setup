"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var test_helpers_1 = require("@glimmer/test-helpers");
var object_reference_1 = require("@glimmer/object-reference");
var env, root, result, self;
function rootElement() {
    return env.getDOM().createElement('div');
}
function compile(template) {
    return env.compile(template);
}
function commonSetup() {
    env = new test_helpers_1.TestEnvironment(); // TODO: Support SimpleDOM
    env.registerBasicComponent('my-component', MyComponent, "<div>{{yield}}</div>");
    root = rootElement();
}
function render(template, context) {
    if (context === void 0) { context = {}; }
    self = new object_reference_1.UpdatableReference(context);
    env.begin();
    result = template.render(self, root, new test_helpers_1.TestDynamicScope());
    env.commit();
    assertInvariants(result);
    return result;
}
function rerender(context) {
    if (context === void 0) { context = null; }
    if (context !== null)
        self.update(context);
    env.begin();
    result.rerender();
    env.commit();
}
function assertInvariants(result) {
    strictEqual(result.firstNode(), root.firstChild, "The firstNode of the result is the same as the root's firstChild");
    strictEqual(result.lastNode(), root.lastChild, "The lastNode of the result is the same as the root's lastChild");
}
QUnit.module("Components", {
    setup: commonSetup
});
var MyComponent = (function (_super) {
    __extends(MyComponent, _super);
    function MyComponent(attrs) {
        var _this = _super.call(this, attrs) || this;
        _this.attrs = attrs;
        return _this;
    }
    Object.defineProperty(MyComponent.prototype, "testing", {
        get: function () {
            if (this.attrs.color === 'red') {
                return '123';
            }
            else {
                return '456';
            }
        },
        enumerable: true,
        configurable: true
    });
    return MyComponent;
}(test_helpers_1.BasicComponent));
var MyOtherComponent = (function (_super) {
    __extends(MyOtherComponent, _super);
    function MyOtherComponent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return MyOtherComponent;
}(test_helpers_1.BasicComponent));
QUnit.test('creating a new component', function (assert) {
    var template = compile("<my-component color='{{color}}'>hello!</my-component>");
    render(template, { color: 'red' });
    test_helpers_1.equalTokens(root, "<div color='red'>hello!</div>");
    rerender({ color: 'green' });
    test_helpers_1.equalTokens(root, "<div color='green'>hello!</div>");
});
QUnit.test('the component class is its context', function (assert) {
    env.registerBasicComponent('my-component', MyComponent, '<div><p>{{testing}}</p>{{yield}}</div>');
    var template = compile("<my-component @color={{color}} color='{{color}}'>hello!</my-component>");
    render(template, { color: 'red' });
    test_helpers_1.equalTokens(root, "<div color='red'><p>123</p>hello!</div>");
    rerender({ color: 'green' });
    test_helpers_1.equalTokens(root, "<div color='green'><p>456</p>hello!</div>");
});
QUnit.test('attrs are available in the layout', function (assert) {
    env.registerBasicComponent('my-component', MyComponent, '<div><p>{{attrs.color}}</p>{{yield}}</div>');
    var template = compile("<my-component color='{{color}}' @color={{color}}>hello!</my-component>");
    render(template, { color: 'red' });
    test_helpers_1.equalTokens(root, "<div color='red'><p>red</p>hello!</div>");
    rerender({ color: 'green' });
    test_helpers_1.equalTokens(root, "<div color='green'><p>green</p>hello!</div>");
});
QUnit.test('nested components', function (assert) {
    env.registerBasicComponent('my-other-component', MyOtherComponent, '<p>{{yield}}</p>');
    var template = compile('<my-component><my-other-component>{{color}}</my-other-component></my-component>');
    render(template, { color: 'red' });
    test_helpers_1.equalTokens(root, '<div><p>red</p></div>');
    rerender({ color: 'green' });
    test_helpers_1.equalTokens(root, '<div><p>green</p></div>');
});
function testError(layout, expected) {
    QUnit.skip("'" + layout + "' produces an error like " + expected, function (assert) {
        env.registerBasicComponent('my-component', MyComponent, layout);
        var template = compile("<my-component>hello!</my-component>");
        assert.throws(function () { return render(template); }, expected);
    });
}
testError("<div>{{yield}}</div>nope", /non-whitespace text/);
testError("<div>{{yield}}</div><div></div>", /multiple root elements/);
testError("<div>{{yield}}</div>{{color}}", /cannot have curlies/);
testError("{{color}}", /cannot have curlies/);
testError("nope", /non-whitespace text/);
testError("", /single root element/);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcG9uZW50LXRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJAZ2xpbW1lci9ydW50aW1lL3Rlc3RzL2NvbXBvbmVudC10ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLHNEQUF1RztBQUN2Ryw4REFBK0Q7QUFHL0QsSUFBSSxHQUFvQixFQUFFLElBQW9CLEVBQUUsTUFBb0IsRUFBRSxJQUFnQyxDQUFDO0FBRXZHO0lBQ0UsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDM0MsQ0FBQztBQUVELGlCQUFpQixRQUFnQjtJQUMvQixNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUMvQixDQUFDO0FBRUQ7SUFDRSxHQUFHLEdBQUcsSUFBSSw4QkFBZSxFQUFFLENBQUMsQ0FBQywwQkFBMEI7SUFDdkQsR0FBRyxDQUFDLHNCQUFzQixDQUFDLGNBQWMsRUFBRSxXQUFXLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztJQUNoRixJQUFJLEdBQUcsV0FBVyxFQUFFLENBQUM7QUFDdkIsQ0FBQztBQUVELGdCQUFtQixRQUFxQixFQUFFLE9BQVU7SUFBVix3QkFBQSxFQUFBLFlBQVU7SUFDbEQsSUFBSSxHQUFHLElBQUkscUNBQWtCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDdkMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ1osTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLCtCQUFnQixFQUFFLENBQUMsQ0FBQztJQUM3RCxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDYixnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN6QixNQUFNLENBQUMsTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxrQkFBa0IsT0FBbUI7SUFBbkIsd0JBQUEsRUFBQSxjQUFtQjtJQUNuQyxF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QUFDN0QsU0FBUyxDQUFDLGlDQUFpQyxFQUFFLHdCQUF3QixDQUFDLENBQUM7QUFDdkUsU0FBUyxDQUFDLCtCQUErQixFQUFFLHFCQUFxQixDQUFDLENBQUM7QUFDbEUsU0FBUyxDQUFDLFdBQVcsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDO0FBQzlDLFNBQVMsQ0FBQyxNQUFNLEVBQUUscUJBQXFCLENBQUMsQ0FBQztBQUN6QyxTQUFTLENBQUMsRUFBRSxFQUFFLHFCQUFxQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTaW1wbGUsIFRlbXBsYXRlLCBSZW5kZXJSZXN1bHQgfSBmcm9tIFwiQGdsaW1tZXIvcnVudGltZVwiO1xuaW1wb3J0IHsgQmFzaWNDb21wb25lbnQsIFRlc3RFbnZpcm9ubWVudCwgVGVzdER5bmFtaWNTY29wZSwgZXF1YWxUb2tlbnMgfSBmcm9tIFwiQGdsaW1tZXIvdGVzdC1oZWxwZXJzXCI7XG5pbXBvcnQgeyBVcGRhdGFibGVSZWZlcmVuY2UgfSBmcm9tIFwiQGdsaW1tZXIvb2JqZWN0LXJlZmVyZW5jZVwiO1xuaW1wb3J0IHsgT3BhcXVlIH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5cbmxldCBlbnY6IFRlc3RFbnZpcm9ubWVudCwgcm9vdDogU2ltcGxlLkVsZW1lbnQsIHJlc3VsdDogUmVuZGVyUmVzdWx0LCBzZWxmOiBVcGRhdGFibGVSZWZlcmVuY2U8T3BhcXVlPjtcblxuZnVuY3Rpb24gcm9vdEVsZW1lbnQoKSB7XG4gIHJldHVybiBlbnYuZ2V0RE9NKCkuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG59XG5cbmZ1bmN0aW9uIGNvbXBpbGUodGVtcGxhdGU6IHN0cmluZykge1xuICByZXR1cm4gZW52LmNvbXBpbGUodGVtcGxhdGUpO1xufVxuXG5mdW5jdGlvbiBjb21tb25TZXR1cCgpIHtcbiAgZW52ID0gbmV3IFRlc3RFbnZpcm9ubWVudCgpOyAvLyBUT0RPOiBTdXBwb3J0IFNpbXBsZURPTVxuICBlbnYucmVnaXN0ZXJCYXNpY0NvbXBvbmVudCgnbXktY29tcG9uZW50JywgTXlDb21wb25lbnQsIFwiPGRpdj57e3lpZWxkfX08L2Rpdj5cIik7XG4gIHJvb3QgPSByb290RWxlbWVudCgpO1xufVxuXG5mdW5jdGlvbiByZW5kZXI8VD4odGVtcGxhdGU6IFRlbXBsYXRlPFQ+LCBjb250ZXh0PXt9KSB7XG4gIHNlbGYgPSBuZXcgVXBkYXRhYmxlUmVmZXJlbmNlKGNvbnRleHQpO1xuICBlbnYuYmVnaW4oKTtcbiAgcmVzdWx0ID0gdGVtcGxhdGUucmVuZGVyKHNlbGYsIHJvb3QsIG5ldyBUZXN0RHluYW1pY1Njb3BlKCkpO1xuICBlbnYuY29tbWl0KCk7XG4gIGFzc2VydEludmFyaWFudHMocmVzdWx0KTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gcmVyZW5kZXIoY29udGV4dDogYW55ID0gbnVsbCkge1xuICBpZiAoY29udGV4dCAhPT0gbnVsbCkgc2VsZi51cGRhdGUoY29udGV4dCk7XG4gIGVudi5iZWdpbigpO1xuICByZXN1bHQucmVyZW5kZXIoKTtcbiAgZW52LmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRJbnZhcmlhbnRzKHJlc3VsdCkge1xuICBzdHJpY3RFcXVhbChyZXN1bHQuZmlyc3ROb2RlKCksIHJvb3QuZmlyc3RDaGlsZCwgXCJUaGUgZmlyc3ROb2RlIG9mIHRoZSByZXN1bHQgaXMgdGhlIHNhbWUgYXMgdGhlIHJvb3QncyBmaXJzdENoaWxkXCIpO1xuICBzdHJpY3RFcXVhbChyZXN1bHQubGFzdE5vZGUoKSwgcm9vdC5sYXN0Q2hpbGQsIFwiVGhlIGxhc3ROb2RlIG9mIHRoZSByZXN1bHQgaXMgdGhlIHNhbWUgYXMgdGhlIHJvb3QncyBsYXN0Q2hpbGRcIik7XG59XG5cblFVbml0Lm1vZHVsZShcIkNvbXBvbmVudHNcIiwge1xuICBzZXR1cDogY29tbW9uU2V0dXBcbn0pO1xuXG5jbGFzcyBNeUNvbXBvbmVudCBleHRlbmRzIEJhc2ljQ29tcG9uZW50IHtcbiAgcHVibGljIGF0dHJzOiB7IGNvbG9yOiBzdHJpbmcgfTtcblxuICBjb25zdHJ1Y3RvcihhdHRyczogeyBjb2xvcjogc3RyaW5nIH0pIHtcbiAgICBzdXBlcihhdHRycyk7XG4gICAgdGhpcy5hdHRycyA9IGF0dHJzO1xuICB9XG5cbiAgZ2V0IHRlc3RpbmcoKSB7XG4gICAgaWYgKHRoaXMuYXR0cnMuY29sb3IgPT09ICdyZWQnKSB7XG4gICAgICByZXR1cm4gJzEyMyc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnNDU2JztcbiAgICB9XG4gIH1cbn1cblxuY2xhc3MgTXlPdGhlckNvbXBvbmVudCBleHRlbmRzIEJhc2ljQ29tcG9uZW50IHt9XG5cblFVbml0LnRlc3QoJ2NyZWF0aW5nIGEgbmV3IGNvbXBvbmVudCcsIGFzc2VydCA9PiB7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoXCI8bXktY29tcG9uZW50IGNvbG9yPSd7e2NvbG9yfX0nPmhlbGxvITwvbXktY29tcG9uZW50PlwiKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7IGNvbG9yOiAncmVkJyB9KTtcblxuICBlcXVhbFRva2Vucyhyb290LCBcIjxkaXYgY29sb3I9J3JlZCc+aGVsbG8hPC9kaXY+XCIpO1xuICByZXJlbmRlcih7IGNvbG9yOiAnZ3JlZW4nIH0pO1xuICBlcXVhbFRva2Vucyhyb290LCBcIjxkaXYgY29sb3I9J2dyZWVuJz5oZWxsbyE8L2Rpdj5cIik7XG59KTtcblxuUVVuaXQudGVzdCgndGhlIGNvbXBvbmVudCBjbGFzcyBpcyBpdHMgY29udGV4dCcsIGFzc2VydCA9PiB7XG4gIGVudi5yZWdpc3RlckJhc2ljQ29tcG9uZW50KCdteS1jb21wb25lbnQnLCBNeUNvbXBvbmVudCwgJzxkaXY+PHA+e3t0ZXN0aW5nfX08L3A+e3t5aWVsZH19PC9kaXY+Jyk7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoXCI8bXktY29tcG9uZW50IEBjb2xvcj17e2NvbG9yfX0gY29sb3I9J3t7Y29sb3J9fSc+aGVsbG8hPC9teS1jb21wb25lbnQ+XCIpO1xuICByZW5kZXIodGVtcGxhdGUsIHsgY29sb3I6ICdyZWQnIH0pO1xuXG4gIGVxdWFsVG9rZW5zKHJvb3QsIFwiPGRpdiBjb2xvcj0ncmVkJz48cD4xMjM8L3A+aGVsbG8hPC9kaXY+XCIpO1xuICByZXJlbmRlcih7IGNvbG9yOiAnZ3JlZW4nIH0pO1xuICBlcXVhbFRva2Vucyhyb290LCBcIjxkaXYgY29sb3I9J2dyZWVuJz48cD40NTY8L3A+aGVsbG8hPC9kaXY+XCIpO1xufSk7XG5cblFVbml0LnRlc3QoJ2F0dHJzIGFyZSBhdmFpbGFibGUgaW4gdGhlIGxheW91dCcsIGFzc2VydCA9PiB7XG4gIGVudi5yZWdpc3RlckJhc2ljQ29tcG9uZW50KCdteS1jb21wb25lbnQnLCBNeUNvbXBvbmVudCwgJzxkaXY+PHA+e3thdHRycy5jb2xvcn19PC9wPnt7eWllbGR9fTwvZGl2PicpO1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKFwiPG15LWNvbXBvbmVudCBjb2xvcj0ne3tjb2xvcn19JyBAY29sb3I9e3tjb2xvcn19PmhlbGxvITwvbXktY29tcG9uZW50PlwiKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7IGNvbG9yOiAncmVkJyB9KTtcblxuICBlcXVhbFRva2Vucyhyb290LCBcIjxkaXYgY29sb3I9J3JlZCc+PHA+cmVkPC9wPmhlbGxvITwvZGl2PlwiKTtcbiAgcmVyZW5kZXIoeyBjb2xvcjogJ2dyZWVuJyB9KTtcbiAgZXF1YWxUb2tlbnMocm9vdCwgXCI8ZGl2IGNvbG9yPSdncmVlbic+PHA+Z3JlZW48L3A+aGVsbG8hPC9kaXY+XCIpO1xufSk7XG5cblFVbml0LnRlc3QoJ25lc3RlZCBjb21wb25lbnRzJywgYXNzZXJ0ID0+IHtcbiAgZW52LnJlZ2lzdGVyQmFzaWNDb21wb25lbnQoJ215LW90aGVyLWNvbXBvbmVudCcsIE15T3RoZXJDb21wb25lbnQsICc8cD57e3lpZWxkfX08L3A+Jyk7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoJzxteS1jb21wb25lbnQ+PG15LW90aGVyLWNvbXBvbmVudD57e2NvbG9yfX08L215LW90aGVyLWNvbXBvbmVudD48L215LWNvbXBvbmVudD4nKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7IGNvbG9yOiAncmVkJyB9KTtcblxuICBlcXVhbFRva2Vucyhyb290LCAnPGRpdj48cD5yZWQ8L3A+PC9kaXY+Jyk7XG4gIHJlcmVuZGVyKHsgY29sb3I6ICdncmVlbicgfSk7XG4gIGVxdWFsVG9rZW5zKHJvb3QsICc8ZGl2PjxwPmdyZWVuPC9wPjwvZGl2PicpO1xufSk7XG5cbmZ1bmN0aW9uIHRlc3RFcnJvcihsYXlvdXQ6IHN0cmluZywgZXhwZWN0ZWQ6IFJlZ0V4cCkge1xuICBRVW5pdC5za2lwKGAnJHtsYXlvdXR9JyBwcm9kdWNlcyBhbiBlcnJvciBsaWtlICR7ZXhwZWN0ZWR9YCwgYXNzZXJ0ID0+IHtcbiAgICBlbnYucmVnaXN0ZXJCYXNpY0NvbXBvbmVudCgnbXktY29tcG9uZW50JywgTXlDb21wb25lbnQsIGxheW91dCk7XG4gICAgbGV0IHRlbXBsYXRlID0gY29tcGlsZShcIjxteS1jb21wb25lbnQ+aGVsbG8hPC9teS1jb21wb25lbnQ+XCIpO1xuICAgIGFzc2VydC50aHJvd3MoKCkgPT4gcmVuZGVyKHRlbXBsYXRlKSwgZXhwZWN0ZWQpO1xuICB9KTtcbn1cblxudGVzdEVycm9yKFwiPGRpdj57e3lpZWxkfX08L2Rpdj5ub3BlXCIsIC9ub24td2hpdGVzcGFjZSB0ZXh0Lyk7XG50ZXN0RXJyb3IoXCI8ZGl2Pnt7eWllbGR9fTwvZGl2PjxkaXY+PC9kaXY+XCIsIC9tdWx0aXBsZSByb290IGVsZW1lbnRzLyk7XG50ZXN0RXJyb3IoXCI8ZGl2Pnt7eWllbGR9fTwvZGl2Pnt7Y29sb3J9fVwiLCAvY2Fubm90IGhhdmUgY3VybGllcy8pO1xudGVzdEVycm9yKFwie3tjb2xvcn19XCIsIC9jYW5ub3QgaGF2ZSBjdXJsaWVzLyk7XG50ZXN0RXJyb3IoXCJub3BlXCIsIC9ub24td2hpdGVzcGFjZSB0ZXh0Lyk7XG50ZXN0RXJyb3IoXCJcIiwgL3NpbmdsZSByb290IGVsZW1lbnQvKTtcbiJdfQ==