"use strict";
var support_1 = require("../support");
var syntax_1 = require("@glimmer/syntax");
var errors_1 = require("@glimmer/syntax/lib/traversal/errors");
QUnit.module('[glimmer-syntax] Traversal - manipulating');
['enter', 'exit'].forEach(function (eventName) {
    QUnit.test("[" + eventName + "] Replacing self in a key (returning null)", function (assert) {
        var ast = syntax_1.preprocess("<x y={{z}} />");
        var attr = ast.body[0].attributes[0];
        assert.throws(function () {
            syntax_1.traverse(ast, {
                MustacheStatement: (_a = {},
                    _a[eventName] = function (node) {
                        if (node.path.parts[0] === 'z') {
                            return null;
                        }
                    },
                    _a)
            });
            var _a;
        }, errors_1.cannotRemoveNode(attr.value, attr, 'value'));
    });
    QUnit.test("[" + eventName + "] Replacing self in a key (returning an empty array)", function (assert) {
        var ast = syntax_1.preprocess("<x y={{z}} />");
        var attr = ast.body[0].attributes[0];
        assert.throws(function () {
            syntax_1.traverse(ast, {
                MustacheStatement: (_a = {},
                    _a[eventName] = function (node) {
                        if (node.path.parts[0] === 'z') {
                            return [];
                        }
                    },
                    _a)
            });
            var _a;
        }, errors_1.cannotRemoveNode(attr.value, attr, 'value'));
    });
    QUnit.test("[" + eventName + "] Replacing self in a key (returning a node)", function () {
        var ast = syntax_1.preprocess("<x y={{z}} />");
        syntax_1.traverse(ast, {
            MustacheStatement: (_a = {},
                _a[eventName] = function (node) {
                    if (node.path.parts[0] === 'z') {
                        return syntax_1.builders.mustache('a');
                    }
                },
                _a)
        });
        support_1.astEqual(ast, "<x y={{a}} />");
        var _a;
    });
    QUnit.test("[" + eventName + "] Replacing self in a key (returning an array with a single node)", function () {
        var ast = syntax_1.preprocess("<x y={{z}} />");
        syntax_1.traverse(ast, {
            MustacheStatement: (_a = {},
                _a[eventName] = function (node) {
                    if (node.path.parts[0] === 'z') {
                        return [syntax_1.builders.mustache('a')];
                    }
                },
                _a)
        });
        support_1.astEqual(ast, "<x y={{a}} />");
        var _a;
    });
    QUnit.test("[" + eventName + "] Replacing self in a key (returning an array with multiple nodes)", function (assert) {
        var ast = syntax_1.preprocess("<x y={{z}} />");
        var attr = ast.body[0].attributes[0];
        assert.throws(function () {
            syntax_1.traverse(ast, {
                MustacheStatement: (_a = {},
                    _a[eventName] = function (node) {
                        if (node.path.parts[0] === 'z') {
                            return [
                                syntax_1.builders.mustache('a'),
                                syntax_1.builders.mustache('b'),
                                syntax_1.builders.mustache('c')
                            ];
                        }
                    },
                    _a)
            });
            var _a;
        }, errors_1.cannotReplaceNode(attr.value, attr, 'value'));
    });
    QUnit.test("[" + eventName + "] Replacing self in an array (returning null)", function () {
        var ast = syntax_1.preprocess("{{x}}{{y}}{{z}}");
        syntax_1.traverse(ast, {
            MustacheStatement: (_a = {},
                _a[eventName] = function (node) {
                    if (node.path.parts[0] === 'y') {
                        return null;
                    }
                },
                _a)
        });
        support_1.astEqual(ast, "{{x}}{{z}}");
        var _a;
    });
    QUnit.test("[" + eventName + "] Replacing self in an array (returning an empty array)", function () {
        var ast = syntax_1.preprocess("{{x}}{{y}}{{z}}");
        syntax_1.traverse(ast, {
            MustacheStatement: (_a = {},
                _a[eventName] = function (node) {
                    if (node.path.parts[0] === 'y') {
                        return [];
                    }
                },
                _a)
        });
        support_1.astEqual(ast, "{{x}}{{z}}");
        var _a;
    });
    QUnit.test("[" + eventName + "] Replacing self in an array (returning a node)", function () {
        var ast = syntax_1.preprocess("{{x}}{{y}}{{z}}");
        syntax_1.traverse(ast, {
            MustacheStatement: (_a = {},
                _a[eventName] = function (node) {
                    if (node.path.parts[0] === 'y') {
                        return syntax_1.builders.mustache('a');
                    }
                },
                _a)
        });
        support_1.astEqual(ast, "{{x}}{{a}}{{z}}");
        var _a;
    });
    QUnit.test("[" + eventName + "] Replacing self in an array (returning an array with a single node)", function () {
        var ast = syntax_1.preprocess("{{x}}{{y}}{{z}}");
        syntax_1.traverse(ast, {
            MustacheStatement: (_a = {},
                _a[eventName] = function (node) {
                    if (node.path.parts[0] === 'y') {
                        return [syntax_1.builders.mustache('a')];
                    }
                },
                _a)
        });
        support_1.astEqual(ast, "{{x}}{{a}}{{z}}");
        var _a;
    });
    QUnit.test("[" + eventName + "] Replacing self in an array (returning an array with multiple nodes)", function () {
        var ast = syntax_1.preprocess("{{x}}{{y}}{{z}}");
        syntax_1.traverse(ast, {
            MustacheStatement: (_a = {},
                _a[eventName] = function (node) {
                    if (node.path.parts[0] === 'y') {
                        return [
                            syntax_1.builders.mustache('a'),
                            syntax_1.builders.mustache('b'),
                            syntax_1.builders.mustache('c')
                        ];
                    }
                },
                _a)
        });
        support_1.astEqual(ast, "{{x}}{{a}}{{b}}{{c}}{{z}}");
        var _a;
    });
});
QUnit.module('[glimmer-syntax] Traversal - manipulating (edge cases)');
QUnit.test('Inside of a block', function () {
    var ast = syntax_1.preprocess("{{y}}{{#w}}{{x}}{{y}}{{z}}{{/w}}");
    syntax_1.traverse(ast, {
        MustacheStatement: function (node) {
            if (node.path.parts[0] === 'y') {
                return [
                    syntax_1.builders.mustache('a'),
                    syntax_1.builders.mustache('b'),
                    syntax_1.builders.mustache('c')
                ];
            }
        }
    });
    support_1.astEqual(ast, "{{a}}{{b}}{{c}}{{#w}}{{x}}{{a}}{{b}}{{c}}{{z}}{{/w}}");
});
QUnit.test('Should recurrsively walk the transformed node', function (assert) {
    var ast = syntax_1.preprocess("{{x}}{{y}}{{z}}");
    syntax_1.traverse(ast, {
        MustacheStatement: function (node) {
            if (node.path.original === 'x') {
                return syntax_1.builders.mustache('y');
            }
            else if (node.path.original === 'y') {
                return syntax_1.builders.mustache('z');
            }
        }
    });
    support_1.astEqual(ast, "{{z}}{{z}}{{z}}");
});
QUnit.test('Should recurrsively walk the keys in the transformed node', function (assert) {
    var ast = syntax_1.preprocess("{{#foo}}{{#bar}}{{baz}}{{/bar}}{{else}}{{#bar}}{{bat}}{{/bar}}{{/foo}}");
    syntax_1.traverse(ast, {
        BlockStatement: function (node) {
            if (node.path.original === 'foo') {
                return syntax_1.builders.block(syntax_1.builders.path('x-foo'), node.params, node.hash, node.program, node.inverse, node.loc);
            }
            else if (node.path.original === 'bar') {
                return syntax_1.builders.block(syntax_1.builders.path('x-bar'), node.params, node.hash, node.program, node.inverse, node.loc);
            }
        },
        MustacheStatement: function (node) {
            if (node.path.original === 'baz') {
                return syntax_1.builders.mustache('x-baz');
            }
            else if (node.path.original === 'bat') {
                return syntax_1.builders.mustache('x-bat');
            }
        }
    });
    support_1.astEqual(ast, "{{#x-foo}}{{#x-bar}}{{x-baz}}{{/x-bar}}{{else}}{{#x-bar}}{{x-bat}}{{/x-bar}}{{/x-foo}}");
});
QUnit.test('Exit event is not triggered if the node is replaced during the enter event', function (assert) {
    var ast = syntax_1.preprocess("{{x}}");
    var entered = [];
    var exited = [];
    syntax_1.traverse(ast, {
        MustacheStatement: {
            enter: function (node) {
                entered.push(node.path.original);
                return syntax_1.builders.mustache('y');
            },
            exit: function (node) {
                exited.push(node.path.original);
            }
        }
    });
    assert.deepEqual(entered, ['x', 'y']);
    assert.deepEqual(exited, ['y']);
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFuaXB1bGF0aW5nLW5vZGUtdGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL3N5bnRheC90ZXN0cy90cmF2ZXJzYWwvbWFuaXB1bGF0aW5nLW5vZGUtdGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsc0NBQXNDO0FBQ3RDLDBDQUErRTtBQUUvRSwrREFHOEM7QUFFOUMsS0FBSyxDQUFDLE1BQU0sQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO0FBRTFELENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFBLFNBQVM7SUFDakMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFJLFNBQVMsK0NBQTRDLEVBQUUsVUFBQSxNQUFNO1FBQzFFLElBQUksR0FBRyxHQUFHLG1CQUFLLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDakMsSUFBSSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFckMsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUNaLGlCQUFRLENBQUMsR0FBRyxFQUFFO2dCQUNaLGlCQUFpQjtvQkFDZixHQUFDLFNBQVMsSUFBVixVQUFZLElBQUk7d0JBQ2QsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQzs0QkFDL0IsTUFBTSxDQUFDLElBQUksQ0FBQzt3QkFDZCxDQUFDO29CQUNILENBQUM7dUJBQ0Y7YUFDRixDQUFDLENBQUM7O1FBQ0wsQ0FBQyxFQUFFLHlCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7SUFDbEQsQ0FBQyxDQUFDLENBQUM7SUFFSCxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQUksU0FBUyx5REFBc0QsRUFBRSxVQUFBLE1BQU07UUFDcEYsSUFB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RSxDQUFDO0lBQ2pCLElBQUksTUFBTSxHQUFJLEVBQUUsQ0FBQztJQUVqQixpQkFBUSxDQUFDLEdBQUcsRUFBRTtRQUNaLGlCQUFpQixFQUFFO1lBQ2pCLEtBQUssWUFBQyxJQUFJO2dCQUNSLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztnQkFDakMsTUFBTSxDQUFDLGlCQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3pCLENBQUM7WUFDRCxJQUFJLFlBQUMsSUFBSTtnQkFDUCxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDbEMsQ0FBQztTQUNGO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN0QyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7QUFDbEMsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhc3RFcXVhbCB9IGZyb20gJy4uL3N1cHBvcnQnO1xuaW1wb3J0IHsgcHJlcHJvY2VzcyBhcyBwYXJzZSwgdHJhdmVyc2UsIGJ1aWxkZXJzIGFzIGIgfSBmcm9tIFwiQGdsaW1tZXIvc3ludGF4XCI7XG5cbmltcG9ydCB7XG4gIGNhbm5vdFJlbW92ZU5vZGUsXG4gIGNhbm5vdFJlcGxhY2VOb2RlLFxufSBmcm9tICdAZ2xpbW1lci9zeW50YXgvbGliL3RyYXZlcnNhbC9lcnJvcnMnO1xuXG5RVW5pdC5tb2R1bGUoJ1tnbGltbWVyLXN5bnRheF0gVHJhdmVyc2FsIC0gbWFuaXB1bGF0aW5nJyk7XG5cblsnZW50ZXInLCAnZXhpdCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYSBrZXkgKHJldHVybmluZyBudWxsKWAsIGFzc2VydCA9PiB7XG4gICAgbGV0IGFzdCA9IHBhcnNlKGA8eCB5PXt7en19IC8+YCk7XG4gICAgbGV0IGF0dHIgPSBhc3QuYm9keVswXS5hdHRyaWJ1dGVzWzBdO1xuXG4gICAgYXNzZXJ0LnRocm93cygoKSA9PiB7XG4gICAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgICBbZXZlbnROYW1lXShub2RlKSB7XG4gICAgICAgICAgICBpZiAobm9kZS5wYXRoLnBhcnRzWzBdID09PSAneicpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCBjYW5ub3RSZW1vdmVOb2RlKGF0dHIudmFsdWUsIGF0dHIsICd2YWx1ZScpKTtcbiAgfSk7XG5cbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYSBrZXkgKHJldHVybmluZyBhbiBlbXB0eSBhcnJheSlgLCBhc3NlcnQgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShgPHggeT17e3p9fSAvPmApO1xuICAgIGxldCBhdHRyID0gYXN0LmJvZHlbMF0uYXR0cmlidXRlc1swXTtcblxuICAgIGFzc2VydC50aHJvd3MoKCkgPT4ge1xuICAgICAgdHJhdmVyc2UoYXN0LCB7XG4gICAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgICAgW2V2ZW50TmFtZV0obm9kZSkge1xuICAgICAgICAgICAgaWYgKG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3onKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sIGNhbm5vdFJlbW92ZU5vZGUoYXR0ci52YWx1ZSwgYXR0ciwgJ3ZhbHVlJykpO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhIGtleSAocmV0dXJuaW5nIGEgbm9kZSlgLCAoKSA9PiB7XG4gICAgbGV0IGFzdCA9IHBhcnNlKGA8eCB5PXt7en19IC8+YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGUpIHtcbiAgICAgICAgICBpZiAobm9kZS5wYXRoLnBhcnRzWzBdID09PSAneicpIHtcbiAgICAgICAgICAgIHJldHVybiBiLm11c3RhY2hlKCdhJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBhc3RFcXVhbChhc3QsIGA8eCB5PXt7YX19IC8+YCk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGEga2V5IChyZXR1cm5pbmcgYW4gYXJyYXkgd2l0aCBhIHNpbmdsZSBub2RlKWAsICgpID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcblxuICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgW2V2ZW50TmFtZV0obm9kZSkge1xuICAgICAgICAgIGlmIChub2RlLnBhdGgucGFydHNbMF0gPT09ICd6Jykge1xuICAgICAgICAgICAgcmV0dXJuIFtiLm11c3RhY2hlKCdhJyldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgYXN0RXF1YWwoYXN0LCBgPHggeT17e2F9fSAvPmApO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhIGtleSAocmV0dXJuaW5nIGFuIGFycmF5IHdpdGggbXVsdGlwbGUgbm9kZXMpYCwgYXNzZXJ0ID0+IHtcbiAgICBsZXQgYXN0ID0gcGFyc2UoYDx4IHk9e3t6fX0gLz5gKTtcbiAgICBsZXQgYXR0ciA9IGFzdC5ib2R5WzBdLmF0dHJpYnV0ZXNbMF07XG5cbiAgICBhc3NlcnQudGhyb3dzKCgpID0+IHtcbiAgICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgICBNdXN0YWNoZVN0YXRlbWVudDoge1xuICAgICAgICAgIFtldmVudE5hbWVdKG5vZGUpIHtcbiAgICAgICAgICAgIGlmIChub2RlLnBhdGgucGFydHNbMF0gPT09ICd6Jykge1xuICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIGIubXVzdGFjaGUoJ2EnKSxcbiAgICAgICAgICAgICAgICBiLm11c3RhY2hlKCdiJyksXG4gICAgICAgICAgICAgICAgYi5tdXN0YWNoZSgnYycpXG4gICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCBjYW5ub3RSZXBsYWNlTm9kZShhdHRyLnZhbHVlLCBhdHRyLCAndmFsdWUnKSk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGFuIGFycmF5IChyZXR1cm5pbmcgbnVsbClgLCAoKSA9PiB7XG4gICAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fXt7eX19e3t6fX1gKTtcblxuICAgIHRyYXZlcnNlKGFzdCwge1xuICAgICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgICAgW2V2ZW50TmFtZV0obm9kZSkge1xuICAgICAgICAgIGlmIChub2RlLnBhdGgucGFydHNbMF0gPT09ICd5Jykge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBhc3RFcXVhbChhc3QsIGB7e3h9fXt7en19YCk7XG4gIH0pO1xuXG4gIFFVbml0LnRlc3QoYFske2V2ZW50TmFtZX1dIFJlcGxhY2luZyBzZWxmIGluIGFuIGFycmF5IChyZXR1cm5pbmcgYW4gZW1wdHkgYXJyYXkpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGUpIHtcbiAgICAgICAgICBpZiAobm9kZS5wYXRoLnBhcnRzWzBdID09PSAneScpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGFzdEVxdWFsKGFzdCwgYHt7eH19e3t6fX1gKTtcbiAgfSk7XG5cbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYW4gYXJyYXkgKHJldHVybmluZyBhIG5vZGUpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGUpIHtcbiAgICAgICAgICBpZiAobm9kZS5wYXRoLnBhcnRzWzBdID09PSAneScpIHtcbiAgICAgICAgICAgIHJldHVybiBiLm11c3RhY2hlKCdhJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBhc3RFcXVhbChhc3QsIGB7e3h9fXt7YX19e3t6fX1gKTtcbiAgfSk7XG5cbiAgUVVuaXQudGVzdChgWyR7ZXZlbnROYW1lfV0gUmVwbGFjaW5nIHNlbGYgaW4gYW4gYXJyYXkgKHJldHVybmluZyBhbiBhcnJheSB3aXRoIGEgc2luZ2xlIG5vZGUpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGUpIHtcbiAgICAgICAgICBpZiAobm9kZS5wYXRoLnBhcnRzWzBdID09PSAneScpIHtcbiAgICAgICAgICAgIHJldHVybiBbYi5tdXN0YWNoZSgnYScpXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGFzdEVxdWFsKGFzdCwgYHt7eH19e3thfX17e3p9fWApO1xuICB9KTtcblxuICBRVW5pdC50ZXN0KGBbJHtldmVudE5hbWV9XSBSZXBsYWNpbmcgc2VsZiBpbiBhbiBhcnJheSAocmV0dXJuaW5nIGFuIGFycmF5IHdpdGggbXVsdGlwbGUgbm9kZXMpYCwgKCkgPT4ge1xuICAgIGxldCBhc3QgPSBwYXJzZShge3t4fX17e3l9fXt7en19YCk7XG5cbiAgICB0cmF2ZXJzZShhc3QsIHtcbiAgICAgIE11c3RhY2hlU3RhdGVtZW50OiB7XG4gICAgICAgIFtldmVudE5hbWVdKG5vZGUpIHtcbiAgICAgICAgICBpZiAobm9kZS5wYXRoLnBhcnRzWzBdID09PSAneScpIHtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgIGIubXVzdGFjaGUoJ2EnKSxcbiAgICAgICAgICAgICAgYi5tdXN0YWNoZSgnYicpLFxuICAgICAgICAgICAgICBiLm11c3RhY2hlKCdjJylcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBhc3RFcXVhbChhc3QsIGB7e3h9fXt7YX19e3tifX17e2N9fXt7en19YCk7XG4gIH0pO1xufSk7XG5cblFVbml0Lm1vZHVsZSgnW2dsaW1tZXItc3ludGF4XSBUcmF2ZXJzYWwgLSBtYW5pcHVsYXRpbmcgKGVkZ2UgY2FzZXMpJyk7XG5cblFVbml0LnRlc3QoJ0luc2lkZSBvZiBhIGJsb2NrJywgKCkgPT4ge1xuICBsZXQgYXN0ID0gcGFyc2UoYHt7eX19e3sjd319e3t4fX17e3l9fXt7en19e3svd319YCk7XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgTXVzdGFjaGVTdGF0ZW1lbnQobm9kZSkge1xuICAgICAgaWYgKG5vZGUucGF0aC5wYXJ0c1swXSA9PT0gJ3knKSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAgYi5tdXN0YWNoZSgnYScpLFxuICAgICAgICAgIGIubXVzdGFjaGUoJ2InKSxcbiAgICAgICAgICBiLm11c3RhY2hlKCdjJylcbiAgICAgICAgXTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGFzdEVxdWFsKGFzdCwgYHt7YX19e3tifX17e2N9fXt7I3d9fXt7eH19e3thfX17e2J9fXt7Y319e3t6fX17ey93fX1gKTtcbn0pO1xuXG5RVW5pdC50ZXN0KCdTaG91bGQgcmVjdXJyc2l2ZWx5IHdhbGsgdGhlIHRyYW5zZm9ybWVkIG5vZGUnLCBhc3NlcnQgPT4ge1xuICBsZXQgYXN0ID0gcGFyc2UoYHt7eH19e3t5fX17e3p9fWApO1xuXG4gIHRyYXZlcnNlKGFzdCwge1xuICAgIE11c3RhY2hlU3RhdGVtZW50OiBmdW5jdGlvbihub2RlKSB7XG4gICAgICBpZiAobm9kZS5wYXRoLm9yaWdpbmFsID09PSAneCcpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3knKTtcbiAgICAgIH0gZWxzZSBpZiAobm9kZS5wYXRoLm9yaWdpbmFsID09PSAneScpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3onKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIGFzdEVxdWFsKGFzdCwgYHt7en19e3t6fX17e3p9fWApO1xufSk7XG5cblFVbml0LnRlc3QoJ1Nob3VsZCByZWN1cnJzaXZlbHkgd2FsayB0aGUga2V5cyBpbiB0aGUgdHJhbnNmb3JtZWQgbm9kZScsIGFzc2VydCA9PiB7XG4gIGxldCBhc3QgPSBwYXJzZShge3sjZm9vfX17eyNiYXJ9fXt7YmF6fX17ey9iYXJ9fXt7ZWxzZX19e3sjYmFyfX17e2JhdH19e3svYmFyfX17ey9mb299fWApO1xuXG4gIHRyYXZlcnNlKGFzdCwge1xuICAgIEJsb2NrU3RhdGVtZW50OiBmdW5jdGlvbihub2RlKSB7XG4gICAgICBpZiAobm9kZS5wYXRoLm9yaWdpbmFsID09PSAnZm9vJykge1xuICAgICAgICByZXR1cm4gYi5ibG9jayhiLnBhdGgoJ3gtZm9vJyksIG5vZGUucGFyYW1zLCBub2RlLmhhc2gsIG5vZGUucHJvZ3JhbSwgbm9kZS5pbnZlcnNlLCBub2RlLmxvYyk7XG4gICAgICB9IGVsc2UgaWYgKG5vZGUucGF0aC5vcmlnaW5hbCA9PT0gJ2JhcicpIHtcbiAgICAgICAgcmV0dXJuIGIuYmxvY2soYi5wYXRoKCd4LWJhcicpLCBub2RlLnBhcmFtcywgbm9kZS5oYXNoLCBub2RlLnByb2dyYW0sIG5vZGUuaW52ZXJzZSwgbm9kZS5sb2MpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBNdXN0YWNoZVN0YXRlbWVudDogZnVuY3Rpb24obm9kZSkge1xuICAgICAgaWYgKG5vZGUucGF0aC5vcmlnaW5hbCA9PT0gJ2JheicpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3gtYmF6Jyk7XG4gICAgICB9IGVsc2UgaWYgKG5vZGUucGF0aC5vcmlnaW5hbCA9PT0gJ2JhdCcpIHtcbiAgICAgICAgcmV0dXJuIGIubXVzdGFjaGUoJ3gtYmF0Jyk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBhc3RFcXVhbChhc3QsIGB7eyN4LWZvb319e3sjeC1iYXJ9fXt7eC1iYXp9fXt7L3gtYmFyfX17e2Vsc2V9fXt7I3gtYmFyfX17e3gtYmF0fX17ey94LWJhcn19e3sveC1mb299fWApO1xufSk7XG5cblFVbml0LnRlc3QoJ0V4aXQgZXZlbnQgaXMgbm90IHRyaWdnZXJlZCBpZiB0aGUgbm9kZSBpcyByZXBsYWNlZCBkdXJpbmcgdGhlIGVudGVyIGV2ZW50JywgYXNzZXJ0ID0+IHtcbiAgbGV0IGFzdCA9IHBhcnNlKGB7e3h9fWApO1xuXG4gIGxldCBlbnRlcmVkID0gW107XG4gIGxldCBleGl0ZWQgID0gW107XG5cbiAgdHJhdmVyc2UoYXN0LCB7XG4gICAgTXVzdGFjaGVTdGF0ZW1lbnQ6IHtcbiAgICAgIGVudGVyKG5vZGUpIHtcbiAgICAgICAgZW50ZXJlZC5wdXNoKG5vZGUucGF0aC5vcmlnaW5hbCk7XG4gICAgICAgIHJldHVybiBiLm11c3RhY2hlKCd5Jyk7XG4gICAgICB9LFxuICAgICAgZXhpdChub2RlKSB7XG4gICAgICAgIGV4aXRlZC5wdXNoKG5vZGUucGF0aC5vcmlnaW5hbCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBhc3NlcnQuZGVlcEVxdWFsKGVudGVyZWQsIFsneCcsICd5J10pO1xuICBhc3NlcnQuZGVlcEVxdWFsKGV4aXRlZCwgWyd5J10pO1xufSk7XG4iXX0=