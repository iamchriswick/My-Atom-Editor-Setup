"use strict";
var SimpleDOM = require("simple-dom");
var test_helpers_1 = require("@glimmer/test-helpers");
var compiler_1 = require("@glimmer/compiler");
var object_reference_1 = require("@glimmer/object-reference");
var node_1 = require("@glimmer/node");
var voidMap = SimpleDOM.voidMap;
var serializer = new SimpleDOM.HTMLSerializer(voidMap);
// const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';
// const XLINK_NAMESPACE = 'http://www.w3.org/1999/xlink';
// const XHTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';
var env, root;
var helper;
var doc;
function compile(template) {
    return env.compile(template);
}
function rootElement() {
    return env.getAppendOperations().createElement('div');
}
function commonSetup() {
    doc = new SimpleDOM.Document();
    helper = new node_1.NodeDOMTreeConstruction(doc);
    env = new test_helpers_1.TestEnvironment({
        document: doc,
        appendOperations: helper
    });
    root = rootElement();
}
function render(template, self) {
    var result;
    env.begin();
    result = template.render(new object_reference_1.UpdatableReference(self), root, new test_helpers_1.TestDynamicScope());
    env.commit();
    return result;
}
function module(name) {
    return QUnit.module(name, {
        beforeEach: function () { commonSetup(); }
    });
}
module("Server-side rendering in Node.js");
QUnit.test("HTML text content", function (assert) {
    var template = compile("content");
    render(template, {});
    assert.equal(serializer.serializeChildren(root), 'content');
});
QUnit.test("HTML tags", function (assert) {
    var template = compile("<h1>hello!</h1><div>content</div>");
    render(template, {});
    assert.equal(serializer.serializeChildren(root), "<h1>hello!</h1><div>content</div>");
});
QUnit.test("HTML tags re-rendered", function (assert) {
    var template = compile("<h1>hello!</h1><div>content</div>");
    var result = render(template, {});
    env.begin();
    result.rerender();
    env.commit();
    assert.equal(serializer.serializeChildren(root), "<h1>hello!</h1><div>content</div>");
});
QUnit.test("HTML attributes", function (assert) {
    var template = compile("<div id='bar' class='foo'>content</div>");
    render(template, {});
    assert.equal(serializer.serializeChildren(root), '<div id="bar" class="foo">content</div>');
});
QUnit.test("HTML tag with empty attribute", function (assert) {
    var template = compile("<div class=''>content</div>");
    render(template, {});
    assert.equal(serializer.serializeChildren(root), "<div class>content</div>");
});
QUnit.test("HTML boolean attribute 'disabled'", function (assert) {
    var template = compile('<input disabled>');
    render(template, {});
    assert.equal(serializer.serializeChildren(root), '<input disabled>', 'disabled without value set as property is true');
});
QUnit.skip("Quoted attribute expression is coerced to a string", function (assert) {
    var template = compile('<input disabled="{{isDisabled}}">');
    render(template, { isDisabled: null });
    assert.equal(serializer.serializeChildren(root), '<input disabled="null">', 'string of "null" set as property');
});
QUnit.test("Unquoted attribute expression with null value is not coerced", function (assert) {
    var template = compile('<input disabled={{isDisabled}}>');
    render(template, { isDisabled: null });
    assert.equal(serializer.serializeChildren(root), '<input>');
});
QUnit.test("Attribute expression can be followed by another attribute", function (assert) {
    var template = compile('<div foo="{{funstuff}}" name="Alice"></div>');
    render(template, { funstuff: "oh my" });
    assert.equal(serializer.serializeChildren(root), '<div foo="oh my" name="Alice"></div>');
});
QUnit.test("HTML tag with data- attribute", function (assert) {
    var template = compile("<div data-some-data='foo'>content</div>");
    render(template, {});
    assert.ok(serializer.serializeChildren(root), '<div data-some-data="foo">content</div>');
});
QUnit.test("The compiler can handle nesting", function (assert) {
    var html = '<div class="foo"><p><span id="bar" data-foo="bar">hi!</span></p></div>&nbsp;More content';
    var template = compile(html);
    render(template, {});
    // Note that the space after the closing div tag is a non-breaking space (Unicode 0xA0)
    assert.equal(serializer.serializeChildren(root), '<div class="foo"><p><span id="bar" data-foo="bar">hi!</span></p></div>Â More content');
});
QUnit.test("The compiler can handle comments", function (assert) {
    var html = '<div><!-- Just passing through --></div>';
    var template = compile(html);
    render(template, {});
    assert.equal(serializer.serializeChildren(root), html);
});
QUnit.test("The compiler can handle HTML comments with mustaches in them", function (assert) {
    var template = compile('<div><!-- {{foo}} --></div>');
    render(template, { foo: 'bar' });
    assert.equal(serializer.serializeChildren(root), '<div><!-- {{foo}} --></div>');
});
QUnit.test("The compiler can handle HTML comments with complex mustaches in them", function (assert) {
    var template = compile('<div><!-- {{foo bar baz}} --></div>');
    render(template, { foo: 'bar' });
    assert.equal(serializer.serializeChildren(root), '<div><!-- {{foo bar baz}} --></div>');
});
QUnit.test("The compiler can handle HTML comments with multi-line mustaches in them", function (assert) {
    var html = '<div><!-- {{#each foo as |bar|}}\n{{bar}}\n\n{{/each}} --></div>';
    var template = compile(html);
    render(template, { foo: 'bar' });
    assert.equal(serializer.serializeChildren(root), html);
});
QUnit.test("The compiler can handle comments with no parent element", function (assert) {
    var html = '<!-- {{foo}} -->';
    var template = compile(html);
    render(template, { foo: 'bar' });
    assert.equal(serializer.serializeChildren(root), html);
});
QUnit.test("The compiler can handle simple handlebars", function (assert) {
    var template = compile('<div>{{title}}</div>');
    render(template, { title: 'hello' });
    assert.equal(serializer.serializeChildren(root), '<div>hello</div>');
});
QUnit.test("The compiler can handle escaping HTML", function (assert) {
    var template = compile('<div>{{title}}</div>');
    render(template, { title: '<strong>hello</strong>' });
    assert.equal(serializer.serializeChildren(root), '<div>&lt;strong&gt;hello&lt;/strong&gt;</div>');
});
QUnit.test("The compiler can handle unescaped HTML", function (assert) {
    var template = compile('<div>{{{title}}}</div>');
    render(template, { title: '<strong>hello</strong>' });
    assert.equal(serializer.serializeChildren(root), '<div><strong>hello</strong></div>');
});
QUnit.test("Unescaped helpers render correctly", function (assert) {
    env.registerHelper('testing-unescaped', function (params) {
        return params[0];
    });
    var escapedTemplate = compile('{{{testing-unescaped "<span>hi</span>"}}}');
    render(escapedTemplate, {});
    assert.equal(serializer.serialize(root), '<div><span>hi</span></div>');
});
QUnit.test('Null literals do not have representation in DOM', function (assert) {
    var template = compile('{{null}}');
    render(template, {});
    assert.equal(serializer.serialize(root), '<div></div>');
});
QUnit.test("Attributes can be populated with helpers that generate a string", function (assert) {
    env.registerHelper('testing', function (params) {
        return params[0];
    });
    var escapedTemplate = compile('<a href="{{testing url}}">linky</a>');
    render(escapedTemplate, { url: 'linky.html' });
    assert.equal(serializer.serialize(root), '<div><a href="linky.html">linky</a></div>');
});
QUnit.test("Elements inside a yielded block", function (assert) {
    var template = compile('{{#if true}}<div id="test">123</div>{{/if}}');
    render(template, {});
    assert.equal(serializer.serialize(root), '<div><div id="test">123</div></div>');
});
QUnit.test("A simple block helper can return text", function (assert) {
    var template = compile('{{#if true}}test{{else}}not shown{{/if}}');
    render(template, {});
    assert.equal(serializer.serialize(root), '<div>test</div>');
});
QUnit.test('can instantiate NodeDOMTreeConstruction without a document', function (assert) {
    // this emulates what happens in Ember when using `App.visit('/', { shouldRender: false });`
    helper = new node_1.NodeDOMTreeConstruction(null);
    assert.ok(!!helper, 'helper was instantiated without errors');
});
QUnit.test("SVG: basic element", function (assert) {
    var template = "\n    <svg xmlns=\"http://www.w3.org/2000/svg\">\n      <rect x=\"10\" y=\"10\" height=\"100\" width=\"100\" style=\"stroke:#ff0000; fill: #0000ff\"></rect>\n    </svg>\n  ";
    render(compile(template), {});
    assert.equal(serializer.serializeChildren(root), template);
});
QUnit.test("SVG: element with xlink:href", function (assert) {
    var template = "\n    <svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n      <rect x=\".01\" y=\".01\" width=\"4.98\" height=\"2.98\" fill=\"none\" stroke=\"blue\" stroke-width=\".03\"></rect>\n      <a xlink:href=\"http://www.w3.org\">\n        <ellipse cx=\"2.5\" cy=\"1.5\" rx=\"2\" ry=\"1\" fill=\"red\"></ellipse>\n      </a>\n    </svg>\n  ";
    render(compile(template), {});
    assert.equal(serializer.serializeChildren(root), template);
});
module('default template id');
QUnit.test('generates id in node', function (assert) {
    var template = compiler_1.precompile('hello');
    var obj = JSON.parse(template);
    assert.equal(obj.id, 'ZDHnvwb1', 'short sha of template source');
    template = compiler_1.precompile('hello', { meta: { moduleName: 'template/hello' } });
    obj = JSON.parse(template);
    assert.equal(obj.id, 'mQsxG3uR', 'short sha of template source and meta');
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS10ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQGdsaW1tZXIvbm9kZS90ZXN0cy9ub2RlLXRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHNDQUF3QztBQUN4QyxzREFBMEU7QUFFMUUsOENBQStDO0FBQy9DLDhEQUErRDtBQUMvRCxzQ0FBd0Q7QUFFeEQsSUFBSSxPQUFPLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQztBQUVoQyxJQUFJLFVBQVUsR0FBRyxJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7QUFFdkQsc0RBQXNEO0FBQ3RELDBEQUEwRDtBQUMxRCwwREFBMEQ7QUFFMUQsSUFBSSxHQUFvQixFQUFFLElBQW9CLENBQUM7QUFDL0MsSUFBSSxNQUErQixDQUFDO0FBQ3BDLElBQUksR0FBb0IsQ0FBQztBQUV6QixpQkFBaUIsUUFBZ0I7SUFDL0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsQ0FBQztBQUVEO0lBQ0UsTUFBTSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUN4RCxDQUFDO0FBRUQ7SUFDRSxHQUFHLEdBQUcsSUFBSSxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDL0IsTUFBTSxHQUFHLElBQUksOEJBQXVCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDMUMsR0FBRyxHQUFHLElBQUksOEJBQWUsQ0FBQztRQUN4QixRQUFRLEVBQUUsR0FBRztRQUNiLGdCQUFnQixFQUFFLE1BQU07S0FDekIsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxHQUFHLFdBQVcsRUFBRSxDQUFDO0FBQ3ZCLENBQUM7QUFFRCxnQkFBbUIsUUFBcUIsRUFBRSxJQUFTO0lBQ2pELElBQUksTUFBTSxDQUFDO0lBQ1gsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ1osTUFBTSxHQUFHLFFBQVEsQ0FB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QU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUU5QixNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUM3RCxDQUFDLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBRTlCLEtBQUssQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsVUFBVSxNQUFNO0lBQ2pELElBQUksUUFBUSxHQUFHLHFCQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDbkMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMvQixNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsVUFBVSxFQUFFLDhCQUE4QixDQUFDLENBQUM7SUFDakUsUUFBUSxHQUFHLHFCQUFVLENBQUMsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLEVBQUMsVUFBVSxFQUFFLGdCQUFnQixFQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3pFLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzNCLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxVQUFVLEVBQUUsdUNBQXVDLENBQUMsQ0FBQztBQUM1RSxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIFNpbXBsZURPTSBmcm9tICdzaW1wbGUtZG9tJztcbmltcG9ydCB7IFRlc3RFbnZpcm9ubWVudCwgVGVzdER5bmFtaWNTY29wZSB9IGZyb20gJ0BnbGltbWVyL3Rlc3QtaGVscGVycyc7XG5pbXBvcnQgeyBUZW1wbGF0ZSwgU2ltcGxlIH0gZnJvbSAnQGdsaW1tZXIvcnVudGltZSc7XG5pbXBvcnQgeyBwcmVjb21waWxlIH0gZnJvbSAnQGdsaW1tZXIvY29tcGlsZXInO1xuaW1wb3J0IHsgVXBkYXRhYmxlUmVmZXJlbmNlIH0gZnJvbSAnQGdsaW1tZXIvb2JqZWN0LXJlZmVyZW5jZSc7XG5pbXBvcnQgeyBOb2RlRE9NVHJlZUNvbnN0cnVjdGlvbiB9IGZyb20gJ0BnbGltbWVyL25vZGUnO1xuXG5sZXQgdm9pZE1hcCA9IFNpbXBsZURPTS52b2lkTWFwO1xuXG5sZXQgc2VyaWFsaXplciA9IG5ldyBTaW1wbGVET00uSFRNTFNlcmlhbGl6ZXIodm9pZE1hcCk7XG5cbi8vIGNvbnN0IFNWR19OQU1FU1BBQ0UgPSAnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnO1xuLy8gY29uc3QgWExJTktfTkFNRVNQQUNFID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnO1xuLy8gY29uc3QgWEhUTUxfTkFNRVNQQUNFID0gJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwnO1xuXG5sZXQgZW52OiBUZXN0RW52aXJvbm1lbnQsIHJvb3Q6IFNpbXBsZS5FbGVtZW50O1xubGV0IGhlbHBlcjogTm9kZURPTVRyZWVDb25zdHJ1Y3Rpb247XG5sZXQgZG9jOiBTaW1wbGUuRG9jdW1lbnQ7XG5cbmZ1bmN0aW9uIGNvbXBpbGUodGVtcGxhdGU6IHN0cmluZykge1xuICByZXR1cm4gZW52LmNvbXBpbGUodGVtcGxhdGUpO1xufVxuXG5mdW5jdGlvbiByb290RWxlbWVudCgpOiBTaW1wbGUuRWxlbWVudCB7XG4gIHJldHVybiBlbnYuZ2V0QXBwZW5kT3BlcmF0aW9ucygpLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xufVxuXG5mdW5jdGlvbiBjb21tb25TZXR1cCgpIHtcbiAgZG9jID0gbmV3IFNpbXBsZURPTS5Eb2N1bWVudCgpO1xuICBoZWxwZXIgPSBuZXcgTm9kZURPTVRyZWVDb25zdHJ1Y3Rpb24oZG9jKTtcbiAgZW52ID0gbmV3IFRlc3RFbnZpcm9ubWVudCh7XG4gICAgZG9jdW1lbnQ6IGRvYyxcbiAgICBhcHBlbmRPcGVyYXRpb25zOiBoZWxwZXJcbiAgfSk7XG4gIHJvb3QgPSByb290RWxlbWVudCgpO1xufVxuXG5mdW5jdGlvbiByZW5kZXI8VD4odGVtcGxhdGU6IFRlbXBsYXRlPFQ+LCBzZWxmOiBhbnkpIHtcbiAgbGV0IHJlc3VsdDtcbiAgZW52LmJlZ2luKCk7XG4gIHJlc3VsdCA9IHRlbXBsYXRlLnJlbmRlcihuZXcgVXBkYXRhYmxlUmVmZXJlbmNlKHNlbGYpLCByb290LCBuZXcgVGVzdER5bmFtaWNTY29wZSgpKTtcbiAgZW52LmNvbW1pdCgpO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBtb2R1bGUobmFtZTogc3RyaW5nKSB7XG4gIHJldHVybiBRVW5pdC5tb2R1bGUobmFtZSwge1xuICAgIGJlZm9yZUVhY2goKSB7IGNvbW1vblNldHVwKCk7IH1cbiAgfSk7XG59XG5cbm1vZHVsZShcIlNlcnZlci1zaWRlIHJlbmRlcmluZyBpbiBOb2RlLmpzXCIpO1xuXG5RVW5pdC50ZXN0KFwiSFRNTCB0ZXh0IGNvbnRlbnRcIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoXCJjb250ZW50XCIpO1xuICByZW5kZXIodGVtcGxhdGUsIHt9KTtcblxuICBhc3NlcnQuZXF1YWwoc2VyaWFsaXplci5zZXJpYWxpemVDaGlsZHJlbihyb290KSwgJ2NvbnRlbnQnKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiSFRNTCB0YWdzXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKFwiPGgxPmhlbGxvITwvaDE+PGRpdj5jb250ZW50PC9kaXY+XCIpO1xuICByZW5kZXIodGVtcGxhdGUsIHt9KTtcblxuICBhc3NlcnQuZXF1YWwoc2VyaWFsaXplci5zZXJpYWxpemVDaGlsZHJlbihyb290KSwgXCI8aDE+aGVsbG8hPC9oMT48ZGl2PmNvbnRlbnQ8L2Rpdj5cIik7XG59KTtcblxuUVVuaXQudGVzdChcIkhUTUwgdGFncyByZS1yZW5kZXJlZFwiLCBmdW5jdGlvbihhc3NlcnQpIHtcbiAgbGV0IHRlbXBsYXRlID0gY29tcGlsZShcIjxoMT5oZWxsbyE8L2gxPjxkaXY+Y29udGVudDwvZGl2PlwiKTtcbiAgbGV0IHJlc3VsdCA9IHJlbmRlcih0ZW1wbGF0ZSwge30pO1xuXG4gIGVudi5iZWdpbigpO1xuICByZXN1bHQucmVyZW5kZXIoKTtcbiAgZW52LmNvbW1pdCgpO1xuXG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCBcIjxoMT5oZWxsbyE8L2gxPjxkaXY+Y29udGVudDwvZGl2PlwiKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiSFRNTCBhdHRyaWJ1dGVzXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKFwiPGRpdiBpZD0nYmFyJyBjbGFzcz0nZm9vJz5jb250ZW50PC9kaXY+XCIpO1xuICByZW5kZXIodGVtcGxhdGUsIHt9KTtcblxuICBhc3NlcnQuZXF1YWwoc2VyaWFsaXplci5zZXJpYWxpemVDaGlsZHJlbihyb290KSwgJzxkaXYgaWQ9XCJiYXJcIiBjbGFzcz1cImZvb1wiPmNvbnRlbnQ8L2Rpdj4nKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiSFRNTCB0YWcgd2l0aCBlbXB0eSBhdHRyaWJ1dGVcIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoXCI8ZGl2IGNsYXNzPScnPmNvbnRlbnQ8L2Rpdj5cIik7XG4gIHJlbmRlcih0ZW1wbGF0ZSwge30pO1xuXG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCBcIjxkaXYgY2xhc3M+Y29udGVudDwvZGl2PlwiKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiSFRNTCBib29sZWFuIGF0dHJpYnV0ZSAnZGlzYWJsZWQnXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKCc8aW5wdXQgZGlzYWJsZWQ+Jyk7XG4gIHJlbmRlcih0ZW1wbGF0ZSwge30pO1xuXG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCAnPGlucHV0IGRpc2FibGVkPicsICdkaXNhYmxlZCB3aXRob3V0IHZhbHVlIHNldCBhcyBwcm9wZXJ0eSBpcyB0cnVlJyk7XG59KTtcblxuUVVuaXQuc2tpcChcIlF1b3RlZCBhdHRyaWJ1dGUgZXhwcmVzc2lvbiBpcyBjb2VyY2VkIHRvIGEgc3RyaW5nXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKCc8aW5wdXQgZGlzYWJsZWQ9XCJ7e2lzRGlzYWJsZWR9fVwiPicpO1xuICByZW5kZXIodGVtcGxhdGUsIHsgaXNEaXNhYmxlZDogbnVsbCB9KTtcblxuICBhc3NlcnQuZXF1YWwoc2VyaWFsaXplci5zZXJpYWxpemVDaGlsZHJlbihyb290KSwgJzxpbnB1dCBkaXNhYmxlZD1cIm51bGxcIj4nLCAnc3RyaW5nIG9mIFwibnVsbFwiIHNldCBhcyBwcm9wZXJ0eScpO1xufSk7XG5cblFVbml0LnRlc3QoXCJVbnF1b3RlZCBhdHRyaWJ1dGUgZXhwcmVzc2lvbiB3aXRoIG51bGwgdmFsdWUgaXMgbm90IGNvZXJjZWRcIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoJzxpbnB1dCBkaXNhYmxlZD17e2lzRGlzYWJsZWR9fT4nKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7IGlzRGlzYWJsZWQ6IG51bGwgfSk7XG5cbiAgYXNzZXJ0LmVxdWFsKHNlcmlhbGl6ZXIuc2VyaWFsaXplQ2hpbGRyZW4ocm9vdCksICc8aW5wdXQ+Jyk7XG59KTtcblxuUVVuaXQudGVzdChcIkF0dHJpYnV0ZSBleHByZXNzaW9uIGNhbiBiZSBmb2xsb3dlZCBieSBhbm90aGVyIGF0dHJpYnV0ZVwiLCBmdW5jdGlvbihhc3NlcnQpIHtcbiAgbGV0IHRlbXBsYXRlID0gY29tcGlsZSgnPGRpdiBmb289XCJ7e2Z1bnN0dWZmfX1cIiBuYW1lPVwiQWxpY2VcIj48L2Rpdj4nKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7ZnVuc3R1ZmY6IFwib2ggbXlcIn0pO1xuXG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCAnPGRpdiBmb289XCJvaCBteVwiIG5hbWU9XCJBbGljZVwiPjwvZGl2PicpO1xufSk7XG5cblFVbml0LnRlc3QoXCJIVE1MIHRhZyB3aXRoIGRhdGEtIGF0dHJpYnV0ZVwiLCBmdW5jdGlvbihhc3NlcnQpIHtcbiAgbGV0IHRlbXBsYXRlID0gY29tcGlsZShcIjxkaXYgZGF0YS1zb21lLWRhdGE9J2Zvbyc+Y29udGVudDwvZGl2PlwiKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7fSk7XG5cbiAgYXNzZXJ0Lm9rKHNlcmlhbGl6ZXIuc2VyaWFsaXplQ2hpbGRyZW4ocm9vdCksICc8ZGl2IGRhdGEtc29tZS1kYXRhPVwiZm9vXCI+Y29udGVudDwvZGl2PicpO1xufSk7XG5cblFVbml0LnRlc3QoXCJUaGUgY29tcGlsZXIgY2FuIGhhbmRsZSBuZXN0aW5nXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgaHRtbCA9ICc8ZGl2IGNsYXNzPVwiZm9vXCI+PHA+PHNwYW4gaWQ9XCJiYXJcIiBkYXRhLWZvbz1cImJhclwiPmhpITwvc3Bhbj48L3A+PC9kaXY+Jm5ic3A7TW9yZSBjb250ZW50JztcbiAgbGV0IHRlbXBsYXRlID0gY29tcGlsZShodG1sKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7fSk7XG5cbiAgLy8gTm90ZSB0aGF0IHRoZSBzcGFjZSBhZnRlciB0aGUgY2xvc2luZyBkaXYgdGFnIGlzIGEgbm9uLWJyZWFraW5nIHNwYWNlIChVbmljb2RlIDB4QTApXG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCAnPGRpdiBjbGFzcz1cImZvb1wiPjxwPjxzcGFuIGlkPVwiYmFyXCIgZGF0YS1mb289XCJiYXJcIj5oaSE8L3NwYW4+PC9wPjwvZGl2PsKgTW9yZSBjb250ZW50Jyk7XG59KTtcblxuUVVuaXQudGVzdChcIlRoZSBjb21waWxlciBjYW4gaGFuZGxlIGNvbW1lbnRzXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgaHRtbCA9ICc8ZGl2PjwhLS0gSnVzdCBwYXNzaW5nIHRocm91Z2ggLS0+PC9kaXY+JztcbiAgbGV0IHRlbXBsYXRlID0gY29tcGlsZShodG1sKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7fSk7XG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCBodG1sKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiVGhlIGNvbXBpbGVyIGNhbiBoYW5kbGUgSFRNTCBjb21tZW50cyB3aXRoIG11c3RhY2hlcyBpbiB0aGVtXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKCc8ZGl2PjwhLS0ge3tmb299fSAtLT48L2Rpdj4nKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7IGZvbzogJ2JhcicgfSk7XG5cbiAgYXNzZXJ0LmVxdWFsKHNlcmlhbGl6ZXIuc2VyaWFsaXplQ2hpbGRyZW4ocm9vdCksICc8ZGl2PjwhLS0ge3tmb299fSAtLT48L2Rpdj4nKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiVGhlIGNvbXBpbGVyIGNhbiBoYW5kbGUgSFRNTCBjb21tZW50cyB3aXRoIGNvbXBsZXggbXVzdGFjaGVzIGluIHRoZW1cIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoJzxkaXY+PCEtLSB7e2ZvbyBiYXIgYmF6fX0gLS0+PC9kaXY+Jyk7XG4gIHJlbmRlcih0ZW1wbGF0ZSwgeyBmb286ICdiYXInIH0pO1xuXG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCAnPGRpdj48IS0tIHt7Zm9vIGJhciBiYXp9fSAtLT48L2Rpdj4nKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiVGhlIGNvbXBpbGVyIGNhbiBoYW5kbGUgSFRNTCBjb21tZW50cyB3aXRoIG11bHRpLWxpbmUgbXVzdGFjaGVzIGluIHRoZW1cIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCBodG1sID0gJzxkaXY+PCEtLSB7eyNlYWNoIGZvbyBhcyB8YmFyfH19XFxue3tiYXJ9fVxcblxcbnt7L2VhY2h9fSAtLT48L2Rpdj4nO1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKGh0bWwpO1xuICByZW5kZXIodGVtcGxhdGUsIHsgZm9vOiAnYmFyJyB9KTtcblxuICBhc3NlcnQuZXF1YWwoc2VyaWFsaXplci5zZXJpYWxpemVDaGlsZHJlbihyb290KSwgaHRtbCk7XG59KTtcblxuUVVuaXQudGVzdChcIlRoZSBjb21waWxlciBjYW4gaGFuZGxlIGNvbW1lbnRzIHdpdGggbm8gcGFyZW50IGVsZW1lbnRcIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCBodG1sID0gJzwhLS0ge3tmb299fSAtLT4nO1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKGh0bWwpO1xuICByZW5kZXIodGVtcGxhdGUsIHsgZm9vOiAnYmFyJyB9KTtcblxuICBhc3NlcnQuZXF1YWwoc2VyaWFsaXplci5zZXJpYWxpemVDaGlsZHJlbihyb290KSwgaHRtbCk7XG59KTtcblxuUVVuaXQudGVzdChcIlRoZSBjb21waWxlciBjYW4gaGFuZGxlIHNpbXBsZSBoYW5kbGViYXJzXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKCc8ZGl2Pnt7dGl0bGV9fTwvZGl2PicpO1xuICByZW5kZXIodGVtcGxhdGUsIHsgdGl0bGU6ICdoZWxsbycgfSk7XG5cbiAgYXNzZXJ0LmVxdWFsKHNlcmlhbGl6ZXIuc2VyaWFsaXplQ2hpbGRyZW4ocm9vdCksICc8ZGl2PmhlbGxvPC9kaXY+Jyk7XG59KTtcblxuUVVuaXQudGVzdChcIlRoZSBjb21waWxlciBjYW4gaGFuZGxlIGVzY2FwaW5nIEhUTUxcIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoJzxkaXY+e3t0aXRsZX19PC9kaXY+Jyk7XG4gIHJlbmRlcih0ZW1wbGF0ZSwgeyB0aXRsZTogJzxzdHJvbmc+aGVsbG88L3N0cm9uZz4nIH0pO1xuXG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCAnPGRpdj4mbHQ7c3Ryb25nJmd0O2hlbGxvJmx0Oy9zdHJvbmcmZ3Q7PC9kaXY+Jyk7XG59KTtcblxuUVVuaXQudGVzdChcIlRoZSBjb21waWxlciBjYW4gaGFuZGxlIHVuZXNjYXBlZCBIVE1MXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKCc8ZGl2Pnt7e3RpdGxlfX19PC9kaXY+Jyk7XG4gIHJlbmRlcih0ZW1wbGF0ZSwgeyB0aXRsZTogJzxzdHJvbmc+aGVsbG88L3N0cm9uZz4nIH0pO1xuXG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZUNoaWxkcmVuKHJvb3QpLCAnPGRpdj48c3Ryb25nPmhlbGxvPC9zdHJvbmc+PC9kaXY+Jyk7XG59KTtcblxuUVVuaXQudGVzdChcIlVuZXNjYXBlZCBoZWxwZXJzIHJlbmRlciBjb3JyZWN0bHlcIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGVudi5yZWdpc3RlckhlbHBlcigndGVzdGluZy11bmVzY2FwZWQnLCBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICByZXR1cm4gcGFyYW1zWzBdO1xuICB9KTtcblxuICBsZXQgZXNjYXBlZFRlbXBsYXRlID0gY29tcGlsZSgne3t7dGVzdGluZy11bmVzY2FwZWQgXCI8c3Bhbj5oaTwvc3Bhbj5cIn19fScpO1xuXG4gIHJlbmRlcihlc2NhcGVkVGVtcGxhdGUsIHt9KTtcblxuICBhc3NlcnQuZXF1YWwoc2VyaWFsaXplci5zZXJpYWxpemUocm9vdCksICc8ZGl2PjxzcGFuPmhpPC9zcGFuPjwvZGl2PicpO1xufSk7XG5cblFVbml0LnRlc3QoJ051bGwgbGl0ZXJhbHMgZG8gbm90IGhhdmUgcmVwcmVzZW50YXRpb24gaW4gRE9NJywgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCB0ZW1wbGF0ZSA9IGNvbXBpbGUoJ3t7bnVsbH19Jyk7XG5cbiAgcmVuZGVyKHRlbXBsYXRlLCB7fSk7XG5cbiAgYXNzZXJ0LmVxdWFsKHNlcmlhbGl6ZXIuc2VyaWFsaXplKHJvb3QpLCAnPGRpdj48L2Rpdj4nKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiQXR0cmlidXRlcyBjYW4gYmUgcG9wdWxhdGVkIHdpdGggaGVscGVycyB0aGF0IGdlbmVyYXRlIGEgc3RyaW5nXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBlbnYucmVnaXN0ZXJIZWxwZXIoJ3Rlc3RpbmcnLCBmdW5jdGlvbihwYXJhbXMpIHtcbiAgICByZXR1cm4gcGFyYW1zWzBdO1xuICB9KTtcblxuICBsZXQgZXNjYXBlZFRlbXBsYXRlID0gY29tcGlsZSgnPGEgaHJlZj1cInt7dGVzdGluZyB1cmx9fVwiPmxpbmt5PC9hPicpO1xuXG4gIHJlbmRlcihlc2NhcGVkVGVtcGxhdGUsIHsgdXJsOiAnbGlua3kuaHRtbCcgfSk7XG5cbiAgYXNzZXJ0LmVxdWFsKHNlcmlhbGl6ZXIuc2VyaWFsaXplKHJvb3QpLCAnPGRpdj48YSBocmVmPVwibGlua3kuaHRtbFwiPmxpbmt5PC9hPjwvZGl2PicpO1xufSk7XG5cblFVbml0LnRlc3QoXCJFbGVtZW50cyBpbnNpZGUgYSB5aWVsZGVkIGJsb2NrXCIsIGZ1bmN0aW9uKGFzc2VydCkge1xuICBsZXQgdGVtcGxhdGUgPSBjb21waWxlKCd7eyNpZiB0cnVlfX08ZGl2IGlkPVwidGVzdFwiPjEyMzwvZGl2Pnt7L2lmfX0nKTtcbiAgcmVuZGVyKHRlbXBsYXRlLCB7fSk7XG4gIGFzc2VydC5lcXVhbChzZXJpYWxpemVyLnNlcmlhbGl6ZShyb290KSwgJzxkaXY+PGRpdiBpZD1cInRlc3RcIj4xMjM8L2Rpdj48L2Rpdj4nKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiQSBzaW1wbGUgYmxvY2sgaGVscGVyIGNhbiByZXR1cm4gdGV4dFwiLCBmdW5jdGlvbihhc3NlcnQpIHtcbiAgbGV0IHRlbXBsYXRlID0gY29tcGlsZSgne3sjaWYgdHJ1ZX19dGVzdHt7ZWxzZX19bm90IHNob3due3svaWZ9fScpO1xuICByZW5kZXIodGVtcGxhdGUsIHt9KTtcbiAgYXNzZXJ0LmVxdWFsKHNlcmlhbGl6ZXIuc2VyaWFsaXplKHJvb3QpLCAnPGRpdj50ZXN0PC9kaXY+Jyk7XG59KTtcblxuUVVuaXQudGVzdCgnY2FuIGluc3RhbnRpYXRlIE5vZGVET01UcmVlQ29uc3RydWN0aW9uIHdpdGhvdXQgYSBkb2N1bWVudCcsIGZ1bmN0aW9uKGFzc2VydCkge1xuICAvLyB0aGlzIGVtdWxhdGVzIHdoYXQgaGFwcGVucyBpbiBFbWJlciB3aGVuIHVzaW5nIGBBcHAudmlzaXQoJy8nLCB7IHNob3VsZFJlbmRlcjogZmFsc2UgfSk7YFxuXG4gIGhlbHBlciA9IG5ldyBOb2RlRE9NVHJlZUNvbnN0cnVjdGlvbihudWxsKTtcblxuICBhc3NlcnQub2soISFoZWxwZXIsICdoZWxwZXIgd2FzIGluc3RhbnRpYXRlZCB3aXRob3V0IGVycm9ycycpO1xufSk7XG5cblFVbml0LnRlc3QoXCJTVkc6IGJhc2ljIGVsZW1lbnRcIiwgZnVuY3Rpb24oYXNzZXJ0KSB7XG4gIGxldCB0ZW1wbGF0ZSA9IGBcbiAgICA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj5cbiAgICAgIDxyZWN0IHg9XCIxMFwiIHk9XCIxMFwiIGhlaWdodD1cIjEwMFwiIHdpZHRoPVwiMTAwXCIgc3R5bGU9XCJzdHJva2U6I2ZmMDAwMDsgZmlsbDogIzAwMDBmZlwiPjwvcmVjdD5cbiAgICA8L3N2Zz5cbiAgYDtcbiAgcmVuZGVyKGNvbXBpbGUodGVtcGxhdGUpLCB7fSk7XG5cbiAgYXNzZXJ0LmVxdWFsKHNlcmlhbGl6ZXIuc2VyaWFsaXplQ2hpbGRyZW4ocm9vdCksIHRlbXBsYXRlKTtcbn0pO1xuXG5RVW5pdC50ZXN0KFwiU1ZHOiBlbGVtZW50IHdpdGggeGxpbms6aHJlZlwiLCBmdW5jdGlvbihhc3NlcnQpIHtcbiAgbGV0IHRlbXBsYXRlID0gYFxuICAgIDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHhtbG5zOnhsaW5rPVwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGlua1wiPlxuICAgICAgPHJlY3QgeD1cIi4wMVwiIHk9XCIuMDFcIiB3aWR0aD1cIjQuOThcIiBoZWlnaHQ9XCIyLjk4XCIgZmlsbD1cIm5vbmVcIiBzdHJva2U9XCJibHVlXCIgc3Ryb2tlLXdpZHRoPVwiLjAzXCI+PC9yZWN0PlxuICAgICAgPGEgeGxpbms6aHJlZj1cImh0dHA6Ly93d3cudzMub3JnXCI+XG4gICAgICAgIDxlbGxpcHNlIGN4PVwiMi41XCIgY3k9XCIxLjVcIiByeD1cIjJcIiByeT1cIjFcIiBmaWxsPVwicmVkXCI+PC9lbGxpcHNlPlxuICAgICAgPC9hPlxuICAgIDwvc3ZnPlxuICBgO1xuICByZW5kZXIoY29tcGlsZSh0ZW1wbGF0ZSksIHt9KTtcblxuICBhc3NlcnQuZXF1YWwoc2VyaWFsaXplci5zZXJpYWxpemVDaGlsZHJlbihyb290KSwgdGVtcGxhdGUpO1xufSk7XG5cbm1vZHVsZSgnZGVmYXVsdCB0ZW1wbGF0ZSBpZCcpO1xuXG5RVW5pdC50ZXN0KCdnZW5lcmF0ZXMgaWQgaW4gbm9kZScsIGZ1bmN0aW9uIChhc3NlcnQpIHtcbiAgbGV0IHRlbXBsYXRlID0gcHJlY29tcGlsZSgnaGVsbG8nKTtcbiAgbGV0IG9iaiA9IEpTT04ucGFyc2UodGVtcGxhdGUpO1xuICBhc3NlcnQuZXF1YWwob2JqLmlkLCAnWkRIbnZ3YjEnLCAnc2hvcnQgc2hhIG9mIHRlbXBsYXRlIHNvdXJjZScpO1xuICB0ZW1wbGF0ZSA9IHByZWNvbXBpbGUoJ2hlbGxvJywgeyBtZXRhOiB7bW9kdWxlTmFtZTogJ3RlbXBsYXRlL2hlbGxvJ30gfSk7XG4gIG9iaiA9IEpTT04ucGFyc2UodGVtcGxhdGUpO1xuICBhc3NlcnQuZXF1YWwob2JqLmlkLCAnbVFzeEczdVInLCAnc2hvcnQgc2hhIG9mIHRlbXBsYXRlIHNvdXJjZSBhbmQgbWV0YScpO1xufSk7XG4iXX0=