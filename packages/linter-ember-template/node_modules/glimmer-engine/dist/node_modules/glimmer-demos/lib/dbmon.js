"use strict";
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var object_reference_1 = require("@glimmer/object-reference");
var test_helpers_1 = require("@glimmer/test-helpers");
var ema_1 = require("./ema");
var Component = (function () {
    function Component(attrs) {
        this.element = null;
        this.attrs = attrs;
    }
    Component.create = function (_a) {
        var attrs = _a.attrs;
        return new this(attrs);
    };
    Component.prototype.set = function (key, value) {
        this[key] = value;
    };
    Component.prototype.didInitAttrs = function () { };
    Component.prototype.didUpdateAttrs = function () { };
    Component.prototype.didReceiveAttrs = function () { };
    Component.prototype.willInsertElement = function () { };
    Component.prototype.willUpdate = function () { };
    Component.prototype.willRender = function () { };
    Component.prototype.didInsertElement = function () { };
    Component.prototype.didUpdate = function () { };
    Component.prototype.didRender = function () { };
    return Component;
}());
var DbmonDatabase = (function (_super) {
    __extends(DbmonDatabase, _super);
    function DbmonDatabase() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(DbmonDatabase.prototype, "queries", {
        get: function () {
            var samples = this.attrs.db.samples;
            return samples[samples.length - 1].queries;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DbmonDatabase.prototype, "topFiveQueries", {
        get: function () {
            var queries = this.queries;
            var topFiveQueries = queries.slice(0, 5);
            while (topFiveQueries.length < 5) {
                topFiveQueries.push({ query: "" });
            }
            return topFiveQueries.map(function (query, index) {
                return {
                    key: index + '',
                    query: query.query,
                    elapsed: query.elapsed ? formatElapsed(query.elapsed) : '',
                    className: elapsedClass(query.elapsed)
                };
            });
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DbmonDatabase.prototype, "countClassName", {
        get: function () {
            var queries = this.queries;
            var countClassName = "label";
            if (queries.length >= 20) {
                countClassName += " label-important";
            }
            else if (queries.length >= 10) {
                countClassName += " label-warning";
            }
            else {
                countClassName += " label-success";
            }
            return countClassName;
        },
        enumerable: true,
        configurable: true
    });
    return DbmonDatabase;
}(Component));
var env = new test_helpers_1.TestEnvironment();
env.registerEmberishGlimmerComponent('dbmon-database', DbmonDatabase, "\n <tr>\n  <td class=\"dbname\">\n  {{db.name}}\n  </td>\n  <td class=\"query-count\">\n    <span class=\"{{countClassName}}\">\n      {{queries.length}}\n    </span>\n  </td>\n  {{#each topFiveQueries key=\"key\" as |query|}}\n    <td class=\"Query {{query.className}}\">\n      {{query.elapsed}}\n      <div class=\"popover left\">\n        <div class=\"popover-content\">{{query.query}}</div>\n        <div class=\"arrow\"></div>\n      </div>\n    </td>\n  {{/each}}\n </tr>\n");
var app = env.compile("\n{{#if fps}}<div id=\"fps\">{{fps}} FPS</div>{{/if}}\n\n<table class=\"table table-striped latest-data\">\n  <tbody>\n    {{#each model.databaseArray key='name' as |db|}}\n      {{dbmon-database db=db}}\n    {{/each}}\n  </tbody>\n</table>\n");
var serversRef;
var result;
var clear;
var fps;
var playing = false;
function init() {
    var output = document.getElementById('output');
    var model = generateData();
    console.time('initial render');
    env.begin();
    serversRef = new object_reference_1.UpdatableReference({ model: model });
    result = app.render(serversRef, output, new test_helpers_1.TestDynamicScope());
    console.log(env['createdComponents'].length);
    env.commit();
    console.timeEnd('initial render');
}
exports.init = init;
function toggle() {
    if (playing) {
        window['playpause'].innerHTML = "Play";
        cancelAnimationFrame(clear);
        clear = null;
        fps = null;
        playing = false;
    }
    else {
        window['playpause'].innerHTML = "Pause";
        start();
        playing = true;
    }
}
exports.toggle = toggle;
function start() {
    playing = true;
    env.begin();
    var lastFrame = null;
    var fpsMeter = new ema_1.default(2 / 121);
    var callback = function () {
        var thisFrame = window.performance.now();
        onFrame();
        if (lastFrame) {
            fps = Math.round(fpsMeter.push(1000 / (thisFrame - lastFrame)));
        }
        result.rerender();
        clear = requestAnimationFrame(callback);
        lastFrame = thisFrame;
    };
    callback();
    lastFrame = null;
}
function onFrame() {
    var model = generateData(serversRef.databaseArray);
    serversRef.update({ model: model, fps: fps });
}
var ROWS = 100;
function getData() {
    // generate some dummy data
    var data = {
        start_at: new Date().getTime() / 1000,
        databases: {}
    };
    for (var i = 1; i <= ROWS; i++) {
        data.databases["cluster" + i] = {
            queries: []
        };
        data.databases["cluster" + i + "slave"] = {
            queries: []
        };
    }
    Object.keys(data.databases).forEach(function (dbname) {
        var info = data.databases[dbname];
        var r = Math.floor((Math.random() * 10) + 1);
        for (var i = 0; i < r; i++) {
            var q = {
                canvas_action: null,
                canvas_context_id: null,
                canvas_controller: null,
                canvas_hostname: null,
                canvas_job_tag: null,
                canvas_pid: null,
                elapsed: Math.random() * 15,
                query: "SELECT blah FROM something",
                waiting: Math.random() < 0.5
            };
            if (Math.random() < 0.2) {
                q.query = "<IDLE> in transaction";
            }
            if (Math.random() < 0.1) {
                q.query = "vacuum";
            }
            info.queries.push(q);
        }
        info.queries = info.queries.sort(function (a, b) {
            return b.elapsed - a.elapsed;
        });
    });
    return data;
}
function generateData(oldData) {
    if (oldData === void 0) { oldData = {}; }
    var rawData = getData();
    var databases = (oldData && oldData.databases) || {};
    var databaseArray = [];
    var data = { databases: databases, databaseArray: databaseArray };
    Object.keys(rawData.databases).forEach(function (dbname) {
        var sampleInfo = rawData.databases[dbname];
        if (!databases[dbname]) {
            databases[dbname] = {
                name: dbname,
                samples: []
            };
        }
        var samples = databases[dbname].samples;
        samples.push({
            time: rawData.start_at,
            queries: sampleInfo.queries
        });
        if (samples.length > 5) {
            samples.splice(0, samples.length - 5);
        }
        databaseArray.push(databases[dbname]);
    });
    return data;
}
// utils
function elapsedClass(elapsed) {
    if (elapsed >= 10.0) {
        return "elapsed warn_long";
    }
    else if (elapsed >= 1.0) {
        return "elapsed warn";
    }
    else {
        return "elapsed short";
    }
}
function lpad(str, padding, toLength) {
    return padding.repeat((toLength - str.length) / padding.length).concat(str);
}
function formatElapsed(value) {
    var str = parseFloat(value).toFixed(2);
    if (value > 60) {
        var minutes = Math.floor(value / 60);
        var comps = (value % 60).toFixed(2).split('.');
        var seconds = lpad(comps[0], '0', 2);
        var ms = comps[1];
        str = minutes + ":" + seconds + "." + ms;
    }
    return str;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGJtb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnbGltbWVyLWRlbW9zL2xpYi9kYm1vbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSw4REFBK0Q7QUFDL0Qsc0RBQTBFO0FBQzFFLDZCQUE2QztBQUU3QztJQVFFLG1CQUFZLEtBQVU7UUFOZixZQUFPLEdBQVksSUFBSSxDQUFDO1FBTzdCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLENBQUM7SUFOTSxnQkFBTSxHQUFiLFVBQWMsRUFBeUI7WUFBdkIsZ0JBQUs7UUFDbkIsTUFBTSxDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFNRCx1QkFBRyxHQUFILFVBQUksR0FBVyxFQUFFLEtBQVU7UUFDekIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztJQUNwQixDQUFDO0lBRUQsZ0NBQVksR0FBWixjQUFnQixDQUFDO0lBQ2pCLGtDQUFjLEdBQWQsY0FBa0IsQ0FBQztJQUNuQixtQ0FBZSxHQUFmLGNBQW1CLENBQUM7SUFDcEIscUNBQWlCLEdBQWpCLGNBQXFCLENBQUM7SUFDdEIsOEJBQVUsR0FBVixjQUFjLENBQUM7SUFDZiw4QkFBVSxHQUFWLGNBQWMsQ0FBQztJQUNmLG9DQUFnQixHQUFoQixjQUFvQixDQUFDO0lBQ3JCLDZCQUFTLEdBQVQsY0FBYSxDQUFDO0lBQ2QsNkJBQVMsR0FBVCxjQUFhLENBQUM7SUFDaEIsZ0JBQUM7QUFBRCxDQUFDLEFBekJELElBeUJDO0FBRUQ7SUFBNEIsaUNBQVM7SUFBckM7O0lBd0NBLENBQUM7SUFyQ0Msc0JBQUksa0NBQU87YUFBWDtZQUNFLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQztZQUNwQyxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQzdDLENBQUM7OztPQUFBO0lBRUQsc0JBQUkseUNBQWM7YUFBbEI7WUFDRSxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQzNCLElBQUksY0FBYyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBRXpDLE9BQU8sY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDakMsY0FBYyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ3JDLENBQUM7WUFFRCxNQUFNLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxVQUFTLEtBQUssRUFBRSxLQUFLO2dCQUM3QyxNQUFNLENBQUM7b0JBQ0wsR0FBRyxFQUFFLEtBQUssR0FBQyxFQUFFO29CQUNiLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztvQkFDbEIsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFO29CQUMxRCxTQUFTLEVBQUUsWUFBWSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUM7aUJBQ3ZDLENBQUM7WUFDSixDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7OztPQUFBO0lBRUQsc0JBQUkseUNBQWM7YUFBbEI7WUFDRSxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQzNCLElBQUksY0FBYyxHQUFHLE9BQU8sQ0FBQztZQUU3QixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pCLGNBQWMsSUFBSSxrQkFBa0IsQ0FBQztZQUN2QyxDQUFDO1lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDaEMsY0FBYyxJQUFJLGdCQUFnQixDQUFDO1lBQ3JDLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixjQUFjLElBQUksZ0JBQWdCLENBQUM7WUFDckMsQ0FBQztZQUVELE1BQU0sQ0FBQyxjQUFjLENBQUM7UUFDeEIsQ0FBQzs7O09BQUE7SUFDSCxvQkFBQztBQUFELENBQUMsQUF4Q0QsQ0FBNEIsU0FBUyxHQXdDcEM7QUFFRCxJQUFJLEdBQUcsR0FBRyxJQUFJLDhCQUFlLEVBQUUsQ0FBQztBQUVoQyxHQUFHLENBQUMsZ0NBQWdDLENBQUMsZ0JBQWdCLEVBQUUsYUFBb0IsRUFBRSxrZUFvQjVFLENBQUMsQ0FBQztBQUVILElBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsb1BBVXJCLENBQUMsQ0FBQztBQUVILElBQUksVUFBVSxDQUFDO0FBQ2YsSUFBSSxNQUFNLENBQUM7QUFDWCxJQUFJLEtBQUssQ0FBQztBQUNWLElBQUksR0FBRyxDQUFDO0FBQ1IsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDO0FBRXBCO0lBQ0UsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMvQyxJQUFJLEtBQUssR0FBRyxZQUFZLEVBQUUsQ0FBQztJQUUzQixPQUFPLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDL0IsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBRVosVUFBVSxHQUFHLElBQUkscUNBQWtCLENBQUMsRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFDLENBQUM7SUFDL0MsTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxJQUFJLCtCQUFnQixFQUFFLENBQUMsQ0FBQztJQUVoRSxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzdDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNiLE9BQU8sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUNwQyxDQUFDO0FBYkQsb0JBYUM7QUFFRDtJQUNFLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDWixNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQztRQUN2QyxvQkFBb0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM1QixLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2IsR0FBRyxHQUFHLElBQUksQ0FBQztRQUNYLE9BQU8sR0FBRyxLQUFLLENBQUM7SUFDbEIsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsR0FBRyxPQUFPLENBQUM7UUFDeEMsS0FBSyxFQUFFLENBQUM7UUFDUixPQUFPLEdBQUcsSUFBSSxDQUFDO0lBQ2pCLENBQUM7QUFDSCxDQUFDO0FBWkQsd0JBWUM7QUFFRDtJQUNFLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFFZixHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7SUFFWixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUM7SUFDckIsSUFBSSxRQUFRLEdBQUcsSUFBSSxhQUF3QixDQUFDLENBQUMsR0FBQyxHQUFHLENBQUMsQ0FBQztJQUVuRCxJQUFJLFFBQVEsR0FBRztRQUNiLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFekMsT0FBTyxFQUFFLENBQUM7UUFFVixFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2QsR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2xFLENBQUM7UUFFRCxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbEIsS0FBSyxHQUFHLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3hDLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFDeEIsQ0FBQyxDQUFDO0lBRUYsUUFBUSxFQUFFLENBQUM7SUFFWCxTQUFTLEdBQUcsSUFBSSxDQUFDO0FBQ25CLENBQUM7QUFFRDtJQUNFLElBQUksS0FBSyxHQUFHLFlBQVksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLENBQUM7SUFFbkQsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEtBQUssT0FBQSxFQUFFLEdBQUcsS0FBQSxFQUFFLENBQUMsQ0FBQztBQUNwQyxDQUFDO0FBRUQsSUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDO0FBRWpCO0lBQ0UsMkJBQTJCO0lBQzNCLElBQUksSUFBSSxHQUFHO1FBQ1QsUUFBUSxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSTtRQUNyQyxTQUFTLEVBQUUsRUFBRTtLQUNkLENBQUM7SUFFRixHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQy9CLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQyxHQUFHO1lBQzlCLE9BQU8sRUFBRSxFQUFFO1NBQ1osQ0FBQztRQUVGLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUMsR0FBRztZQUN4QyxPQUFPLEVBQUUsRUFBRTtTQUNaLENBQUM7SUFDSixDQUFDO0lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVMsTUFBTTtRQUNqRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRWxDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDN0MsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMzQixJQUFJLENBQUMsR0FBRztnQkFDTixhQUFhLEVBQUUsSUFBSTtnQkFDbkIsaUJBQWlCLEVBQUUsSUFBSTtnQkFDdkIsaUJBQWlCLEVBQUUsSUFBSTtnQkFDdkIsZUFBZSxFQUFFLElBQUk7Z0JBQ3JCLGNBQWMsRUFBRSxJQUFJO2dCQUNwQixVQUFVLEVBQUUsSUFBSTtnQkFDaEIsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFO2dCQUMzQixLQUFLLEVBQUUsNEJBQTRCO2dCQUNuQyxPQUFPLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUc7YUFDN0IsQ0FBQztZQUVGLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN4QixDQUFDLENBQUMsS0FBSyxHQUFHLHVCQUF1QixDQUFDO1lBQ3BDLENBQUM7WUFFRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDeEIsQ0FBQyxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUM7WUFDckIsQ0FBQztZQUVELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7UUFFRCxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVMsQ0FBQyxFQUFFLENBQUM7WUFDNUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUMvQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFFRCxzQkFBc0IsT0FBaUI7SUFBakIsd0JBQUEsRUFBQSxZQUFpQjtJQUNyQyxJQUFJLE9BQU8sR0FBRyxPQUFPLEVBQUUsQ0FBQztJQUV4QixJQUFJLFNBQVMsR0FBRyxDQUFDLE9BQU8sSUFBSSxPQUFPLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3JELElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztJQUV2QixJQUFJLElBQUksR0FBRyxFQUFFLFNBQVMsV0FBQSxFQUFFLGFBQWEsZUFBQSxFQUFFLENBQUM7SUFFeEMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsTUFBTTtRQUMzQyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRTNDLEVBQUUsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QixTQUFTLENBQUMsTUFBTSxDQUFDLEdBQUc7Z0JBQ2xCLElBQUksRUFBRSxNQUFNO2dCQUNaLE9BQU8sRUFBRSxFQUFFO2FBQ1osQ0FBQztRQUNKLENBQUM7UUFFRCxJQUFJLE9BQU8sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDO1FBRXhDLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDWCxJQUFJLEVBQUUsT0FBTyxDQUFDLFFBQVE7WUFDdEIsT0FBTyxFQUFFLFVBQVUsQ0FBQyxPQUFPO1NBQzVCLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QixPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLENBQUM7UUFFRCxhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ3hDLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFFRCxRQUFRO0FBRVIsc0JBQXNCLE9BQU87SUFDM0IsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDcEIsTUFBTSxDQUFDLG1CQUFtQixDQUFDO0lBQzdCLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDMUIsTUFBTSxDQUFDLGNBQWMsQ0FBQztJQUN4QixDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixNQUFNLENBQUMsZUFBZSxDQUFDO0lBQ3pCLENBQUM7QUFDSCxDQUFDO0FBRUQsY0FBYyxHQUFHLEVBQUUsT0FBTyxFQUFFLFFBQVE7SUFDbEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDOUUsQ0FBQztBQUVELHVCQUF1QixLQUFLO0lBQzFCLElBQUksR0FBRyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkMsRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDZixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNyQyxJQUFJLEtBQUssR0FBRyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQy9DLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3JDLElBQUksRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQixHQUFHLEdBQUcsT0FBTyxHQUFHLEdBQUcsR0FBRyxPQUFPLEdBQUcsR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUMzQyxDQUFDO0lBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQztBQUNiLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVcGRhdGFibGVSZWZlcmVuY2UgfSBmcm9tICdAZ2xpbW1lci9vYmplY3QtcmVmZXJlbmNlJztcbmltcG9ydCB7IFRlc3RFbnZpcm9ubWVudCwgVGVzdER5bmFtaWNTY29wZSB9IGZyb20gJ0BnbGltbWVyL3Rlc3QtaGVscGVycyc7XG5pbXBvcnQgRXhwb25lbnRpYWxNb3ZpbmdBdmVyYWdlIGZyb20gJy4vZW1hJztcblxuY2xhc3MgQ29tcG9uZW50IHtcbiAgcHVibGljIGF0dHJzOiBhbnk7XG4gIHB1YmxpYyBlbGVtZW50OiBFbGVtZW50ID0gbnVsbDtcblxuICBzdGF0aWMgY3JlYXRlKHsgYXR0cnMgfTogeyBhdHRyczogYW55IH0pOiBDb21wb25lbnQge1xuICAgIHJldHVybiBuZXcgdGhpcyhhdHRycyk7XG4gIH1cblxuICBjb25zdHJ1Y3RvcihhdHRyczogYW55KSB7XG4gICAgdGhpcy5hdHRycyA9IGF0dHJzO1xuICB9XG5cbiAgc2V0KGtleTogc3RyaW5nLCB2YWx1ZTogYW55KSB7XG4gICAgdGhpc1trZXldID0gdmFsdWU7XG4gIH1cblxuICBkaWRJbml0QXR0cnMoKSB7fVxuICBkaWRVcGRhdGVBdHRycygpIHt9XG4gIGRpZFJlY2VpdmVBdHRycygpIHt9XG4gIHdpbGxJbnNlcnRFbGVtZW50KCkge31cbiAgd2lsbFVwZGF0ZSgpIHt9XG4gIHdpbGxSZW5kZXIoKSB7fVxuICBkaWRJbnNlcnRFbGVtZW50KCkge31cbiAgZGlkVXBkYXRlKCkge31cbiAgZGlkUmVuZGVyKCkge31cbn1cblxuY2xhc3MgRGJtb25EYXRhYmFzZSBleHRlbmRzIENvbXBvbmVudCB7XG4gIGRiOiBudWxsO1xuXG4gIGdldCBxdWVyaWVzKCkge1xuICAgIGxldCBzYW1wbGVzID0gdGhpcy5hdHRycy5kYi5zYW1wbGVzO1xuICAgIHJldHVybiBzYW1wbGVzW3NhbXBsZXMubGVuZ3RoIC0gMV0ucXVlcmllcztcbiAgfVxuXG4gIGdldCB0b3BGaXZlUXVlcmllcygpIHtcbiAgICBsZXQgcXVlcmllcyA9IHRoaXMucXVlcmllcztcbiAgICBsZXQgdG9wRml2ZVF1ZXJpZXMgPSBxdWVyaWVzLnNsaWNlKDAsIDUpO1xuXG4gICAgd2hpbGUgKHRvcEZpdmVRdWVyaWVzLmxlbmd0aCA8IDUpIHtcbiAgICAgIHRvcEZpdmVRdWVyaWVzLnB1c2goeyBxdWVyeTogXCJcIiB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdG9wRml2ZVF1ZXJpZXMubWFwKGZ1bmN0aW9uKHF1ZXJ5LCBpbmRleCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2V5OiBpbmRleCsnJyxcbiAgICAgICAgcXVlcnk6IHF1ZXJ5LnF1ZXJ5LFxuICAgICAgICBlbGFwc2VkOiBxdWVyeS5lbGFwc2VkID8gZm9ybWF0RWxhcHNlZChxdWVyeS5lbGFwc2VkKSA6ICcnLFxuICAgICAgICBjbGFzc05hbWU6IGVsYXBzZWRDbGFzcyhxdWVyeS5lbGFwc2VkKVxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldCBjb3VudENsYXNzTmFtZSgpIHtcbiAgICBsZXQgcXVlcmllcyA9IHRoaXMucXVlcmllcztcbiAgICBsZXQgY291bnRDbGFzc05hbWUgPSBcImxhYmVsXCI7XG5cbiAgICBpZiAocXVlcmllcy5sZW5ndGggPj0gMjApIHtcbiAgICAgIGNvdW50Q2xhc3NOYW1lICs9IFwiIGxhYmVsLWltcG9ydGFudFwiO1xuICAgIH0gZWxzZSBpZiAocXVlcmllcy5sZW5ndGggPj0gMTApIHtcbiAgICAgIGNvdW50Q2xhc3NOYW1lICs9IFwiIGxhYmVsLXdhcm5pbmdcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgY291bnRDbGFzc05hbWUgKz0gXCIgbGFiZWwtc3VjY2Vzc1wiO1xuICAgIH1cblxuICAgIHJldHVybiBjb3VudENsYXNzTmFtZTtcbiAgfVxufVxuXG5sZXQgZW52ID0gbmV3IFRlc3RFbnZpcm9ubWVudCgpO1xuXG5lbnYucmVnaXN0ZXJFbWJlcmlzaEdsaW1tZXJDb21wb25lbnQoJ2RibW9uLWRhdGFiYXNlJywgRGJtb25EYXRhYmFzZSBhcyBhbnksIGBcbiA8dHI+XG4gIDx0ZCBjbGFzcz1cImRibmFtZVwiPlxuICB7e2RiLm5hbWV9fVxuICA8L3RkPlxuICA8dGQgY2xhc3M9XCJxdWVyeS1jb3VudFwiPlxuICAgIDxzcGFuIGNsYXNzPVwie3tjb3VudENsYXNzTmFtZX19XCI+XG4gICAgICB7e3F1ZXJpZXMubGVuZ3RofX1cbiAgICA8L3NwYW4+XG4gIDwvdGQ+XG4gIHt7I2VhY2ggdG9wRml2ZVF1ZXJpZXMga2V5PVwia2V5XCIgYXMgfHF1ZXJ5fH19XG4gICAgPHRkIGNsYXNzPVwiUXVlcnkge3txdWVyeS5jbGFzc05hbWV9fVwiPlxuICAgICAge3txdWVyeS5lbGFwc2VkfX1cbiAgICAgIDxkaXYgY2xhc3M9XCJwb3BvdmVyIGxlZnRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInBvcG92ZXItY29udGVudFwiPnt7cXVlcnkucXVlcnl9fTwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiYXJyb3dcIj48L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvdGQ+XG4gIHt7L2VhY2h9fVxuIDwvdHI+XG5gKTtcblxubGV0IGFwcCA9IGVudi5jb21waWxlKGBcbnt7I2lmIGZwc319PGRpdiBpZD1cImZwc1wiPnt7ZnBzfX0gRlBTPC9kaXY+e3svaWZ9fVxuXG48dGFibGUgY2xhc3M9XCJ0YWJsZSB0YWJsZS1zdHJpcGVkIGxhdGVzdC1kYXRhXCI+XG4gIDx0Ym9keT5cbiAgICB7eyNlYWNoIG1vZGVsLmRhdGFiYXNlQXJyYXkga2V5PSduYW1lJyBhcyB8ZGJ8fX1cbiAgICAgIHt7ZGJtb24tZGF0YWJhc2UgZGI9ZGJ9fVxuICAgIHt7L2VhY2h9fVxuICA8L3Rib2R5PlxuPC90YWJsZT5cbmApO1xuXG5sZXQgc2VydmVyc1JlZjtcbmxldCByZXN1bHQ7XG5sZXQgY2xlYXI7XG5sZXQgZnBzO1xubGV0IHBsYXlpbmcgPSBmYWxzZTtcblxuZXhwb3J0IGZ1bmN0aW9uIGluaXQoKSB7XG4gIGxldCBvdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3V0cHV0Jyk7XG4gIGxldCBtb2RlbCA9IGdlbmVyYXRlRGF0YSgpO1xuXG4gIGNvbnNvbGUudGltZSgnaW5pdGlhbCByZW5kZXInKTtcbiAgZW52LmJlZ2luKCk7XG5cbiAgc2VydmVyc1JlZiA9IG5ldyBVcGRhdGFibGVSZWZlcmVuY2UoeyBtb2RlbCB9KTtcbiAgcmVzdWx0ID0gYXBwLnJlbmRlcihzZXJ2ZXJzUmVmLCBvdXRwdXQsIG5ldyBUZXN0RHluYW1pY1Njb3BlKCkpO1xuXG4gIGNvbnNvbGUubG9nKGVudlsnY3JlYXRlZENvbXBvbmVudHMnXS5sZW5ndGgpO1xuICBlbnYuY29tbWl0KCk7XG4gIGNvbnNvbGUudGltZUVuZCgnaW5pdGlhbCByZW5kZXInKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRvZ2dsZSgpIHtcbiAgaWYgKHBsYXlpbmcpIHtcbiAgICB3aW5kb3dbJ3BsYXlwYXVzZSddLmlubmVySFRNTCA9IFwiUGxheVwiO1xuICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGNsZWFyKTtcbiAgICBjbGVhciA9IG51bGw7XG4gICAgZnBzID0gbnVsbDtcbiAgICBwbGF5aW5nID0gZmFsc2U7XG4gIH0gZWxzZSB7XG4gICAgd2luZG93WydwbGF5cGF1c2UnXS5pbm5lckhUTUwgPSBcIlBhdXNlXCI7XG4gICAgc3RhcnQoKTtcbiAgICBwbGF5aW5nID0gdHJ1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzdGFydCgpIHtcbiAgcGxheWluZyA9IHRydWU7XG5cbiAgZW52LmJlZ2luKCk7XG5cbiAgbGV0IGxhc3RGcmFtZSA9IG51bGw7XG4gIGxldCBmcHNNZXRlciA9IG5ldyBFeHBvbmVudGlhbE1vdmluZ0F2ZXJhZ2UoMi8xMjEpO1xuXG4gIGxldCBjYWxsYmFjayA9ICgpID0+IHtcbiAgICBsZXQgdGhpc0ZyYW1lID0gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgb25GcmFtZSgpO1xuXG4gICAgaWYgKGxhc3RGcmFtZSkge1xuICAgICAgZnBzID0gTWF0aC5yb3VuZChmcHNNZXRlci5wdXNoKDEwMDAgLyAodGhpc0ZyYW1lIC0gbGFzdEZyYW1lKSkpO1xuICAgIH1cblxuICAgIHJlc3VsdC5yZXJlbmRlcigpO1xuICAgIGNsZWFyID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNhbGxiYWNrKTtcbiAgICBsYXN0RnJhbWUgPSB0aGlzRnJhbWU7XG4gIH07XG5cbiAgY2FsbGJhY2soKTtcblxuICBsYXN0RnJhbWUgPSBudWxsO1xufVxuXG5mdW5jdGlvbiBvbkZyYW1lKCkge1xuICBsZXQgbW9kZWwgPSBnZW5lcmF0ZURhdGEoc2VydmVyc1JlZi5kYXRhYmFzZUFycmF5KTtcblxuICBzZXJ2ZXJzUmVmLnVwZGF0ZSh7IG1vZGVsLCBmcHMgfSk7XG59XG5cbmNvbnN0IFJPV1MgPSAxMDA7XG5cbmZ1bmN0aW9uIGdldERhdGEoKSB7XG4gIC8vIGdlbmVyYXRlIHNvbWUgZHVtbXkgZGF0YVxuICBsZXQgZGF0YSA9IHtcbiAgICBzdGFydF9hdDogbmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwLFxuICAgIGRhdGFiYXNlczoge31cbiAgfTtcblxuICBmb3IgKGxldCBpID0gMTsgaSA8PSBST1dTOyBpKyspIHtcbiAgICBkYXRhLmRhdGFiYXNlc1tcImNsdXN0ZXJcIiArIGldID0ge1xuICAgICAgcXVlcmllczogW11cbiAgICB9O1xuXG4gICAgZGF0YS5kYXRhYmFzZXNbXCJjbHVzdGVyXCIgKyBpICsgXCJzbGF2ZVwiXSA9IHtcbiAgICAgIHF1ZXJpZXM6IFtdXG4gICAgfTtcbiAgfVxuXG4gIE9iamVjdC5rZXlzKGRhdGEuZGF0YWJhc2VzKS5mb3JFYWNoKGZ1bmN0aW9uKGRibmFtZSkge1xuICAgIGxldCBpbmZvID0gZGF0YS5kYXRhYmFzZXNbZGJuYW1lXTtcblxuICAgIGxldCByID0gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIDEwKSArIDEpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcjsgaSsrKSB7XG4gICAgICBsZXQgcSA9IHtcbiAgICAgICAgY2FudmFzX2FjdGlvbjogbnVsbCxcbiAgICAgICAgY2FudmFzX2NvbnRleHRfaWQ6IG51bGwsXG4gICAgICAgIGNhbnZhc19jb250cm9sbGVyOiBudWxsLFxuICAgICAgICBjYW52YXNfaG9zdG5hbWU6IG51bGwsXG4gICAgICAgIGNhbnZhc19qb2JfdGFnOiBudWxsLFxuICAgICAgICBjYW52YXNfcGlkOiBudWxsLFxuICAgICAgICBlbGFwc2VkOiBNYXRoLnJhbmRvbSgpICogMTUsXG4gICAgICAgIHF1ZXJ5OiBcIlNFTEVDVCBibGFoIEZST00gc29tZXRoaW5nXCIsXG4gICAgICAgIHdhaXRpbmc6IE1hdGgucmFuZG9tKCkgPCAwLjVcbiAgICAgIH07XG5cbiAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC4yKSB7XG4gICAgICAgIHEucXVlcnkgPSBcIjxJRExFPiBpbiB0cmFuc2FjdGlvblwiO1xuICAgICAgfVxuXG4gICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMSkge1xuICAgICAgICBxLnF1ZXJ5ID0gXCJ2YWN1dW1cIjtcbiAgICAgIH1cblxuICAgICAgaW5mby5xdWVyaWVzLnB1c2gocSk7XG4gICAgfVxuXG4gICAgaW5mby5xdWVyaWVzID0gaW5mby5xdWVyaWVzLnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgICAgcmV0dXJuIGIuZWxhcHNlZCAtIGEuZWxhcHNlZDtcbiAgICB9KTtcbiAgfSk7XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlRGF0YShvbGREYXRhOiBhbnkgPSB7fSkge1xuICBsZXQgcmF3RGF0YSA9IGdldERhdGEoKTtcblxuICBsZXQgZGF0YWJhc2VzID0gKG9sZERhdGEgJiYgb2xkRGF0YS5kYXRhYmFzZXMpIHx8IHt9O1xuICBsZXQgZGF0YWJhc2VBcnJheSA9IFtdO1xuXG4gIGxldCBkYXRhID0geyBkYXRhYmFzZXMsIGRhdGFiYXNlQXJyYXkgfTtcblxuICBPYmplY3Qua2V5cyhyYXdEYXRhLmRhdGFiYXNlcykuZm9yRWFjaChkYm5hbWUgPT4ge1xuICAgIGxldCBzYW1wbGVJbmZvID0gcmF3RGF0YS5kYXRhYmFzZXNbZGJuYW1lXTtcblxuICAgIGlmICghZGF0YWJhc2VzW2RibmFtZV0pIHtcbiAgICAgIGRhdGFiYXNlc1tkYm5hbWVdID0ge1xuICAgICAgICBuYW1lOiBkYm5hbWUsXG4gICAgICAgIHNhbXBsZXM6IFtdXG4gICAgICB9O1xuICAgIH1cblxuICAgIGxldCBzYW1wbGVzID0gZGF0YWJhc2VzW2RibmFtZV0uc2FtcGxlcztcblxuICAgIHNhbXBsZXMucHVzaCh7XG4gICAgICB0aW1lOiByYXdEYXRhLnN0YXJ0X2F0LFxuICAgICAgcXVlcmllczogc2FtcGxlSW5mby5xdWVyaWVzXG4gICAgfSk7XG5cbiAgICBpZiAoc2FtcGxlcy5sZW5ndGggPiA1KSB7XG4gICAgICBzYW1wbGVzLnNwbGljZSgwLCBzYW1wbGVzLmxlbmd0aCAtIDUpO1xuICAgIH1cblxuICAgIGRhdGFiYXNlQXJyYXkucHVzaChkYXRhYmFzZXNbZGJuYW1lXSk7XG4gIH0pO1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG4vLyB1dGlsc1xuXG5mdW5jdGlvbiBlbGFwc2VkQ2xhc3MoZWxhcHNlZCkge1xuICBpZiAoZWxhcHNlZCA+PSAxMC4wKSB7XG4gICAgcmV0dXJuIFwiZWxhcHNlZCB3YXJuX2xvbmdcIjtcbiAgfSBlbHNlIGlmIChlbGFwc2VkID49IDEuMCkge1xuICAgIHJldHVybiBcImVsYXBzZWQgd2FyblwiO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBcImVsYXBzZWQgc2hvcnRcIjtcbiAgfVxufVxuXG5mdW5jdGlvbiBscGFkKHN0ciwgcGFkZGluZywgdG9MZW5ndGgpIHtcbiAgcmV0dXJuIHBhZGRpbmcucmVwZWF0KCh0b0xlbmd0aCAtIHN0ci5sZW5ndGgpIC8gcGFkZGluZy5sZW5ndGgpLmNvbmNhdChzdHIpO1xufVxuXG5mdW5jdGlvbiBmb3JtYXRFbGFwc2VkKHZhbHVlKSB7XG4gIGxldCBzdHIgPSBwYXJzZUZsb2F0KHZhbHVlKS50b0ZpeGVkKDIpO1xuICBpZiAodmFsdWUgPiA2MCkge1xuICAgIGxldCBtaW51dGVzID0gTWF0aC5mbG9vcih2YWx1ZSAvIDYwKTtcbiAgICBsZXQgY29tcHMgPSAodmFsdWUgJSA2MCkudG9GaXhlZCgyKS5zcGxpdCgnLicpO1xuICAgIGxldCBzZWNvbmRzID0gbHBhZChjb21wc1swXSwgJzAnLCAyKTtcbiAgICBsZXQgbXMgPSBjb21wc1sxXTtcbiAgICBzdHIgPSBtaW51dGVzICsgXCI6XCIgKyBzZWNvbmRzICsgXCIuXCIgKyBtcztcbiAgfVxuICByZXR1cm4gc3RyO1xufVxuIl19