"use strict";
var object_reference_1 = require("@glimmer/object-reference");
var test_helpers_1 = require("@glimmer/test-helpers");
function RingBuffer(capacity) {
    this.capacity = capacity;
    this.head = 0;
    this.items = new Array(capacity);
    this.length = 0;
}
RingBuffer.prototype.push = function (item) {
    this.items[this.head] = item;
    this.length++;
    this.head++;
    this.head %= this.capacity;
};
RingBuffer.prototype.remove = function (i) {
    this.length--;
    this.items[i] = undefined;
};
RingBuffer.prototype.forEach = function (callback, thisArg) {
    for (var i = 0, l = this.items.length; i < l; i++) {
        if (this.items[i] === undefined)
            continue;
        callback.call(thisArg, this.items[i], i);
    }
};
function Point(timestamp, x, y) {
    this.key = null;
    this.timestamp = timestamp;
    this.x = x;
    this.y = y;
    this.size = 0.0;
    this.opacity = 1.0;
}
;
Point.prototype.update = function (index, currentTimestamp) {
    var delta = currentTimestamp - this.timestamp;
    this.size = Math.max(delta / 10, 0);
    this.opacity = Math.exp(-delta / 250);
    this.key = String(index);
};
function start() {
    var env = new test_helpers_1.TestEnvironment();
    var TEMPLATES = {};
    Array.prototype.slice.call(document.querySelectorAll("[data-template-name]")).forEach(function (node) {
        var name = node.getAttribute("data-template-name"), source = node.textContent;
        TEMPLATES[name] = env.compile(source);
    });
    var data = {
        width: window.innerWidth,
        height: window.innerHeight,
        points: new RingBuffer(500),
        count: 0,
    };
    var output = document.getElementById('output');
    var self = new object_reference_1.UpdatableReference(data);
    var result = TEMPLATES['application'].render(self, env, { appendTo: output });
    window.addEventListener("resize", function () {
        data.width = window.innerWidth;
        data.height = window.innerHeight;
    });
    document.addEventListener("mousemove", function (e) {
        data.points.push(new Point(window.performance.now(), e.layerX, e.layerY));
    });
    function tick() {
        var timestamp = window.performance.now();
        data.count = 0;
        data.points.forEach(function (point, i) {
            if (point) {
                point.update(i, timestamp);
                if (point.opacity > 0.001) {
                    data.count++;
                }
                else {
                    data.points.remove(i);
                }
            }
        });
        self.update(data);
        result.rerender();
        window.requestAnimationFrame(tick);
    }
    tick();
}
exports.start = start;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmlwcGxlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImdsaW1tZXItZGVtb3MvbGliL3JpcHBsZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLDhEQUErRDtBQUMvRCxzREFBMkU7QUFFM0Usb0JBQW9CLFFBQVE7SUFDMUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUM7SUFDekIsSUFBSSxDQUFDLElBQUksR0FBTyxDQUFDLENBQUM7SUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBTSxJQUFJLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNwQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztBQUNsQixDQUFDO0FBRUQsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsVUFBUyxJQUFJO0lBQ3ZDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQztJQUU3QixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7SUFDZCxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDWixJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUM7QUFDN0IsQ0FBQyxDQUFDO0FBRUYsVUFBVSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsVUFBUyxDQUFDO0lBQ3RDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNkLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDO0FBQzVCLENBQUMsQ0FBQztBQUVGLFVBQVUsQ0FBQyxTQUFTLENBQUMsT0FBTyxHQUFHLFVBQVMsUUFBUSxFQUFFLE9BQU87SUFDdkQsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsR0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDNUMsRUFBRSxDQUFD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LENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFFLENBQUM7SUFDOUUsQ0FBQyxDQUFDLENBQUM7SUFFSDtRQUNFLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFekMsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7UUFFZixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFTLEtBQUssRUFBRSxDQUFDO1lBQ25DLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ1YsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBRTNCLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQztvQkFDMUIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUNmLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ04sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLENBQUM7WUFDSCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUVsQixNQUFNLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDckMsQ0FBQztJQUVELElBQUksRUFBRSxDQUFDO0FBQ1QsQ0FBQztBQXpERCxzQkF5REMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBVcGRhdGFibGVSZWZlcmVuY2UgfSBmcm9tICdAZ2xpbW1lci9vYmplY3QtcmVmZXJlbmNlJztcbmltcG9ydCB7IFRlc3RFbnZpcm9ubWVudCBhcyBEZW1vRW52aXJvbm1lbnQgfSBmcm9tICdAZ2xpbW1lci90ZXN0LWhlbHBlcnMnO1xuXG5mdW5jdGlvbiBSaW5nQnVmZmVyKGNhcGFjaXR5KSB7XG4gIHRoaXMuY2FwYWNpdHkgPSBjYXBhY2l0eTtcbiAgdGhpcy5oZWFkICAgICA9IDA7XG4gIHRoaXMuaXRlbXMgICAgPSBuZXcgQXJyYXkoY2FwYWNpdHkpO1xuICB0aGlzLmxlbmd0aCA9IDA7XG59XG5cblJpbmdCdWZmZXIucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbihpdGVtKSB7XG4gIHRoaXMuaXRlbXNbdGhpcy5oZWFkXSA9IGl0ZW07XG5cbiAgdGhpcy5sZW5ndGgrKztcbiAgdGhpcy5oZWFkKys7XG4gIHRoaXMuaGVhZCAlPSB0aGlzLmNhcGFjaXR5O1xufTtcblxuUmluZ0J1ZmZlci5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oaSkge1xuICB0aGlzLmxlbmd0aC0tO1xuICB0aGlzLml0ZW1zW2ldID0gdW5kZWZpbmVkO1xufTtcblxuUmluZ0J1ZmZlci5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uKGNhbGxiYWNrLCB0aGlzQXJnKSB7XG4gIGZvciAobGV0IGk9MCwgbD10aGlzLml0ZW1zLmxlbmd0aDsgaTxsOyBpKyspIHtcbiAgICBpZiAodGhpcy5pdGVtc1tpXSA9PT0gdW5kZWZpbmVkKSBjb250aW51ZTtcbiAgICBjYWxsYmFjay5jYWxsKHRoaXNBcmcsIHRoaXMuaXRlbXNbaV0sIGkpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBQb2ludCh0aW1lc3RhbXAsIHgsIHkpIHtcbiAgdGhpcy5rZXkgPSBudWxsO1xuICB0aGlzLnRpbWVzdGFtcCA9IHRpbWVzdGFtcDtcblxuICB0aGlzLnggPSB4O1xuICB0aGlzLnkgPSB5O1xuICB0aGlzLnNpemUgPSAwLjA7XG4gIHRoaXMub3BhY2l0eSA9IDEuMDtcbn07XG5cblBvaW50LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihpbmRleCwgY3VycmVudFRpbWVzdGFtcCkge1xuICBsZXQgZGVsdGEgPSBjdXJyZW50VGltZXN0YW1wIC0gdGhpcy50aW1lc3RhbXA7XG5cbiAgdGhpcy5zaXplICAgID0gTWF0aC5tYXgoZGVsdGEvMTAsIDApO1xuICB0aGlzLm9wYWNpdHkgPSBNYXRoLmV4cCgtZGVsdGEvMjUwKTtcbiAgdGhpcy5rZXkgPSBTdHJpbmcoaW5kZXgpO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHN0YXJ0KCkge1xuICBsZXQgZW52ID0gbmV3IERlbW9FbnZpcm9ubWVudCgpO1xuXG4gIGNvbnN0IFRFTVBMQVRFUyA9IHt9O1xuXG4gIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJbZGF0YS10ZW1wbGF0ZS1uYW1lXVwiKSkuZm9yRWFjaChmdW5jdGlvbihub2RlKSB7XG4gICAgbGV0IG5hbWUgICA9IG5vZGUuZ2V0QXR0cmlidXRlKFwiZGF0YS10ZW1wbGF0ZS1uYW1lXCIpLFxuICAgICAgICBzb3VyY2UgPSBub2RlLnRleHRDb250ZW50O1xuXG4gICAgVEVNUExBVEVTW25hbWVdID0gZW52LmNvbXBpbGUoc291cmNlKTtcbiAgfSk7XG5cbiAgbGV0IGRhdGEgPSB7XG4gICAgd2lkdGg6ICB3aW5kb3cuaW5uZXJXaWR0aCxcbiAgICBoZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodCxcbiAgICBwb2ludHM6IG5ldyBSaW5nQnVmZmVyKDUwMCksIC8vIGluIHByYWN0aWNlIHdlIG9ubHkgaGF2ZSAxMDAtMjAwIGNpcmNsZXMgb24gc2NyZWVuXG4gICAgY291bnQ6ICAwLFxuICAgIC8vIGZwczogICAgMFxuICB9O1xuXG4gIGxldCBvdXRwdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3V0cHV0Jyk7XG4gIGxldCBzZWxmID0gbmV3IFVwZGF0YWJsZVJlZmVyZW5jZShkYXRhKTtcbiAgbGV0IHJlc3VsdCA9IFRFTVBMQVRFU1snYXBwbGljYXRpb24nXS5yZW5kZXIoc2VsZiwgZW52LCB7IGFwcGVuZFRvOiBvdXRwdXQgfSk7XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgZnVuY3Rpb24oKSB7XG4gICAgZGF0YS53aWR0aCAgPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgICBkYXRhLmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcbiAgfSk7XG5cbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgZGF0YS5wb2ludHMucHVzaCggbmV3IFBvaW50KHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKSwgZS5sYXllclgsIGUubGF5ZXJZKSApO1xuICB9KTtcblxuICBmdW5jdGlvbiB0aWNrKCkge1xuICAgIGxldCB0aW1lc3RhbXAgPSB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCk7XG5cbiAgICBkYXRhLmNvdW50ID0gMDtcblxuICAgIGRhdGEucG9pbnRzLmZvckVhY2goZnVuY3Rpb24ocG9pbnQsIGkpIHtcbiAgICAgIGlmIChwb2ludCkge1xuICAgICAgICBwb2ludC51cGRhdGUoaSwgdGltZXN0YW1wKTtcblxuICAgICAgICBpZiAocG9pbnQub3BhY2l0eSA+IDAuMDAxKSB7XG4gICAgICAgICAgZGF0YS5jb3VudCsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRhdGEucG9pbnRzLnJlbW92ZShpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2VsZi51cGRhdGUoZGF0YSk7XG4gICAgcmVzdWx0LnJlcmVuZGVyKCk7XG5cbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRpY2spO1xuICB9XG5cbiAgdGljaygpO1xufVxuIl19