import { dict } from '@glimmer/util';
export function entryPoint(meta) {
    return new ProgramSymbolTable(meta);
}
export function layout(meta, wireNamed, wireYields, hasPartials) {
    let { named, yields, partialSymbol, size } = symbols(wireNamed, wireYields, hasPartials);
    return new ProgramSymbolTable(meta, named, yields, partialSymbol, size);
}
export function block(parent, locals) {
    let localsMap = null;
    let program = parent['program'];
    if (locals.length !== 0) {
        let map = localsMap = dict();
        locals.forEach(l => map[l] = program.size++);
    }
    return new BlockSymbolTable(parent, program, localsMap);
}
function symbols(named, yields, hasPartials) {
    let yieldsMap = null;
    let namedMap = null;
    let size = 1;
    if (yields.length !== 0) {
        let map = yieldsMap = dict();
        yields.forEach(y => map[y] = size++);
    }
    if (named.length !== 0) {
        let map = namedMap = dict();
        named.forEach(y => map[y] = size++);
    }
    let partialSymbol = hasPartials ? size++ : null;
    return { named: namedMap, yields: yieldsMap, partialSymbol, size };
}
export class ProgramSymbolTable {
    constructor(meta, named = null, yields = null, partialArgs = null, size = 1) {
        this.meta = meta;
        this.named = named;
        this.yields = yields;
        this.partialArgs = partialArgs;
        this.size = size;
        this.program = this;
    }
    getMeta() {
        return this.meta;
    }
    getSymbols() {
        return {
            named: this.named,
            yields: this.yields,
            locals: null,
            partialArgs: this.partialArgs
        };
    }
    getSymbol(kind, name) {
        if (kind === 'local')
            return null;
        return this[kind] && this[kind][name];
    }
    getPartialArgs() {
        return this.partialArgs || 0;
    }
}
export class BlockSymbolTable {
    constructor(parent, program, locals) {
        this.parent = parent;
        this.program = program;
        this.locals = locals;
    }
    getMeta() {
        return this.program.getMeta();
    }
    getSymbols() {
        return {
            named: null,
            yields: null,
            locals: this.locals,
            partialArgs: null
        };
    }
    getSymbol(kind, name) {
        if (kind === 'local') {
            return this.getLocal(name);
        }
        else {
            return this.program.getSymbol(kind, name);
        }
    }
    getLocal(name) {
        let { locals, parent } = this;
        let symbol = locals && locals[name];
        if (!symbol && parent) {
            symbol = parent.getSymbol('local', name);
        }
        return symbol;
    }
    getPartialArgs() {
        return this.program.getPartialArgs();
    }
}
export const EMPTY_SYMBOL_TABLE = {
    getMeta() {
        return null;
    },
    getSymbols() {
        return {
            named: null,
            yields: null,
            locals: null,
            partialArgs: null
        };
    },
    getSymbol(_kind, _name) {
        throw new Error("BUG: Calling getSymbol on EMPTY_SYMBOL_TABLE");
    },
    getPartialArgs() {
        return null;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ltYm9sLXRhYmxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQGdsaW1tZXIvcnVudGltZS9saWIvc3ltYm9sLXRhYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBZ0IsSUFBSSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBU25ELE1BQU0scUJBQXFCLElBQTBCO0lBQ25ELE1BQU0sQ0FBQyxJQUFJLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ3RDLENBQUM7QUFFRCxNQUFNLGlCQUFpQixJQUFrQixFQUFFLFNBQW1CLEVBQUUsVUFBb0IsRUFBRSxXQUFvQjtJQUN4RyxJQUFJLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDekYsTUFBTSxDQUFDLElBQUksa0JBQWtCLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQzFFLENBQUM7QUFFRCxNQUFNLGdCQUFnQixNQUFtQixFQUFFLE1BQWdCO0lBQ3pELElBQUksU0FBUyxHQUF5QixJQUFJLENBQUM7SUFDM0MsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBRWhDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFJLEdBQUcsR0FBRyxTQUFTLEdBQUcsSUFBSSxFQUFVLENBQUM7UUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRCxNQUFNLENBQUMsSUFBSSxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFD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QUVELGNBQWM7UUFDWixNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztDQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPcHRpb24sIERpY3QsIGRpY3QgfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IFRlbXBsYXRlTWV0YSB9IGZyb20gJ0BnbGltbWVyL3dpcmUtZm9ybWF0JztcbmltcG9ydCB7XG4gIFN5bWJvbFRhYmxlLFxuICBQcm9ncmFtU3ltYm9sVGFibGUgYXMgSVByb2dyYW1TeW1ib2xUYWJsZSxcbiAgQmxvY2tTeW1ib2xUYWJsZSBhcyBJQmxvY2tTeW1ib2xUYWJsZSxcbiAgU3ltYm9sc1xufSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcblxuZXhwb3J0IGZ1bmN0aW9uIGVudHJ5UG9pbnQobWV0YTogT3B0aW9uPFRlbXBsYXRlTWV0YT4pOiBQcm9ncmFtU3ltYm9sVGFibGUge1xuICByZXR1cm4gbmV3IFByb2dyYW1TeW1ib2xUYWJsZShtZXRhKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxheW91dChtZXRhOiBUZW1wbGF0ZU1ldGEsIHdpcmVOYW1lZDogc3RyaW5nW10sIHdpcmVZaWVsZHM6IHN0cmluZ1tdLCBoYXNQYXJ0aWFsczogYm9vbGVhbik6IFByb2dyYW1TeW1ib2xUYWJsZSB7XG4gIGxldCB7IG5hbWVkLCB5aWVsZHMsIHBhcnRpYWxTeW1ib2wsIHNpemUgfSA9IHN5bWJvbHMod2lyZU5hbWVkLCB3aXJlWWllbGRzLCBoYXNQYXJ0aWFscyk7XG4gIHJldHVybiBuZXcgUHJvZ3JhbVN5bWJvbFRhYmxlKG1ldGEsIG5hbWVkLCB5aWVsZHMsIHBhcnRpYWxTeW1ib2wsIHNpemUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYmxvY2socGFyZW50OiBTeW1ib2xUYWJsZSwgbG9jYWxzOiBzdHJpbmdbXSk6IFN5bWJvbFRhYmxlIHtcbiAgbGV0IGxvY2Fsc01hcDogT3B0aW9uPERpY3Q8bnVtYmVyPj4gPSBudWxsO1xuICBsZXQgcHJvZ3JhbSA9IHBhcmVudFsncHJvZ3JhbSddO1xuXG4gIGlmIChsb2NhbHMubGVuZ3RoICE9PSAwKSB7XG4gICAgbGV0IG1hcCA9IGxvY2Fsc01hcCA9IGRpY3Q8bnVtYmVyPigpO1xuICAgIGxvY2Fscy5mb3JFYWNoKGwgPT4gbWFwW2xdID0gcHJvZ3JhbS5zaXplKyspO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBCbG9ja1N5bWJvbFRhYmxlKHBhcmVudCwgcHJvZ3JhbSwgbG9jYWxzTWFwKTtcbn1cblxuZnVuY3Rpb24gc3ltYm9scyhuYW1lZDogc3RyaW5nW10sIHlpZWxkczogc3RyaW5nW10sIGhhc1BhcnRpYWxzOiBib29sZWFuKTogeyBuYW1lZDogT3B0aW9uPERpY3Q8bnVtYmVyPj4sIHlpZWxkczogT3B0aW9uPERpY3Q8bnVtYmVyPj4sIHBhcnRpYWxTeW1ib2w6IE9wdGlvbjxudW1iZXI+LCBzaXplOiBudW1iZXIgfSB7XG4gIGxldCB5aWVsZHNNYXA6IE9wdGlvbjxEaWN0PG51bWJlcj4+ID0gbnVsbDtcbiAgbGV0IG5hbWVkTWFwOiBPcHRpb248RGljdDxudW1iZXI+PiA9IG51bGw7XG5cbiAgbGV0IHNpemUgPSAxO1xuXG4gIGlmICh5aWVsZHMubGVuZ3RoICE9PSAwKSB7XG4gICAgbGV0IG1hcCA9IHlpZWxkc01hcCA9IGRpY3Q8bnVtYmVyPigpO1xuICAgIHlpZWxkcy5mb3JFYWNoKHkgPT4gbWFwW3ldID0gc2l6ZSsrKTtcbiAgfVxuXG4gIGlmIChuYW1lZC5sZW5ndGggIT09IDApIHtcbiAgICBsZXQgbWFwID0gbmFtZWRNYXAgPSBkaWN0PG51bWJlcj4oKTtcbiAgICBuYW1lZC5mb3JFYWNoKHkgPT4gbWFwW3ldID0gc2l6ZSsrKTtcbiAgfVxuXG4gIGxldCBwYXJ0aWFsU3ltYm9sOiBPcHRpb248bnVtYmVyPiA9IGhhc1BhcnRpYWxzID8gc2l6ZSsrIDogbnVsbDtcblxuICByZXR1cm4geyBuYW1lZDogbmFtZWRNYXAsIHlpZWxkczogeWllbGRzTWFwLCBwYXJ0aWFsU3ltYm9sLCBzaXplIH07XG59XG5cbmV4cG9ydCBjbGFzcyBQcm9ncmFtU3ltYm9sVGFibGUgaW1wbGVtZW50cyBJUHJvZ3JhbVN5bWJvbFRhYmxlIHtcbiAgcHJvZ3JhbTogdGhpcztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIG1ldGE6IE9wdGlvbjxUZW1wbGF0ZU1ldGE+LFxuICAgIHByaXZhdGUgbmFtZWQ6IE9wdGlvbjxEaWN0PG51bWJlcj4+ID0gbnVsbCxcbiAgICBwcml2YXRlIHlpZWxkczogT3B0aW9uPERpY3Q8bnVtYmVyPj4gPSBudWxsLFxuICAgIHByaXZhdGUgcGFydGlhbEFyZ3M6IE9wdGlvbjxudW1iZXI+ID0gbnVsbCxcbiAgICBwdWJsaWMgc2l6ZSA9IDFcbiAgKSB7XG4gICAgdGhpcy5wcm9ncmFtID0gdGhpcztcbiAgfVxuXG4gIGdldE1ldGEoKTogT3B0aW9uPFRlbXBsYXRlTWV0YT4ge1xuICAgIHJldHVybiB0aGlzLm1ldGE7XG4gIH1cblxuICBnZXRTeW1ib2xzKCk6IFN5bWJvbHMge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lZDogdGhpcy5uYW1lZCxcbiAgICAgIHlpZWxkczogdGhpcy55aWVsZHMsXG4gICAgICBsb2NhbHM6IG51bGwsXG4gICAgICBwYXJ0aWFsQXJnczogdGhpcy5wYXJ0aWFsQXJnc1xuICAgIH07XG4gIH1cblxuICBnZXRTeW1ib2woa2luZDogJ2xvY2FsJywgbmFtZTogc3RyaW5nKTogbnVsbDtcbiAgZ2V0U3ltYm9sKGtpbmQ6ICdsb2NhbCcgfCAnbmFtZWQnIHwgJ3lpZWxkcycsIG5hbWU6IHN0cmluZyk6IE9wdGlvbjxudW1iZXI+O1xuICBnZXRTeW1ib2woa2luZDogc3RyaW5nLCBuYW1lOiBzdHJpbmcpOiBPcHRpb248bnVtYmVyPiB7XG4gICAgaWYgKGtpbmQgPT09ICdsb2NhbCcpIHJldHVybiBudWxsO1xuICAgIHJldHVybiB0aGlzW2tpbmRdICYmIHRoaXNba2luZF1bbmFtZV07XG4gIH1cblxuICBnZXRQYXJ0aWFsQXJncygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnBhcnRpYWxBcmdzIHx8IDA7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEJsb2NrU3ltYm9sVGFibGUgaW1wbGVtZW50cyBJQmxvY2tTeW1ib2xUYWJsZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcGFyZW50OiBTeW1ib2xUYWJsZSwgcHJvdGVjdGVkIHByb2dyYW06IFByb2dyYW1TeW1ib2xUYWJsZSwgcHJpdmF0ZSBsb2NhbHM6IE9wdGlvbjxEaWN0PG51bWJlcj4+KSB7XG4gIH1cblxuICBnZXRNZXRhKCk6IE9wdGlvbjxUZW1wbGF0ZU1ldGE+IHtcbiAgICByZXR1cm4gdGhpcy5wcm9ncmFtLmdldE1ldGEoKTtcbiAgfVxuXG4gIGdldFN5bWJvbHMoKTogU3ltYm9scyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWVkOiBudWxsLFxuICAgICAgeWllbGRzOiBudWxsLFxuICAgICAgbG9jYWxzOiB0aGlzLmxvY2FscyxcbiAgICAgIHBhcnRpYWxBcmdzOiBudWxsXG4gICAgfTtcbiAgfVxuXG4gIGdldFN5bWJvbChraW5kOiAnbG9jYWwnIHwgJ25hbWVkJyB8ICd5aWVsZHMnLCBuYW1lOiBzdHJpbmcpOiBPcHRpb248bnVtYmVyPiB7XG4gICAgaWYgKGtpbmQgPT09ICdsb2NhbCcpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldExvY2FsKG5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5wcm9ncmFtLmdldFN5bWJvbChraW5kLCBuYW1lKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldExvY2FsKG5hbWU6IHN0cmluZyk6IE9wdGlvbjxudW1iZXI+IHtcbiAgICBsZXQgeyBsb2NhbHMsIHBhcmVudCB9ID0gdGhpcztcblxuICAgIGxldCBzeW1ib2w6IE9wdGlvbjxudW1iZXI+ID0gbG9jYWxzICYmIGxvY2Fsc1tuYW1lXTtcblxuICAgIGlmICghc3ltYm9sICYmIHBhcmVudCkge1xuICAgICAgc3ltYm9sID0gcGFyZW50LmdldFN5bWJvbCgnbG9jYWwnLCBuYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3ltYm9sO1xuICB9XG5cbiAgZ2V0UGFydGlhbEFyZ3MoKTogT3B0aW9uPG51bWJlcj4ge1xuICAgIHJldHVybiB0aGlzLnByb2dyYW0uZ2V0UGFydGlhbEFyZ3MoKTtcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgRU1QVFlfU1lNQk9MX1RBQkxFOiBTeW1ib2xUYWJsZSA9IHtcbiAgZ2V0TWV0YSgpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcblxuICBnZXRTeW1ib2xzKCk6IFN5bWJvbHMge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lZDogbnVsbCxcbiAgICAgIHlpZWxkczogbnVsbCxcbiAgICAgIGxvY2FsczogbnVsbCxcbiAgICAgIHBhcnRpYWxBcmdzOiBudWxsXG4gICAgfTtcbiAgfSxcblxuICBnZXRTeW1ib2woX2tpbmQ6IG5ldmVyLCBfbmFtZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCVUc6IENhbGxpbmcgZ2V0U3ltYm9sIG9uIEVNUFRZX1NZTUJPTF9UQUJMRVwiKTtcbiAgfSxcblxuICBnZXRQYXJ0aWFsQXJncygpOiBPcHRpb248bnVtYmVyPiB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn07XG4iXX0=