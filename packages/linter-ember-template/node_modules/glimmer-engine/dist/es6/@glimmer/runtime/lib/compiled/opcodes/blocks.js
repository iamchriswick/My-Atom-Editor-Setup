import { APPEND_OPCODES, OpcodeName as Op } from '../../opcodes';
APPEND_OPCODES.add(Op.OpenBlock, (vm, { op1: _getBlock, op2: _args }) => {
    let inner = vm.constants.getOther(_getBlock);
    let rawArgs = vm.constants.getExpression(_args);
    let args = null;
    let block = inner.evaluate(vm);
    if (block) {
        args = rawArgs.evaluate(vm);
    }
    // FIXME: can we avoid doing this when we don't have a block?
    vm.pushCallerScope();
    if (block) {
        vm.invokeBlock(block, args || null);
    }
});
APPEND_OPCODES.add(Op.CloseBlock, vm => vm.popScope());
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmxvY2tzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQGdsaW1tZXIvcnVudGltZS9saWIvY29tcGlsZWQvb3Bjb2Rlcy9ibG9ja3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUEsT0FBTyxFQUFFLGNBQWMsRUFBRSxVQUFVLElBQUksRUFBRSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR2pFLGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRTtJQUNsRSxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBbUIsU0FBUyxDQUFDLENBQUM7SUFDL0QsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQWUsS0FBSyxDQUFDLENBQUM7SUFDOUQsSUFBSSxJQUFJLEdBQTBCLElBQUksQ0FBQztJQUV2QyxJQUFJLEtBQUssR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBRS9CLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDVixJQUFJLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUM5QixDQUFDO0lBRUQsNkRBQTZEO0lBQzdELEVBQUUsQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUVyQixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ1YsRUFBRSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDO0lBQ3RDLENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILGNBQWMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLFVBQVUsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21waWxlZEdldEJsb2NrIH0gZnJvbSAnLi4vZXhwcmVzc2lvbnMvaGFzLWJsb2NrJztcclxuaW1wb3J0IHsgQ29tcGlsZWRBcmdzLCBFdmFsdWF0ZWRBcmdzIH0gZnJvbSAnLi4vZXhwcmVzc2lvbnMvYXJncyc7XHJcbmltcG9ydCB7IEFQUEVORF9PUENPREVTLCBPcGNvZGVOYW1lIGFzIE9wIH0gZnJvbSAnLi4vLi4vb3Bjb2Rlcyc7XHJcbmltcG9ydCB7IE9wdGlvbiB9IGZyb20gJ0BnbGltbWVyL3V0aWwnO1xyXG5cclxuQVBQRU5EX09QQ09ERVMuYWRkKE9wLk9wZW5CbG9jaywgKHZtLCB7IG9wMTogX2dldEJsb2NrLCBvcDI6IF9hcmdzIH0pID0+IHtcclxuICBsZXQgaW5uZXIgPSB2bS5jb25zdGFudHMuZ2V0T3RoZXI8Q29tcGlsZWRHZXRCbG9jaz4oX2dldEJsb2NrKTtcclxuICBsZXQgcmF3QXJncyA9IHZtLmNvbnN0YW50cy5nZXRFeHByZXNzaW9uPENvbXBpbGVkQXJncz4oX2FyZ3MpO1xyXG4gIGxldCBhcmdzOiBPcHRpb248RXZhbHVhdGVkQXJncz4gPSBudWxsO1xyXG5cclxuICBsZXQgYmxvY2sgPSBpbm5lci5ldmFsdWF0ZSh2bSk7XHJcblxyXG4gIGlmIChibG9jaykge1xyXG4gICAgYXJncyA9IHJhd0FyZ3MuZXZhbHVhdGUodm0pO1xyXG4gIH1cclxuXHJcbiAgLy8gRklYTUU6IGNhbiB3ZSBhdm9pZCBkb2luZyB0aGlzIHdoZW4gd2UgZG9uJ3QgaGF2ZSBhIGJsb2NrP1xyXG4gIHZtLnB1c2hDYWxsZXJTY29wZSgpO1xyXG5cclxuICBpZiAoYmxvY2spIHtcclxuICAgIHZtLmludm9rZUJsb2NrKGJsb2NrLCBhcmdzIHx8IG51bGwpO1xyXG4gIH1cclxufSk7XHJcblxyXG5BUFBFTkRfT1BDT0RFUy5hZGQoT3AuQ2xvc2VCbG9jaywgdm0gPT4gdm0ucG9wU2NvcGUoKSk7XHJcbiJdfQ==