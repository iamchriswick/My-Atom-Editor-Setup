import { unwrap, expect } from '@glimmer/util';
export class CapturedFrame {
    constructor(operand, args, condition) {
        this.operand = operand;
        this.args = args;
        this.condition = condition;
    }
}
class Frame {
    constructor(ops, component = null, manager = null, shadow = null) {
        this.ops = ops;
        this.component = component;
        this.manager = manager;
        this.shadow = shadow;
        this.operand = null;
        this.immediate = null;
        this.args = null;
        this.callerScope = null;
        this.blocks = null;
        this.condition = null;
        this.iterator = null;
        this.key = null;
        this.ip = ops[0];
    }
    capture() {
        return new CapturedFrame(this.operand, this.args, this.condition);
    }
    restore(frame) {
        this.operand = frame['operand'];
        this.args = frame['args'];
        this.condition = frame['condition'];
    }
}
export class FrameStack {
    constructor() {
        this.frames = [];
        this.frame = null;
    }
    get currentFrame() {
        return this.frames[unwrap(this.frame)];
    }
    push(ops, component = null, manager = null, shadow = null) {
        let frame = (this.frame === null) ? (this.frame = 0) : ++this.frame;
        if (this.frames.length <= frame) {
            this.frames.push(null);
        }
        this.frames[frame] = new Frame(ops, component, manager, shadow);
    }
    pop() {
        let { frames, frame } = this;
        frames[expect(frame, 'only pop after pushing')] = null;
        this.frame = frame === 0 ? null : frame - 1;
    }
    capture() {
        return this.currentFrame.capture();
    }
    restore(frame) {
        this.currentFrame.restore(frame);
    }
    getOps() {
        return this.currentFrame.ops;
    }
    getCurrent() {
        return this.currentFrame.ip;
    }
    setCurrent(ip) {
        return this.currentFrame.ip = ip;
    }
    getOperand() {
        return unwrap(this.currentFrame.operand);
    }
    setOperand(operand) {
        return this.currentFrame.operand = operand;
    }
    getImmediate() {
        return this.currentFrame.immediate;
    }
    setImmediate(value) {
        return this.currentFrame.immediate = value;
    }
    // FIXME: These options are required in practice by the existing code, but
    // figure out why.
    getArgs() {
        return this.currentFrame.args;
    }
    setArgs(args) {
        return this.currentFrame.args = args;
    }
    getCondition() {
        return unwrap(this.currentFrame.condition);
    }
    setCondition(condition) {
        return this.currentFrame.condition = condition;
    }
    getIterator() {
        return unwrap(this.currentFrame.iterator);
    }
    setIterator(iterator) {
        return this.currentFrame.iterator = iterator;
    }
    getKey() {
        return this.currentFrame.key;
    }
    setKey(key) {
        return this.currentFrame.key = key;
    }
    getBlocks() {
        return unwrap(this.currentFrame.blocks);
    }
    setBlocks(blocks) {
        return this.currentFrame.blocks = blocks;
    }
    getCallerScope() {
        return unwrap(this.currentFrame.callerScope);
    }
    setCallerScope(callerScope) {
        return this.currentFrame.callerScope = callerScope;
    }
    getComponent() {
        return unwrap(this.currentFrame.component);
    }
    getManager() {
        return unwrap(this.currentFrame.manager);
    }
    getShadow() {
        return this.currentFrame.shadow;
    }
    goto(ip) {
        this.setCurrent(ip);
    }
    hasOpcodes() {
        return this.frame !== null;
    }
    nextStatement(env) {
        let ip = this.frames[unwrap(this.frame)].ip;
        let ops = this.getOps();
        if (ip <= ops[1]) {
            let program = env.program;
            this.setCurrent(ip + 4);
            return program.opcode(ip);
        }
        else {
            this.pop();
            return null;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnJhbWUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJAZ2xpbW1lci9ydW50aW1lL2xpYi92bS9mcmFtZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQWlCLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFNOUQsTUFBTTtJQUNKLFlBQ1MsT0FBbUMsRUFDbkMsSUFBMkIsRUFDM0IsU0FBcUM7UUFGckMsWUFBTyxHQUFQLE9BQU8sQ0FBNEI7UUFDbkMsU0FBSSxHQUFKLElBQUksQ0FBdUI7UUFDM0IsY0FBUyxHQUFULFNBQVMsQ0FBNEI7SUFDM0MsQ0FBQztDQUNMO0FBRUQ7SUFXRSxZQUNTLEdBQVUsRUFDVixZQUF1QixJQUFJLEVBQzNCLFVBQStDLElBQUksRUFDbkQsU0FBOEIsSUFBSTtRQUhsQyxRQUFHLEdBQUgsR0FBRyxDQUFPO1FBQ1YsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFDM0IsWUFBTyxHQUFQLE9BQU8sQ0FBNEM7UUFDbkQsV0FBTSxHQUFOLE1BQU0sQ0FBNEI7UUFiM0MsWUFBTyxHQUErQixJQUFJLENBQUM7UUFDM0MsY0FBUyxHQUFRLElBQUksQ0FBQztRQUN0QixTQUFJLEdBQTBCLElBQUksQ0FBQztRQUNuQyxnQkFBVyxHQUFrQixJQUFJLENBQUM7UUFDbEMsV0FBTSxHQUFtQixJQUFJLENBQUM7UUFDOUIsY0FBUyxHQUErQixJQUFJLENBQUM7UUFDN0MsYUFBUSxHQUE4QixJQUFJLENBQUM7UUFDM0MsUUFBRyxHQUFtQixJQUFJLENBQUM7UUFRekIsSUFBSSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkIsQ0FBQztJQUVELE9BQU87UUFDTCxNQUFNLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNwRSxDQUFDO0lBRUQsT0FBTyxDQUFD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b25tZW50LCBPcGNvZGUgfSBmcm9tICcuLi9lbnZpcm9ubWVudCc7XG5pbXBvcnQgeyBSZWZlcmVuY2UsIFBhdGhSZWZlcmVuY2UsIFJlZmVyZW5jZUl0ZXJhdG9yIH0gZnJvbSAnQGdsaW1tZXIvcmVmZXJlbmNlJztcbmltcG9ydCB7IFRSVVNULCBPcHRpb24sIHVud3JhcCwgZXhwZWN0IH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQgeyBJbmxpbmVCbG9jayB9IGZyb20gJy4uL3NjYW5uZXInO1xuaW1wb3J0IHsgRXZhbHVhdGVkQXJncyB9IGZyb20gJy4uL2NvbXBpbGVkL2V4cHJlc3Npb25zL2FyZ3MnO1xuaW1wb3J0IHsgU2xpY2UgfSBmcm9tICcuLi9vcGNvZGVzJztcbmltcG9ydCB7IENvbXBvbmVudCwgQ29tcG9uZW50TWFuYWdlciB9IGZyb20gJy4uL2NvbXBvbmVudC9pbnRlcmZhY2VzJztcblxuZXhwb3J0IGNsYXNzIENhcHR1cmVkRnJhbWUge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwdWJsaWMgb3BlcmFuZDogT3B0aW9uPFBhdGhSZWZlcmVuY2U8YW55Pj4sXG4gICAgcHVibGljIGFyZ3M6IE9wdGlvbjxFdmFsdWF0ZWRBcmdzPixcbiAgICBwdWJsaWMgY29uZGl0aW9uOiBPcHRpb248UmVmZXJlbmNlPGJvb2xlYW4+PlxuICApIHt9XG59XG5cbmNsYXNzIEZyYW1lIHtcbiAgaXA6IG51bWJlcjtcbiAgb3BlcmFuZDogT3B0aW9uPFBhdGhSZWZlcmVuY2U8YW55Pj4gPSBudWxsO1xuICBpbW1lZGlhdGU6IGFueSA9IG51bGw7XG4gIGFyZ3M6IE9wdGlvbjxFdmFsdWF0ZWRBcmdzPiA9IG51bGw7XG4gIGNhbGxlclNjb3BlOiBPcHRpb248U2NvcGU+ID0gbnVsbDtcbiAgYmxvY2tzOiBPcHRpb248QmxvY2tzPiA9IG51bGw7XG4gIGNvbmRpdGlvbjogT3B0aW9uPFJlZmVyZW5jZTxib29sZWFuPj4gPSBudWxsO1xuICBpdGVyYXRvcjogT3B0aW9uPFJlZmVyZW5jZUl0ZXJhdG9yPiA9IG51bGw7XG4gIGtleTogT3B0aW9uPHN0cmluZz4gPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBvcHM6IFNsaWNlLFxuICAgIHB1YmxpYyBjb21wb25lbnQ6IENvbXBvbmVudCA9IG51bGwsXG4gICAgcHVibGljIG1hbmFnZXI6IE9wdGlvbjxDb21wb25lbnRNYW5hZ2VyPENvbXBvbmVudD4+ID0gbnVsbCxcbiAgICBwdWJsaWMgc2hhZG93OiBPcHRpb248SW5saW5lQmxvY2s+ID0gbnVsbFxuICApIHtcbiAgICB0aGlzLmlwID0gb3BzWzBdO1xuICB9XG5cbiAgY2FwdHVyZSgpOiBDYXB0dXJlZEZyYW1lIHtcbiAgICByZXR1cm4gbmV3IENhcHR1cmVkRnJhbWUodGhpcy5vcGVyYW5kLCB0aGlzLmFyZ3MsIHRoaXMuY29uZGl0aW9uKTtcbiAgfVxuXG4gIHJlc3RvcmUoZnJhbWU6IENhcHR1cmVkRnJhbWUpIHtcbiAgICB0aGlzLm9wZXJhbmQgPSBmcmFtZVsnb3BlcmFuZCddO1xuICAgIHRoaXMuYXJncyA9IGZyYW1lWydhcmdzJ107XG4gICAgdGhpcy5jb25kaXRpb24gPSBmcmFtZVsnY29uZGl0aW9uJ107XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBCbG9ja3Mge1xuICBkZWZhdWx0OiBPcHRpb248SW5saW5lQmxvY2s+O1xuICBpbnZlcnNlOiBPcHRpb248SW5saW5lQmxvY2s+O1xufVxuXG5leHBvcnQgY2xhc3MgRnJhbWVTdGFjayB7XG4gIHByaXZhdGUgZnJhbWVzOiBGcmFtZVtdID0gW107XG4gIHByaXZhdGUgZnJhbWU6IE9wdGlvbjxudW1iZXI+ID0gbnVsbDtcblxuICBwcml2YXRlIGdldCBjdXJyZW50RnJhbWUoKTogRnJhbWUge1xuICAgIHJldHVybiB0aGlzLmZyYW1lc1t1bndyYXAodGhpcy5mcmFtZSldO1xuICB9XG5cbiAgcHVzaChvcHM6IFNsaWNlLCBjb21wb25lbnQ6IENvbXBvbmVudCA9IG51bGwsIG1hbmFnZXI6IE9wdGlvbjxDb21wb25lbnRNYW5hZ2VyPENvbXBvbmVudD4+ID0gbnVsbCwgc2hhZG93OiBPcHRpb248SW5saW5lQmxvY2s+ID0gbnVsbCkge1xuICAgIGxldCBmcmFtZSA9ICh0aGlzLmZyYW1lID09PSBudWxsKSA/ICh0aGlzLmZyYW1lID0gMCkgOiArK3RoaXMuZnJhbWU7XG5cbiAgICBpZiAodGhpcy5mcmFtZXMubGVuZ3RoIDw9IGZyYW1lKSB7XG4gICAgICB0aGlzLmZyYW1lcy5wdXNoKG51bGwgYXMgVFJVU1Q8RnJhbWUsICd0aGUgbnVsbCBpcyByZXBsYWNlZCBvbiB0aGUgbmV4dCBsaW5lJz4pO1xuICAgIH1cblxuICAgIHRoaXMuZnJhbWVzW2ZyYW1lXSA9IG5ldyBGcmFtZShvcHMsIGNvbXBvbmVudCwgbWFuYWdlciwgc2hhZG93KTtcbiAgfVxuXG4gIHBvcCgpIHtcbiAgICBsZXQgeyBmcmFtZXMsIGZyYW1lIH0gPSB0aGlzO1xuICAgIGZyYW1lc1tleHBlY3QoZnJhbWUsICdvbmx5IHBvcCBhZnRlciBwdXNoaW5nJyldID0gbnVsbCBhcyBUUlVTVDxGcmFtZSwgXCJ0aGlzIGZyYW1lIHdvbid0IGJlIGFjY2Vzc2VkIGFueW1vcmVcIj47XG4gICAgdGhpcy5mcmFtZSA9IGZyYW1lID09PSAwID8gbnVsbCA6IGZyYW1lIC0gMTtcbiAgfVxuXG4gIGNhcHR1cmUoKTogQ2FwdHVyZWRGcmFtZSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZyYW1lLmNhcHR1cmUoKTtcbiAgfVxuXG4gIHJlc3RvcmUoZnJhbWU6IENhcHR1cmVkRnJhbWUpIHtcbiAgICB0aGlzLmN1cnJlbnRGcmFtZS5yZXN0b3JlKGZyYW1lKTtcbiAgfVxuXG4gIGdldE9wcygpOiBTbGljZSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZyYW1lLm9wcztcbiAgfVxuXG4gIGdldEN1cnJlbnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50RnJhbWUuaXA7XG4gIH1cblxuICBzZXRDdXJyZW50KGlwOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGcmFtZS5pcCA9IGlwO1xuICB9XG5cbiAgZ2V0T3BlcmFuZDxUPigpOiBQYXRoUmVmZXJlbmNlPFQ+IHtcbiAgICByZXR1cm4gdW53cmFwKHRoaXMuY3VycmVudEZyYW1lLm9wZXJhbmQpO1xuICB9XG5cbiAgc2V0T3BlcmFuZDxUPihvcGVyYW5kOiBQYXRoUmVmZXJlbmNlPFQ+KTogUGF0aFJlZmVyZW5jZTxUPiB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZyYW1lLm9wZXJhbmQgPSBvcGVyYW5kO1xuICB9XG5cbiAgZ2V0SW1tZWRpYXRlPFQ+KCk6IFQge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGcmFtZS5pbW1lZGlhdGU7XG4gIH1cblxuICBzZXRJbW1lZGlhdGU8VD4odmFsdWU6IFQpOiBUIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50RnJhbWUuaW1tZWRpYXRlID0gdmFsdWU7XG4gIH1cblxuICAvLyBGSVhNRTogVGhlc2Ugb3B0aW9ucyBhcmUgcmVxdWlyZWQgaW4gcHJhY3RpY2UgYnkgdGhlIGV4aXN0aW5nIGNvZGUsIGJ1dFxuICAvLyBmaWd1cmUgb3V0IHdoeS5cblxuICBnZXRBcmdzKCk6IE9wdGlvbjxFdmFsdWF0ZWRBcmdzPiB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZyYW1lLmFyZ3M7XG4gIH1cblxuICBzZXRBcmdzKGFyZ3M6IEV2YWx1YXRlZEFyZ3MpOiBFdmFsdWF0ZWRBcmdzIHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50RnJhbWUuYXJncyA9IGFyZ3M7XG4gIH1cblxuICBnZXRDb25kaXRpb24oKTogUmVmZXJlbmNlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdW53cmFwKHRoaXMuY3VycmVudEZyYW1lLmNvbmRpdGlvbik7XG4gIH1cblxuICBzZXRDb25kaXRpb24oY29uZGl0aW9uOiBSZWZlcmVuY2U8Ym9vbGVhbj4pOiBSZWZlcmVuY2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGcmFtZS5jb25kaXRpb24gPSBjb25kaXRpb247XG4gIH1cblxuICBnZXRJdGVyYXRvcigpOiBSZWZlcmVuY2VJdGVyYXRvciB7XG4gICAgcmV0dXJuIHVud3JhcCh0aGlzLmN1cnJlbnRGcmFtZS5pdGVyYXRvcik7XG4gIH1cblxuICBzZXRJdGVyYXRvcihpdGVyYXRvcjogUmVmZXJlbmNlSXRlcmF0b3IpOiBSZWZlcmVuY2VJdGVyYXRvciB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZyYW1lLml0ZXJhdG9yID0gaXRlcmF0b3I7XG4gIH1cblxuICBnZXRLZXkoKTogT3B0aW9uPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGcmFtZS5rZXk7XG4gIH1cblxuICBzZXRLZXkoa2V5OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGcmFtZS5rZXkgPSBrZXk7XG4gIH1cblxuICBnZXRCbG9ja3MoKTogQmxvY2tzIHtcbiAgICByZXR1cm4gdW53cmFwKHRoaXMuY3VycmVudEZyYW1lLmJsb2Nrcyk7XG4gIH1cblxuICBzZXRCbG9ja3MoYmxvY2tzOiBCbG9ja3MpOiBCbG9ja3Mge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGcmFtZS5ibG9ja3MgPSBibG9ja3M7XG4gIH1cblxuICBnZXRDYWxsZXJTY29wZSgpOiBTY29wZSB7XG4gICAgcmV0dXJuIHVud3JhcCh0aGlzLmN1cnJlbnRGcmFtZS5jYWxsZXJTY29wZSk7XG4gIH1cblxuICBzZXRDYWxsZXJTY29wZShjYWxsZXJTY29wZTogU2NvcGUpOiBTY29wZSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZyYW1lLmNhbGxlclNjb3BlID0gY2FsbGVyU2NvcGU7XG4gIH1cblxuICBnZXRDb21wb25lbnQoKTogQ29tcG9uZW50IHtcbiAgICByZXR1cm4gdW53cmFwKHRoaXMuY3VycmVudEZyYW1lLmNvbXBvbmVudCk7XG4gIH1cblxuICBnZXRNYW5hZ2VyKCk6IENvbXBvbmVudE1hbmFnZXI8Q29tcG9uZW50PiB7XG4gICAgcmV0dXJuIHVud3JhcCh0aGlzLmN1cnJlbnRGcmFtZS5tYW5hZ2VyKTtcbiAgfVxuXG4gIGdldFNoYWRvdygpOiBPcHRpb248SW5saW5lQmxvY2s+IHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50RnJhbWUuc2hhZG93O1xuICB9XG5cbiAgZ290byhpcDogbnVtYmVyKSB7XG4gICAgdGhpcy5zZXRDdXJyZW50KGlwKTtcbiAgfVxuXG4gIGhhc09wY29kZXMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZnJhbWUgIT09IG51bGw7XG4gIH1cblxuICBuZXh0U3RhdGVtZW50KGVudjogRW52aXJvbm1lbnQpOiBPcHRpb248T3Bjb2RlPiB7XG4gICAgbGV0IGlwID0gdGhpcy5mcmFtZXNbdW53cmFwKHRoaXMuZnJhbWUpXS5pcDtcbiAgICBsZXQgb3BzID0gdGhpcy5nZXRPcHMoKTtcblxuICAgIGlmIChpcCA8PSBvcHNbMV0pIHtcbiAgICAgIGxldCBwcm9ncmFtID0gZW52LnByb2dyYW07XG4gICAgICB0aGlzLnNldEN1cnJlbnQoaXAgKyA0KTtcbiAgICAgIHJldHVybiBwcm9ncmFtLm9wY29kZShpcCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucG9wKCk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbn1cbiJdfQ==