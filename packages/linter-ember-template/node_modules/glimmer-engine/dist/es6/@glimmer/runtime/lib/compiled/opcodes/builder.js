import * as content from './content';
import * as vm from './vm';
import { CompiledGetBlockBySymbol, CompiledInPartialGetBlock } from '../../compiled/expressions/has-block';
import { Stack, dict, expect } from '@glimmer/util';
import { expr } from '../../syntax/functions';
import { CompiledExpression } from '../expressions';
import { ComponentBuilder } from '../../compiler';
import { APPEND_OPCODES, OpcodeName as Op } from '../../opcodes';
function appendOpcode(name, op1, op2, op3) {
    return APPEND_OPCODES.construct(name, null, op1, op2, op3);
}
class Labels {
    constructor() {
        this.labels = dict();
        this.jumps = [];
        this.ranges = [];
    }
    label(name, index) {
        this.labels[name] = index;
    }
    jump(at, Target, target) {
        this.jumps.push({ at, target, Target });
    }
    range(at, Range, start, end) {
        this.ranges.push({ at, start, end, Range });
    }
    patch(constants, opcodes) {
        for (let i = 0; i < this.jumps.length; i++) {
            let { at, target, Target } = this.jumps[i];
            opcodes.set(at, APPEND_OPCODES.construct(Target, null, this.labels[target]));
        }
        for (let i = 0; i < this.ranges.length; i++) {
            let { at, start, end, Range } = this.ranges[i];
            let slice = constants.slice([this.labels[start], this.labels[end] - 1]);
            opcodes.set(at, APPEND_OPCODES.construct(Range, null, slice));
        }
    }
}
export class BasicOpcodeBuilder {
    constructor(symbolTable, env, program) {
        this.symbolTable = symbolTable;
        this.env = env;
        this.program = program;
        this.labelsStack = new Stack();
        this.constants = env.constants;
        this.start = program.next;
    }
    get pos() {
        return this.program.current;
    }
    get nextPos() {
        return this.program.next;
    }
    opcode(name, op1, op2, op3) {
        this.push(appendOpcode(name, op1, op2, op3));
    }
    push(op) {
        // console.log(`pushing ${op && op.type}`);
        if (op === null) {
            this.program.push([0, 0, 0, 0]);
        }
        else {
            this.program.push(op);
        }
    }
    toSlice() {
        return [this.start, this.program.current];
    }
    // helpers
    get labels() {
        return expect(this.labelsStack.current, 'bug: not in a label stack');
    }
    startLabels() {
        this.labelsStack.push(new Labels());
    }
    stopLabels() {
        let label = expect(this.labelsStack.pop(), 'unbalanced push and pop labels');
        label.patch(this.constants, this.program);
    }
    // partials
    putPartialDefinition(_definition) {
        let definition = this.constants.other(_definition);
        this.opcode(Op.PutPartial, definition);
    }
    putDynamicPartialDefinition() {
        this.opcode(Op.PutDynamicPartial, this.constants.other(this.symbolTable));
    }
    evaluatePartial() {
        this.opcode(Op.EvaluatePartial, this.constants.other(this.symbolTable), this.constants.other(dict()));
    }
    // components
    putComponentDefinition(definition) {
        this.opcode(Op.PutComponent, this.other(definition));
    }
    putDynamicComponentDefinition() {
        this.opcode(Op.PutDynamicComponent);
    }
    openComponent(args, shadow) {
        this.opcode(Op.OpenComponent, this.args(args), shadow ? this.block(shadow) : 0);
    }
    didCreateElement() {
        this.opcode(Op.DidCreateElement);
    }
    shadowAttributes() {
        this.opcode(Op.ShadowAttributes);
        this.opcode(Op.CloseBlock);
    }
    didRenderLayout() {
        this.opcode(Op.DidRenderLayout);
    }
    closeComponent() {
        this.opcode(Op.CloseComponent);
    }
    // content
    dynamicContent(Opcode) {
        this.opcode(Op.DynamicContent, this.other(Opcode));
    }
    cautiousAppend() {
        this.dynamicContent(new content.OptimizedCautiousAppendOpcode());
    }
    trustingAppend() {
        this.dynamicContent(new content.OptimizedTrustingAppendOpcode());
    }
    guardedCautiousAppend(expression) {
        this.dynamicContent(new content.GuardedCautiousAppendOpcode(this.compileExpression(expression), this.symbolTable));
    }
    guardedTrustingAppend(expression) {
        this.dynamicContent(new content.GuardedTrustingAppendOpcode(this.compileExpression(expression), this.symbolTable));
    }
    // dom
    text(text) {
        this.opcode(Op.Text, this.constants.string(text));
    }
    openPrimitiveElement(tag) {
        this.opcode(Op.OpenElement, this.constants.string(tag));
    }
    openComponentElement(tag) {
        this.opcode(Op.OpenComponentElement, this.constants.string(tag));
    }
    openDynamicPrimitiveElement() {
        this.opcode(Op.OpenDynamicElement);
    }
    flushElement() {
        this.opcode(Op.FlushElement);
    }
    closeElement() {
        this.opcode(Op.CloseElement);
    }
    staticAttr(_name, _namespace, _value) {
        let name = this.constants.string(_name);
        let namespace = _namespace ? this.constants.string(_namespace) : 0;
        let value = this.constants.string(_value);
        this.opcode(Op.StaticAttr, name, value, namespace);
    }
    dynamicAttrNS(_name, _namespace, trusting) {
        let name = this.constants.string(_name);
        let namespace = this.constants.string(_namespace);
        this.opcode(Op.DynamicAttrNS, name, namespace, trusting | 0);
    }
    dynamicAttr(_name, trusting) {
        let name = this.constants.string(_name);
        this.opcode(Op.DynamicAttr, name, trusting | 0);
    }
    comment(_comment) {
        let comment = this.constants.string(_comment);
        this.opcode(Op.Comment, comment);
    }
    modifier(_name, _args) {
        let args = this.constants.expression(this.compile(_args));
        let _modifierManager = this.env.lookupModifier([_name], this.symbolTable);
        let modifierManager = this.constants.other(_modifierManager);
        let name = this.constants.string(_name);
        this.opcode(Op.Modifier, name, modifierManager, args);
    }
    // lists
    putIterator() {
        this.opcode(Op.PutIterator);
    }
    enterList(start, end) {
        this.push(null);
        this.labels.range(this.pos, Op.EnterList, start, end);
    }
    exitList() {
        this.opcode(Op.ExitList);
    }
    enterWithKey(start, end) {
        this.push(null);
        this.labels.range(this.pos, Op.EnterWithKey, start, end);
    }
    nextIter(end) {
        this.push(null);
        this.labels.jump(this.pos, Op.NextIter, end);
    }
    // vm
    openBlock(_args, _inner) {
        let args = this.constants.expression(this.compile(_args));
        let inner = this.constants.other(_inner);
        this.opcode(Op.OpenBlock, inner, args);
    }
    closeBlock() {
        this.opcode(Op.CloseBlock);
    }
    pushRemoteElement() {
        this.opcode(Op.PushRemoteElement);
    }
    popRemoteElement() {
        this.opcode(Op.PopRemoteElement);
    }
    popElement() {
        this.opcode(Op.PopElement);
    }
    label(name) {
        this.labels.label(name, this.nextPos);
    }
    pushChildScope() {
        this.opcode(Op.PushChildScope);
    }
    popScope() {
        this.opcode(Op.PopScope);
    }
    pushDynamicScope() {
        this.opcode(Op.PushDynamicScope);
    }
    popDynamicScope() {
        this.opcode(Op.PopDynamicScope);
    }
    putNull() {
        this.opcode(Op.Put, this.constants.NULL_REFERENCE);
    }
    putValue(_expression) {
        let expr = this.constants.expression(this.compileExpression(_expression));
        this.opcode(Op.EvaluatePut, expr);
    }
    putArgs(_args) {
        let args = this.constants.expression(this.compile(_args));
        this.opcode(Op.PutArgs, args);
    }
    bindDynamicScope(_names) {
        this.opcode(Op.BindDynamicScope, this.names(_names));
    }
    bindPositionalArgs(_names, _symbols) {
        this.opcode(Op.BindPositionalArgs, this.names(_names), this.symbols(_symbols));
    }
    bindNamedArgs(_names, _symbols) {
        this.opcode(Op.BindNamedArgs, this.names(_names), this.symbols(_symbols));
    }
    bindBlocks(_names, _symbols) {
        this.opcode(Op.BindBlocks, this.names(_names), this.symbols(_symbols));
    }
    enter(enter, exit) {
        this.push(null);
        this.labels.range(this.pos, Op.Enter, enter, exit);
    }
    exit() {
        this.opcode(Op.Exit);
    }
    evaluate(_block) {
        let block = this.constants.block(_block);
        this.opcode(Op.Evaluate, block);
    }
    test(testFunc) {
        let _func;
        if (testFunc === 'const') {
            _func = vm.ConstTest;
        }
        else if (testFunc === 'simple') {
            _func = vm.SimpleTest;
        }
        else if (testFunc === 'environment') {
            _func = vm.EnvironmentTest;
        }
        else if (typeof testFunc === 'function') {
            _func = testFunc;
        }
        else {
            throw new Error('unreachable');
        }
        let func = this.constants.function(_func);
        this.opcode(Op.Test, func);
    }
    jump(target) {
        this.push(null);
        this.labels.jump(this.pos, Op.Jump, target);
    }
    jumpIf(target) {
        this.push(null);
        this.labels.jump(this.pos, Op.JumpIf, target);
    }
    jumpUnless(target) {
        this.push(null);
        this.labels.jump(this.pos, Op.JumpUnless, target);
    }
    names(_names) {
        let names = _names.map(n => this.constants.string(n));
        return this.constants.array(names);
    }
    symbols(symbols) {
        return this.constants.array(symbols);
    }
    other(value) {
        return this.constants.other(value);
    }
    args(args) {
        return this.constants.expression(this.compile(args));
    }
    block(block) {
        return this.constants.block(block);
    }
}
function isCompilableExpression(expr) {
    return expr && typeof expr['compile'] === 'function';
}
export default class OpcodeBuilder extends BasicOpcodeBuilder {
    constructor(symbolTable, env, program = env.program) {
        super(symbolTable, env, program);
        this.component = new ComponentBuilder(this);
    }
    compile(expr) {
        if (isCompilableExpression(expr)) {
            return expr.compile(this);
        }
        else {
            return expr;
        }
    }
    compileExpression(expression) {
        if (expression instanceof CompiledExpression) {
            return expression;
        }
        else {
            return expr(expression, this);
        }
    }
    bindPositionalArgsForLocals(locals) {
        let symbols = Object.keys(locals).map(name => locals[name]);
        this.opcode(Op.BindPositionalArgs, this.symbols(symbols));
    }
    preludeForLayout(layout) {
        let symbols = layout.symbolTable.getSymbols();
        if (symbols.named) {
            let named = symbols.named;
            let namedNames = Object.keys(named);
            let namedSymbols = namedNames.map(n => named[n]);
            this.opcode(Op.BindNamedArgs, this.names(namedNames), this.symbols(namedSymbols));
        }
        this.opcode(Op.BindCallerScope);
        if (symbols.yields) {
            let yields = symbols.yields;
            let yieldNames = Object.keys(yields);
            let yieldSymbols = yieldNames.map(n => yields[n]);
            this.opcode(Op.BindBlocks, this.names(yieldNames), this.symbols(yieldSymbols));
        }
        if (symbols.partialArgs) {
            this.opcode(Op.BindPartialArgs, symbols.partialArgs);
        }
    }
    yield(args, to) {
        let yields, partial;
        let inner;
        if (yields = this.symbolTable.getSymbol('yields', to)) {
            inner = new CompiledGetBlockBySymbol(yields, to);
        }
        else if (partial = this.symbolTable.getPartialArgs()) {
            inner = new CompiledInPartialGetBlock(partial, to);
        }
        else {
            throw new Error('[BUG] ${to} is not a valid block name.');
        }
        this.openBlock(args, inner);
        this.closeBlock();
    }
    // TODO
    // come back to this
    labelled(args, callback) {
        if (args)
            this.putArgs(args);
        this.startLabels();
        this.enter('BEGIN', 'END');
        this.label('BEGIN');
        callback(this, 'BEGIN', 'END');
        this.label('END');
        this.exit();
        this.stopLabels();
    }
    // TODO
    // come back to this
    iter(callback) {
        this.startLabels();
        this.enterList('BEGIN', 'END');
        this.label('ITER');
        this.nextIter('BREAK');
        this.enterWithKey('BEGIN', 'END');
        this.label('BEGIN');
        callback(this, 'BEGIN', 'END');
        this.label('END');
        this.exit();
        this.jump('ITER');
        this.label('BREAK');
        this.exitList();
        this.stopLabels();
    }
    // TODO
    // come back to this
    unit(callback) {
        this.startLabels();
        callback(this);
        this.stopLabels();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL2NvbXBpbGVkL29wY29kZXMvYnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssT0FBTyxNQUFNLFdBQVcsQ0FBQztBQUNyQyxPQUFPLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUkzQixPQUFPLEVBRUwsd0JBQXdCLEVBQ3hCLHlCQUF5QixFQUMxQixNQUFNLHNDQUFzQyxDQUFDO0FBRTlDLE9BQU8sRUFBVSxLQUFLLEVBQWdCLElBQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRzlDLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBTXBELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBR2xELE9BQU8sRUFDTCxjQUFjLEVBQ2QsVUFBVSxJQUFJLEVBQUUsRUFNakIsTUFBTSxlQUFlLENBQUM7QUFFdkIsc0JBQXNCLElBQVEsRUFBRSxHQUFZLEVBQUUsR0FBWSxFQUFFLEdBQVk7SUFDdEUsTUFBTSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQzdELENBQUM7QUFtQkQ7SUFBQTtRQUNFLFdBQU0sR0FBRyxJQUFJLEVBQVUsQ0FBQztRQUN4QixVQUFLLEdBQTJELEVBQUUsQ0FBQztRQUNuRSxXQUFNLEdBQXFFLEVBQUUsQ0FBQztJQTBCaEYsQ0FBQztJQXhCQyxLQUFLLENBQUMsSUFBWSxFQUFFLEtBQWE7UUFDL0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUM7SUFDNUIsQ0FBQztJQUVELElBQUksQ0FBQyxFQUFVLEVBQUUsTUFB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LEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNsQixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDWixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDcEIsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRUQsT0FBTztJQUNQLG9CQUFvQjtJQUNwQixJQUFJLENBQUMsUUFBMEM7UUFDN0MsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ25CLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUNwQixDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjb250ZW50IGZyb20gJy4vY29udGVudCc7XG5pbXBvcnQgKiBhcyB2bSBmcm9tICcuL3ZtJztcblxuaW1wb3J0IHsgSW5zZXJ0aW9uIH0gZnJvbSAnLi4vLi4vdXBzZXJ0JztcblxuaW1wb3J0IHtcbiAgQ29tcGlsZWRHZXRCbG9jayxcbiAgQ29tcGlsZWRHZXRCbG9ja0J5U3ltYm9sLFxuICBDb21waWxlZEluUGFydGlhbEdldEJsb2NrXG59IGZyb20gJy4uLy4uL2NvbXBpbGVkL2V4cHJlc3Npb25zL2hhcy1ibG9jayc7XG5cbmltcG9ydCB7IE9wdGlvbiwgU3RhY2ssIERpY3QsIE9wYXF1ZSwgZGljdCwgZXhwZWN0IH0gZnJvbSAnQGdsaW1tZXIvdXRpbCc7XG5pbXBvcnQgeyBleHByIH0gZnJvbSAnLi4vLi4vc3ludGF4L2Z1bmN0aW9ucyc7XG5pbXBvcnQgeyBDb25zdGFudHMsIFNsaWNlIH0gZnJvbSAnLi4vLi4vb3Bjb2Rlcyc7XG5pbXBvcnQgeyBDb21waWxlZEFyZ3MgfSBmcm9tICcuLi9leHByZXNzaW9ucy9hcmdzJztcbmltcG9ydCB7IENvbXBpbGVkRXhwcmVzc2lvbiB9IGZyb20gJy4uL2V4cHJlc3Npb25zJztcbmltcG9ydCB7IENvbXBvbmVudERlZmluaXRpb24gfSBmcm9tICcuLi8uLi9jb21wb25lbnQvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBQYXJ0aWFsRGVmaW5pdGlvbiB9IGZyb20gJy4uLy4uL3BhcnRpYWwnO1xuaW1wb3J0IEVudmlyb25tZW50LCB7IFByb2dyYW0gfSBmcm9tICcuLi8uLi9lbnZpcm9ubWVudCc7XG5pbXBvcnQgeyBTeW1ib2xUYWJsZSB9IGZyb20gJ0BnbGltbWVyL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgQ29tcG9uZW50QnVpbGRlciBhcyBJQ29tcG9uZW50QnVpbGRlciB9IGZyb20gJy4uLy4uL29wY29kZS1idWlsZGVyJztcbmltcG9ydCB7IENvbXBvbmVudEJ1aWxkZXIgfSBmcm9tICcuLi8uLi9jb21waWxlcic7XG5pbXBvcnQgeyBCYXNlbGluZVN5bnRheCwgSW5saW5lQmxvY2ssIFRlbXBsYXRlIH0gZnJvbSAnLi4vLi4vc2Nhbm5lcic7XG5cbmltcG9ydCB7XG4gIEFQUEVORF9PUENPREVTLFxuICBPcGNvZGVOYW1lIGFzIE9wLFxuICBBcHBlbmRPcGNvZGUsXG4gIENvbnN0YW50QXJyYXksXG4gIENvbnN0YW50T3RoZXIsXG4gIENvbnN0YW50RXhwcmVzc2lvbixcbiAgQ29uc3RhbnRCbG9ja1xufSBmcm9tICcuLi8uLi9vcGNvZGVzJztcblxuZnVuY3Rpb24gYXBwZW5kT3Bjb2RlKG5hbWU6IE9wLCBvcDE/OiBudW1iZXIsIG9wMj86IG51bWJlciwgb3AzPzogbnVtYmVyKTogQXBwZW5kT3Bjb2RlIHtcbiAgcmV0dXJuIEFQUEVORF9PUENPREVTLmNvbnN0cnVjdChuYW1lLCBudWxsLCBvcDEsIG9wMiwgb3AzKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb21waWxlc0ludG88RT4ge1xuICBjb21waWxlKGJ1aWxkZXI6IE9wY29kZUJ1aWxkZXIpOiBFO1xufVxuXG5leHBvcnQgdHlwZSBSZXByZXNlbnRzRXhwcmVzc2lvbiA9IEJhc2VsaW5lU3ludGF4LkFueUV4cHJlc3Npb24gfCBDb21waWxlZEV4cHJlc3Npb248T3BhcXVlPjtcblxuZXhwb3J0IHR5cGUgUmVwcmVzZW50czxFPiA9IENvbXBpbGVzSW50bzxFPiB8IEU7XG5cbmV4cG9ydCB0eXBlIExhYmVsID0gc3RyaW5nO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN5bWJvbExvb2t1cCB7XG4gIHN5bWJvbFRhYmxlOiBTeW1ib2xUYWJsZTtcbn1cblxudHlwZSBUYXJnZXRPcGNvZGUgPSBPcC5KdW1wIHwgT3AuSnVtcElmIHwgT3AuSnVtcFVubGVzcyB8IE9wLk5leHRJdGVyO1xudHlwZSBSYW5nZU9wY29kZSA9IE9wLkVudGVyIHwgT3AuRW50ZXJMaXN0IHwgT3AuRW50ZXJXaXRoS2V5IHwgT3AuTmV4dEl0ZXI7XG5cbmNsYXNzIExhYmVscyB7XG4gIGxhYmVscyA9IGRpY3Q8bnVtYmVyPigpO1xuICBqdW1wczogeyBhdDogbnVtYmVyLCB0YXJnZXQ6IHN0cmluZywgVGFyZ2V0OiBUYXJnZXRPcGNvZGUgfVtdID0gW107XG4gIHJhbmdlczogeyBhdDogbnVtYmVyLCBzdGFydDogc3RyaW5nLCBlbmQ6IHN0cmluZywgUmFuZ2U6IFJhbmdlT3Bjb2RlIH1bXSA9IFtdO1xuXG4gIGxhYmVsKG5hbWU6IHN0cmluZywgaW5kZXg6IG51bWJlcikge1xuICAgIHRoaXMubGFiZWxzW25hbWVdID0gaW5kZXg7XG4gIH1cblxuICBqdW1wKGF0OiBudW1iZXIsIFRhcmdldDogVGFyZ2V0T3Bjb2RlLCB0YXJnZXQ6IHN0cmluZykge1xuICAgIHRoaXMuanVtcHMucHVzaCh7IGF0LCB0YXJnZXQsIFRhcmdldCB9KTtcbiAgfVxuXG4gIHJhbmdlKGF0OiBudW1iZXIsIFJhbmdlOiBSYW5nZU9wY29kZSwgc3RhcnQ6IHN0cmluZywgZW5kOiBzdHJpbmcpIHtcbiAgICB0aGlzLnJhbmdlcy5wdXNoKHsgYXQsIHN0YXJ0LCBlbmQsIFJhbmdlIH0pO1xuICB9XG5cbiAgcGF0Y2goY29uc3RhbnRzOiBDb25zdGFudHMsIG9wY29kZXM6IFByb2dyYW0pOiB2b2lkIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuanVtcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCB7IGF0LCB0YXJnZXQsIFRhcmdldCB9ID0gdGhpcy5qdW1wc1tpXTtcbiAgICAgIG9wY29kZXMuc2V0KGF0LCBBUFBFTkRfT1BDT0RFUy5jb25zdHJ1Y3QoVGFyZ2V0LCBudWxsLCB0aGlzLmxhYmVsc1t0YXJnZXRdKSk7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IHsgYXQsIHN0YXJ0LCBlbmQsIFJhbmdlIH0gPSB0aGlzLnJhbmdlc1tpXTtcbiAgICAgIGxldCBzbGljZSA9IGNvbnN0YW50cy5zbGljZShbdGhpcy5sYWJlbHNbc3RhcnRdLCB0aGlzLmxhYmVsc1tlbmRdIC0gMV0pO1xuICAgICAgb3Bjb2Rlcy5zZXQoYXQsIEFQUEVORF9PUENPREVTLmNvbnN0cnVjdChSYW5nZSwgbnVsbCwgc2xpY2UpKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEJhc2ljT3Bjb2RlQnVpbGRlciBpbXBsZW1lbnRzIFN5bWJvbExvb2t1cCB7XG4gIHByaXZhdGUgbGFiZWxzU3RhY2sgPSBuZXcgU3RhY2s8TGFiZWxzPigpO1xuICBwdWJsaWMgY29uc3RhbnRzOiBDb25zdGFudHM7XG4gIHByaXZhdGUgc3RhcnQ6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgc3ltYm9sVGFibGU6IFN5bWJvbFRhYmxlLCBwdWJsaWMgZW52OiBFbnZpcm9ubWVudCwgcHVibGljIHByb2dyYW06IFByb2dyYW0pIHtcbiAgICB0aGlzLmNvbnN0YW50cyA9IGVudi5jb25zdGFudHM7XG4gICAgdGhpcy5zdGFydCA9IHByb2dyYW0ubmV4dDtcbiAgfVxuXG4gIGFic3RyYWN0IGNvbXBpbGU8RT4oZXhwcjogUmVwcmVzZW50czxFPik6IEU7XG4gIGFic3RyYWN0IGNvbXBpbGVFeHByZXNzaW9uKGV4cHI6IFJlcHJlc2VudHNFeHByZXNzaW9uKTogQ29tcGlsZWRFeHByZXNzaW9uPE9wYXF1ZT47XG5cbiAgcHJpdmF0ZSBnZXQgcG9zKCkge1xuICAgIHJldHVybiB0aGlzLnByb2dyYW0uY3VycmVudDtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0IG5leHRQb3MoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJvZ3JhbS5uZXh0O1xuICB9XG5cbiAgcHJvdGVjdGVkIG9wY29kZShuYW1lOiBPcCwgb3AxPzogbnVtYmVyLCBvcDI/OiBudW1iZXIsIG9wMz86IG51bWJlcikge1xuICAgIHRoaXMucHVzaChhcHBlbmRPcGNvZGUobmFtZSwgb3AxLCBvcDIsIG9wMykpO1xuICB9XG5cbiAgcHVzaChvcDogT3B0aW9uPEFwcGVuZE9wY29kZT4pIHtcbiAgICAvLyBjb25zb2xlLmxvZyhgcHVzaGluZyAke29wICYmIG9wLnR5cGV9YCk7XG4gICAgaWYgKG9wID09PSBudWxsKSB7XG4gICAgICB0aGlzLnByb2dyYW0ucHVzaChbMCwgMCwgMCwgMF0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb2dyYW0ucHVzaChvcCk7XG4gICAgfVxuICB9XG5cbiAgdG9TbGljZSgpOiBTbGljZSB7XG4gICAgcmV0dXJuIFt0aGlzLnN0YXJ0LCB0aGlzLnByb2dyYW0uY3VycmVudF07XG4gIH1cblxuICAvLyBoZWxwZXJzXG5cbiAgcHJpdmF0ZSBnZXQgbGFiZWxzKCk6IExhYmVscyB7XG4gICAgcmV0dXJuIGV4cGVjdCh0aGlzLmxhYmVsc1N0YWNrLmN1cnJlbnQsICdidWc6IG5vdCBpbiBhIGxhYmVsIHN0YWNrJyk7XG4gIH1cblxuICBzdGFydExhYmVscygpIHtcbiAgICB0aGlzLmxhYmVsc1N0YWNrLnB1c2gobmV3IExhYmVscygpKTtcbiAgfVxuXG4gIHN0b3BMYWJlbHMoKSB7XG4gICAgbGV0IGxhYmVsID0gZXhwZWN0KHRoaXMubGFiZWxzU3RhY2sucG9wKCksICd1bmJhbGFuY2VkIHB1c2ggYW5kIHBvcCBsYWJlbHMnKTtcbiAgICBsYWJlbC5wYXRjaCh0aGlzLmNvbnN0YW50cywgdGhpcy5wcm9ncmFtKTtcbiAgfVxuXG4gIC8vIHBhcnRpYWxzXG5cbiAgcHV0UGFydGlhbERlZmluaXRpb24oX2RlZmluaXRpb246IFBhcnRpYWxEZWZpbml0aW9uPE9wYXF1ZT4pIHtcbiAgICBsZXQgZGVmaW5pdGlvbiA9IHRoaXMuY29uc3RhbnRzLm90aGVyKF9kZWZpbml0aW9uKTtcbiAgICB0aGlzLm9wY29kZShPcC5QdXRQYXJ0aWFsLCBkZWZpbml0aW9uKTtcbiAgfVxuXG4gIHB1dER5bmFtaWNQYXJ0aWFsRGVmaW5pdGlvbigpIHtcbiAgICB0aGlzLm9wY29kZShPcC5QdXREeW5hbWljUGFydGlhbCwgdGhpcy5jb25zdGFudHMub3RoZXIodGhpcy5zeW1ib2xUYWJsZSkpO1xuICB9XG5cbiAgZXZhbHVhdGVQYXJ0aWFsKCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkV2YWx1YXRlUGFydGlhbCwgdGhpcy5jb25zdGFudHMub3RoZXIodGhpcy5zeW1ib2xUYWJsZSksIHRoaXMuY29uc3RhbnRzLm90aGVyKGRpY3QoKSkpO1xuICB9XG5cbiAgLy8gY29tcG9uZW50c1xuXG4gIHB1dENvbXBvbmVudERlZmluaXRpb24oZGVmaW5pdGlvbjogQ29tcG9uZW50RGVmaW5pdGlvbjxPcGFxdWU+KSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUHV0Q29tcG9uZW50LCB0aGlzLm90aGVyKGRlZmluaXRpb24pKTtcbiAgfVxuXG4gIHB1dER5bmFtaWNDb21wb25lbnREZWZpbml0aW9uKCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLlB1dER5bmFtaWNDb21wb25lbnQpO1xuICB9XG5cbiAgb3BlbkNvbXBvbmVudChhcmdzOiBSZXByZXNlbnRzPENvbXBpbGVkQXJncz4sIHNoYWRvdz86IElubGluZUJsb2NrKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuT3BlbkNvbXBvbmVudCwgdGhpcy5hcmdzKGFyZ3MpLCBzaGFkb3cgPyB0aGlzLmJsb2NrKHNoYWRvdykgOiAwKTtcbiAgfVxuXG4gIGRpZENyZWF0ZUVsZW1lbnQoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuRGlkQ3JlYXRlRWxlbWVudCk7XG4gIH1cblxuICBzaGFkb3dBdHRyaWJ1dGVzKCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLlNoYWRvd0F0dHJpYnV0ZXMpO1xuICAgIHRoaXMub3Bjb2RlKE9wLkNsb3NlQmxvY2spO1xuICB9XG5cbiAgZGlkUmVuZGVyTGF5b3V0KCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkRpZFJlbmRlckxheW91dCk7XG4gIH1cblxuICBjbG9zZUNvbXBvbmVudCgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5DbG9zZUNvbXBvbmVudCk7XG4gIH1cblxuICAvLyBjb250ZW50XG5cbiAgZHluYW1pY0NvbnRlbnQoT3Bjb2RlOiBjb250ZW50LkFwcGVuZER5bmFtaWNPcGNvZGU8SW5zZXJ0aW9uPikge1xuICAgIHRoaXMub3Bjb2RlKE9wLkR5bmFtaWNDb250ZW50LCB0aGlzLm90aGVyKE9wY29kZSkpO1xuICB9XG5cbiAgY2F1dGlvdXNBcHBlbmQoKSB7XG4gICAgdGhpcy5keW5hbWljQ29udGVudChuZXcgY29udGVudC5PcHRpbWl6ZWRDYXV0aW91c0FwcGVuZE9wY29kZSgpKTtcbiAgfVxuXG4gIHRydXN0aW5nQXBwZW5kKCkge1xuICAgIHRoaXMuZHluYW1pY0NvbnRlbnQobmV3IGNvbnRlbnQuT3B0aW1pemVkVHJ1c3RpbmdBcHBlbmRPcGNvZGUoKSk7XG4gIH1cblxuICBndWFyZGVkQ2F1dGlvdXNBcHBlbmQoZXhwcmVzc2lvbjogUmVwcmVzZW50c0V4cHJlc3Npb24pIHtcbiAgICB0aGlzLmR5bmFtaWNDb250ZW50KG5ldyBjb250ZW50Lkd1YXJkZWRDYXV0aW91c0FwcGVuZE9wY29kZSh0aGlzLmNvbXBpbGVFeHByZXNzaW9uKGV4cHJlc3Npb24pLCB0aGlzLnN5bWJvbFRhYmxlKSk7XG4gIH1cblxuICBndWFyZGVkVHJ1c3RpbmdBcHBlbmQoZXhwcmVzc2lvbjogUmVwcmVzZW50c0V4cHJlc3Npb24pIHtcbiAgICB0aGlzLmR5bmFtaWNDb250ZW50KG5ldyBjb250ZW50Lkd1YXJkZWRUcnVzdGluZ0FwcGVuZE9wY29kZSh0aGlzLmNvbXBpbGVFeHByZXNzaW9uKGV4cHJlc3Npb24pLCB0aGlzLnN5bWJvbFRhYmxlKSk7XG4gIH1cblxuICAvLyBkb21cblxuICB0ZXh0KHRleHQ6IHN0cmluZykge1xuICAgIHRoaXMub3Bjb2RlKE9wLlRleHQsIHRoaXMuY29uc3RhbnRzLnN0cmluZyh0ZXh0KSk7XG4gIH1cblxuICBvcGVuUHJpbWl0aXZlRWxlbWVudCh0YWc6IHN0cmluZykge1xuICAgIHRoaXMub3Bjb2RlKE9wLk9wZW5FbGVtZW50LCB0aGlzLmNvbnN0YW50cy5zdHJpbmcodGFnKSk7XG4gIH1cblxuICBvcGVuQ29tcG9uZW50RWxlbWVudCh0YWc6IHN0cmluZykge1xuICAgIHRoaXMub3Bjb2RlKE9wLk9wZW5Db21wb25lbnRFbGVtZW50LCB0aGlzLmNvbnN0YW50cy5zdHJpbmcodGFnKSk7XG4gIH1cblxuICBvcGVuRHluYW1pY1ByaW1pdGl2ZUVsZW1lbnQoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuT3BlbkR5bmFtaWNFbGVtZW50KTtcbiAgfVxuXG4gIGZsdXNoRWxlbWVudCgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5GbHVzaEVsZW1lbnQpO1xuICB9XG5cbiAgY2xvc2VFbGVtZW50KCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkNsb3NlRWxlbWVudCk7XG4gIH1cblxuICBzdGF0aWNBdHRyKF9uYW1lOiBzdHJpbmcsIF9uYW1lc3BhY2U6IE9wdGlvbjxzdHJpbmc+LCBfdmFsdWU6IHN0cmluZykge1xuICAgIGxldCBuYW1lID0gdGhpcy5jb25zdGFudHMuc3RyaW5nKF9uYW1lKTtcbiAgICBsZXQgbmFtZXNwYWNlID0gX25hbWVzcGFjZSA/IHRoaXMuY29uc3RhbnRzLnN0cmluZyhfbmFtZXNwYWNlKSA6IDA7XG4gICAgbGV0IHZhbHVlID0gdGhpcy5jb25zdGFudHMuc3RyaW5nKF92YWx1ZSk7XG5cbiAgICB0aGlzLm9wY29kZShPcC5TdGF0aWNBdHRyLCBuYW1lLCB2YWx1ZSwgbmFtZXNwYWNlKTtcbiAgfVxuXG4gIGR5bmFtaWNBdHRyTlMoX25hbWU6IHN0cmluZywgX25hbWVzcGFjZTogc3RyaW5nLCB0cnVzdGluZzogYm9vbGVhbikge1xuICAgIGxldCBuYW1lID0gdGhpcy5jb25zdGFudHMuc3RyaW5nKF9uYW1lKTtcbiAgICBsZXQgbmFtZXNwYWNlID0gdGhpcy5jb25zdGFudHMuc3RyaW5nKF9uYW1lc3BhY2UpO1xuXG4gICAgdGhpcy5vcGNvZGUoT3AuRHluYW1pY0F0dHJOUywgbmFtZSwgbmFtZXNwYWNlLCAodHJ1c3RpbmcgYXMgYW55KXwwKTtcbiAgfVxuXG4gIGR5bmFtaWNBdHRyKF9uYW1lOiBzdHJpbmcsIHRydXN0aW5nOiBib29sZWFuKSB7XG4gICAgbGV0IG5hbWUgPSB0aGlzLmNvbnN0YW50cy5zdHJpbmcoX25hbWUpO1xuICAgIHRoaXMub3Bjb2RlKE9wLkR5bmFtaWNBdHRyLCBuYW1lLCAodHJ1c3RpbmcgYXMgYW55KXwwKTtcbiAgfVxuXG4gIGNvbW1lbnQoX2NvbW1lbnQ6IHN0cmluZykge1xuICAgIGxldCBjb21tZW50ID0gdGhpcy5jb25zdGFudHMuc3RyaW5nKF9jb21tZW50KTtcbiAgICB0aGlzLm9wY29kZShPcC5Db21tZW50LCBjb21tZW50KTtcbiAgfVxuXG4gIG1vZGlmaWVyKF9uYW1lOiBzdHJpbmcsIF9hcmdzOiBSZXByZXNlbnRzPENvbXBpbGVkQXJncz4pIHtcbiAgICBsZXQgYXJncyA9IHRoaXMuY29uc3RhbnRzLmV4cHJlc3Npb24odGhpcy5jb21waWxlKF9hcmdzKSk7XG4gICAgbGV0IF9tb2RpZmllck1hbmFnZXIgPSB0aGlzLmVudi5sb29rdXBNb2RpZmllcihbX25hbWVdLCB0aGlzLnN5bWJvbFRhYmxlKTtcbiAgICBsZXQgbW9kaWZpZXJNYW5hZ2VyID0gdGhpcy5jb25zdGFudHMub3RoZXIoX21vZGlmaWVyTWFuYWdlcik7XG4gICAgbGV0IG5hbWUgPSB0aGlzLmNvbnN0YW50cy5zdHJpbmcoX25hbWUpO1xuICAgIHRoaXMub3Bjb2RlKE9wLk1vZGlmaWVyLCBuYW1lLCBtb2RpZmllck1hbmFnZXIsIGFyZ3MpO1xuICB9XG5cbiAgLy8gbGlzdHNcblxuICBwdXRJdGVyYXRvcigpIHtcbiAgICB0aGlzLm9wY29kZShPcC5QdXRJdGVyYXRvcik7XG4gIH1cblxuICBlbnRlckxpc3Qoc3RhcnQ6IHN0cmluZywgZW5kOiBzdHJpbmcpIHtcbiAgICB0aGlzLnB1c2gobnVsbCk7XG4gICAgdGhpcy5sYWJlbHMucmFuZ2UodGhpcy5wb3MsIE9wLkVudGVyTGlzdCwgc3RhcnQsIGVuZCk7XG4gIH1cblxuICBleGl0TGlzdCgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5FeGl0TGlzdCk7XG4gIH1cblxuICBlbnRlcldpdGhLZXkoc3RhcnQ6IHN0cmluZywgZW5kOiBzdHJpbmcpIHtcbiAgICB0aGlzLnB1c2gobnVsbCk7XG4gICAgdGhpcy5sYWJlbHMucmFuZ2UodGhpcy5wb3MsIE9wLkVudGVyV2l0aEtleSwgc3RhcnQsIGVuZCk7XG4gIH1cblxuICBuZXh0SXRlcihlbmQ6IHN0cmluZykge1xuICAgIHRoaXMucHVzaChudWxsKTtcbiAgICB0aGlzLmxhYmVscy5qdW1wKHRoaXMucG9zLCBPcC5OZXh0SXRlciwgZW5kKTtcbiAgfVxuXG4gIC8vIHZtXG5cbiAgb3BlbkJsb2NrKF9hcmdzOiBSZXByZXNlbnRzPENvbXBpbGVkQXJncz4sIF9pbm5lcjogQ29tcGlsZWRHZXRCbG9jaykge1xuICAgIGxldCBhcmdzID0gdGhpcy5jb25zdGFudHMuZXhwcmVzc2lvbih0aGlzLmNvbXBpbGUoX2FyZ3MpKTtcbiAgICBsZXQgaW5uZXIgPSB0aGlzLmNvbnN0YW50cy5vdGhlcihfaW5uZXIpO1xuICAgIHRoaXMub3Bjb2RlKE9wLk9wZW5CbG9jaywgaW5uZXIsIGFyZ3MpO1xuICB9XG5cbiAgY2xvc2VCbG9jaygpIHtcbiAgICB0aGlzLm9wY29kZShPcC5DbG9zZUJsb2NrKTtcbiAgfVxuXG4gIHB1c2hSZW1vdGVFbGVtZW50KCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLlB1c2hSZW1vdGVFbGVtZW50KTtcbiAgfVxuXG4gIHBvcFJlbW90ZUVsZW1lbnQoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUG9wUmVtb3RlRWxlbWVudCk7XG4gIH1cblxuICBwb3BFbGVtZW50KCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLlBvcEVsZW1lbnQpO1xuICB9XG5cbiAgbGFiZWwobmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5sYWJlbHMubGFiZWwobmFtZSwgdGhpcy5uZXh0UG9zKTtcbiAgfVxuXG4gIHB1c2hDaGlsZFNjb3BlKCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLlB1c2hDaGlsZFNjb3BlKTtcbiAgfVxuXG4gIHBvcFNjb3BlKCkge1xuICAgIHRoaXMub3Bjb2RlKE9wLlBvcFNjb3BlKTtcbiAgfVxuXG4gIHB1c2hEeW5hbWljU2NvcGUoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUHVzaER5bmFtaWNTY29wZSk7XG4gIH1cblxuICBwb3BEeW5hbWljU2NvcGUoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUG9wRHluYW1pY1Njb3BlKTtcbiAgfVxuXG4gIHB1dE51bGwoKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuUHV0LCB0aGlzLmNvbnN0YW50cy5OVUxMX1JFRkVSRU5DRSk7XG4gIH1cblxuICBwdXRWYWx1ZShfZXhwcmVzc2lvbjogUmVwcmVzZW50c0V4cHJlc3Npb24pIHtcbiAgICBsZXQgZXhwciA9IHRoaXMuY29uc3RhbnRzLmV4cHJlc3Npb24odGhpcy5jb21waWxlRXhwcmVzc2lvbihfZXhwcmVzc2lvbikpO1xuICAgIHRoaXMub3Bjb2RlKE9wLkV2YWx1YXRlUHV0LCBleHByKTtcbiAgfVxuXG4gIHB1dEFyZ3MoX2FyZ3M6IFJlcHJlc2VudHM8Q29tcGlsZWRBcmdzPikge1xuICAgIGxldCBhcmdzID0gdGhpcy5jb25zdGFudHMuZXhwcmVzc2lvbih0aGlzLmNvbXBpbGUoX2FyZ3MpKTtcbiAgICB0aGlzLm9wY29kZShPcC5QdXRBcmdzLCBhcmdzKTtcbiAgfVxuXG4gIGJpbmREeW5hbWljU2NvcGUoX25hbWVzOiBzdHJpbmdbXSkge1xuICAgIHRoaXMub3Bjb2RlKE9wLkJpbmREeW5hbWljU2NvcGUsIHRoaXMubmFtZXMoX25hbWVzKSk7XG4gIH1cblxuICBiaW5kUG9zaXRpb25hbEFyZ3MoX25hbWVzOiBzdHJpbmdbXSwgX3N5bWJvbHM6IG51bWJlcltdKSB7XG4gICAgdGhpcy5vcGNvZGUoT3AuQmluZFBvc2l0aW9uYWxBcmdzLCB0aGlzLm5hbWVzKF9uYW1lcyksIHRoaXMuc3ltYm9scyhfc3ltYm9scykpO1xuICB9XG5cbiAgYmluZE5hbWVkQXJncyhfbmFtZXM6IHN0cmluZ1tdLCBfc3ltYm9sczogbnVtYmVyW10pIHtcbiAgICB0aGlzLm9wY29kZShPcC5CaW5kTmFtZWRBcmdzLCB0aGlzLm5hbWVzKF9uYW1lcyksIHRoaXMuc3ltYm9scyhfc3ltYm9scykpO1xuICB9XG5cbiAgYmluZEJsb2NrcyhfbmFtZXM6IHN0cmluZ1tdLCBfc3ltYm9sczogbnVtYmVyW10pIHtcbiAgICB0aGlzLm9wY29kZShPcC5CaW5kQmxvY2tzLCB0aGlzLm5hbWVzKF9uYW1lcyksIHRoaXMuc3ltYm9scyhfc3ltYm9scykpO1xuICB9XG5cbiAgZW50ZXIoZW50ZXI6IHN0cmluZywgZXhpdDogc3RyaW5nKSB7XG4gICAgdGhpcy5wdXNoKG51bGwpO1xuICAgIHRoaXMubGFiZWxzLnJhbmdlKHRoaXMucG9zLCBPcC5FbnRlciwgZW50ZXIsIGV4aXQpO1xuICB9XG5cbiAgZXhpdCgpIHtcbiAgICB0aGlzLm9wY29kZShPcC5FeGl0KTtcbiAgfVxuXG4gIGV2YWx1YXRlKF9ibG9jazogSW5saW5lQmxvY2spIHtcbiAgICBsZXQgYmxvY2sgPSB0aGlzLmNvbnN0YW50cy5ibG9jayhfYmxvY2spO1xuICAgIHRoaXMub3Bjb2RlKE9wLkV2YWx1YXRlLCBibG9jayk7XG4gIH1cblxuICB0ZXN0KHRlc3RGdW5jOiAnY29uc3QnIHwgJ3NpbXBsZScgfCAnZW52aXJvbm1lbnQnIHwgdm0uVGVzdEZ1bmN0aW9uKSB7XG4gICAgbGV0IF9mdW5jOiB2bS5UZXN0RnVuY3Rpb247XG5cbiAgICBpZiAodGVzdEZ1bmMgPT09ICdjb25zdCcpIHtcbiAgICAgIF9mdW5jID0gdm0uQ29uc3RUZXN0O1xuICAgIH0gZWxzZSBpZiAodGVzdEZ1bmMgPT09ICdzaW1wbGUnKSB7XG4gICAgICBfZnVuYyA9IHZtLlNpbXBsZVRlc3Q7XG4gICAgfSBlbHNlIGlmICh0ZXN0RnVuYyA9PT0gJ2Vudmlyb25tZW50Jykge1xuICAgICAgX2Z1bmMgPSB2bS5FbnZpcm9ubWVudFRlc3Q7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgdGVzdEZ1bmMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIF9mdW5jID0gdGVzdEZ1bmM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigndW5yZWFjaGFibGUnKTtcbiAgICB9XG5cbiAgICBsZXQgZnVuYyA9IHRoaXMuY29uc3RhbnRzLmZ1bmN0aW9uKF9mdW5jKTtcbiAgICB0aGlzLm9wY29kZShPcC5UZXN0LCBmdW5jKTtcbiAgfVxuXG4gIGp1bXAodGFyZ2V0OiBzdHJpbmcpIHtcbiAgICB0aGlzLnB1c2gobnVsbCk7XG4gICAgdGhpcy5sYWJlbHMuanVtcCh0aGlzLnBvcywgT3AuSnVtcCwgdGFyZ2V0KTtcbiAgfVxuXG4gIGp1bXBJZih0YXJnZXQ6IHN0cmluZykge1xuICAgIHRoaXMucHVzaChudWxsKTtcbiAgICB0aGlzLmxhYmVscy5qdW1wKHRoaXMucG9zLCBPcC5KdW1wSWYsIHRhcmdldCk7XG4gIH1cblxuICBqdW1wVW5sZXNzKHRhcmdldDogc3RyaW5nKSB7XG4gICAgdGhpcy5wdXNoKG51bGwpO1xuICAgIHRoaXMubGFiZWxzLmp1bXAodGhpcy5wb3MsIE9wLkp1bXBVbmxlc3MsIHRhcmdldCk7XG4gIH1cblxuICBwcm90ZWN0ZWQgbmFtZXMoX25hbWVzOiBzdHJpbmdbXSk6IENvbnN0YW50QXJyYXkge1xuICAgIGxldCBuYW1lcyA9IF9uYW1lcy5tYXAobiA9PiB0aGlzLmNvbnN0YW50cy5zdHJpbmcobikpO1xuICAgIHJldHVybiB0aGlzLmNvbnN0YW50cy5hcnJheShuYW1lcyk7XG4gIH1cblxuICBwcm90ZWN0ZWQgc3ltYm9scyhzeW1ib2xzOiBudW1iZXJbXSk6IENvbnN0YW50QXJyYXkge1xuICAgIHJldHVybiB0aGlzLmNvbnN0YW50cy5hcnJheShzeW1ib2xzKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBvdGhlcih2YWx1ZTogT3BhcXVlKTogQ29uc3RhbnRPdGhlciB7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzLm90aGVyKHZhbHVlKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBhcmdzKGFyZ3M6IFJlcHJlc2VudHM8Q29tcGlsZWRBcmdzPik6IENvbnN0YW50RXhwcmVzc2lvbiB7XG4gICAgcmV0dXJuIHRoaXMuY29uc3RhbnRzLmV4cHJlc3Npb24odGhpcy5jb21waWxlKGFyZ3MpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBibG9jayhibG9jazogSW5saW5lQmxvY2spOiBDb25zdGFudEJsb2NrIHtcbiAgICByZXR1cm4gdGhpcy5jb25zdGFudHMuYmxvY2soYmxvY2spO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzQ29tcGlsYWJsZUV4cHJlc3Npb248RT4oZXhwcjogUmVwcmVzZW50czxFPik6IGV4cHIgaXMgQ29tcGlsZXNJbnRvPEU+IHtcbiAgcmV0dXJuIGV4cHIgJiYgdHlwZW9mIGV4cHJbJ2NvbXBpbGUnXSA9PT0gJ2Z1bmN0aW9uJztcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT3Bjb2RlQnVpbGRlciBleHRlbmRzIEJhc2ljT3Bjb2RlQnVpbGRlciB7XG4gIHB1YmxpYyBjb21wb25lbnQ6IElDb21wb25lbnRCdWlsZGVyO1xuXG4gIGNvbnN0cnVjdG9yKHN5bWJvbFRhYmxlOiBTeW1ib2xUYWJsZSwgZW52OiBFbnZpcm9ubWVudCwgcHJvZ3JhbTogUHJvZ3JhbSA9IGVudi5wcm9ncmFtKSB7XG4gICAgc3VwZXIoc3ltYm9sVGFibGUsIGVudiwgcHJvZ3JhbSk7XG4gICAgdGhpcy5jb21wb25lbnQgPSBuZXcgQ29tcG9uZW50QnVpbGRlcih0aGlzKTtcbiAgfVxuXG4gIGNvbXBpbGU8RT4oZXhwcjogUmVwcmVzZW50czxFPik6IEUge1xuICAgIGlmIChpc0NvbXBpbGFibGVFeHByZXNzaW9uKGV4cHIpKSB7XG4gICAgICByZXR1cm4gZXhwci5jb21waWxlKHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZXhwcjtcbiAgICB9XG4gIH1cblxuICBjb21waWxlRXhwcmVzc2lvbihleHByZXNzaW9uOiBSZXByZXNlbnRzRXhwcmVzc2lvbik6IENvbXBpbGVkRXhwcmVzc2lvbjxPcGFxdWU+IHtcbiAgICBpZiAoZXhwcmVzc2lvbiBpbnN0YW5jZW9mIENvbXBpbGVkRXhwcmVzc2lvbikge1xuICAgICAgcmV0dXJuIGV4cHJlc3Npb247XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBleHByKGV4cHJlc3Npb24sIHRoaXMpO1xuICAgIH1cbiAgfVxuXG4gIGJpbmRQb3NpdGlvbmFsQXJnc0ZvckxvY2Fscyhsb2NhbHM6IERpY3Q8bnVtYmVyPikge1xuICAgIGxldCBzeW1ib2xzID0gT2JqZWN0LmtleXMobG9jYWxzKS5tYXAobmFtZSA9PiBsb2NhbHNbbmFtZV0pO1xuICAgIHRoaXMub3Bjb2RlKE9wLkJpbmRQb3NpdGlvbmFsQXJncywgdGhpcy5zeW1ib2xzKHN5bWJvbHMpKTtcbiAgfVxuXG4gIHByZWx1ZGVGb3JMYXlvdXQobGF5b3V0OiBUZW1wbGF0ZSkge1xuICAgIGxldCBzeW1ib2xzID0gbGF5b3V0LnN5bWJvbFRhYmxlLmdldFN5bWJvbHMoKTtcblxuICAgIGlmIChzeW1ib2xzLm5hbWVkKSB7XG4gICAgICBsZXQgbmFtZWQgPSBzeW1ib2xzLm5hbWVkO1xuICAgICAgbGV0IG5hbWVkTmFtZXMgPSBPYmplY3Qua2V5cyhuYW1lZCk7XG4gICAgICBsZXQgbmFtZWRTeW1ib2xzID0gbmFtZWROYW1lcy5tYXAobiA9PiBuYW1lZFtuXSk7XG4gICAgICB0aGlzLm9wY29kZShPcC5CaW5kTmFtZWRBcmdzLCB0aGlzLm5hbWVzKG5hbWVkTmFtZXMpLCB0aGlzLnN5bWJvbHMobmFtZWRTeW1ib2xzKSk7XG4gICAgfVxuXG4gICAgdGhpcy5vcGNvZGUoT3AuQmluZENhbGxlclNjb3BlKTtcblxuICAgIGlmIChzeW1ib2xzLnlpZWxkcykge1xuICAgICAgbGV0IHlpZWxkcyA9IHN5bWJvbHMueWllbGRzO1xuICAgICAgbGV0IHlpZWxkTmFtZXMgPSBPYmplY3Qua2V5cyh5aWVsZHMpO1xuICAgICAgbGV0IHlpZWxkU3ltYm9scyA9IHlpZWxkTmFtZXMubWFwKG4gPT4geWllbGRzW25dKTtcbiAgICAgIHRoaXMub3Bjb2RlKE9wLkJpbmRCbG9ja3MsIHRoaXMubmFtZXMoeWllbGROYW1lcyksIHRoaXMuc3ltYm9scyh5aWVsZFN5bWJvbHMpKTtcbiAgICB9XG5cbiAgICBpZiAoc3ltYm9scy5wYXJ0aWFsQXJncykge1xuICAgICAgdGhpcy5vcGNvZGUoT3AuQmluZFBhcnRpYWxBcmdzLCBzeW1ib2xzLnBhcnRpYWxBcmdzKTtcbiAgICB9XG4gIH1cblxuICB5aWVsZChhcmdzOiBSZXByZXNlbnRzPENvbXBpbGVkQXJncz4sIHRvOiBzdHJpbmcpIHtcbiAgICBsZXQgeWllbGRzOiBPcHRpb248bnVtYmVyPiwgcGFydGlhbDogT3B0aW9uPG51bWJlcj47XG4gICAgbGV0IGlubmVyOiBDb21waWxlZEdldEJsb2NrO1xuXG4gICAgaWYgKHlpZWxkcyA9IHRoaXMuc3ltYm9sVGFibGUuZ2V0U3ltYm9sKCd5aWVsZHMnLCB0bykpIHtcbiAgICAgIGlubmVyID0gbmV3IENvbXBpbGVkR2V0QmxvY2tCeVN5bWJvbCh5aWVsZHMsIHRvKTtcbiAgICB9IGVsc2UgaWYgKHBhcnRpYWwgPSB0aGlzLnN5bWJvbFRhYmxlLmdldFBhcnRpYWxBcmdzKCkpIHtcbiAgICAgIGlubmVyID0gbmV3IENvbXBpbGVkSW5QYXJ0aWFsR2V0QmxvY2socGFydGlhbCwgdG8pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tCVUddICR7dG99IGlzIG5vdCBhIHZhbGlkIGJsb2NrIG5hbWUuJyk7XG4gICAgfVxuXG4gICAgdGhpcy5vcGVuQmxvY2soYXJncywgaW5uZXIpO1xuICAgIHRoaXMuY2xvc2VCbG9jaygpO1xuICB9XG5cbiAgLy8gVE9ET1xuICAvLyBjb21lIGJhY2sgdG8gdGhpc1xuICBsYWJlbGxlZChhcmdzOiBPcHRpb248UmVwcmVzZW50czxDb21waWxlZEFyZ3M+PiwgY2FsbGJhY2s6IEJsb2NrQ2FsbGJhY2spIHtcbiAgICBpZiAoYXJncykgdGhpcy5wdXRBcmdzKGFyZ3MpO1xuXG4gICAgdGhpcy5zdGFydExhYmVscygpO1xuICAgIHRoaXMuZW50ZXIoJ0JFR0lOJywgJ0VORCcpO1xuICAgIHRoaXMubGFiZWwoJ0JFR0lOJyk7XG5cbiAgICBjYWxsYmFjayh0aGlzLCAnQkVHSU4nLCAnRU5EJyk7XG5cbiAgICB0aGlzLmxhYmVsKCdFTkQnKTtcbiAgICB0aGlzLmV4aXQoKTtcbiAgICB0aGlzLnN0b3BMYWJlbHMoKTtcbiAgfVxuXG4gIC8vIFRPRE9cbiAgLy8gY29tZSBiYWNrIHRvIHRoaXNcbiAgaXRlcihjYWxsYmFjazogQmxvY2tDYWxsYmFjaykge1xuICAgIHRoaXMuc3RhcnRMYWJlbHMoKTtcbiAgICB0aGlzLmVudGVyTGlzdCgnQkVHSU4nLCAnRU5EJyk7XG4gICAgdGhpcy5sYWJlbCgnSVRFUicpO1xuICAgIHRoaXMubmV4dEl0ZXIoJ0JSRUFLJyk7XG4gICAgdGhpcy5lbnRlcldpdGhLZXkoJ0JFR0lOJywgJ0VORCcpO1xuICAgIHRoaXMubGFiZWwoJ0JFR0lOJyk7XG5cbiAgICBjYWxsYmFjayh0aGlzLCAnQkVHSU4nLCAnRU5EJyk7XG5cbiAgICB0aGlzLmxhYmVsKCdFTkQnKTtcbiAgICB0aGlzLmV4aXQoKTtcbiAgICB0aGlzLmp1bXAoJ0lURVInKTtcbiAgICB0aGlzLmxhYmVsKCdCUkVBSycpO1xuICAgIHRoaXMuZXhpdExpc3QoKTtcbiAgICB0aGlzLnN0b3BMYWJlbHMoKTtcbiAgfVxuXG4gIC8vIFRPRE9cbiAgLy8gY29tZSBiYWNrIHRvIHRoaXNcbiAgdW5pdChjYWxsYmFjazogKGJ1aWxkZXI6IE9wY29kZUJ1aWxkZXIpID0+IHZvaWQpIHtcbiAgICB0aGlzLnN0YXJ0TGFiZWxzKCk7XG4gICAgY2FsbGJhY2sodGhpcyk7XG4gICAgdGhpcy5zdG9wTGFiZWxzKCk7XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgQmxvY2tDYWxsYmFjayA9IChkc2w6IE9wY29kZUJ1aWxkZXIsIEJFR0lOOiBMYWJlbCwgRU5EOiBMYWJlbCkgPT4gdm9pZDtcbiJdfQ==