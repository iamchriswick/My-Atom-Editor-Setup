import { LOGGER, initializeGuid, fillNulls } from '@glimmer/util';
import { NULL_REFERENCE, UNDEFINED_REFERENCE } from './references';
export function pretty(json) {
    return `${json.type}(${json.args ? json.args.join(', ') : ''})`;
}
export function defaultToJSON(opcode) {
    return { type: opcode[0] };
}
export var OpcodeName;
(function (OpcodeName) {
    OpcodeName[OpcodeName["PushChildScope"] = 0] = "PushChildScope";
    OpcodeName[OpcodeName["PopScope"] = 1] = "PopScope";
    OpcodeName[OpcodeName["PushDynamicScope"] = 2] = "PushDynamicScope";
    OpcodeName[OpcodeName["PopDynamicScope"] = 3] = "PopDynamicScope";
    OpcodeName[OpcodeName["Put"] = 4] = "Put";
    OpcodeName[OpcodeName["EvaluatePut"] = 5] = "EvaluatePut";
    OpcodeName[OpcodeName["PutArgs"] = 6] = "PutArgs";
    OpcodeName[OpcodeName["BindPositionalArgs"] = 7] = "BindPositionalArgs";
    OpcodeName[OpcodeName["BindNamedArgs"] = 8] = "BindNamedArgs";
    OpcodeName[OpcodeName["BindBlocks"] = 9] = "BindBlocks";
    OpcodeName[OpcodeName["BindPartialArgs"] = 10] = "BindPartialArgs";
    OpcodeName[OpcodeName["BindCallerScope"] = 11] = "BindCallerScope";
    OpcodeName[OpcodeName["BindDynamicScope"] = 12] = "BindDynamicScope";
    OpcodeName[OpcodeName["Enter"] = 13] = "Enter";
    OpcodeName[OpcodeName["Exit"] = 14] = "Exit";
    OpcodeName[OpcodeName["Evaluate"] = 15] = "Evaluate";
    OpcodeName[OpcodeName["Jump"] = 16] = "Jump";
    OpcodeName[OpcodeName["JumpIf"] = 17] = "JumpIf";
    OpcodeName[OpcodeName["JumpUnless"] = 18] = "JumpUnless";
    OpcodeName[OpcodeName["Test"] = 19] = "Test";
    OpcodeName[OpcodeName["OpenBlock"] = 20] = "OpenBlock";
    OpcodeName[OpcodeName["CloseBlock"] = 21] = "CloseBlock";
    OpcodeName[OpcodeName["PutDynamicComponent"] = 22] = "PutDynamicComponent";
    OpcodeName[OpcodeName["PutComponent"] = 23] = "PutComponent";
    OpcodeName[OpcodeName["OpenComponent"] = 24] = "OpenComponent";
    OpcodeName[OpcodeName["DidCreateElement"] = 25] = "DidCreateElement";
    OpcodeName[OpcodeName["ShadowAttributes"] = 26] = "ShadowAttributes";
    OpcodeName[OpcodeName["DidRenderLayout"] = 27] = "DidRenderLayout";
    OpcodeName[OpcodeName["CloseComponent"] = 28] = "CloseComponent";
    OpcodeName[OpcodeName["Text"] = 29] = "Text";
    OpcodeName[OpcodeName["Comment"] = 30] = "Comment";
    OpcodeName[OpcodeName["DynamicContent"] = 31] = "DynamicContent";
    OpcodeName[OpcodeName["OpenElement"] = 32] = "OpenElement";
    OpcodeName[OpcodeName["PushRemoteElement"] = 33] = "PushRemoteElement";
    OpcodeName[OpcodeName["PopRemoteElement"] = 34] = "PopRemoteElement";
    OpcodeName[OpcodeName["OpenComponentElement"] = 35] = "OpenComponentElement";
    OpcodeName[OpcodeName["OpenDynamicElement"] = 36] = "OpenDynamicElement";
    OpcodeName[OpcodeName["FlushElement"] = 37] = "FlushElement";
    OpcodeName[OpcodeName["CloseElement"] = 38] = "CloseElement";
    OpcodeName[OpcodeName["PopElement"] = 39] = "PopElement";
    OpcodeName[OpcodeName["StaticAttr"] = 40] = "StaticAttr";
    OpcodeName[OpcodeName["Modifier"] = 41] = "Modifier";
    OpcodeName[OpcodeName["DynamicAttrNS"] = 42] = "DynamicAttrNS";
    OpcodeName[OpcodeName["DynamicAttr"] = 43] = "DynamicAttr";
    OpcodeName[OpcodeName["PutIterator"] = 44] = "PutIterator";
    OpcodeName[OpcodeName["EnterList"] = 45] = "EnterList";
    OpcodeName[OpcodeName["ExitList"] = 46] = "ExitList";
    OpcodeName[OpcodeName["EnterWithKey"] = 47] = "EnterWithKey";
    OpcodeName[OpcodeName["NextIter"] = 48] = "NextIter";
    OpcodeName[OpcodeName["PutDynamicPartial"] = 49] = "PutDynamicPartial";
    OpcodeName[OpcodeName["PutPartial"] = 50] = "PutPartial";
    OpcodeName[OpcodeName["EvaluatePartial"] = 51] = "EvaluatePartial"; // (Other<SymbolTable>, Other<Dict<PartialBlock>>)
})(OpcodeName || (OpcodeName = {}));
export class Constants {
    constructor() {
        // `0` means NULL
        this.references = [];
        this.strings = [];
        this.expressions = [];
        this.arrays = [];
        this.slices = [];
        this.blocks = [];
        this.functions = [];
        this.others = [];
        this.NULL_REFERENCE = this.reference(NULL_REFERENCE);
        this.UNDEFINED_REFERENCE = this.reference(UNDEFINED_REFERENCE);
    }
    getReference(value) {
        return this.references[value - 1];
    }
    reference(value) {
        let index = this.references.length;
        this.references.push(value);
        return index + 1;
    }
    getString(value) {
        return this.strings[value - 1];
    }
    string(value) {
        let index = this.strings.length;
        this.strings.push(value);
        return index + 1;
    }
    getExpression(value) {
        return this.expressions[value - 1];
    }
    expression(value) {
        let index = this.expressions.length;
        this.expressions.push(value);
        return index + 1;
    }
    getArray(value) {
        return this.arrays[value - 1];
    }
    array(values) {
        let index = this.arrays.length;
        this.arrays.push(values);
        return index + 1;
    }
    getSlice(value) {
        return this.slices[value - 1];
    }
    slice(slice) {
        // TODO: Put the entire program in one big array
        let index = this.slices.length;
        this.slices.push(slice);
        return index + 1;
    }
    getBlock(value) {
        return this.blocks[value - 1];
    }
    block(block) {
        let index = this.blocks.length;
        this.blocks.push(block);
        return index + 1;
    }
    getFunction(value) {
        return this.functions[value - 1];
    }
    function(f) {
        let index = this.functions.length;
        this.functions.push(f);
        return index + 1;
    }
    getOther(value) {
        return this.others[value - 1];
    }
    other(other) {
        let index = this.others.length;
        this.others.push(other);
        return index + 1;
    }
}
export class AppendOpcodes {
    constructor() {
        this.evaluateOpcode = fillNulls(OpcodeName.EvaluatePartial + 1);
    }
    add(name, evaluate) {
        this.evaluateOpcode[name] = evaluate;
    }
    construct(name, _debug, op1, op2, op3) {
        return [name | 0, (op1 || 0) | 0, (op2 || 0) | 0, (op3 || 0) | 0];
    }
    evaluate(vm, opcode) {
        LOGGER.debug(`[VM] OPCODE: ${opcode.type}`);
        let func = this.evaluateOpcode[opcode.type];
        func(vm, opcode);
    }
}
export const APPEND_OPCODES = new AppendOpcodes();
export class AbstractOpcode {
    constructor() {
        initializeGuid(this);
    }
    toJSON() {
        return { guid: this._guid, type: this.type };
    }
}
export class UpdatingOpcode extends AbstractOpcode {
    constructor() {
        super(...arguments);
        this.next = null;
        this.prev = null;
    }
}
export function inspect(opcodes) {
    let buffer = [];
    opcodes.forEach((opcode, i) => {
        _inspect(opcode.toJSON(), buffer, 0, i);
    });
    return buffer.join('');
}
function _inspect(opcode, buffer, level, index) {
    let indentation = [];
    for (let i = 0; i < level; i++) {
        indentation.push('  ');
    }
    buffer.push(...indentation);
    buffer.push(`${index}. ${opcode.type}`);
    if (opcode.args || opcode.details) {
        buffer.push('(');
        if (opcode.args) {
            buffer.push(opcode.args.join(', '));
        }
        if (opcode.details) {
            let keys = Object.keys(opcode.details);
            if (keys.length) {
                if (opcode.args && opcode.args.length) {
                    buffer.push(', ');
                }
                buffer.push(keys.map(key => `${key}=${opcode.details && opcode.details[key]}`).join(', '));
            }
        }
        buffer.push(')');
    }
    buffer.push('\n');
    if (opcode.children && opcode.children.length) {
        for (let i = 0; i < opcode.children.length; i++) {
            _inspect(opcode.children[i], buffer, level + 1, i);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3Bjb2Rlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL3J1bnRpbWUvbGliL29wY29kZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE1BQU0sRUFBNEMsY0FBYyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUk1RyxPQUFPLEVBQUUsY0FBYyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sY0FBYyxDQUFDO0FBZW5FLE1BQU0saUJBQWlCLElBQWdCO0lBQ3JDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQztBQUNsRSxDQUFDO0FBRUQsTUFBTSx3QkFBd0IsTUFBb0I7SUFDaEQsTUFBTSxDQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQzdCLENBQUM7QUFFRCxNQUFNLENBQU4sSUFBa0IsVUFxRGpCO0FBckRELFdBQWtCLFVBQVU7SUFDMUIsK0RBQWMsQ0FBQTtJQUNkLG1EQUFRLENBQUE7SUFDUixtRUFBZ0IsQ0FBQTtJQUNoQixpRUFBZSxDQUFBO0lBQ2YseUNBQUcsQ0FBQTtJQUNILHlEQUFXLENBQUE7SUFDWCxpREFBTyxDQUFBO0lBQ1AsdUVBQWtCLENBQUE7SUFDbEIsNkRBQWEsQ0FBQTtJQUNiLHVEQUFVLENBQUE7SUFDVixrRUFBZSxDQUFBO0lBQ2Ysa0VBQWUsQ0FBQTtJQUNmLG9FQUFnQixDQUFBO0lBQ2hCLDhDQUFLLENBQUE7SUFDTCw0Q0FBSSxDQUFBO0lBQ0osb0RBQVEsQ0FBQTtJQUNSLDRDQUFJLENBQUE7SUFDSixnREFBTSxDQUFBO0lBQ04sd0RBQVUsQ0FBQTtJQUNWLDRDQUFJLENBQUE7SUFDSixzREFBUyxDQUFBO0lBQ1Qsd0RBQVUsQ0FBQTtJQUNWLDBFQUFtQixD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QUksQ0FBQyxDQUFDO0lBRWxCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzlDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUM1QyxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsS0FBSyxHQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNuRCxDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMT0dHRVIsIE9wYXF1ZSwgT3B0aW9uLCBEaWN0LCBTbGljZSBhcyBMaXN0U2xpY2UsIGluaXRpYWxpemVHdWlkLCBmaWxsTnVsbHMgfSBmcm9tICdAZ2xpbW1lci91dGlsJztcbmltcG9ydCB7IFJldmlzaW9uVGFnLCBWZXJzaW9uZWRQYXRoUmVmZXJlbmNlIH0gZnJvbSAnQGdsaW1tZXIvcmVmZXJlbmNlJztcbmltcG9ydCB7IFZNLCBVcGRhdGluZ1ZNIH0gZnJvbSAnLi92bSc7XG5pbXBvcnQgeyBDb21waWxlZEV4cHJlc3Npb24sIENvbXBpbGVkQXJncyB9IGZyb20gJy4vY29tcGlsZWQvZXhwcmVzc2lvbnMnO1xuaW1wb3J0IHsgTlVMTF9SRUZFUkVOQ0UsIFVOREVGSU5FRF9SRUZFUkVOQ0UgfSBmcm9tICcuL3JlZmVyZW5jZXMnO1xuaW1wb3J0IHsgSW5saW5lQmxvY2sgfSBmcm9tICcuL3NjYW5uZXInO1xuaW1wb3J0IHsgT3Bjb2RlIH0gZnJvbSAnLi9lbnZpcm9ubWVudCc7XG5cbmV4cG9ydCB0eXBlIFNsaWNlID0gW251bWJlciwgbnVtYmVyXTtcblxuZXhwb3J0IGludGVyZmFjZSBPcGNvZGVKU09OIHtcbiAgdHlwZTogbnVtYmVyIHwgc3RyaW5nO1xuICBndWlkPzogT3B0aW9uPG51bWJlcj47XG4gIGRlb3B0ZWQ/OiBib29sZWFuO1xuICBhcmdzPzogc3RyaW5nW107XG4gIGRldGFpbHM/OiBEaWN0PE9wdGlvbjxzdHJpbmc+PjtcbiAgY2hpbGRyZW4/OiBPcGNvZGVKU09OW107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcmV0dHkoanNvbjogT3Bjb2RlSlNPTik6IHN0cmluZyB7XG4gIHJldHVybiBgJHtqc29uLnR5cGV9KCR7anNvbi5hcmdzID8ganNvbi5hcmdzLmpvaW4oJywgJykgOiAnJ30pYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlZmF1bHRUb0pTT04ob3Bjb2RlOiBBcHBlbmRPcGNvZGUpOiBPcGNvZGVKU09OIHtcbiAgcmV0dXJuIHsgdHlwZTogb3Bjb2RlWzBdIH07XG59XG5cbmV4cG9ydCBjb25zdCBlbnVtIE9wY29kZU5hbWUge1xuICBQdXNoQ2hpbGRTY29wZSwgICAgICAgICAgICAvLyAoKVxuICBQb3BTY29wZSwgICAgICAgICAgICAgICAgICAvLyAoKVxuICBQdXNoRHluYW1pY1Njb3BlLCAgICAgICAgICAvLyAoKVxuICBQb3BEeW5hbWljU2NvcGUsICAgICAgICAgICAvLyAoKVxuICBQdXQsICAgICAgICAgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRSZWZlcmVuY2UpXG4gIEV2YWx1YXRlUHV0LCAgICAgICAgICAgICAgIC8vIChDb25zdGFudEV4cHJlc3Npb24pXG4gIFB1dEFyZ3MsICAgICAgICAgICAgICAgICAgIC8vIChDb25zdGFudEV4cHJlc3Npb24pXG4gIEJpbmRQb3NpdGlvbmFsQXJncywgICAgICAgIC8vXG4gIEJpbmROYW1lZEFyZ3MsICAgICAgICAgICAgIC8vIChDb25zdGFudEFycmF5PHN0cmluZz4sIENvbnN0YW50QXJyYXk8bnVtYmVyPilcbiAgQmluZEJsb2NrcywgICAgICAgICAgICAgICAgLy8gKENvbnN0YW50QXJyYXk8c3RyaW5nPiwgQ29uc3RhbnRBcnJheTxudW1iZXI+KVxuICBCaW5kUGFydGlhbEFyZ3MsICAgICAgICAgICAvLyAobnVtYmVyKVxuICBCaW5kQ2FsbGVyU2NvcGUsICAgICAgICAgICAvLyAoKVxuICBCaW5kRHluYW1pY1Njb3BlLCAgICAgICAgICAvLyAoQ29uc3RhbnRBcnJheTxzdHJpbmc+KVxuICBFbnRlciwgICAgICAgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRTbGljZSlcbiAgRXhpdCwgICAgICAgICAgICAgICAgICAgICAgLy8gKClcbiAgRXZhbHVhdGUsICAgICAgICAgICAgICAgICAgLy8gKENvbnN0YW50QmxvY2spXG4gIEp1bXAsICAgICAgICAgICAgICAgICAgICAgIC8vIChudW1iZXIpXG4gIEp1bXBJZiwgICAgICAgICAgICAgICAgICAgIC8vIChudW1iZXIpXG4gIEp1bXBVbmxlc3MsICAgICAgICAgICAgICAgIC8vIChudW1iZXIpXG4gIFRlc3QsICAgICAgICAgICAgICAgICAgICAgIC8vIChDb25zdGFudEZ1bmN0aW9uKVxuICBPcGVuQmxvY2ssICAgICAgICAgICAgICAgICAvLyAoT3RoZXI8Q29tcGlsZWRHZXRCbG9jaz4sIENvbnN0YW50RXhwcmVzc2lvbilcbiAgQ2xvc2VCbG9jaywgICAgICAgICAgICAgICAgLy8gKClcbiAgUHV0RHluYW1pY0NvbXBvbmVudCwgICAgICAgLy8gKClcbiAgUHV0Q29tcG9uZW50LCAgICAgICAgICAgICAgLy8gKE90aGVyPENvbXBvbmVudERlZmluaXRpb24+KVxuICBPcGVuQ29tcG9uZW50LCAgICAgICAgICAgICAvLyAoQ29uc3RhbnRFeHByZXNzaW9uLCBDb25zdGFudEJsb2NrKVxuICBEaWRDcmVhdGVFbGVtZW50LCAgICAgICAgICAvL1xuICBTaGFkb3dBdHRyaWJ1dGVzLCAgICAgICAgICAvLyAoKVxuICBEaWRSZW5kZXJMYXlvdXQsICAgICAgICAgICAvLyAoKVxuICBDbG9zZUNvbXBvbmVudCwgICAgICAgICAgICAvLyAoKVxuICBUZXh0LCAgICAgICAgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRTdHJpbmcpXG4gIENvbW1lbnQsICAgICAgICAgICAgICAgICAgIC8vIChDb25zdGFudFN0cmluZylcbiAgRHluYW1pY0NvbnRlbnQsICAgICAgICAgICAgLy8gKE90aGVyPEFwcGVuZER5bmFtaWNPcGNvZGU+KVxuICBPcGVuRWxlbWVudCwgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRTdHJpbmcpXG4gIFB1c2hSZW1vdGVFbGVtZW50LCAgICAgICAgIC8vICgpXG4gIFBvcFJlbW90ZUVsZW1lbnQsICAgICAgICAgIC8vICgpXG4gIE9wZW5Db21wb25lbnRFbGVtZW50LCAgICAgIC8vIChDb25zdGFudFN0cmluZylcbiAgT3BlbkR5bmFtaWNFbGVtZW50LCAgICAgICAgLy8gKClcbiAgRmx1c2hFbGVtZW50LCAgICAgICAgICAgICAgLy8gKClcbiAgQ2xvc2VFbGVtZW50LCAgICAgICAgICAgICAgLy8gKClcbiAgUG9wRWxlbWVudCwgICAgICAgICAgICAgICAgLy8gKClcbiAgU3RhdGljQXR0ciwgICAgICAgICAgICAgICAgLy8gKENvbnN0YW50U3RyaW5nLCBDb25zdGFudFN0cmluZywgQ29uc3RhbnRTdHJpbmcpXG4gIE1vZGlmaWVyLCAgICAgICAgICAgICAgICAgIC8vIChDb25zdGFudFN0cmluZywgQ29uc3RhbnRPdGhlcjxNb2RpZmllck1hbmFnZXI+LCBDb25zdGFudEV4cHJlc3Npb24pXG4gIER5bmFtaWNBdHRyTlMsICAgICAgICAgICAgIC8vIChDb25zdGFudFN0cmluZywgQ29uc3RhbnRTdHJpbmcsIG51bWJlcilcbiAgRHluYW1pY0F0dHIsICAgICAgICAgICAgICAgLy8gKENvbnN0YW50U3RyaW5nLCBudW1iZXIpXG4gIFB1dEl0ZXJhdG9yLCAgICAgICAgICAgICAgIC8vICgpXG4gIEVudGVyTGlzdCwgICAgICAgICAgICAgICAgIC8vIChDb25zdGFudFNsaWNlKVxuICBFeGl0TGlzdCwgICAgICAgICAgICAgICAgICAvLyAoKVxuICBFbnRlcldpdGhLZXksICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRTbGljZSlcbiAgTmV4dEl0ZXIsICAgICAgICAgICAgICAgICAgLy8gKG51bWJlcilcbiAgUHV0RHluYW1pY1BhcnRpYWwsICAgICAgICAgLy8gKE90aGVyPFN5bWJvbFRhYmxlPilcbiAgUHV0UGFydGlhbCwgICAgICAgICAgICAgICAgLy8gKE90aGVyPFBhcnRpYWxEZWZpbml0aW9uPilcbiAgRXZhbHVhdGVQYXJ0aWFsICAgICAgICAgICAgLy8gKE90aGVyPFN5bWJvbFRhYmxlPiwgT3RoZXI8RGljdDxQYXJ0aWFsQmxvY2s+Pilcbn1cblxuLy8gZXhwb3J0IHR5cGUgT3Bjb2RlTmFtZSA9XG4vLyAgICAgXCJQdXNoQ2hpbGRTY29wZVwiICAgICAgICAgICAgLy8gKClcbi8vICAgfCBcIlBvcFNjb3BlXCIgICAgICAgICAgICAgICAgICAvLyAoKVxuLy8gICB8IFwiUHVzaER5bmFtaWNTY29wZVwiICAgICAgICAgIC8vICgpXG4vLyAgIHwgXCJQb3BEeW5hbWljU2NvcGVcIiAgICAgICAgICAgLy8gKClcbi8vICAgfCBcIlB1dFwiICAgICAgICAgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRSZWZlcmVuY2UpXG4vLyAgIHwgXCJFdmFsdWF0ZVB1dFwiICAgICAgICAgICAgICAgLy8gKENvbnN0YW50RXhwcmVzc2lvbilcbi8vICAgfCBcIlB1dEFyZ3NcIiAgICAgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRFeHByZXNzaW9uKVxuLy8gICB8IFwiQmluZFBvc2l0aW9uYWxBcmdzXCIgICAgICAgIC8vXG4vLyAgIHwgXCJCaW5kTmFtZWRBcmdzXCIgICAgICAgICAgICAgLy8gKENvbnN0YW50QXJyYXk8c3RyaW5nPiwgQ29uc3RhbnRBcnJheTxudW1iZXI+KVxuLy8gICB8IFwiQmluZEJsb2Nrc1wiICAgICAgICAgICAgICAgIC8vIChDb25zdGFudEFycmF5PHN0cmluZz4sIENvbnN0YW50QXJyYXk8bnVtYmVyPilcbi8vICAgfCBcIkJpbmRQYXJ0aWFsQXJnc1wiICAgICAgICAgICAvLyAobnVtYmVyKVxuLy8gICB8IFwiQmluZENhbGxlclNjb3BlXCIgICAgICAgICAgIC8vICgpXG4vLyAgIHwgXCJCaW5kRHluYW1pY1Njb3BlXCIgICAgICAgICAgLy8gKENvbnN0YW50QXJyYXk8c3RyaW5nPilcbi8vICAgfCBcIkVudGVyXCIgICAgICAgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRTbGljZSlcbi8vICAgfCBcIkV4aXRcIiAgICAgICAgICAgICAgICAgICAgICAvLyAoKVxuLy8gICB8IFwiRXZhbHVhdGVcIiAgICAgICAgICAgICAgICAgIC8vIChDb25zdGFudEJsb2NrKVxuLy8gICB8IFwiSnVtcFwiICAgICAgICAgICAgICAgICAgICAgIC8vIChudW1iZXIpXG4vLyAgIHwgXCJKdW1wSWZcIiAgICAgICAgICAgICAgICAgICAgLy8gKG51bWJlcilcbi8vICAgfCBcIkp1bXBVbmxlc3NcIiAgICAgICAgICAgICAgICAvLyAobnVtYmVyKVxuLy8gICB8IFwiVGVzdFwiICAgICAgICAgICAgICAgICAgICAgIC8vIChDb25zdGFudEZ1bmN0aW9uKVxuLy8gICB8IFwiT3BlbkJsb2NrXCIgICAgICAgICAgICAgICAgIC8vIChPdGhlcjxDb21waWxlZEdldEJsb2NrPiwgQ29uc3RhbnRFeHByZXNzaW9uKVxuLy8gICB8IFwiQ2xvc2VCbG9ja1wiICAgICAgICAgICAgICAgIC8vICgpXG4vLyAgIHwgXCJQdXREeW5hbWljQ29tcG9uZW50XCIgICAgICAgLy8gKClcbi8vICAgfCBcIlB1dENvbXBvbmVudFwiICAgICAgICAgICAgICAvLyAoT3RoZXI8Q29tcG9uZW50RGVmaW5pdGlvbj4pXG4vLyAgIHwgXCJPcGVuQ29tcG9uZW50XCIgICAgICAgICAgICAgLy8gKENvbnN0YW50RXhwcmVzc2lvbiwgQ29uc3RhbnRCbG9jaylcbi8vICAgfCBcIkRpZENyZWF0ZUVsZW1lbnRcIiAgICAgICAgICAvL1xuLy8gICB8IFwiU2hhZG93QXR0cmlidXRlc1wiICAgICAgICAgIC8vICgpXG4vLyAgIHwgXCJEaWRSZW5kZXJMYXlvdXRcIiAgICAgICAgICAgLy8gKClcbi8vICAgfCBcIkNsb3NlQ29tcG9uZW50XCIgICAgICAgICAgICAvLyAoKVxuLy8gICB8IFwiVGV4dFwiICAgICAgICAgICAgICAgICAgICAgIC8vIChDb25zdGFudFN0cmluZylcbi8vICAgfCBcIkNvbW1lbnRcIiAgICAgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRTdHJpbmcpXG4vLyAgIHwgXCJEeW5hbWljQ29udGVudFwiICAgICAgICAgICAgLy8gKE90aGVyPEFwcGVuZER5bmFtaWNPcGNvZGU+KVxuLy8gICB8IFwiT3BlbkVsZW1lbnRcIiAgICAgICAgICAgICAgIC8vIChDb25zdGFudFN0cmluZylcbi8vICAgfCBcIlB1c2hSZW1vdGVFbGVtZW50XCIgICAgICAgICAvLyAoKVxuLy8gICB8IFwiUG9wUmVtb3RlRWxlbWVudFwiICAgICAgICAgIC8vICgpXG4vLyAgIHwgXCJPcGVuQ29tcG9uZW50RWxlbWVudFwiICAgICAgLy8gKENvbnN0YW50U3RyaW5nKVxuLy8gICB8IFwiT3BlbkR5bmFtaWNFbGVtZW50XCIgICAgICAgIC8vICgpXG4vLyAgIHwgXCJGbHVzaEVsZW1lbnRcIiAgICAgICAgICAgICAgLy8gKClcbi8vICAgfCBcIkNsb3NlRWxlbWVudFwiICAgICAgICAgICAgICAvLyAoKVxuLy8gICB8IFwiUG9wRWxlbWVudFwiICAgICAgICAgICAgICAgIC8vICgpXG4vLyAgIHwgXCJTdGF0aWNBdHRyXCIgICAgICAgICAgICAgICAgLy8gKENvbnN0YW50U3RyaW5nLCBDb25zdGFudFN0cmluZywgQ29uc3RhbnRTdHJpbmcpXG4vLyAgIHwgXCJNb2RpZmllclwiICAgICAgICAgICAgICAgICAgLy8gKENvbnN0YW50U3RyaW5nLCBDb25zdGFudE90aGVyPE1vZGlmaWVyTWFuYWdlcj4sIENvbnN0YW50RXhwcmVzc2lvbilcbi8vICAgfCBcIkR5bmFtaWNBdHRyTlNcIiAgICAgICAgICAgICAvLyAoQ29uc3RhbnRTdHJpbmcsIENvbnN0YW50U3RyaW5nLCBudW1iZXIpXG4vLyAgIHwgXCJEeW5hbWljQXR0clwiICAgICAgICAgICAgICAgLy8gKENvbnN0YW50U3RyaW5nLCBudW1iZXIpXG4vLyAgIHwgXCJQdXRJdGVyYXRvclwiICAgICAgICAgICAgICAgLy8gKClcbi8vICAgfCBcIkVudGVyTGlzdFwiICAgICAgICAgICAgICAgICAvLyAoQ29uc3RhbnRTbGljZSlcbi8vICAgfCBcIkV4aXRMaXN0XCIgICAgICAgICAgICAgICAgICAvLyAoKVxuLy8gICB8IFwiRW50ZXJXaXRoS2V5XCIgICAgICAgICAgICAgIC8vIChDb25zdGFudFNsaWNlKVxuLy8gICB8IFwiTmV4dEl0ZXJcIiAgICAgICAgICAgICAgICAgIC8vIChudW1iZXIpXG4vLyAgIHwgXCJQdXREeW5hbWljUGFydGlhbFwiICAgICAgICAgLy8gKE90aGVyPFN5bWJvbFRhYmxlPilcbi8vICAgfCBcIlB1dFBhcnRpYWxcIiAgICAgICAgICAgICAgICAvLyAoT3RoZXI8UGFydGlhbERlZmluaXRpb24+KVxuLy8gICB8IFwiRXZhbHVhdGVQYXJ0aWFsXCIgICAgICAgICAgIC8vIChPdGhlcjxTeW1ib2xUYWJsZT4sIE90aGVyPERpY3Q8UGFydGlhbEJsb2NrPj4pXG4vLyAgIDtcblxuZXhwb3J0IHR5cGUgQ29uc3RhbnRUeXBlID0gJ3NsaWNlJyB8ICdibG9jaycgfCAncmVmZXJlbmNlJyB8ICdzdHJpbmcnIHwgJ251bWJlcicgfCAnZXhwcmVzc2lvbic7XG5leHBvcnQgdHlwZSBDb25zdGFudFJlZmVyZW5jZSA9ICBudW1iZXI7XG5leHBvcnQgdHlwZSBDb25zdGFudFN0cmluZyA9IG51bWJlcjtcbmV4cG9ydCB0eXBlIENvbnN0YW50RXhwcmVzc2lvbiA9IG51bWJlcjtcbmV4cG9ydCB0eXBlIENvbnN0YW50U2xpY2UgPSBudW1iZXI7XG5leHBvcnQgdHlwZSBDb25zdGFudEJsb2NrID0gbnVtYmVyO1xuZXhwb3J0IHR5cGUgQ29uc3RhbnRGdW5jdGlvbiA9IG51bWJlcjtcbmV4cG9ydCB0eXBlIENvbnN0YW50QXJyYXkgPSBudW1iZXI7XG5leHBvcnQgdHlwZSBDb25zdGFudE90aGVyID0gbnVtYmVyO1xuXG5leHBvcnQgY2xhc3MgQ29uc3RhbnRzIHtcbiAgLy8gYDBgIG1lYW5zIE5VTExcblxuICBwcml2YXRlIHJlZmVyZW5jZXM6IFZlcnNpb25lZFBhdGhSZWZlcmVuY2U8T3BhcXVlPltdID0gW107XG4gIHByaXZhdGUgc3RyaW5nczogc3RyaW5nW10gPSBbXTtcbiAgcHJpdmF0ZSBleHByZXNzaW9uczogT3BhcXVlW10gPSBbXTtcbiAgcHJpdmF0ZSBhcnJheXM6IG51bWJlcltdW10gPSBbXTtcbiAgcHJpdmF0ZSBzbGljZXM6IFNsaWNlW10gPSBbXTtcbiAgcHJpdmF0ZSBibG9ja3M6IElubGluZUJsb2NrW10gPSBbXTtcbiAgcHJpdmF0ZSBmdW5jdGlvbnM6IEZ1bmN0aW9uW10gPSBbXTtcbiAgcHJpdmF0ZSBvdGhlcnM6IE9wYXF1ZVtdID0gW107XG5cbiAgcHVibGljIE5VTExfUkVGRVJFTkNFOiBudW1iZXI7XG4gIHB1YmxpYyBVTkRFRklORURfUkVGRVJFTkNFOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5OVUxMX1JFRkVSRU5DRSA9IHRoaXMucmVmZXJlbmNlKE5VTExfUkVGRVJFTkNFKTtcbiAgICB0aGlzLlVOREVGSU5FRF9SRUZFUkVOQ0UgPSB0aGlzLnJlZmVyZW5jZShVTkRFRklORURfUkVGRVJFTkNFKTtcbiAgfVxuXG4gIGdldFJlZmVyZW5jZTxUIGV4dGVuZHMgT3BhcXVlPih2YWx1ZTogQ29uc3RhbnRSZWZlcmVuY2UpOiBWZXJzaW9uZWRQYXRoUmVmZXJlbmNlPFQ+IHtcbiAgICByZXR1cm4gdGhpcy5yZWZlcmVuY2VzW3ZhbHVlIC0gMV0gYXMgVmVyc2lvbmVkUGF0aFJlZmVyZW5jZTxUPjtcbiAgfVxuXG4gIHJlZmVyZW5jZSh2YWx1ZTogVmVyc2lvbmVkUGF0aFJlZmVyZW5jZTxPcGFxdWU+KTogQ29uc3RhbnRSZWZlcmVuY2Uge1xuICAgIGxldCBpbmRleCA9IHRoaXMucmVmZXJlbmNlcy5sZW5ndGg7XG4gICAgdGhpcy5yZWZlcmVuY2VzLnB1c2godmFsdWUpO1xuICAgIHJldHVybiBpbmRleCArIDE7XG4gIH1cblxuICBnZXRTdHJpbmcodmFsdWU6IENvbnN0YW50U3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5zdHJpbmdzW3ZhbHVlIC0gMV07XG4gIH1cblxuICBzdHJpbmcodmFsdWU6IHN0cmluZyk6IENvbnN0YW50U3RyaW5nIHtcbiAgICBsZXQgaW5kZXggPSB0aGlzLnN0cmluZ3MubGVuZ3RoO1xuICAgIHRoaXMuc3RyaW5ncy5wdXNoKHZhbHVlKTtcbiAgICByZXR1cm4gaW5kZXggKyAxO1xuICB9XG5cbiAgZ2V0RXhwcmVzc2lvbjxUPih2YWx1ZTogQ29uc3RhbnRFeHByZXNzaW9uKTogVCB7XG4gICAgcmV0dXJuIHRoaXMuZXhwcmVzc2lvbnNbdmFsdWUgLSAxXSBhcyBUO1xuICB9XG5cbiAgZXhwcmVzc2lvbih2YWx1ZTogQ29tcGlsZWRFeHByZXNzaW9uPE9wYXF1ZT4gfCBDb21waWxlZEFyZ3MpOiBDb25zdGFudEV4cHJlc3Npb24ge1xuICAgIGxldCBpbmRleCA9IHRoaXMuZXhwcmVzc2lvbnMubGVuZ3RoO1xuICAgIHRoaXMuZXhwcmVzc2lvbnMucHVzaCh2YWx1ZSk7XG4gICAgcmV0dXJuIGluZGV4ICsgMTtcbiAgfVxuXG4gIGdldEFycmF5KHZhbHVlOiBDb25zdGFudEFycmF5KTogbnVtYmVyW10ge1xuICAgIHJldHVybiB0aGlzLmFycmF5c1t2YWx1ZSAtIDFdO1xuICB9XG5cbiAgYXJyYXkodmFsdWVzOiBudW1iZXJbXSk6IENvbnN0YW50QXJyYXkge1xuICAgIGxldCBpbmRleCA9IHRoaXMuYXJyYXlzLmxlbmd0aDtcbiAgICB0aGlzLmFycmF5cy5wdXNoKHZhbHVlcyk7XG4gICAgcmV0dXJuIGluZGV4ICsgMTtcbiAgfVxuXG4gIGdldFNsaWNlKHZhbHVlOiBDb25zdGFudFNsaWNlKTogU2xpY2Uge1xuICAgIHJldHVybiB0aGlzLnNsaWNlc1t2YWx1ZSAtIDFdO1xuICB9XG5cbiAgc2xpY2Uoc2xpY2U6IFNsaWNlKTogQ29uc3RhbnRTbGljZSB7XG4gICAgLy8gVE9ETzogUHV0IHRoZSBlbnRpcmUgcHJvZ3JhbSBpbiBvbmUgYmlnIGFycmF5XG4gICAgbGV0IGluZGV4ID0gdGhpcy5zbGljZXMubGVuZ3RoO1xuICAgIHRoaXMuc2xpY2VzLnB1c2goc2xpY2UpO1xuICAgIHJldHVybiBpbmRleCArIDE7XG4gIH1cblxuICBnZXRCbG9jayh2YWx1ZTogQ29uc3RhbnRCbG9jayk6IElubGluZUJsb2NrIHtcbiAgICByZXR1cm4gdGhpcy5ibG9ja3NbdmFsdWUgLSAxXTtcbiAgfVxuXG4gIGJsb2NrKGJsb2NrOiBJbmxpbmVCbG9jayk6IENvbnN0YW50QmxvY2sge1xuICAgIGxldCBpbmRleCA9IHRoaXMuYmxvY2tzLmxlbmd0aDtcbiAgICB0aGlzLmJsb2Nrcy5wdXNoKGJsb2NrKTtcbiAgICByZXR1cm4gaW5kZXggKyAxO1xuICB9XG5cbiAgZ2V0RnVuY3Rpb248VCBleHRlbmRzIEZ1bmN0aW9uPih2YWx1ZTogQ29uc3RhbnRGdW5jdGlvbik6IFQge1xuICAgIHJldHVybiB0aGlzLmZ1bmN0aW9uc1t2YWx1ZSAtIDFdIGFzIFQ7XG4gIH1cblxuICBmdW5jdGlvbihmOiBGdW5jdGlvbik6IENvbnN0YW50RnVuY3Rpb24ge1xuICAgIGxldCBpbmRleCA9IHRoaXMuZnVuY3Rpb25zLmxlbmd0aDtcbiAgICB0aGlzLmZ1bmN0aW9ucy5wdXNoKGYpO1xuICAgIHJldHVybiBpbmRleCArIDE7XG4gIH1cblxuICBnZXRPdGhlcjxUPih2YWx1ZTogQ29uc3RhbnRPdGhlcik6IFQge1xuICAgIHJldHVybiB0aGlzLm90aGVyc1t2YWx1ZSAtIDFdIGFzIFQ7XG4gIH1cblxuICBvdGhlcihvdGhlcjogT3BhcXVlKTogQ29uc3RhbnRPdGhlciB7XG4gICAgbGV0IGluZGV4ID0gdGhpcy5vdGhlcnMubGVuZ3RoO1xuICAgIHRoaXMub3RoZXJzLnB1c2gob3RoZXIpO1xuICAgIHJldHVybiBpbmRleCArIDE7XG4gIH1cbn1cblxuZXhwb3J0IHR5cGUgT3BlcmFuZDEgPSBudW1iZXI7XG5leHBvcnQgdHlwZSBPcGVyYW5kMiA9IG51bWJlcjtcbmV4cG9ydCB0eXBlIE9wZXJhbmQzID0gbnVtYmVyO1xuXG5leHBvcnQgdHlwZSBPcGNvZGVUb0pTT04gPSAoZGF0YTogQXBwZW5kT3Bjb2RlLCBjb25zdGFudHM6IENvbnN0YW50cykgPT4gT3Bjb2RlSlNPTjtcbmV4cG9ydCB0eXBlIEV2YWx1YXRlT3Bjb2RlID0gKHZtOiBWTSwgb3Bjb2RlOiBPcGNvZGUpID0+IHZvaWQ7XG5cbmV4cG9ydCBjbGFzcyBBcHBlbmRPcGNvZGVzIHtcbiAgcHJpdmF0ZSBldmFsdWF0ZU9wY29kZTogRXZhbHVhdGVPcGNvZGVbXSA9IGZpbGxOdWxsczxFdmFsdWF0ZU9wY29kZT4oT3Bjb2RlTmFtZS5FdmFsdWF0ZVBhcnRpYWwgKyAxKTtcblxuICBhZGQ8TmFtZSBleHRlbmRzIE9wY29kZU5hbWU+KG5hbWU6IE5hbWUsIGV2YWx1YXRlOiBFdmFsdWF0ZU9wY29kZSk6IHZvaWQge1xuICAgIHRoaXMuZXZhbHVhdGVPcGNvZGVbbmFtZSBhcyBudW1iZXJdID0gZXZhbHVhdGU7XG4gIH1cblxuICBjb25zdHJ1Y3Q8TmFtZSBleHRlbmRzIE9wY29kZU5hbWU+KG5hbWU6IE5hbWUsIF9kZWJ1ZzogT3B0aW9uPE9iamVjdD4sIG9wMT86IE9wZXJhbmQxLCBvcDI/OiBPcGVyYW5kMiwgb3AzPzogT3BlcmFuZDMpOiBBcHBlbmRPcGNvZGUge1xuICAgIHJldHVybiBbKG5hbWUgYXMgbnVtYmVyKXwwLCAob3AxIHx8IDApfDAsIChvcDIgfHwgMCl8MCwgKG9wMyB8fCAwKXwwXTtcbiAgfVxuXG4gIGV2YWx1YXRlKHZtOiBWTSwgb3Bjb2RlOiBPcGNvZGUpIHtcbiAgICBMT0dHRVIuZGVidWcoYFtWTV0gT1BDT0RFOiAke29wY29kZS50eXBlfWApO1xuICAgIGxldCBmdW5jID0gdGhpcy5ldmFsdWF0ZU9wY29kZVtvcGNvZGUudHlwZV07XG4gICAgZnVuYyh2bSwgb3Bjb2RlKTtcbiAgfVxufVxuXG5leHBvcnQgdHlwZSBBcHBlbmRPcGNvZGUgPSBbbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyXTtcblxuZXhwb3J0IGNvbnN0IEFQUEVORF9PUENPREVTID0gbmV3IEFwcGVuZE9wY29kZXMoKTtcblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFic3RyYWN0T3Bjb2RlIHtcbiAgcHVibGljIHR5cGU6IHN0cmluZztcbiAgcHVibGljIF9ndWlkOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgaW5pdGlhbGl6ZUd1aWQodGhpcyk7XG4gIH1cblxuICB0b0pTT04oKTogT3Bjb2RlSlNPTiB7XG4gICAgcmV0dXJuIHsgZ3VpZDogdGhpcy5fZ3VpZCwgdHlwZTogdGhpcy50eXBlIH07XG4gIH1cbn1cblxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFVwZGF0aW5nT3Bjb2RlIGV4dGVuZHMgQWJzdHJhY3RPcGNvZGUge1xuICBwdWJsaWMgdGFnOiBSZXZpc2lvblRhZztcblxuICBuZXh0OiBPcHRpb248VXBkYXRpbmdPcGNvZGU+ID0gbnVsbDtcbiAgcHJldjogT3B0aW9uPFVwZGF0aW5nT3Bjb2RlPiA9IG51bGw7XG5cbiAgYWJzdHJhY3QgZXZhbHVhdGUodm06IFVwZGF0aW5nVk0pOiB2b2lkO1xufVxuXG5leHBvcnQgdHlwZSBVcGRhdGluZ09wU2VxID0gTGlzdFNsaWNlPFVwZGF0aW5nT3Bjb2RlPjtcblxuZXhwb3J0IGZ1bmN0aW9uIGluc3BlY3Qob3Bjb2RlczogUmVhZG9ubHlBcnJheTxBYnN0cmFjdE9wY29kZT4pOiBzdHJpbmcge1xuICBsZXQgYnVmZmVyOiBzdHJpbmdbXSA9IFtdO1xuXG4gIG9wY29kZXMuZm9yRWFjaCgob3Bjb2RlLCBpKSA9PiB7XG4gICAgX2luc3BlY3Qob3Bjb2RlLnRvSlNPTigpLCBidWZmZXIsIDAsIGkpO1xuICB9KTtcblxuICByZXR1cm4gYnVmZmVyLmpvaW4oJycpO1xufVxuXG5mdW5jdGlvbiBfaW5zcGVjdChvcGNvZGU6IE9wY29kZUpTT04sIGJ1ZmZlcjogc3RyaW5nW10sIGxldmVsOiBudW1iZXIsIGluZGV4OiBudW1iZXIpIHtcbiAgbGV0IGluZGVudGF0aW9uOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGZvciAobGV0IGk9MDsgaTxsZXZlbDsgaSsrKSB7XG4gICAgaW5kZW50YXRpb24ucHVzaCgnICAnKTtcbiAgfVxuXG4gIGJ1ZmZlci5wdXNoKC4uLmluZGVudGF0aW9uKTtcbiAgYnVmZmVyLnB1c2goYCR7aW5kZXh9LiAke29wY29kZS50eXBlfWApO1xuXG4gIGlmIChvcGNvZGUuYXJncyB8fCBvcGNvZGUuZGV0YWlscykge1xuICAgIGJ1ZmZlci5wdXNoKCcoJyk7XG5cbiAgICBpZiAob3Bjb2RlLmFyZ3MpIHtcbiAgICAgIGJ1ZmZlci5wdXNoKG9wY29kZS5hcmdzLmpvaW4oJywgJykpO1xuICAgIH1cblxuICAgIGlmIChvcGNvZGUuZGV0YWlscykge1xuICAgICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhvcGNvZGUuZGV0YWlscyk7XG5cbiAgICAgIGlmIChrZXlzLmxlbmd0aCkge1xuICAgICAgICBpZiAob3Bjb2RlLmFyZ3MgJiYgb3Bjb2RlLmFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgYnVmZmVyLnB1c2goJywgJyk7XG4gICAgICAgIH1cblxuICAgICAgICBidWZmZXIucHVzaChrZXlzLm1hcChrZXkgPT4gYCR7a2V5fT0ke29wY29kZS5kZXRhaWxzICYmIG9wY29kZS5kZXRhaWxzW2tleV19YCkuam9pbignLCAnKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgYnVmZmVyLnB1c2goJyknKTtcbiAgfVxuXG4gIGJ1ZmZlci5wdXNoKCdcXG4nKTtcblxuICBpZiAob3Bjb2RlLmNoaWxkcmVuICYmIG9wY29kZS5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICBmb3IgKGxldCBpPTA7IGk8b3Bjb2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICBfaW5zcGVjdChvcGNvZGUuY2hpbGRyZW5baV0sIGJ1ZmZlciwgbGV2ZWwrMSwgaSk7XG4gICAgfVxuICB9XG59XG4iXX0=