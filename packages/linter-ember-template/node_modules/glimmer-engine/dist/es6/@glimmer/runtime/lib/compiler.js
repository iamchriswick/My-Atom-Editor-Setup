import { CompiledProgram } from './compiled/blocks';
import { compileStatement } from './scanner';
import { compileArgs, compileBaselineArgs } from './syntax/functions';
import OpcodeBuilderDSL from './compiled/opcodes/builder';
export function compileLayout(compilable, env) {
    let builder = new ComponentLayoutBuilder(env);
    compilable.compile(builder);
    return builder.compile();
}
class ComponentLayoutBuilder {
    constructor(env) {
        this.env = env;
    }
    wrapLayout(layout) {
        this.inner = new WrappedBuilder(this.env, layout);
    }
    fromLayout(layout) {
        this.inner = new UnwrappedBuilder(this.env, layout);
    }
    compile() {
        return this.inner.compile();
    }
    get tag() {
        return this.inner.tag;
    }
    get attrs() {
        return this.inner.attrs;
    }
}
class WrappedBuilder {
    constructor(env, layout) {
        this.env = env;
        this.layout = layout;
        this.tag = new ComponentTagBuilder();
        this.attrs = new ComponentAttrsBuilder();
    }
    compile() {
        //========DYNAMIC
        //        PutValue(TagExpr)
        //        Test
        //        JumpUnless(BODY)
        //        OpenDynamicPrimitiveElement
        //        DidCreateElement
        //        ...attr statements...
        //        FlushElement
        // BODY:  Noop
        //        ...body statements...
        //        PutValue(TagExpr)
        //        Test
        //        JumpUnless(END)
        //        CloseElement
        // END:   Noop
        //        DidRenderLayout
        //        Exit
        //
        //========STATIC
        //        OpenPrimitiveElementOpcode
        //        DidCreateElement
        //        ...attr statements...
        //        FlushElement
        //        ...body statements...
        //        CloseElement
        //        DidRenderLayout
        //        Exit
        let { env, layout } = this;
        let symbolTable = layout.symbolTable;
        let b = builder(env, layout.symbolTable);
        b.startLabels();
        let dynamicTag = this.tag.getDynamic();
        let staticTag;
        if (dynamicTag) {
            b.putValue(dynamicTag);
            b.test('simple');
            b.jumpUnless('BODY');
            b.openDynamicPrimitiveElement();
            b.didCreateElement();
            this.attrs['buffer'].forEach(statement => compileStatement(statement, b));
            b.flushElement();
            b.label('BODY');
        }
        else if (staticTag = this.tag.getStatic()) {
            b.openPrimitiveElement(staticTag);
            b.didCreateElement();
            this.attrs['buffer'].forEach(statement => compileStatement(statement, b));
            b.flushElement();
        }
        b.preludeForLayout(layout);
        layout.statements.forEach(statement => compileStatement(statement, b));
        if (dynamicTag) {
            b.putValue(dynamicTag);
            b.test('simple');
            b.jumpUnless('END');
            b.closeElement();
            b.label('END');
        }
        else if (staticTag) {
            b.closeElement();
        }
        b.didRenderLayout();
        b.stopLabels();
        return new CompiledProgram(b.toSlice(), symbolTable.size);
    }
}
function isOpenElement(value) {
    let type = value[0];
    return type === 'open-element' || type === 'open-primitive-element';
}
class UnwrappedBuilder {
    constructor(env, layout) {
        this.env = env;
        this.layout = layout;
        this.attrs = new ComponentAttrsBuilder();
    }
    get tag() {
        throw new Error('BUG: Cannot call `tag` on an UnwrappedBuilder');
    }
    compile() {
        let { env, layout } = this;
        let b = builder(env, layout.symbolTable);
        b.startLabels();
        b.preludeForLayout(layout);
        let attrs = this.attrs['buffer'];
        let attrsInserted = false;
        for (let i = 0; i < layout.statements.length; i++) {
            let statement = layout.statements[i];
            if (!attrsInserted && isOpenElement(statement)) {
                b.openComponentElement(statement[1]);
                b.didCreateElement();
                b.shadowAttributes();
                attrs.forEach(statement => compileStatement(statement, b));
                attrsInserted = true;
            }
            else {
                compileStatement(statement, b);
            }
        }
        b.didRenderLayout();
        b.stopLabels();
        return new CompiledProgram(b.toSlice(), layout.symbolTable.size);
    }
}
class ComponentTagBuilder {
    constructor() {
        this.isDynamic = null;
        this.isStatic = null;
        this.staticTagName = null;
        this.dynamicTagName = null;
    }
    getDynamic() {
        if (this.isDynamic) {
            return this.dynamicTagName;
        }
    }
    getStatic() {
        if (this.isStatic) {
            return this.staticTagName;
        }
    }
    static(tagName) {
        this.isStatic = true;
        this.staticTagName = tagName;
    }
    dynamic(tagName) {
        this.isDynamic = true;
        this.dynamicTagName = ['function', tagName];
    }
}
class ComponentAttrsBuilder {
    constructor() {
        this.buffer = [];
    }
    static(name, value) {
        this.buffer.push(['static-attr', name, value, null]);
    }
    dynamic(name, value) {
        this.buffer.push(['dynamic-attr', name, ['function', value], null]);
    }
}
export class ComponentBuilder {
    constructor(builder) {
        this.builder = builder;
        this.env = builder.env;
    }
    static(definition, args, _symbolTable, shadow) {
        this.builder.unit(b => {
            b.putComponentDefinition(definition);
            b.openComponent(compileBaselineArgs(args, b), shadow);
            b.closeComponent();
        });
    }
    dynamic(definitionArgs, definition, args, _symbolTable, shadow) {
        this.builder.unit(b => {
            b.putArgs(compileArgs(definitionArgs[0], definitionArgs[1], b));
            b.putValue(['function', definition]);
            b.test('simple');
            b.enter('BEGIN', 'END');
            b.label('BEGIN');
            b.jumpUnless('END');
            b.putDynamicComponentDefinition();
            b.openComponent(compileBaselineArgs(args, b), shadow);
            b.closeComponent();
            b.label('END');
            b.exit();
        });
    }
}
export function builder(env, symbolTable) {
    return new OpcodeBuilderDSL(symbolTable, env);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGlsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJAZ2xpbW1lci9ydW50aW1lL2xpYi9jb21waWxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFHcEQsT0FBTyxFQUlMLGdCQUFnQixFQUNqQixNQUFNLFdBQVcsQ0FBQztBQVFuQixPQUFPLEVBQ0wsV0FBVyxFQUNYLG1CQUFtQixFQUNwQixNQUFNLG9CQUFvQixDQUFDO0FBTTVCLE9BQU8sZ0JBQWdCLE1BQU0sNEJBQTRCLENBQUM7QUFVMUQsTUFBTSx3QkFBd0IsVUFBNEIsRUFBRSxHQUFnQjtJQUMxRSxJQUFJLE9BQU8sR0FBRyxJQUFJLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRTlDLFVBQVUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFNUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUMzQixDQUFDO0FBRUQ7SUFHRSxZQUFtQixHQUFnQjtRQUFoQixRQUFHLEdBQUgsR0FBRyxDQUFhO0lBQUcsQ0FBQztJQUV2QyxVQUFVLENBQUMsTUFBYztRQUN2QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUVELFVBQVUsQ0FBQyxNQUFjO1FBQ3ZCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFFRCxPQUFPO1FBQ0wsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDOUIsQ0FBQztJQUVELElBQUksR0FBRztRQUNMLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQztJQUN4QixDQUFDO0lBRUQs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Q0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3RELENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUNuQixDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2YsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ1gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFFRCxNQUFNLGtCQUF5QyxHQUFnQixFQUFFLFdBQWM7SUFDN0UsTUFBTSxDQUFDLElBQUksZ0JBQWdCLENBQUMsV0FBVyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQ2hELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFbnZpcm9ubWVudCB9IGZyb20gJy4vZW52aXJvbm1lbnQnO1xuaW1wb3J0IHsgU3ltYm9sVGFibGUgfSBmcm9tICdAZ2xpbW1lci9pbnRlcmZhY2VzJztcbmltcG9ydCB7IENvbXBpbGVkUHJvZ3JhbSB9IGZyb20gJy4vY29tcGlsZWQvYmxvY2tzJztcbmltcG9ydCB7IE1heWJlLCBPcHRpb24gfSBmcm9tICdAZ2xpbW1lci91dGlsJztcblxuaW1wb3J0IHtcbiAgQmFzZWxpbmVTeW50YXgsXG4gIExheW91dCxcbiAgSW5saW5lQmxvY2ssXG4gIGNvbXBpbGVTdGF0ZW1lbnRcbn0gZnJvbSAnLi9zY2FubmVyJztcblxuaW1wb3J0IHtcbiAgQ29tcG9uZW50QnVpbGRlciBhcyBJQ29tcG9uZW50QnVpbGRlcixcbiAgRHluYW1pY0RlZmluaXRpb24sXG4gIFN0YXRpY0RlZmluaXRpb25cbn0gZnJvbSAnLi9vcGNvZGUtYnVpbGRlcic7XG5cbmltcG9ydCB7XG4gIGNvbXBpbGVBcmdzLFxuICBjb21waWxlQmFzZWxpbmVBcmdzXG59IGZyb20gJy4vc3ludGF4L2Z1bmN0aW9ucyc7XG5cbmltcG9ydCB7XG4gIEZ1bmN0aW9uRXhwcmVzc2lvblxufSBmcm9tICcuL2NvbXBpbGVkL2V4cHJlc3Npb25zL2Z1bmN0aW9uJztcblxuaW1wb3J0IE9wY29kZUJ1aWxkZXJEU0wgZnJvbSAnLi9jb21waWxlZC9vcGNvZGVzL2J1aWxkZXInO1xuXG5pbXBvcnQgKiBhcyBDb21wb25lbnQgZnJvbSAnLi9jb21wb25lbnQvaW50ZXJmYWNlcyc7XG5cbmltcG9ydCAqIGFzIFdpcmVGb3JtYXQgZnJvbSAnQGdsaW1tZXIvd2lyZS1mb3JtYXQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbXBpbGFibGVMYXlvdXQge1xuICBjb21waWxlKGJ1aWxkZXI6IENvbXBvbmVudC5Db21wb25lbnRMYXlvdXRCdWlsZGVyKTogdm9pZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBpbGVMYXlvdXQoY29tcGlsYWJsZTogQ29tcGlsYWJsZUxheW91dCwgZW52OiBFbnZpcm9ubWVudCk6IENvbXBpbGVkUHJvZ3JhbSB7XG4gIGxldCBidWlsZGVyID0gbmV3IENvbXBvbmVudExheW91dEJ1aWxkZXIoZW52KTtcblxuICBjb21waWxhYmxlLmNvbXBpbGUoYnVpbGRlcik7XG5cbiAgcmV0dXJuIGJ1aWxkZXIuY29tcGlsZSgpO1xufVxuXG5jbGFzcyBDb21wb25lbnRMYXlvdXRCdWlsZGVyIGltcGxlbWVudHMgQ29tcG9uZW50LkNvbXBvbmVudExheW91dEJ1aWxkZXIge1xuICBwcml2YXRlIGlubmVyOiBXcmFwcGVkQnVpbGRlciB8IFVud3JhcHBlZEJ1aWxkZXI7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGVudjogRW52aXJvbm1lbnQpIHt9XG5cbiAgd3JhcExheW91dChsYXlvdXQ6IExheW91dCkge1xuICAgIHRoaXMuaW5uZXIgPSBuZXcgV3JhcHBlZEJ1aWxkZXIodGhpcy5lbnYsIGxheW91dCk7XG4gIH1cblxuICBmcm9tTGF5b3V0KGxheW91dDogTGF5b3V0KSB7XG4gICAgdGhpcy5pbm5lciA9IG5ldyBVbndyYXBwZWRCdWlsZGVyKHRoaXMuZW52LCBsYXlvdXQpO1xuICB9XG5cbiAgY29tcGlsZSgpOiBDb21waWxlZFByb2dyYW0ge1xuICAgIHJldHVybiB0aGlzLmlubmVyLmNvbXBpbGUoKTtcbiAgfVxuXG4gIGdldCB0YWcoKTogQ29tcG9uZW50LkNvbXBvbmVudFRhZ0J1aWxkZXIge1xuICAgIHJldHVybiB0aGlzLmlubmVyLnRhZztcbiAgfVxuXG4gIGdldCBhdHRycygpOiBDb21wb25lbnQuQ29tcG9uZW50QXR0cnNCdWlsZGVyIHtcbiAgICByZXR1cm4gdGhpcy5pbm5lci5hdHRycztcbiAgfVxufVxuXG5jbGFzcyBXcmFwcGVkQnVpbGRlciB7XG4gIHB1YmxpYyB0YWcgPSBuZXcgQ29tcG9uZW50VGFnQnVpbGRlcigpO1xuICBwdWJsaWMgYXR0cnMgPSBuZXcgQ29tcG9uZW50QXR0cnNCdWlsZGVyKCk7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGVudjogRW52aXJvbm1lbnQsIHByaXZhdGUgbGF5b3V0OiBMYXlvdXQpIHt9XG5cbiAgY29tcGlsZSgpOiBDb21waWxlZFByb2dyYW0ge1xuICAgIC8vPT09PT09PT1EWU5BTUlDXG4gICAgLy8gICAgICAgIFB1dFZhbHVlKFRhZ0V4cHIpXG4gICAgLy8gICAgICAgIFRlc3RcbiAgICAvLyAgICAgICAgSnVtcFVubGVzcyhCT0RZKVxuICAgIC8vICAgICAgICBPcGVuRHluYW1pY1ByaW1pdGl2ZUVsZW1lbnRcbiAgICAvLyAgICAgICAgRGlkQ3JlYXRlRWxlbWVudFxuICAgIC8vICAgICAgICAuLi5hdHRyIHN0YXRlbWVudHMuLi5cbiAgICAvLyAgICAgICAgRmx1c2hFbGVtZW50XG4gICAgLy8gQk9EWTogIE5vb3BcbiAgICAvLyAgICAgICAgLi4uYm9keSBzdGF0ZW1lbnRzLi4uXG4gICAgLy8gICAgICAgIFB1dFZhbHVlKFRhZ0V4cHIpXG4gICAgLy8gICAgICAgIFRlc3RcbiAgICAvLyAgICAgICAgSnVtcFVubGVzcyhFTkQpXG4gICAgLy8gICAgICAgIENsb3NlRWxlbWVudFxuICAgIC8vIEVORDogICBOb29wXG4gICAgLy8gICAgICAgIERpZFJlbmRlckxheW91dFxuICAgIC8vICAgICAgICBFeGl0XG4gICAgLy9cbiAgICAvLz09PT09PT09U1RBVElDXG4gICAgLy8gICAgICAgIE9wZW5QcmltaXRpdmVFbGVtZW50T3Bjb2RlXG4gICAgLy8gICAgICAgIERpZENyZWF0ZUVsZW1lbnRcbiAgICAvLyAgICAgICAgLi4uYXR0ciBzdGF0ZW1lbnRzLi4uXG4gICAgLy8gICAgICAgIEZsdXNoRWxlbWVudFxuICAgIC8vICAgICAgICAuLi5ib2R5IHN0YXRlbWVudHMuLi5cbiAgICAvLyAgICAgICAgQ2xvc2VFbGVtZW50XG4gICAgLy8gICAgICAgIERpZFJlbmRlckxheW91dFxuICAgIC8vICAgICAgICBFeGl0XG5cbiAgICBsZXQgeyBlbnYsIGxheW91dCB9ID0gdGhpcztcblxuICAgIGxldCBzeW1ib2xUYWJsZSA9IGxheW91dC5zeW1ib2xUYWJsZTtcbiAgICBsZXQgYiA9IGJ1aWxkZXIoZW52LCBsYXlvdXQuc3ltYm9sVGFibGUpO1xuXG4gICAgYi5zdGFydExhYmVscygpO1xuXG4gICAgbGV0IGR5bmFtaWNUYWcgPSB0aGlzLnRhZy5nZXREeW5hbWljKCk7XG4gICAgbGV0IHN0YXRpY1RhZzogTWF5YmU8c3RyaW5nPjtcblxuICAgIGlmIChkeW5hbWljVGFnKSB7XG4gICAgICBiLnB1dFZhbHVlKGR5bmFtaWNUYWcpO1xuICAgICAgYi50ZXN0KCdzaW1wbGUnKTtcbiAgICAgIGIuanVtcFVubGVzcygnQk9EWScpO1xuICAgICAgYi5vcGVuRHluYW1pY1ByaW1pdGl2ZUVsZW1lbnQoKTtcbiAgICAgIGIuZGlkQ3JlYXRlRWxlbWVudCgpO1xuICAgICAgdGhpcy5hdHRyc1snYnVmZmVyJ10uZm9yRWFjaChzdGF0ZW1lbnQgPT4gY29tcGlsZVN0YXRlbWVudChzdGF0ZW1lbnQsIGIpKTtcbiAgICAgIGIuZmx1c2hFbGVtZW50KCk7XG4gICAgICBiLmxhYmVsKCdCT0RZJyk7XG4gICAgfSBlbHNlIGlmIChzdGF0aWNUYWcgPSB0aGlzLnRhZy5nZXRTdGF0aWMoKSkge1xuICAgICAgYi5vcGVuUHJpbWl0aXZlRWxlbWVudChzdGF0aWNUYWcpO1xuICAgICAgYi5kaWRDcmVhdGVFbGVtZW50KCk7XG4gICAgICB0aGlzLmF0dHJzWydidWZmZXInXS5mb3JFYWNoKHN0YXRlbWVudCA9PiBjb21waWxlU3RhdGVtZW50KHN0YXRlbWVudCwgYikpO1xuICAgICAgYi5mbHVzaEVsZW1lbnQoKTtcbiAgICB9XG5cbiAgICBiLnByZWx1ZGVGb3JMYXlvdXQobGF5b3V0KTtcblxuICAgIGxheW91dC5zdGF0ZW1lbnRzLmZvckVhY2goc3RhdGVtZW50ID0+IGNvbXBpbGVTdGF0ZW1lbnQoc3RhdGVtZW50LCBiKSk7XG5cbiAgICBpZiAoZHluYW1pY1RhZykge1xuICAgICAgYi5wdXRWYWx1ZShkeW5hbWljVGFnKTtcbiAgICAgIGIudGVzdCgnc2ltcGxlJyk7XG4gICAgICBiLmp1bXBVbmxlc3MoJ0VORCcpO1xuICAgICAgYi5jbG9zZUVsZW1lbnQoKTtcbiAgICAgIGIubGFiZWwoJ0VORCcpO1xuICAgIH0gZWxzZSBpZiAoc3RhdGljVGFnKSB7XG4gICAgICBiLmNsb3NlRWxlbWVudCgpO1xuICAgIH1cblxuICAgIGIuZGlkUmVuZGVyTGF5b3V0KCk7XG4gICAgYi5zdG9wTGFiZWxzKCk7XG5cbiAgICByZXR1cm4gbmV3IENvbXBpbGVkUHJvZ3JhbShiLnRvU2xpY2UoKSwgc3ltYm9sVGFibGUuc2l6ZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNPcGVuRWxlbWVudCh2YWx1ZTogQmFzZWxpbmVTeW50YXguQW55U3RhdGVtZW50KTogdmFsdWUgaXMgKEJhc2VsaW5lU3ludGF4Lk9wZW5QcmltaXRpdmVFbGVtZW50IHwgV2lyZUZvcm1hdC5TdGF0ZW1lbnRzLk9wZW5FbGVtZW50KSB7XG4gIGxldCB0eXBlID0gdmFsdWVbMF07XG4gIHJldHVybiB0eXBlID09PSAnb3Blbi1lbGVtZW50JyB8fCB0eXBlID09PSAnb3Blbi1wcmltaXRpdmUtZWxlbWVudCc7XG59XG5cbmNsYXNzIFVud3JhcHBlZEJ1aWxkZXIge1xuICBwdWJsaWMgYXR0cnMgPSBuZXcgQ29tcG9uZW50QXR0cnNCdWlsZGVyKCk7XG5cbiAgY29uc3RydWN0b3IocHVibGljIGVudjogRW52aXJvbm1lbnQsIHByaXZhdGUgbGF5b3V0OiBMYXlvdXQpIHt9XG5cbiAgZ2V0IHRhZygpOiBDb21wb25lbnQuQ29tcG9uZW50VGFnQnVpbGRlciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCVUc6IENhbm5vdCBjYWxsIGB0YWdgIG9uIGFuIFVud3JhcHBlZEJ1aWxkZXInKTtcbiAgfVxuXG4gIGNvbXBpbGUoKTogQ29tcGlsZWRQcm9ncmFtIHtcbiAgICBsZXQgeyBlbnYsIGxheW91dCB9ID0gdGhpcztcblxuICAgIGxldCBiID0gYnVpbGRlcihlbnYsIGxheW91dC5zeW1ib2xUYWJsZSk7XG5cbiAgICBiLnN0YXJ0TGFiZWxzKCk7XG5cbiAgICBiLnByZWx1ZGVGb3JMYXlvdXQobGF5b3V0KTtcblxuICAgIGxldCBhdHRycyA9IHRoaXMuYXR0cnNbJ2J1ZmZlciddO1xuICAgIGxldCBhdHRyc0luc2VydGVkID0gZmFsc2U7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxheW91dC5zdGF0ZW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgc3RhdGVtZW50ID0gbGF5b3V0LnN0YXRlbWVudHNbaV07XG4gICAgICBpZiAoIWF0dHJzSW5zZXJ0ZWQgJiYgaXNPcGVuRWxlbWVudChzdGF0ZW1lbnQpKSB7XG4gICAgICAgIGIub3BlbkNvbXBvbmVudEVsZW1lbnQoc3RhdGVtZW50WzFdKTtcbiAgICAgICAgYi5kaWRDcmVhdGVFbGVtZW50KCk7XG4gICAgICAgIGIuc2hhZG93QXR0cmlidXRlcygpO1xuICAgICAgICBhdHRycy5mb3JFYWNoKHN0YXRlbWVudCA9PiBjb21waWxlU3RhdGVtZW50KHN0YXRlbWVudCwgYikpO1xuICAgICAgICBhdHRyc0luc2VydGVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbXBpbGVTdGF0ZW1lbnQoc3RhdGVtZW50LCBiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBiLmRpZFJlbmRlckxheW91dCgpO1xuICAgIGIuc3RvcExhYmVscygpO1xuXG4gICAgcmV0dXJuIG5ldyBDb21waWxlZFByb2dyYW0oYi50b1NsaWNlKCksIGxheW91dC5zeW1ib2xUYWJsZS5zaXplKTtcbiAgfVxufVxuXG5jbGFzcyBDb21wb25lbnRUYWdCdWlsZGVyIGltcGxlbWVudHMgQ29tcG9uZW50LkNvbXBvbmVudFRhZ0J1aWxkZXIge1xuICBwdWJsaWMgaXNEeW5hbWljOiBPcHRpb248Ym9vbGVhbj4gPSBudWxsO1xuICBwdWJsaWMgaXNTdGF0aWM6IE9wdGlvbjxib29sZWFuPiA9IG51bGw7XG4gIHB1YmxpYyBzdGF0aWNUYWdOYW1lOiBPcHRpb248c3RyaW5nPiA9IG51bGw7XG4gIHB1YmxpYyBkeW5hbWljVGFnTmFtZTogT3B0aW9uPEJhc2VsaW5lU3ludGF4LkFueUV4cHJlc3Npb24+ID0gbnVsbDtcblxuICBnZXREeW5hbWljKCk6IE1heWJlPEJhc2VsaW5lU3ludGF4LkFueUV4cHJlc3Npb24+IHtcbiAgICBpZiAodGhpcy5pc0R5bmFtaWMpIHtcbiAgICAgIHJldHVybiB0aGlzLmR5bmFtaWNUYWdOYW1lO1xuICAgIH1cbiAgfVxuXG4gIGdldFN0YXRpYygpOiBNYXliZTxzdHJpbmc+IHtcbiAgICBpZiAodGhpcy5pc1N0YXRpYykge1xuICAgICAgcmV0dXJuIHRoaXMuc3RhdGljVGFnTmFtZTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWModGFnTmFtZTogc3RyaW5nKSB7XG4gICAgdGhpcy5pc1N0YXRpYyA9IHRydWU7XG4gICAgdGhpcy5zdGF0aWNUYWdOYW1lID0gdGFnTmFtZTtcbiAgfVxuXG4gIGR5bmFtaWModGFnTmFtZTogRnVuY3Rpb25FeHByZXNzaW9uPHN0cmluZz4pIHtcbiAgICB0aGlzLmlzRHluYW1pYyA9IHRydWU7XG4gICAgdGhpcy5keW5hbWljVGFnTmFtZSA9IFsnZnVuY3Rpb24nLCB0YWdOYW1lXTtcbiAgfVxufVxuXG5jbGFzcyBDb21wb25lbnRBdHRyc0J1aWxkZXIgaW1wbGVtZW50cyBDb21wb25lbnQuQ29tcG9uZW50QXR0cnNCdWlsZGVyIHtcbiAgcHJpdmF0ZSBidWZmZXI6IFdpcmVGb3JtYXQuU3RhdGVtZW50cy5BdHRyaWJ1dGVbXSA9IFtdO1xuXG4gIHN0YXRpYyhuYW1lOiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICB0aGlzLmJ1ZmZlci5wdXNoKFsnc3RhdGljLWF0dHInLCBuYW1lLCB2YWx1ZSwgbnVsbF0pO1xuICB9XG5cbiAgZHluYW1pYyhuYW1lOiBzdHJpbmcsIHZhbHVlOiBGdW5jdGlvbkV4cHJlc3Npb248c3RyaW5nPikge1xuICAgIHRoaXMuYnVmZmVyLnB1c2goWydkeW5hbWljLWF0dHInLCBuYW1lLCBbJ2Z1bmN0aW9uJywgdmFsdWVdLCBudWxsXSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIENvbXBvbmVudEJ1aWxkZXIgaW1wbGVtZW50cyBJQ29tcG9uZW50QnVpbGRlciB7XG4gIHByaXZhdGUgZW52OiBFbnZpcm9ubWVudDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGJ1aWxkZXI6IE9wY29kZUJ1aWxkZXJEU0wpIHtcbiAgICB0aGlzLmVudiA9IGJ1aWxkZXIuZW52O1xuICB9XG5cbiAgc3RhdGljKGRlZmluaXRpb246IFN0YXRpY0RlZmluaXRpb24sIGFyZ3M6IEJhc2VsaW5lU3ludGF4LkFyZ3MsIF9zeW1ib2xUYWJsZTogU3ltYm9sVGFibGUsIHNoYWRvdzogSW5saW5lQmxvY2spIHtcbiAgICB0aGlzLmJ1aWxkZXIudW5pdChiID0+IHtcbiAgICAgIGIucHV0Q29tcG9uZW50RGVmaW5pdGlvbihkZWZpbml0aW9uKTtcbiAgICAgIGIub3BlbkNvbXBvbmVudChjb21waWxlQmFzZWxpbmVBcmdzKGFyZ3MsIGIpLCBzaGFkb3cpO1xuICAgICAgYi5jbG9zZUNvbXBvbmVudCgpO1xuICAgIH0pO1xuICB9XG5cbiAgZHluYW1pYyhkZWZpbml0aW9uQXJnczogQmFzZWxpbmVTeW50YXguQXJncywgZGVmaW5pdGlvbjogRHluYW1pY0RlZmluaXRpb24sIGFyZ3M6IEJhc2VsaW5lU3ludGF4LkFyZ3MsIF9zeW1ib2xUYWJsZTogU3ltYm9sVGFibGUsIHNoYWRvdzogSW5saW5lQmxvY2spIHtcbiAgICB0aGlzLmJ1aWxkZXIudW5pdChiID0+IHtcbiAgICAgIGIucHV0QXJncyhjb21waWxlQXJncyhkZWZpbml0aW9uQXJnc1swXSwgZGVmaW5pdGlvbkFyZ3NbMV0sIGIpKTtcbiAgICAgIGIucHV0VmFsdWUoWydmdW5jdGlvbicsIGRlZmluaXRpb25dKTtcbiAgICAgIGIudGVzdCgnc2ltcGxlJyk7XG4gICAgICBiLmVudGVyKCdCRUdJTicsICdFTkQnKTtcbiAgICAgIGIubGFiZWwoJ0JFR0lOJyk7XG4gICAgICBiLmp1bXBVbmxlc3MoJ0VORCcpO1xuICAgICAgYi5wdXREeW5hbWljQ29tcG9uZW50RGVmaW5pdGlvbigpO1xuICAgICAgYi5vcGVuQ29tcG9uZW50KGNvbXBpbGVCYXNlbGluZUFyZ3MoYXJncywgYiksIHNoYWRvdyk7XG4gICAgICBiLmNsb3NlQ29tcG9uZW50KCk7XG4gICAgICBiLmxhYmVsKCdFTkQnKTtcbiAgICAgIGIuZXhpdCgpO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBidWlsZGVyPFMgZXh0ZW5kcyBTeW1ib2xUYWJsZT4oZW52OiBFbnZpcm9ubWVudCwgc3ltYm9sVGFibGU6IFMpIHtcbiAgcmV0dXJuIG5ldyBPcGNvZGVCdWlsZGVyRFNMKHN5bWJvbFRhYmxlLCBlbnYpO1xufVxuIl19