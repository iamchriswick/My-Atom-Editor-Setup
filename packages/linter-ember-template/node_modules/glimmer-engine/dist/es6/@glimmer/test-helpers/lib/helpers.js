import { tokenize } from "simple-html-tokenizer";
import { templateFactory } from "@glimmer/runtime";
import { precompile } from "@glimmer/compiler";
// For Phantom
function toObject(val) {
    if (val === null || val === undefined) {
        throw new TypeError('Object.assign cannot be called with null or undefined');
    }
    return Object(val);
}
if (typeof Object.assign !== 'function') {
    Object.assign = function (target, source) {
        let from;
        let to = toObject(target);
        let symbols;
        for (let s = 1; s < arguments.length; s++) {
            from = Object(arguments[s]);
            for (let key in from) {
                if (Object.prototype.hasOwnProperty.call(from, key)) {
                    to[key] = from[key];
                }
            }
            if (Object.getOwnPropertySymbols) {
                symbols = Object.getOwnPropertySymbols(from);
                for (let i = 0; i < symbols.length; i++) {
                    if (Object.prototype.propertyIsEnumerable.call(from, symbols[i])) {
                        to[symbols[i]] = from[symbols[i]];
                    }
                }
            }
        }
        return to;
    };
}
export const assign = Object.assign;
function isMarker(node) {
    const TextNode = window.Text;
    const Comment = window.Comment;
    if (node instanceof Comment && node.textContent === '') {
        return true;
    }
    if (node instanceof TextNode && node.textContent === '') {
        return true;
    }
    return false;
}
export function compile(string, options) {
    let js = precompile(string, options);
    let factory = templateFactory(JSON.parse(js));
    return factory.create(options.env);
}
export function compileLayout(string, options) {
    return compile(string, options).asLayout();
}
export function equalInnerHTML(fragment, html, msg) {
    let actualHTML = normalizeInnerHTML(fragment.innerHTML);
    QUnit.push(actualHTML === html, actualHTML, html, msg);
}
export function equalHTML(node, html) {
    let fragment;
    if (!node.nodeType && node.length) {
        fragment = document.createDocumentFragment();
        while (node[0]) {
            fragment.appendChild(node[0]);
        }
    }
    else {
        fragment = node;
    }
    let div = document.createElement("div");
    div.appendChild(fragment.cloneNode(true));
    equalInnerHTML(div, html);
}
function generateTokens(divOrHTML) {
    let div;
    if (typeof divOrHTML === 'string') {
        div = document.createElement("div");
        div.innerHTML = divOrHTML;
    }
    else {
        div = divOrHTML;
    }
    return { tokens: tokenize(div.innerHTML), html: div.innerHTML };
}
export function equalTokens(fragment, html, message = null) {
    if (fragment.fragment) {
        fragment = fragment.fragment;
    }
    if (html.fragment) {
        html = html.fragment;
    }
    let fragTokens = generateTokens(fragment);
    let htmlTokens = generateTokens(html);
    function normalizeTokens(token) {
        if (token.type === 'StartTag') {
            token.attributes = token.attributes.sort(function (a, b) {
                if (a[0] > b[0]) {
                    return 1;
                }
                if (a[0] < b[0]) {
                    return -1;
                }
                return 0;
            });
        }
    }
    fragTokens.tokens.forEach(normalizeTokens);
    htmlTokens.tokens.forEach(normalizeTokens);
    // let msg = "Expected: " + htmlTokens.html + "; Actual: " + fragTokens.html;
    // if (message) { msg += " (" + message + ")"; }
    let equiv = QUnit.equiv(fragTokens.tokens, htmlTokens.tokens);
    if (equiv && fragTokens.html !== htmlTokens.html) {
        QUnit.deepEqual(fragTokens.tokens, htmlTokens.tokens, message);
    }
    else {
        QUnit.push(QUnit.equiv(fragTokens.tokens, htmlTokens.tokens), fragTokens.html, htmlTokens.html, message);
    }
    // deepEqual(fragTokens.tokens, htmlTokens.tokens, msg);
}
export function generateSnapshot(element) {
    let snapshot = [];
    let node = element.firstChild;
    while (node) {
        if (!isMarker(node)) {
            snapshot.push(node);
        }
        node = node.nextSibling;
    }
    return snapshot;
}
export function equalSnapshots(a, b) {
    QUnit.strictEqual(a.length, b.length, 'Same number of nodes');
    for (let i = 0; i < b.length; i++) {
        QUnit.strictEqual(a[i], b[i], 'Nodes are the same');
    }
}
// detect side-effects of cloning svg elements in IE9-11
let ieSVGInnerHTML = (function () {
    if (typeof document === 'undefined' || !document.createElementNS) {
        return false;
    }
    let div = document.createElement('div');
    let node = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    div.appendChild(node);
    let clone = div.cloneNode(true);
    return clone.innerHTML === '<svg xmlns="http://www.w3.org/2000/svg" />';
})();
export function normalizeInnerHTML(actualHTML) {
    if (ieSVGInnerHTML) {
        // Replace `<svg xmlns="http://www.w3.org/2000/svg" height="50%" />` with `<svg height="50%"></svg>`, etc.
        // drop namespace attribute
        actualHTML = actualHTML.replace(/ xmlns="[^"]+"/, '');
        // replace self-closing elements
        actualHTML = actualHTML.replace(/<([^ >]+) [^\/>]*\/>/gi, function (tag, tagName) {
            return tag.slice(0, tag.length - 3) + '></' + tagName + '>';
        });
    }
    return actualHTML;
}
let isCheckedInputHTML;
if (typeof document === 'undefined') {
    isCheckedInputHTML = function (element) {
    };
}
else {
    // detect weird IE8 checked element string
    let checkedInput = document.createElement('input');
    checkedInput.setAttribute('checked', 'checked');
    let checkedInputString = checkedInput.outerHTML;
    isCheckedInputHTML = function (element) {
        QUnit.equal(element.outerHTML, checkedInputString);
    };
}
export { isCheckedInputHTML };
// check which property has the node's text content
let textProperty = typeof document === 'object' && document.createElement('div').textContent === undefined ? 'innerText' : 'textContent';
export function getTextContent(el) {
    // textNode
    if (el.nodeType === 3) {
        return el.nodeValue;
    }
    else {
        return el[textProperty];
    }
}
export function strip(strings) {
    return strings[0].split('\n').map(s => s.trim()).join(' ');
}
export function stripTight(strings) {
    return strings[0].split('\n').map(s => s.trim()).join('');
}
export function trimLines(strings) {
    return strings[0].trim().split('\n').map(s => s.trim()).join('\n');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkBnbGltbWVyL3Rlc3QtaGVscGVycy9saWIvaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFpQyxlQUFlLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUNsRixPQUFPLEVBQUUsVUFBVSxFQUFxQixNQUFNLG1CQUFtQixDQUFDO0FBRWxFLGNBQWM7QUFDZCxrQkFBa0IsR0FBRztJQUNuQixFQUFFLENBQUMsQ0FBQyxHQUFHLEtBQUssSUFBSSxJQUFJLEdBQUcsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sSUFBSSxTQUFTLENBQUMsdURBQXVELENBQUMsQ0FBQztJQUMvRSxDQUFDO0lBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNyQixDQUFDO0FBRUQsRUFBRSxDQUFDLENBQUMsT0FBTyxNQUFNLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDeEMsTUFBTSxDQUFDLE1BQU0sR0FBRyxVQUFTLE1BQU0sRUFBRSxNQUFNO1FBQ3JDLElBQUksSUFBSSxDQUFDO1FBQ1QsSUFBSSxFQUFFLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzFCLElBQUksT0FBTyxDQUFDO1FBRVosR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDMUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUU1QixHQUFHLENBQUMsQ0FBQyxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsU0FBUyxD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LENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzdELENBQUM7QUFFRCxNQUFNLHFCQUFxQixPQUE2QjtJQUN0RCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUM1RCxDQUFDO0FBRUQsTUFBTSxvQkFBb0IsT0FBNkI7SUFDckQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDckUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHRva2VuaXplIH0gZnJvbSBcInNpbXBsZS1odG1sLXRva2VuaXplclwiO1xuaW1wb3J0IHsgRW52aXJvbm1lbnQsIFRlbXBsYXRlLCBMYXlvdXQsIHRlbXBsYXRlRmFjdG9yeSB9IGZyb20gXCJAZ2xpbW1lci9ydW50aW1lXCI7XG5pbXBvcnQgeyBwcmVjb21waWxlLCBQcmVjb21waWxlT3B0aW9ucyB9IGZyb20gXCJAZ2xpbW1lci9jb21waWxlclwiO1xuXG4vLyBGb3IgUGhhbnRvbVxuZnVuY3Rpb24gdG9PYmplY3QodmFsKSB7XG4gIGlmICh2YWwgPT09IG51bGwgfHwgdmFsID09PSB1bmRlZmluZWQpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdPYmplY3QuYXNzaWduIGNhbm5vdCBiZSBjYWxsZWQgd2l0aCBudWxsIG9yIHVuZGVmaW5lZCcpO1xuICB9XG5cbiAgcmV0dXJuIE9iamVjdCh2YWwpO1xufVxuXG5pZiAodHlwZW9mIE9iamVjdC5hc3NpZ24gIT09ICdmdW5jdGlvbicpIHtcbiAgT2JqZWN0LmFzc2lnbiA9IGZ1bmN0aW9uKHRhcmdldCwgc291cmNlKSB7XG4gICAgbGV0IGZyb207XG4gICAgbGV0IHRvID0gdG9PYmplY3QodGFyZ2V0KTtcbiAgICBsZXQgc3ltYm9scztcblxuICAgIGZvciAobGV0IHMgPSAxOyBzIDwgYXJndW1lbnRzLmxlbmd0aDsgcysrKSB7XG4gICAgICBmcm9tID0gT2JqZWN0KGFyZ3VtZW50c1tzXSk7XG5cbiAgICAgIGZvciAobGV0IGtleSBpbiBmcm9tKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZnJvbSwga2V5KSkge1xuICAgICAgICAgIHRvW2tleV0gPSBmcm9tW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHtcbiAgICAgICAgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZnJvbSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3ltYm9scy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoZnJvbSwgc3ltYm9sc1tpXSkpIHtcbiAgICAgICAgICAgIHRvW3N5bWJvbHNbaV1dID0gZnJvbVtzeW1ib2xzW2ldXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdG87XG4gIH07XG59XG5cbmV4cG9ydCBjb25zdCBhc3NpZ24gPSBPYmplY3QuYXNzaWduO1xuXG5mdW5jdGlvbiBpc01hcmtlcihub2RlKSB7XG4gIGNvbnN0IFRleHROb2RlID0gKDxhbnk+d2luZG93KS5UZXh0O1xuICBjb25zdCBDb21tZW50ID0gKDxhbnk+d2luZG93KS5Db21tZW50O1xuXG4gIGlmIChub2RlIGluc3RhbmNlb2YgQ29tbWVudCAmJiBub2RlLnRleHRDb250ZW50ID09PSAnJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgaWYgKG5vZGUgaW5zdGFuY2VvZiBUZXh0Tm9kZSAmJiBub2RlLnRleHRDb250ZW50ID09PSAnJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRlc3RDb21waWxlT3B0aW9uczxUPiBleHRlbmRzIFByZWNvbXBpbGVPcHRpb25zPFQ+IHtcbiAgZW52OiBFbnZpcm9ubWVudDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBpbGU8VD4oc3RyaW5nOiBzdHJpbmcsIG9wdGlvbnM6IFRlc3RDb21waWxlT3B0aW9uczxUPik6IFRlbXBsYXRlPFQ+IHtcbiAgbGV0IGpzID0gcHJlY29tcGlsZShzdHJpbmcsIG9wdGlvbnMpO1xuICBsZXQgZmFjdG9yeSA9IHRlbXBsYXRlRmFjdG9yeTxUPihKU09OLnBhcnNlKGpzKSk7XG4gIHJldHVybiBmYWN0b3J5LmNyZWF0ZShvcHRpb25zLmVudik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21waWxlTGF5b3V0PFQ+KHN0cmluZzogc3RyaW5nLCBvcHRpb25zOiBUZXN0Q29tcGlsZU9wdGlvbnM8VD4pOiBMYXlvdXQge1xuICByZXR1cm4gY29tcGlsZShzdHJpbmcsIG9wdGlvbnMpLmFzTGF5b3V0KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbElubmVySFRNTChmcmFnbWVudCwgaHRtbCwgbXNnPykge1xuICBsZXQgYWN0dWFsSFRNTCA9IG5vcm1hbGl6ZUlubmVySFRNTChmcmFnbWVudC5pbm5lckhUTUwpO1xuICBRVW5pdC5wdXNoKGFjdHVhbEhUTUwgPT09IGh0bWwsIGFjdHVhbEhUTUwsIGh0bWwsIG1zZyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbEhUTUwobm9kZSwgaHRtbCkge1xuICBsZXQgZnJhZ21lbnQ7XG4gIGlmICghbm9kZS5ub2RlVHlwZSAmJiBub2RlLmxlbmd0aCkge1xuICAgIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHdoaWxlIChub2RlWzBdKSB7XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChub2RlWzBdKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZnJhZ21lbnQgPSBub2RlO1xuICB9XG5cbiAgbGV0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gIGRpdi5hcHBlbmRDaGlsZChmcmFnbWVudC5jbG9uZU5vZGUodHJ1ZSkpO1xuXG4gIGVxdWFsSW5uZXJIVE1MKGRpdiwgaHRtbCk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVG9rZW5zKGRpdk9ySFRNTCkge1xuICBsZXQgZGl2O1xuICBpZiAodHlwZW9mIGRpdk9ySFRNTCA9PT0gJ3N0cmluZycpIHtcbiAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIGRpdi5pbm5lckhUTUwgPSBkaXZPckhUTUw7XG4gIH0gZWxzZSB7XG4gICAgZGl2ID0gZGl2T3JIVE1MO1xuICB9XG5cbiAgcmV0dXJuIHsgdG9rZW5zOiB0b2tlbml6ZShkaXYuaW5uZXJIVE1MKSwgaHRtbDogZGl2LmlubmVySFRNTCB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXF1YWxUb2tlbnMoZnJhZ21lbnQsIGh0bWwsIG1lc3NhZ2U9bnVsbCkge1xuICBpZiAoZnJhZ21lbnQuZnJhZ21lbnQpIHsgZnJhZ21lbnQgPSBmcmFnbWVudC5mcmFnbWVudDsgfVxuICBpZiAoaHRtbC5mcmFnbWVudCkgeyBodG1sID0gaHRtbC5mcmFnbWVudDsgfVxuXG4gIGxldCBmcmFnVG9rZW5zID0gZ2VuZXJhdGVUb2tlbnMoZnJhZ21lbnQpO1xuICBsZXQgaHRtbFRva2VucyA9IGdlbmVyYXRlVG9rZW5zKGh0bWwpO1xuXG4gIGZ1bmN0aW9uIG5vcm1hbGl6ZVRva2Vucyh0b2tlbikge1xuICAgIGlmICh0b2tlbi50eXBlID09PSAnU3RhcnRUYWcnKSB7XG4gICAgICB0b2tlbi5hdHRyaWJ1dGVzID0gdG9rZW4uYXR0cmlidXRlcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgaWYgKGFbMF0gPiBiWzBdKSB7IHJldHVybiAxOyB9XG4gICAgICAgIGlmIChhWzBdIDwgYlswXSkgeyByZXR1cm4gLTE7IH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBmcmFnVG9rZW5zLnRva2Vucy5mb3JFYWNoKG5vcm1hbGl6ZVRva2Vucyk7XG4gIGh0bWxUb2tlbnMudG9rZW5zLmZvckVhY2gobm9ybWFsaXplVG9rZW5zKTtcblxuICAvLyBsZXQgbXNnID0gXCJFeHBlY3RlZDogXCIgKyBodG1sVG9rZW5zLmh0bWwgKyBcIjsgQWN0dWFsOiBcIiArIGZyYWdUb2tlbnMuaHRtbDtcblxuICAvLyBpZiAobWVzc2FnZSkgeyBtc2cgKz0gXCIgKFwiICsgbWVzc2FnZSArIFwiKVwiOyB9XG5cbiAgbGV0IGVxdWl2ID0gUVVuaXQuZXF1aXYoZnJhZ1Rva2Vucy50b2tlbnMsIGh0bWxUb2tlbnMudG9rZW5zKTtcblxuICBpZiAoZXF1aXYgJiYgZnJhZ1Rva2Vucy5odG1sICE9PSBodG1sVG9rZW5zLmh0bWwpIHtcbiAgICBRVW5pdC5kZWVwRXF1YWwoZnJhZ1Rva2Vucy50b2tlbnMsIGh0bWxUb2tlbnMudG9rZW5zLCBtZXNzYWdlKTtcbiAgfSBlbHNlIHtcbiAgICBRVW5pdC5wdXNoKFFVbml0LmVxdWl2KGZyYWdUb2tlbnMudG9rZW5zLCBodG1sVG9rZW5zLnRva2VucyksIGZyYWdUb2tlbnMuaHRtbCwgaHRtbFRva2Vucy5odG1sLCBtZXNzYWdlKTtcbiAgfVxuXG4gIC8vIGRlZXBFcXVhbChmcmFnVG9rZW5zLnRva2VucywgaHRtbFRva2Vucy50b2tlbnMsIG1zZyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVNuYXBzaG90KGVsZW1lbnQpIHtcbiAgbGV0IHNuYXBzaG90ID0gW107XG4gIGxldCBub2RlID0gZWxlbWVudC5maXJzdENoaWxkO1xuXG4gIHdoaWxlIChub2RlKSB7XG4gICAgaWYgKCFpc01hcmtlcihub2RlKSkge1xuICAgICAgc25hcHNob3QucHVzaChub2RlKTtcbiAgICB9XG4gICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XG4gIH1cblxuICByZXR1cm4gc25hcHNob3Q7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlcXVhbFNuYXBzaG90cyhhLCBiKSB7XG4gIFFVbml0LnN0cmljdEVxdWFsKGEubGVuZ3RoLCBiLmxlbmd0aCwgJ1NhbWUgbnVtYmVyIG9mIG5vZGVzJyk7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYi5sZW5ndGg7IGkrKykge1xuICAgIFFVbml0LnN0cmljdEVxdWFsKGFbaV0sIGJbaV0sICdOb2RlcyBhcmUgdGhlIHNhbWUnKTtcbiAgfVxufVxuXG4vLyBkZXRlY3Qgc2lkZS1lZmZlY3RzIG9mIGNsb25pbmcgc3ZnIGVsZW1lbnRzIGluIElFOS0xMVxubGV0IGllU1ZHSW5uZXJIVE1MID0gKGZ1bmN0aW9uICgpIHtcbiAgaWYgKHR5cGVvZiBkb2N1bWVudCA9PT0gJ3VuZGVmaW5lZCcgfHwgIWRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGxldCBub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdzdmcnKTtcbiAgZGl2LmFwcGVuZENoaWxkKG5vZGUpO1xuICBsZXQgY2xvbmUgPSA8SFRNTERpdkVsZW1lbnQ+ZGl2LmNsb25lTm9kZSh0cnVlKTtcbiAgcmV0dXJuIGNsb25lLmlubmVySFRNTCA9PT0gJzxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIC8+Jztcbn0pKCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVJbm5lckhUTUwoYWN0dWFsSFRNTCkge1xuICBpZiAoaWVTVkdJbm5lckhUTUwpIHtcbiAgICAvLyBSZXBsYWNlIGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiBoZWlnaHQ9XCI1MCVcIiAvPmAgd2l0aCBgPHN2ZyBoZWlnaHQ9XCI1MCVcIj48L3N2Zz5gLCBldGMuXG4gICAgLy8gZHJvcCBuYW1lc3BhY2UgYXR0cmlidXRlXG4gICAgYWN0dWFsSFRNTCA9IGFjdHVhbEhUTUwucmVwbGFjZSgvIHhtbG5zPVwiW15cIl0rXCIvLCAnJyk7XG4gICAgLy8gcmVwbGFjZSBzZWxmLWNsb3NpbmcgZWxlbWVudHNcbiAgICBhY3R1YWxIVE1MID0gYWN0dWFsSFRNTC5yZXBsYWNlKC88KFteID5dKykgW15cXC8+XSpcXC8+L2dpLCBmdW5jdGlvbih0YWcsIHRhZ05hbWUpIHtcbiAgICAgIHJldHVybiB0YWcuc2xpY2UoMCwgdGFnLmxlbmd0aCAtIDMpICsgJz48LycgKyB0YWdOYW1lICsgJz4nO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGFjdHVhbEhUTUw7XG59XG5cbmxldCBpc0NoZWNrZWRJbnB1dEhUTUw7XG5cbmlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICd1bmRlZmluZWQnKSB7XG4gIGlzQ2hlY2tlZElucHV0SFRNTCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgfTtcbn0gZWxzZSB7XG4gIC8vIGRldGVjdCB3ZWlyZCBJRTggY2hlY2tlZCBlbGVtZW50IHN0cmluZ1xuICBsZXQgY2hlY2tlZElucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgY2hlY2tlZElucHV0LnNldEF0dHJpYnV0ZSgnY2hlY2tlZCcsICdjaGVja2VkJyk7XG4gIGxldCBjaGVja2VkSW5wdXRTdHJpbmcgPSBjaGVja2VkSW5wdXQub3V0ZXJIVE1MO1xuXG4gIGlzQ2hlY2tlZElucHV0SFRNTCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBRVW5pdC5lcXVhbChlbGVtZW50Lm91dGVySFRNTCwgY2hlY2tlZElucHV0U3RyaW5nKTtcbiAgfTtcbn1cblxuZXhwb3J0IHsgaXNDaGVja2VkSW5wdXRIVE1MIH07XG5cbi8vIGNoZWNrIHdoaWNoIHByb3BlcnR5IGhhcyB0aGUgbm9kZSdzIHRleHQgY29udGVudFxubGV0IHRleHRQcm9wZXJ0eSA9IHR5cGVvZiBkb2N1bWVudCA9PT0gJ29iamVjdCcgJiYgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykudGV4dENvbnRlbnQgPT09IHVuZGVmaW5lZCA/ICdpbm5lclRleHQnIDogJ3RleHRDb250ZW50JztcbmV4cG9ydCBmdW5jdGlvbiBnZXRUZXh0Q29udGVudChlbCkge1xuICAvLyB0ZXh0Tm9kZVxuICBpZiAoZWwubm9kZVR5cGUgPT09IDMpIHtcbiAgICByZXR1cm4gZWwubm9kZVZhbHVlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBlbFt0ZXh0UHJvcGVydHldO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzdHJpcChzdHJpbmdzOiBUZW1wbGF0ZVN0cmluZ3NBcnJheSkge1xuICByZXR1cm4gc3RyaW5nc1swXS5zcGxpdCgnXFxuJykubWFwKHMgPT4gcy50cmltKCkpLmpvaW4oJyAnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmlwVGlnaHQoc3RyaW5nczogVGVtcGxhdGVTdHJpbmdzQXJyYXkpIHtcbiAgcmV0dXJuIHN0cmluZ3NbMF0uc3BsaXQoJ1xcbicpLm1hcChzID0+IHMudHJpbSgpKS5qb2luKCcnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRyaW1MaW5lcyhzdHJpbmdzOiBUZW1wbGF0ZVN0cmluZ3NBcnJheSkge1xuICByZXR1cm4gc3RyaW5nc1swXS50cmltKCkuc3BsaXQoJ1xcbicpLm1hcChzID0+IHMudHJpbSgpKS5qb2luKCdcXG4nKTtcbn1cbiJdfQ==